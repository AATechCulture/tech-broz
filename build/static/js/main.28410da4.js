/*! For license information please see main.28410da4.js.LICENSE.txt */
(()=>{var g={347:g=>{"use strict";var t={single_source_shortest_paths:function(g,e,I){var n={},C={};C[e]=0;var i,l,o,s,a,r,c,A=t.PriorityQueue.make();for(A.push(e,0);!A.empty();)for(o in l=(i=A.pop()).value,s=i.cost,a=g[l]||{})a.hasOwnProperty(o)&&(r=s+a[o],c=C[o],("undefined"===typeof C[o]||c>r)&&(C[o]=r,A.push(o,r),n[o]=l));if("undefined"!==typeof I&&"undefined"===typeof C[I]){var d=["Could not find a path from ",e," to ",I,"."].join("");throw new Error(d)}return n},extract_shortest_path_from_predecessor_list:function(g,t){for(var e=[],I=t;I;)e.push(I),g[I],I=g[I];return e.reverse(),e},find_path:function(g,e,I){var n=t.single_source_shortest_paths(g,e,I);return t.extract_shortest_path_from_predecessor_list(n,I)},PriorityQueue:{make:function(g){var e,I=t.PriorityQueue,n={};for(e in g=g||{},I)I.hasOwnProperty(e)&&(n[e]=I[e]);return n.queue=[],n.sorter=g.sorter||I.default_sorter,n},default_sorter:function(g,t){return g.cost-t.cost},push:function(g,t){var e={value:g,cost:t};this.queue.push(e),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return 0===this.queue.length}}};g.exports=t},228:function(g,t){!function(g){"use strict";var t="1.9.4";function e(g){var t,e,I,n;for(e=1,I=arguments.length;e<I;e++)for(t in n=arguments[e])g[t]=n[t];return g}var I=Object.create||function(){function g(){}return function(t){return g.prototype=t,new g}}();function n(g,t){var e=Array.prototype.slice;if(g.bind)return g.bind.apply(g,e.call(arguments,1));var I=e.call(arguments,2);return function(){return g.apply(t,I.length?I.concat(e.call(arguments)):arguments)}}var C=0;function i(g){return"_leaflet_id"in g||(g._leaflet_id=++C),g._leaflet_id}function l(g,t,e){var I,n,C,i;return i=function(){I=!1,n&&(C.apply(e,n),n=!1)},C=function(){I?n=arguments:(g.apply(e,arguments),setTimeout(i,t),I=!0)},C}function o(g,t,e){var I=t[1],n=t[0],C=I-n;return g===I&&e?g:((g-n)%C+C)%C+n}function s(){return!1}function a(g,t){if(!1===t)return g;var e=Math.pow(10,void 0===t?6:t);return Math.round(g*e)/e}function r(g){return g.trim?g.trim():g.replace(/^\s+|\s+$/g,"")}function c(g){return r(g).split(/\s+/)}function A(g,t){for(var e in Object.prototype.hasOwnProperty.call(g,"options")||(g.options=g.options?I(g.options):{}),t)g.options[e]=t[e];return g.options}function d(g,t,e){var I=[];for(var n in g)I.push(encodeURIComponent(e?n.toUpperCase():n)+"="+encodeURIComponent(g[n]));return(t&&-1!==t.indexOf("?")?"&":"?")+I.join("&")}var u=/\{ *([\w_ -]+) *\}/g;function h(g,t){return g.replace(u,(function(g,e){var I=t[e];if(void 0===I)throw new Error("No value provided for variable "+g);return"function"===typeof I&&(I=I(t)),I}))}var m=Array.isArray||function(g){return"[object Array]"===Object.prototype.toString.call(g)};function Z(g,t){for(var e=0;e<g.length;e++)if(g[e]===t)return e;return-1}var b="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function G(g){return window["webkit"+g]||window["moz"+g]||window["ms"+g]}var p=0;function y(g){var t=+new Date,e=Math.max(0,16-(t-p));return p=t+e,window.setTimeout(g,e)}var B=window.requestAnimationFrame||G("RequestAnimationFrame")||y,V=window.cancelAnimationFrame||G("CancelAnimationFrame")||G("CancelRequestAnimationFrame")||function(g){window.clearTimeout(g)};function W(g,t,e){if(!e||B!==y)return B.call(window,n(g,t));g.call(t)}function S(g){g&&V.call(window,g)}var R={__proto__:null,extend:e,create:I,bind:n,get lastId(){return C},stamp:i,throttle:l,wrapNum:o,falseFn:s,formatNum:a,trim:r,splitWords:c,setOptions:A,getParamString:d,template:h,isArray:m,indexOf:Z,emptyImageUrl:b,requestFn:B,cancelFn:V,requestAnimFrame:W,cancelAnimFrame:S};function f(){}function X(g){if("undefined"!==typeof L&&L&&L.Mixin){g=m(g)?g:[g];for(var t=0;t<g.length;t++)g[t]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}f.extend=function(g){var t=function(){A(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},n=t.__super__=this.prototype,C=I(n);for(var i in C.constructor=t,t.prototype=C,this)Object.prototype.hasOwnProperty.call(this,i)&&"prototype"!==i&&"__super__"!==i&&(t[i]=this[i]);return g.statics&&e(t,g.statics),g.includes&&(X(g.includes),e.apply(null,[C].concat(g.includes))),e(C,g),delete C.statics,delete C.includes,C.options&&(C.options=n.options?I(n.options):{},e(C.options,g.options)),C._initHooks=[],C.callInitHooks=function(){if(!this._initHooksCalled){n.callInitHooks&&n.callInitHooks.call(this),this._initHooksCalled=!0;for(var g=0,t=C._initHooks.length;g<t;g++)C._initHooks[g].call(this)}},t},f.include=function(g){var t=this.prototype.options;return e(this.prototype,g),g.options&&(this.prototype.options=t,this.mergeOptions(g.options)),this},f.mergeOptions=function(g){return e(this.prototype.options,g),this},f.addInitHook=function(g){var t=Array.prototype.slice.call(arguments,1),e="function"===typeof g?g:function(){this[g].apply(this,t)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(e),this};var J={on:function(g,t,e){if("object"===typeof g)for(var I in g)this._on(I,g[I],t);else for(var n=0,C=(g=c(g)).length;n<C;n++)this._on(g[n],t,e);return this},off:function(g,t,e){if(arguments.length)if("object"===typeof g)for(var I in g)this._off(I,g[I],t);else{g=c(g);for(var n=1===arguments.length,C=0,i=g.length;C<i;C++)n?this._off(g[C]):this._off(g[C],t,e)}else delete this._events;return this},_on:function(g,t,e,I){if("function"===typeof t){if(!1===this._listens(g,t,e)){e===this&&(e=void 0);var n={fn:t,ctx:e};I&&(n.once=!0),this._events=this._events||{},this._events[g]=this._events[g]||[],this._events[g].push(n)}}else console.warn("wrong listener type: "+typeof t)},_off:function(g,t,e){var I,n,C;if(this._events&&(I=this._events[g]))if(1!==arguments.length)if("function"===typeof t){var i=this._listens(g,t,e);if(!1!==i){var l=I[i];this._firingCount&&(l.fn=s,this._events[g]=I=I.slice()),I.splice(i,1)}}else console.warn("wrong listener type: "+typeof t);else{if(this._firingCount)for(n=0,C=I.length;n<C;n++)I[n].fn=s;delete this._events[g]}},fire:function(g,t,I){if(!this.listens(g,I))return this;var n=e({},t,{type:g,target:this,sourceTarget:t&&t.sourceTarget||this});if(this._events){var C=this._events[g];if(C){this._firingCount=this._firingCount+1||1;for(var i=0,l=C.length;i<l;i++){var o=C[i],s=o.fn;o.once&&this.off(g,s,o.ctx),s.call(o.ctx||this,n)}this._firingCount--}}return I&&this._propagateEvent(n),this},listens:function(g,t,e,I){"string"!==typeof g&&console.warn('"string" type argument expected');var n=t;"function"!==typeof t&&(I=!!t,n=void 0,e=void 0);var C=this._events&&this._events[g];if(C&&C.length&&!1!==this._listens(g,n,e))return!0;if(I)for(var i in this._eventParents)if(this._eventParents[i].listens(g,t,e,I))return!0;return!1},_listens:function(g,t,e){if(!this._events)return!1;var I=this._events[g]||[];if(!t)return!!I.length;e===this&&(e=void 0);for(var n=0,C=I.length;n<C;n++)if(I[n].fn===t&&I[n].ctx===e)return n;return!1},once:function(g,t,e){if("object"===typeof g)for(var I in g)this._on(I,g[I],t,!0);else for(var n=0,C=(g=c(g)).length;n<C;n++)this._on(g[n],t,e,!0);return this},addEventParent:function(g){return this._eventParents=this._eventParents||{},this._eventParents[i(g)]=g,this},removeEventParent:function(g){return this._eventParents&&delete this._eventParents[i(g)],this},_propagateEvent:function(g){for(var t in this._eventParents)this._eventParents[t].fire(g.type,e({layer:g.target,propagatedFrom:g.target},g),!0)}};J.addEventListener=J.on,J.removeEventListener=J.clearAllEventListeners=J.off,J.addOneTimeEventListener=J.once,J.fireEvent=J.fire,J.hasEventListeners=J.listens;var v=f.extend(J);function k(g,t,e){this.x=e?Math.round(g):g,this.y=e?Math.round(t):t}var Y=Math.trunc||function(g){return g>0?Math.floor(g):Math.ceil(g)};function H(g,t,e){return g instanceof k?g:m(g)?new k(g[0],g[1]):void 0===g||null===g?g:"object"===typeof g&&"x"in g&&"y"in g?new k(g.x,g.y):new k(g,t,e)}function w(g,t){if(g)for(var e=t?[g,t]:g,I=0,n=e.length;I<n;I++)this.extend(e[I])}function N(g,t){return!g||g instanceof w?g:new w(g,t)}function K(g,t){if(g)for(var e=t?[g,t]:g,I=0,n=e.length;I<n;I++)this.extend(e[I])}function F(g,t){return g instanceof K?g:new K(g,t)}function E(g,t,e){if(isNaN(g)||isNaN(t))throw new Error("Invalid LatLng object: ("+g+", "+t+")");this.lat=+g,this.lng=+t,void 0!==e&&(this.alt=+e)}function z(g,t,e){return g instanceof E?g:m(g)&&"object"!==typeof g[0]?3===g.length?new E(g[0],g[1],g[2]):2===g.length?new E(g[0],g[1]):null:void 0===g||null===g?g:"object"===typeof g&&"lat"in g?new E(g.lat,"lng"in g?g.lng:g.lon,g.alt):void 0===t?null:new E(g,t,e)}k.prototype={clone:function(){return new k(this.x,this.y)},add:function(g){return this.clone()._add(H(g))},_add:function(g){return this.x+=g.x,this.y+=g.y,this},subtract:function(g){return this.clone()._subtract(H(g))},_subtract:function(g){return this.x-=g.x,this.y-=g.y,this},divideBy:function(g){return this.clone()._divideBy(g)},_divideBy:function(g){return this.x/=g,this.y/=g,this},multiplyBy:function(g){return this.clone()._multiplyBy(g)},_multiplyBy:function(g){return this.x*=g,this.y*=g,this},scaleBy:function(g){return new k(this.x*g.x,this.y*g.y)},unscaleBy:function(g){return new k(this.x/g.x,this.y/g.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=Y(this.x),this.y=Y(this.y),this},distanceTo:function(g){var t=(g=H(g)).x-this.x,e=g.y-this.y;return Math.sqrt(t*t+e*e)},equals:function(g){return(g=H(g)).x===this.x&&g.y===this.y},contains:function(g){return g=H(g),Math.abs(g.x)<=Math.abs(this.x)&&Math.abs(g.y)<=Math.abs(this.y)},toString:function(){return"Point("+a(this.x)+", "+a(this.y)+")"}},w.prototype={extend:function(g){var t,e;if(!g)return this;if(g instanceof k||"number"===typeof g[0]||"x"in g)t=e=H(g);else if(t=(g=N(g)).min,e=g.max,!t||!e)return this;return this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(e.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(e.y,this.max.y)):(this.min=t.clone(),this.max=e.clone()),this},getCenter:function(g){return H((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,g)},getBottomLeft:function(){return H(this.min.x,this.max.y)},getTopRight:function(){return H(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(g){var t,e;return(g="number"===typeof g[0]||g instanceof k?H(g):N(g))instanceof w?(t=g.min,e=g.max):t=e=g,t.x>=this.min.x&&e.x<=this.max.x&&t.y>=this.min.y&&e.y<=this.max.y},intersects:function(g){g=N(g);var t=this.min,e=this.max,I=g.min,n=g.max,C=n.x>=t.x&&I.x<=e.x,i=n.y>=t.y&&I.y<=e.y;return C&&i},overlaps:function(g){g=N(g);var t=this.min,e=this.max,I=g.min,n=g.max,C=n.x>t.x&&I.x<e.x,i=n.y>t.y&&I.y<e.y;return C&&i},isValid:function(){return!(!this.min||!this.max)},pad:function(g){var t=this.min,e=this.max,I=Math.abs(t.x-e.x)*g,n=Math.abs(t.y-e.y)*g;return N(H(t.x-I,t.y-n),H(e.x+I,e.y+n))},equals:function(g){return!!g&&(g=N(g),this.min.equals(g.getTopLeft())&&this.max.equals(g.getBottomRight()))}},K.prototype={extend:function(g){var t,e,I=this._southWest,n=this._northEast;if(g instanceof E)t=g,e=g;else{if(!(g instanceof K))return g?this.extend(z(g)||F(g)):this;if(t=g._southWest,e=g._northEast,!t||!e)return this}return I||n?(I.lat=Math.min(t.lat,I.lat),I.lng=Math.min(t.lng,I.lng),n.lat=Math.max(e.lat,n.lat),n.lng=Math.max(e.lng,n.lng)):(this._southWest=new E(t.lat,t.lng),this._northEast=new E(e.lat,e.lng)),this},pad:function(g){var t=this._southWest,e=this._northEast,I=Math.abs(t.lat-e.lat)*g,n=Math.abs(t.lng-e.lng)*g;return new K(new E(t.lat-I,t.lng-n),new E(e.lat+I,e.lng+n))},getCenter:function(){return new E((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new E(this.getNorth(),this.getWest())},getSouthEast:function(){return new E(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(g){g="number"===typeof g[0]||g instanceof E||"lat"in g?z(g):F(g);var t,e,I=this._southWest,n=this._northEast;return g instanceof K?(t=g.getSouthWest(),e=g.getNorthEast()):t=e=g,t.lat>=I.lat&&e.lat<=n.lat&&t.lng>=I.lng&&e.lng<=n.lng},intersects:function(g){g=F(g);var t=this._southWest,e=this._northEast,I=g.getSouthWest(),n=g.getNorthEast(),C=n.lat>=t.lat&&I.lat<=e.lat,i=n.lng>=t.lng&&I.lng<=e.lng;return C&&i},overlaps:function(g){g=F(g);var t=this._southWest,e=this._northEast,I=g.getSouthWest(),n=g.getNorthEast(),C=n.lat>t.lat&&I.lat<e.lat,i=n.lng>t.lng&&I.lng<e.lng;return C&&i},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(g,t){return!!g&&(g=F(g),this._southWest.equals(g.getSouthWest(),t)&&this._northEast.equals(g.getNorthEast(),t))},isValid:function(){return!(!this._southWest||!this._northEast)}},E.prototype={equals:function(g,t){return!!g&&(g=z(g),Math.max(Math.abs(this.lat-g.lat),Math.abs(this.lng-g.lng))<=(void 0===t?1e-9:t))},toString:function(g){return"LatLng("+a(this.lat,g)+", "+a(this.lng,g)+")"},distanceTo:function(g){return M.distance(this,z(g))},wrap:function(){return M.wrapLatLng(this)},toBounds:function(g){var t=180*g/40075017,e=t/Math.cos(Math.PI/180*this.lat);return F([this.lat-t,this.lng-e],[this.lat+t,this.lng+e])},clone:function(){return new E(this.lat,this.lng,this.alt)}};var x={latLngToPoint:function(g,t){var e=this.projection.project(g),I=this.scale(t);return this.transformation._transform(e,I)},pointToLatLng:function(g,t){var e=this.scale(t),I=this.transformation.untransform(g,e);return this.projection.unproject(I)},project:function(g){return this.projection.project(g)},unproject:function(g){return this.projection.unproject(g)},scale:function(g){return 256*Math.pow(2,g)},zoom:function(g){return Math.log(g/256)/Math.LN2},getProjectedBounds:function(g){if(this.infinite)return null;var t=this.projection.bounds,e=this.scale(g);return new w(this.transformation.transform(t.min,e),this.transformation.transform(t.max,e))},infinite:!1,wrapLatLng:function(g){var t=this.wrapLng?o(g.lng,this.wrapLng,!0):g.lng;return new E(this.wrapLat?o(g.lat,this.wrapLat,!0):g.lat,t,g.alt)},wrapLatLngBounds:function(g){var t=g.getCenter(),e=this.wrapLatLng(t),I=t.lat-e.lat,n=t.lng-e.lng;if(0===I&&0===n)return g;var C=g.getSouthWest(),i=g.getNorthEast();return new K(new E(C.lat-I,C.lng-n),new E(i.lat-I,i.lng-n))}},M=e({},x,{wrapLng:[-180,180],R:6371e3,distance:function(g,t){var e=Math.PI/180,I=g.lat*e,n=t.lat*e,C=Math.sin((t.lat-g.lat)*e/2),i=Math.sin((t.lng-g.lng)*e/2),l=C*C+Math.cos(I)*Math.cos(n)*i*i,o=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l));return this.R*o}}),U=6378137,T={R:U,MAX_LATITUDE:85.0511287798,project:function(g){var t=Math.PI/180,e=this.MAX_LATITUDE,I=Math.max(Math.min(e,g.lat),-e),n=Math.sin(I*t);return new k(this.R*g.lng*t,this.R*Math.log((1+n)/(1-n))/2)},unproject:function(g){var t=180/Math.PI;return new E((2*Math.atan(Math.exp(g.y/this.R))-Math.PI/2)*t,g.x*t/this.R)},bounds:function(){var g=U*Math.PI;return new w([-g,-g],[g,g])}()};function Q(g,t,e,I){if(m(g))return this._a=g[0],this._b=g[1],this._c=g[2],void(this._d=g[3]);this._a=g,this._b=t,this._c=e,this._d=I}function D(g,t,e,I){return new Q(g,t,e,I)}Q.prototype={transform:function(g,t){return this._transform(g.clone(),t)},_transform:function(g,t){return t=t||1,g.x=t*(this._a*g.x+this._b),g.y=t*(this._c*g.y+this._d),g},untransform:function(g,t){return t=t||1,new k((g.x/t-this._b)/this._a,(g.y/t-this._d)/this._c)}};var _=e({},M,{code:"EPSG:3857",projection:T,transformation:function(){var g=.5/(Math.PI*T.R);return D(g,.5,-g,.5)}()}),j=e({},_,{code:"EPSG:900913"});function P(g){return document.createElementNS("http://www.w3.org/2000/svg",g)}function O(g,t){var e,I,n,C,i,l,o="";for(e=0,n=g.length;e<n;e++){for(I=0,C=(i=g[e]).length;I<C;I++)o+=(I?"L":"M")+(l=i[I]).x+" "+l.y;o+=t?Ng.svg?"z":"x":""}return o||"M0 0"}var q=document.documentElement.style,$="ActiveXObject"in window,gg=$&&!document.addEventListener,tg="msLaunchUri"in navigator&&!("documentMode"in document),eg=wg("webkit"),Ig=wg("android"),ng=wg("android 2")||wg("android 3"),Cg=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),ig=Ig&&wg("Google")&&Cg<537&&!("AudioNode"in window),lg=!!window.opera,og=!tg&&wg("chrome"),sg=wg("gecko")&&!eg&&!lg&&!$,ag=!og&&wg("safari"),rg=wg("phantom"),cg="OTransition"in q,Ag=0===navigator.platform.indexOf("Win"),dg=$&&"transition"in q,ug="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!ng,hg="MozPerspective"in q,mg=!window.L_DISABLE_3D&&(dg||ug||hg)&&!cg&&!rg,Zg="undefined"!==typeof orientation||wg("mobile"),bg=Zg&&eg,Gg=Zg&&ug,pg=!window.PointerEvent&&window.MSPointerEvent,yg=!(!window.PointerEvent&&!pg),Bg="ontouchstart"in window||!!window.TouchEvent,Vg=!window.L_NO_TOUCH&&(Bg||yg),Wg=Zg&&lg,Sg=Zg&&sg,Rg=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,fg=function(){var g=!1;try{var t=Object.defineProperty({},"passive",{get:function(){g=!0}});window.addEventListener("testPassiveEventSupport",s,t),window.removeEventListener("testPassiveEventSupport",s,t)}catch(e){}return g}(),Xg=!!document.createElement("canvas").getContext,Jg=!(!document.createElementNS||!P("svg").createSVGRect),vg=!!Jg&&function(){var g=document.createElement("div");return g.innerHTML="<svg/>","http://www.w3.org/2000/svg"===(g.firstChild&&g.firstChild.namespaceURI)}(),kg=!Jg&&function(){try{var g=document.createElement("div");g.innerHTML='<v:shape adj="1"/>';var t=g.firstChild;return t.style.behavior="url(#default#VML)",t&&"object"===typeof t.adj}catch(e){return!1}}(),Yg=0===navigator.platform.indexOf("Mac"),Hg=0===navigator.platform.indexOf("Linux");function wg(g){return navigator.userAgent.toLowerCase().indexOf(g)>=0}var Ng={ie:$,ielt9:gg,edge:tg,webkit:eg,android:Ig,android23:ng,androidStock:ig,opera:lg,chrome:og,gecko:sg,safari:ag,phantom:rg,opera12:cg,win:Ag,ie3d:dg,webkit3d:ug,gecko3d:hg,any3d:mg,mobile:Zg,mobileWebkit:bg,mobileWebkit3d:Gg,msPointer:pg,pointer:yg,touch:Vg,touchNative:Bg,mobileOpera:Wg,mobileGecko:Sg,retina:Rg,passiveEvents:fg,canvas:Xg,svg:Jg,vml:kg,inlineSvg:vg,mac:Yg,linux:Hg},Kg=Ng.msPointer?"MSPointerDown":"pointerdown",Fg=Ng.msPointer?"MSPointerMove":"pointermove",Eg=Ng.msPointer?"MSPointerUp":"pointerup",zg=Ng.msPointer?"MSPointerCancel":"pointercancel",xg={touchstart:Kg,touchmove:Fg,touchend:Eg,touchcancel:zg},Lg={touchstart:qg,touchmove:Og,touchend:Og,touchcancel:Og},Mg={},Ug=!1;function Tg(g,t,e){return"touchstart"===t&&Pg(),Lg[t]?(e=Lg[t].bind(this,e),g.addEventListener(xg[t],e,!1),e):(console.warn("wrong event specified:",t),s)}function Qg(g,t,e){xg[t]?g.removeEventListener(xg[t],e,!1):console.warn("wrong event specified:",t)}function Dg(g){Mg[g.pointerId]=g}function _g(g){Mg[g.pointerId]&&(Mg[g.pointerId]=g)}function jg(g){delete Mg[g.pointerId]}function Pg(){Ug||(document.addEventListener(Kg,Dg,!0),document.addEventListener(Fg,_g,!0),document.addEventListener(Eg,jg,!0),document.addEventListener(zg,jg,!0),Ug=!0)}function Og(g,t){if(t.pointerType!==(t.MSPOINTER_TYPE_MOUSE||"mouse")){for(var e in t.touches=[],Mg)t.touches.push(Mg[e]);t.changedTouches=[t],g(t)}}function qg(g,t){t.MSPOINTER_TYPE_TOUCH&&t.pointerType===t.MSPOINTER_TYPE_TOUCH&&Dt(t),Og(g,t)}function $g(g){var t,e,I={};for(e in g)t=g[e],I[e]=t&&t.bind?t.bind(g):t;return g=I,I.type="dblclick",I.detail=2,I.isTrusted=!1,I._simulated=!0,I}var gt=200;function tt(g,t){g.addEventListener("dblclick",t);var e,I=0;function n(g){if(1===g.detail){if("mouse"!==g.pointerType&&(!g.sourceCapabilities||g.sourceCapabilities.firesTouchEvents)){var n=jt(g);if(!n.some((function(g){return g instanceof HTMLLabelElement&&g.attributes.for}))||n.some((function(g){return g instanceof HTMLInputElement||g instanceof HTMLSelectElement}))){var C=Date.now();C-I<=gt?2===++e&&t($g(g)):e=1,I=C}}}else e=g.detail}return g.addEventListener("click",n),{dblclick:t,simDblclick:n}}function et(g,t){g.removeEventListener("dblclick",t.dblclick),g.removeEventListener("click",t.simDblclick)}var It,nt,Ct,it,lt,ot=Wt(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),st=Wt(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),at="webkitTransition"===st||"OTransition"===st?st+"End":"transitionend";function rt(g){return"string"===typeof g?document.getElementById(g):g}function ct(g,t){var e=g.style[t]||g.currentStyle&&g.currentStyle[t];if((!e||"auto"===e)&&document.defaultView){var I=document.defaultView.getComputedStyle(g,null);e=I?I[t]:null}return"auto"===e?null:e}function At(g,t,e){var I=document.createElement(g);return I.className=t||"",e&&e.appendChild(I),I}function dt(g){var t=g.parentNode;t&&t.removeChild(g)}function ut(g){for(;g.firstChild;)g.removeChild(g.firstChild)}function ht(g){var t=g.parentNode;t&&t.lastChild!==g&&t.appendChild(g)}function mt(g){var t=g.parentNode;t&&t.firstChild!==g&&t.insertBefore(g,t.firstChild)}function Zt(g,t){if(void 0!==g.classList)return g.classList.contains(t);var e=yt(g);return e.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(e)}function bt(g,t){if(void 0!==g.classList)for(var e=c(t),I=0,n=e.length;I<n;I++)g.classList.add(e[I]);else if(!Zt(g,t)){var C=yt(g);pt(g,(C?C+" ":"")+t)}}function Gt(g,t){void 0!==g.classList?g.classList.remove(t):pt(g,r((" "+yt(g)+" ").replace(" "+t+" "," ")))}function pt(g,t){void 0===g.className.baseVal?g.className=t:g.className.baseVal=t}function yt(g){return g.correspondingElement&&(g=g.correspondingElement),void 0===g.className.baseVal?g.className:g.className.baseVal}function Bt(g,t){"opacity"in g.style?g.style.opacity=t:"filter"in g.style&&Vt(g,t)}function Vt(g,t){var e=!1,I="DXImageTransform.Microsoft.Alpha";try{e=g.filters.item(I)}catch(n){if(1===t)return}t=Math.round(100*t),e?(e.Enabled=100!==t,e.Opacity=t):g.style.filter+=" progid:"+I+"(opacity="+t+")"}function Wt(g){for(var t=document.documentElement.style,e=0;e<g.length;e++)if(g[e]in t)return g[e];return!1}function St(g,t,e){var I=t||new k(0,0);g.style[ot]=(Ng.ie3d?"translate("+I.x+"px,"+I.y+"px)":"translate3d("+I.x+"px,"+I.y+"px,0)")+(e?" scale("+e+")":"")}function Rt(g,t){g._leaflet_pos=t,Ng.any3d?St(g,t):(g.style.left=t.x+"px",g.style.top=t.y+"px")}function ft(g){return g._leaflet_pos||new k(0,0)}if("onselectstart"in document)It=function(){Kt(window,"selectstart",Dt)},nt=function(){Et(window,"selectstart",Dt)};else{var Xt=Wt(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);It=function(){if(Xt){var g=document.documentElement.style;Ct=g[Xt],g[Xt]="none"}},nt=function(){Xt&&(document.documentElement.style[Xt]=Ct,Ct=void 0)}}function Jt(){Kt(window,"dragstart",Dt)}function vt(){Et(window,"dragstart",Dt)}function kt(g){for(;-1===g.tabIndex;)g=g.parentNode;g.style&&(Yt(),it=g,lt=g.style.outlineStyle,g.style.outlineStyle="none",Kt(window,"keydown",Yt))}function Yt(){it&&(it.style.outlineStyle=lt,it=void 0,lt=void 0,Et(window,"keydown",Yt))}function Ht(g){do{g=g.parentNode}while((!g.offsetWidth||!g.offsetHeight)&&g!==document.body);return g}function wt(g){var t=g.getBoundingClientRect();return{x:t.width/g.offsetWidth||1,y:t.height/g.offsetHeight||1,boundingClientRect:t}}var Nt={__proto__:null,TRANSFORM:ot,TRANSITION:st,TRANSITION_END:at,get:rt,getStyle:ct,create:At,remove:dt,empty:ut,toFront:ht,toBack:mt,hasClass:Zt,addClass:bt,removeClass:Gt,setClass:pt,getClass:yt,setOpacity:Bt,testProp:Wt,setTransform:St,setPosition:Rt,getPosition:ft,get disableTextSelection(){return It},get enableTextSelection(){return nt},disableImageDrag:Jt,enableImageDrag:vt,preventOutline:kt,restoreOutline:Yt,getSizedParentNode:Ht,getScale:wt};function Kt(g,t,e,I){if(t&&"object"===typeof t)for(var n in t)Lt(g,n,t[n],e);else for(var C=0,i=(t=c(t)).length;C<i;C++)Lt(g,t[C],e,I);return this}var Ft="_leaflet_events";function Et(g,t,e,I){if(1===arguments.length)zt(g),delete g[Ft];else if(t&&"object"===typeof t)for(var n in t)Mt(g,n,t[n],e);else if(t=c(t),2===arguments.length)zt(g,(function(g){return-1!==Z(t,g)}));else for(var C=0,i=t.length;C<i;C++)Mt(g,t[C],e,I);return this}function zt(g,t){for(var e in g[Ft]){var I=e.split(/\d/)[0];t&&!t(I)||Mt(g,I,null,null,e)}}var xt={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Lt(g,t,e,I){var n=t+i(e)+(I?"_"+i(I):"");if(g[Ft]&&g[Ft][n])return this;var C=function(t){return e.call(I||g,t||window.event)},l=C;!Ng.touchNative&&Ng.pointer&&0===t.indexOf("touch")?C=Tg(g,t,C):Ng.touch&&"dblclick"===t?C=tt(g,C):"addEventListener"in g?"touchstart"===t||"touchmove"===t||"wheel"===t||"mousewheel"===t?g.addEventListener(xt[t]||t,C,!!Ng.passiveEvents&&{passive:!1}):"mouseenter"===t||"mouseleave"===t?(C=function(t){t=t||window.event,$t(g,t)&&l(t)},g.addEventListener(xt[t],C,!1)):g.addEventListener(t,l,!1):g.attachEvent("on"+t,C),g[Ft]=g[Ft]||{},g[Ft][n]=C}function Mt(g,t,e,I,n){n=n||t+i(e)+(I?"_"+i(I):"");var C=g[Ft]&&g[Ft][n];if(!C)return this;!Ng.touchNative&&Ng.pointer&&0===t.indexOf("touch")?Qg(g,t,C):Ng.touch&&"dblclick"===t?et(g,C):"removeEventListener"in g?g.removeEventListener(xt[t]||t,C,!1):g.detachEvent("on"+t,C),g[Ft][n]=null}function Ut(g){return g.stopPropagation?g.stopPropagation():g.originalEvent?g.originalEvent._stopped=!0:g.cancelBubble=!0,this}function Tt(g){return Lt(g,"wheel",Ut),this}function Qt(g){return Kt(g,"mousedown touchstart dblclick contextmenu",Ut),g._leaflet_disable_click=!0,this}function Dt(g){return g.preventDefault?g.preventDefault():g.returnValue=!1,this}function _t(g){return Dt(g),Ut(g),this}function jt(g){if(g.composedPath)return g.composedPath();for(var t=[],e=g.target;e;)t.push(e),e=e.parentNode;return t}function Pt(g,t){if(!t)return new k(g.clientX,g.clientY);var e=wt(t),I=e.boundingClientRect;return new k((g.clientX-I.left)/e.x-t.clientLeft,(g.clientY-I.top)/e.y-t.clientTop)}var Ot=Ng.linux&&Ng.chrome?window.devicePixelRatio:Ng.mac?3*window.devicePixelRatio:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function qt(g){return Ng.edge?g.wheelDeltaY/2:g.deltaY&&0===g.deltaMode?-g.deltaY/Ot:g.deltaY&&1===g.deltaMode?20*-g.deltaY:g.deltaY&&2===g.deltaMode?60*-g.deltaY:g.deltaX||g.deltaZ?0:g.wheelDelta?(g.wheelDeltaY||g.wheelDelta)/2:g.detail&&Math.abs(g.detail)<32765?20*-g.detail:g.detail?g.detail/-32765*60:0}function $t(g,t){var e=t.relatedTarget;if(!e)return!0;try{for(;e&&e!==g;)e=e.parentNode}catch(I){return!1}return e!==g}var ge={__proto__:null,on:Kt,off:Et,stopPropagation:Ut,disableScrollPropagation:Tt,disableClickPropagation:Qt,preventDefault:Dt,stop:_t,getPropagationPath:jt,getMousePosition:Pt,getWheelDelta:qt,isExternalTarget:$t,addListener:Kt,removeListener:Et},te=v.extend({run:function(g,t,e,I){this.stop(),this._el=g,this._inProgress=!0,this._duration=e||.25,this._easeOutPower=1/Math.max(I||.5,.2),this._startPos=ft(g),this._offset=t.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=W(this._animate,this),this._step()},_step:function(g){var t=+new Date-this._startTime,e=1e3*this._duration;t<e?this._runFrame(this._easeOut(t/e),g):(this._runFrame(1),this._complete())},_runFrame:function(g,t){var e=this._startPos.add(this._offset.multiplyBy(g));t&&e._round(),Rt(this._el,e),this.fire("step")},_complete:function(){S(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(g){return 1-Math.pow(1-g,this._easeOutPower)}}),ee=v.extend({options:{crs:_,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(g,t){t=A(this,t),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(g),this._initLayout(),this._onResize=n(this._onResize,this),this._initEvents(),t.maxBounds&&this.setMaxBounds(t.maxBounds),void 0!==t.zoom&&(this._zoom=this._limitZoom(t.zoom)),t.center&&void 0!==t.zoom&&this.setView(z(t.center),t.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=st&&Ng.any3d&&!Ng.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Kt(this._proxy,at,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(g,t,I){return t=void 0===t?this._zoom:this._limitZoom(t),g=this._limitCenter(z(g),t,this.options.maxBounds),I=I||{},this._stop(),this._loaded&&!I.reset&&!0!==I&&(void 0!==I.animate&&(I.zoom=e({animate:I.animate},I.zoom),I.pan=e({animate:I.animate,duration:I.duration},I.pan)),this._zoom!==t?this._tryAnimatedZoom&&this._tryAnimatedZoom(g,t,I.zoom):this._tryAnimatedPan(g,I.pan))?(clearTimeout(this._sizeTimer),this):(this._resetView(g,t,I.pan&&I.pan.noMoveStart),this)},setZoom:function(g,t){return this._loaded?this.setView(this.getCenter(),g,{zoom:t}):(this._zoom=g,this)},zoomIn:function(g,t){return g=g||(Ng.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+g,t)},zoomOut:function(g,t){return g=g||(Ng.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-g,t)},setZoomAround:function(g,t,e){var I=this.getZoomScale(t),n=this.getSize().divideBy(2),C=(g instanceof k?g:this.latLngToContainerPoint(g)).subtract(n).multiplyBy(1-1/I),i=this.containerPointToLatLng(n.add(C));return this.setView(i,t,{zoom:e})},_getBoundsCenterZoom:function(g,t){t=t||{},g=g.getBounds?g.getBounds():F(g);var e=H(t.paddingTopLeft||t.padding||[0,0]),I=H(t.paddingBottomRight||t.padding||[0,0]),n=this.getBoundsZoom(g,!1,e.add(I));if((n="number"===typeof t.maxZoom?Math.min(t.maxZoom,n):n)===1/0)return{center:g.getCenter(),zoom:n};var C=I.subtract(e).divideBy(2),i=this.project(g.getSouthWest(),n),l=this.project(g.getNorthEast(),n);return{center:this.unproject(i.add(l).divideBy(2).add(C),n),zoom:n}},fitBounds:function(g,t){if(!(g=F(g)).isValid())throw new Error("Bounds are not valid.");var e=this._getBoundsCenterZoom(g,t);return this.setView(e.center,e.zoom,t)},fitWorld:function(g){return this.fitBounds([[-90,-180],[90,180]],g)},panTo:function(g,t){return this.setView(g,this._zoom,{pan:t})},panBy:function(g,t){if(t=t||{},!(g=H(g).round()).x&&!g.y)return this.fire("moveend");if(!0!==t.animate&&!this.getSize().contains(g))return this._resetView(this.unproject(this.project(this.getCenter()).add(g)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new te,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),t.noMoveStart||this.fire("movestart"),!1!==t.animate){bt(this._mapPane,"leaflet-pan-anim");var e=this._getMapPanePos().subtract(g).round();this._panAnim.run(this._mapPane,e,t.duration||.25,t.easeLinearity)}else this._rawPanBy(g),this.fire("move").fire("moveend");return this},flyTo:function(g,t,e){if(!1===(e=e||{}).animate||!Ng.any3d)return this.setView(g,t,e);this._stop();var I=this.project(this.getCenter()),n=this.project(g),C=this.getSize(),i=this._zoom;g=z(g),t=void 0===t?i:t;var l=Math.max(C.x,C.y),o=l*this.getZoomScale(i,t),s=n.distanceTo(I)||1,a=1.42,r=a*a;function c(g){var t=(o*o-l*l+(g?-1:1)*r*r*s*s)/(2*(g?o:l)*r*s),e=Math.sqrt(t*t+1)-t;return e<1e-9?-18:Math.log(e)}function A(g){return(Math.exp(g)-Math.exp(-g))/2}function d(g){return(Math.exp(g)+Math.exp(-g))/2}function u(g){return A(g)/d(g)}var h=c(0);function m(g){return l*(d(h)/d(h+a*g))}function Z(g){return l*(d(h)*u(h+a*g)-A(h))/r}function b(g){return 1-Math.pow(1-g,1.5)}var G=Date.now(),p=(c(1)-h)/a,y=e.duration?1e3*e.duration:1e3*p*.8;function B(){var e=(Date.now()-G)/y,C=b(e)*p;e<=1?(this._flyToFrame=W(B,this),this._move(this.unproject(I.add(n.subtract(I).multiplyBy(Z(C)/s)),i),this.getScaleZoom(l/m(C),i),{flyTo:!0})):this._move(g,t)._moveEnd(!0)}return this._moveStart(!0,e.noMoveStart),B.call(this),this},flyToBounds:function(g,t){var e=this._getBoundsCenterZoom(g,t);return this.flyTo(e.center,e.zoom,t)},setMaxBounds:function(g){return g=F(g),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),g.isValid()?(this.options.maxBounds=g,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(g){var t=this.options.minZoom;return this.options.minZoom=g,this._loaded&&t!==g&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(g):this},setMaxZoom:function(g){var t=this.options.maxZoom;return this.options.maxZoom=g,this._loaded&&t!==g&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(g):this},panInsideBounds:function(g,t){this._enforcingBounds=!0;var e=this.getCenter(),I=this._limitCenter(e,this._zoom,F(g));return e.equals(I)||this.panTo(I,t),this._enforcingBounds=!1,this},panInside:function(g,t){var e=H((t=t||{}).paddingTopLeft||t.padding||[0,0]),I=H(t.paddingBottomRight||t.padding||[0,0]),n=this.project(this.getCenter()),C=this.project(g),i=this.getPixelBounds(),l=N([i.min.add(e),i.max.subtract(I)]),o=l.getSize();if(!l.contains(C)){this._enforcingBounds=!0;var s=C.subtract(l.getCenter()),a=l.extend(C).getSize().subtract(o);n.x+=s.x<0?-a.x:a.x,n.y+=s.y<0?-a.y:a.y,this.panTo(this.unproject(n),t),this._enforcingBounds=!1}return this},invalidateSize:function(g){if(!this._loaded)return this;g=e({animate:!1,pan:!0},!0===g?{animate:!0}:g);var t=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var I=this.getSize(),C=t.divideBy(2).round(),i=I.divideBy(2).round(),l=C.subtract(i);return l.x||l.y?(g.animate&&g.pan?this.panBy(l):(g.pan&&this._rawPanBy(l),this.fire("move"),g.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(n(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:t,newSize:I})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(g){if(g=this._locateOptions=e({timeout:1e4,watch:!1},g),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var t=n(this._handleGeolocationResponse,this),I=n(this._handleGeolocationError,this);return g.watch?this._locationWatchId=navigator.geolocation.watchPosition(t,I,g):navigator.geolocation.getCurrentPosition(t,I,g),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(g){if(this._container._leaflet_id){var t=g.code,e=g.message||(1===t?"permission denied":2===t?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:t,message:"Geolocation error: "+e+"."})}},_handleGeolocationResponse:function(g){if(this._container._leaflet_id){var t=new E(g.coords.latitude,g.coords.longitude),e=t.toBounds(2*g.coords.accuracy),I=this._locateOptions;if(I.setView){var n=this.getBoundsZoom(e);this.setView(t,I.maxZoom?Math.min(n,I.maxZoom):n)}var C={latlng:t,bounds:e,timestamp:g.timestamp};for(var i in g.coords)"number"===typeof g.coords[i]&&(C[i]=g.coords[i]);this.fire("locationfound",C)}},addHandler:function(g,t){if(!t)return this;var e=this[g]=new t(this);return this._handlers.push(e),this.options[g]&&e.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=void 0,this._containerId=void 0}var g;for(g in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),dt(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(S(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[g].remove();for(g in this._panes)dt(this._panes[g]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(g,t){var e=At("div","leaflet-pane"+(g?" leaflet-"+g.replace("Pane","")+"-pane":""),t||this._mapPane);return g&&(this._panes[g]=e),e},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var g=this.getPixelBounds();return new K(this.unproject(g.getBottomLeft()),this.unproject(g.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(g,t,e){g=F(g),e=H(e||[0,0]);var I=this.getZoom()||0,n=this.getMinZoom(),C=this.getMaxZoom(),i=g.getNorthWest(),l=g.getSouthEast(),o=this.getSize().subtract(e),s=N(this.project(l,I),this.project(i,I)).getSize(),a=Ng.any3d?this.options.zoomSnap:1,r=o.x/s.x,c=o.y/s.y,A=t?Math.max(r,c):Math.min(r,c);return I=this.getScaleZoom(A,I),a&&(I=Math.round(I/(a/100))*(a/100),I=t?Math.ceil(I/a)*a:Math.floor(I/a)*a),Math.max(n,Math.min(C,I))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new k(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(g,t){var e=this._getTopLeftPoint(g,t);return new w(e,e.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(g){return this.options.crs.getProjectedBounds(void 0===g?this.getZoom():g)},getPane:function(g){return"string"===typeof g?this._panes[g]:g},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(g,t){var e=this.options.crs;return t=void 0===t?this._zoom:t,e.scale(g)/e.scale(t)},getScaleZoom:function(g,t){var e=this.options.crs;t=void 0===t?this._zoom:t;var I=e.zoom(g*e.scale(t));return isNaN(I)?1/0:I},project:function(g,t){return t=void 0===t?this._zoom:t,this.options.crs.latLngToPoint(z(g),t)},unproject:function(g,t){return t=void 0===t?this._zoom:t,this.options.crs.pointToLatLng(H(g),t)},layerPointToLatLng:function(g){var t=H(g).add(this.getPixelOrigin());return this.unproject(t)},latLngToLayerPoint:function(g){return this.project(z(g))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(g){return this.options.crs.wrapLatLng(z(g))},wrapLatLngBounds:function(g){return this.options.crs.wrapLatLngBounds(F(g))},distance:function(g,t){return this.options.crs.distance(z(g),z(t))},containerPointToLayerPoint:function(g){return H(g).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(g){return H(g).add(this._getMapPanePos())},containerPointToLatLng:function(g){var t=this.containerPointToLayerPoint(H(g));return this.layerPointToLatLng(t)},latLngToContainerPoint:function(g){return this.layerPointToContainerPoint(this.latLngToLayerPoint(z(g)))},mouseEventToContainerPoint:function(g){return Pt(g,this._container)},mouseEventToLayerPoint:function(g){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(g))},mouseEventToLatLng:function(g){return this.layerPointToLatLng(this.mouseEventToLayerPoint(g))},_initContainer:function(g){var t=this._container=rt(g);if(!t)throw new Error("Map container not found.");if(t._leaflet_id)throw new Error("Map container is already initialized.");Kt(t,"scroll",this._onScroll,this),this._containerId=i(t)},_initLayout:function(){var g=this._container;this._fadeAnimated=this.options.fadeAnimation&&Ng.any3d,bt(g,"leaflet-container"+(Ng.touch?" leaflet-touch":"")+(Ng.retina?" leaflet-retina":"")+(Ng.ielt9?" leaflet-oldie":"")+(Ng.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var t=ct(g,"position");"absolute"!==t&&"relative"!==t&&"fixed"!==t&&"sticky"!==t&&(g.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var g=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Rt(this._mapPane,new k(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(bt(g.markerPane,"leaflet-zoom-hide"),bt(g.shadowPane,"leaflet-zoom-hide"))},_resetView:function(g,t,e){Rt(this._mapPane,new k(0,0));var I=!this._loaded;this._loaded=!0,t=this._limitZoom(t),this.fire("viewprereset");var n=this._zoom!==t;this._moveStart(n,e)._move(g,t)._moveEnd(n),this.fire("viewreset"),I&&this.fire("load")},_moveStart:function(g,t){return g&&this.fire("zoomstart"),t||this.fire("movestart"),this},_move:function(g,t,e,I){void 0===t&&(t=this._zoom);var n=this._zoom!==t;return this._zoom=t,this._lastCenter=g,this._pixelOrigin=this._getNewPixelOrigin(g),I?e&&e.pinch&&this.fire("zoom",e):((n||e&&e.pinch)&&this.fire("zoom",e),this.fire("move",e)),this},_moveEnd:function(g){return g&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return S(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(g){Rt(this._mapPane,this._getMapPanePos().subtract(g))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(g){this._targets={},this._targets[i(this._container)]=this;var t=g?Et:Kt;t(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&t(window,"resize",this._onResize,this),Ng.any3d&&this.options.transform3DLimit&&(g?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){S(this._resizeRequest),this._resizeRequest=W((function(){this.invalidateSize({debounceMoveend:!0})}),this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var g=this._getMapPanePos();Math.max(Math.abs(g.x),Math.abs(g.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(g,t){for(var e,I=[],n="mouseout"===t||"mouseover"===t,C=g.target||g.srcElement,l=!1;C;){if((e=this._targets[i(C)])&&("click"===t||"preclick"===t)&&this._draggableMoved(e)){l=!0;break}if(e&&e.listens(t,!0)){if(n&&!$t(C,g))break;if(I.push(e),n)break}if(C===this._container)break;C=C.parentNode}return I.length||l||n||!this.listens(t,!0)||(I=[this]),I},_isClickDisabled:function(g){for(;g&&g!==this._container;){if(g._leaflet_disable_click)return!0;g=g.parentNode}},_handleDOMEvent:function(g){var t=g.target||g.srcElement;if(!(!this._loaded||t._leaflet_disable_events||"click"===g.type&&this._isClickDisabled(t))){var e=g.type;"mousedown"===e&&kt(t),this._fireDOMEvent(g,e)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(g,t,I){if("click"===g.type){var n=e({},g);n.type="preclick",this._fireDOMEvent(n,n.type,I)}var C=this._findEventTargets(g,t);if(I){for(var i=[],l=0;l<I.length;l++)I[l].listens(t,!0)&&i.push(I[l]);C=i.concat(C)}if(C.length){"contextmenu"===t&&Dt(g);var o=C[0],s={originalEvent:g};if("keypress"!==g.type&&"keydown"!==g.type&&"keyup"!==g.type){var a=o.getLatLng&&(!o._radius||o._radius<=10);s.containerPoint=a?this.latLngToContainerPoint(o.getLatLng()):this.mouseEventToContainerPoint(g),s.layerPoint=this.containerPointToLayerPoint(s.containerPoint),s.latlng=a?o.getLatLng():this.layerPointToLatLng(s.layerPoint)}for(l=0;l<C.length;l++)if(C[l].fire(t,s,!0),s.originalEvent._stopped||!1===C[l].options.bubblingMouseEvents&&-1!==Z(this._mouseEvents,t))return}},_draggableMoved:function(g){return(g=g.dragging&&g.dragging.enabled()?g:this).dragging&&g.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var g=0,t=this._handlers.length;g<t;g++)this._handlers[g].disable()},whenReady:function(g,t){return this._loaded?g.call(t||this,{target:this}):this.on("load",g,t),this},_getMapPanePos:function(){return ft(this._mapPane)||new k(0,0)},_moved:function(){var g=this._getMapPanePos();return g&&!g.equals([0,0])},_getTopLeftPoint:function(g,t){return(g&&void 0!==t?this._getNewPixelOrigin(g,t):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(g,t){var e=this.getSize()._divideBy(2);return this.project(g,t)._subtract(e)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(g,t,e){var I=this._getNewPixelOrigin(e,t);return this.project(g,t)._subtract(I)},_latLngBoundsToNewLayerBounds:function(g,t,e){var I=this._getNewPixelOrigin(e,t);return N([this.project(g.getSouthWest(),t)._subtract(I),this.project(g.getNorthWest(),t)._subtract(I),this.project(g.getSouthEast(),t)._subtract(I),this.project(g.getNorthEast(),t)._subtract(I)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(g){return this.latLngToLayerPoint(g).subtract(this._getCenterLayerPoint())},_limitCenter:function(g,t,e){if(!e)return g;var I=this.project(g,t),n=this.getSize().divideBy(2),C=new w(I.subtract(n),I.add(n)),i=this._getBoundsOffset(C,e,t);return Math.abs(i.x)<=1&&Math.abs(i.y)<=1?g:this.unproject(I.add(i),t)},_limitOffset:function(g,t){if(!t)return g;var e=this.getPixelBounds(),I=new w(e.min.add(g),e.max.add(g));return g.add(this._getBoundsOffset(I,t))},_getBoundsOffset:function(g,t,e){var I=N(this.project(t.getNorthEast(),e),this.project(t.getSouthWest(),e)),n=I.min.subtract(g.min),C=I.max.subtract(g.max);return new k(this._rebound(n.x,-C.x),this._rebound(n.y,-C.y))},_rebound:function(g,t){return g+t>0?Math.round(g-t)/2:Math.max(0,Math.ceil(g))-Math.max(0,Math.floor(t))},_limitZoom:function(g){var t=this.getMinZoom(),e=this.getMaxZoom(),I=Ng.any3d?this.options.zoomSnap:1;return I&&(g=Math.round(g/I)*I),Math.max(t,Math.min(e,g))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Gt(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(g,t){var e=this._getCenterOffset(g)._trunc();return!(!0!==(t&&t.animate)&&!this.getSize().contains(e))&&(this.panBy(e,t),!0)},_createAnimProxy:function(){var g=this._proxy=At("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(g),this.on("zoomanim",(function(g){var t=ot,e=this._proxy.style[t];St(this._proxy,this.project(g.center,g.zoom),this.getZoomScale(g.zoom,1)),e===this._proxy.style[t]&&this._animatingZoom&&this._onZoomTransitionEnd()}),this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){dt(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var g=this.getCenter(),t=this.getZoom();St(this._proxy,this.project(g,t),this.getZoomScale(t,1))},_catchTransitionEnd:function(g){this._animatingZoom&&g.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(g,t,e){if(this._animatingZoom)return!0;if(e=e||{},!this._zoomAnimated||!1===e.animate||this._nothingToAnimate()||Math.abs(t-this._zoom)>this.options.zoomAnimationThreshold)return!1;var I=this.getZoomScale(t),n=this._getCenterOffset(g)._divideBy(1-1/I);return!(!0!==e.animate&&!this.getSize().contains(n))&&(W((function(){this._moveStart(!0,e.noMoveStart||!1)._animateZoom(g,t,!0)}),this),!0)},_animateZoom:function(g,t,e,I){this._mapPane&&(e&&(this._animatingZoom=!0,this._animateToCenter=g,this._animateToZoom=t,bt(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:g,zoom:t,noUpdate:I}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(n(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Gt(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Ie(g,t){return new ee(g,t)}var ne=f.extend({options:{position:"topright"},initialize:function(g){A(this,g)},getPosition:function(){return this.options.position},setPosition:function(g){var t=this._map;return t&&t.removeControl(this),this.options.position=g,t&&t.addControl(this),this},getContainer:function(){return this._container},addTo:function(g){this.remove(),this._map=g;var t=this._container=this.onAdd(g),e=this.getPosition(),I=g._controlCorners[e];return bt(t,"leaflet-control"),-1!==e.indexOf("bottom")?I.insertBefore(t,I.firstChild):I.appendChild(t),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(dt(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(g){this._map&&g&&g.screenX>0&&g.screenY>0&&this._map.getContainer().focus()}}),Ce=function(g){return new ne(g)};ee.include({addControl:function(g){return g.addTo(this),this},removeControl:function(g){return g.remove(),this},_initControlPos:function(){var g=this._controlCorners={},t="leaflet-",e=this._controlContainer=At("div",t+"control-container",this._container);function I(I,n){var C=t+I+" "+t+n;g[I+n]=At("div",C,e)}I("top","left"),I("top","right"),I("bottom","left"),I("bottom","right")},_clearControlPos:function(){for(var g in this._controlCorners)dt(this._controlCorners[g]);dt(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var ie=ne.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(g,t,e,I){return e<I?-1:I<e?1:0}},initialize:function(g,t,e){for(var I in A(this,e),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1,g)this._addLayer(g[I],I);for(I in t)this._addLayer(t[I],I,!0)},onAdd:function(g){this._initLayout(),this._update(),this._map=g,g.on("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(g){return ne.prototype.addTo.call(this,g),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var g=0;g<this._layers.length;g++)this._layers[g].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(g,t){return this._addLayer(g,t),this._map?this._update():this},addOverlay:function(g,t){return this._addLayer(g,t,!0),this._map?this._update():this},removeLayer:function(g){g.off("add remove",this._onLayerChange,this);var t=this._getLayer(i(g));return t&&this._layers.splice(this._layers.indexOf(t),1),this._map?this._update():this},expand:function(){bt(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var g=this._map.getSize().y-(this._container.offsetTop+50);return g<this._section.clientHeight?(bt(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=g+"px"):Gt(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Gt(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var g="leaflet-control-layers",t=this._container=At("div",g),e=this.options.collapsed;t.setAttribute("aria-haspopup",!0),Qt(t),Tt(t);var I=this._section=At("section",g+"-list");e&&(this._map.on("click",this.collapse,this),Kt(t,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var n=this._layersLink=At("a",g+"-toggle",t);n.href="#",n.title="Layers",n.setAttribute("role","button"),Kt(n,{keydown:function(g){13===g.keyCode&&this._expandSafely()},click:function(g){Dt(g),this._expandSafely()}},this),e||this.expand(),this._baseLayersList=At("div",g+"-base",I),this._separator=At("div",g+"-separator",I),this._overlaysList=At("div",g+"-overlays",I),t.appendChild(I)},_getLayer:function(g){for(var t=0;t<this._layers.length;t++)if(this._layers[t]&&i(this._layers[t].layer)===g)return this._layers[t]},_addLayer:function(g,t,e){this._map&&g.on("add remove",this._onLayerChange,this),this._layers.push({layer:g,name:t,overlay:e}),this.options.sortLayers&&this._layers.sort(n((function(g,t){return this.options.sortFunction(g.layer,t.layer,g.name,t.name)}),this)),this.options.autoZIndex&&g.setZIndex&&(this._lastZIndex++,g.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;ut(this._baseLayersList),ut(this._overlaysList),this._layerControlInputs=[];var g,t,e,I,n=0;for(e=0;e<this._layers.length;e++)I=this._layers[e],this._addItem(I),t=t||I.overlay,g=g||!I.overlay,n+=I.overlay?0:1;return this.options.hideSingleBase&&(g=g&&n>1,this._baseLayersList.style.display=g?"":"none"),this._separator.style.display=t&&g?"":"none",this},_onLayerChange:function(g){this._handlingClick||this._update();var t=this._getLayer(i(g.target)),e=t.overlay?"add"===g.type?"overlayadd":"overlayremove":"add"===g.type?"baselayerchange":null;e&&this._map.fire(e,t)},_createRadioElement:function(g,t){var e='<input type="radio" class="leaflet-control-layers-selector" name="'+g+'"'+(t?' checked="checked"':"")+"/>",I=document.createElement("div");return I.innerHTML=e,I.firstChild},_addItem:function(g){var t,e=document.createElement("label"),I=this._map.hasLayer(g.layer);g.overlay?((t=document.createElement("input")).type="checkbox",t.className="leaflet-control-layers-selector",t.defaultChecked=I):t=this._createRadioElement("leaflet-base-layers_"+i(this),I),this._layerControlInputs.push(t),t.layerId=i(g.layer),Kt(t,"click",this._onInputClick,this);var n=document.createElement("span");n.innerHTML=" "+g.name;var C=document.createElement("span");return e.appendChild(C),C.appendChild(t),C.appendChild(n),(g.overlay?this._overlaysList:this._baseLayersList).appendChild(e),this._checkDisabledLayers(),e},_onInputClick:function(){if(!this._preventClick){var g,t,e=this._layerControlInputs,I=[],n=[];this._handlingClick=!0;for(var C=e.length-1;C>=0;C--)g=e[C],t=this._getLayer(g.layerId).layer,g.checked?I.push(t):g.checked||n.push(t);for(C=0;C<n.length;C++)this._map.hasLayer(n[C])&&this._map.removeLayer(n[C]);for(C=0;C<I.length;C++)this._map.hasLayer(I[C])||this._map.addLayer(I[C]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var g,t,e=this._layerControlInputs,I=this._map.getZoom(),n=e.length-1;n>=0;n--)g=e[n],t=this._getLayer(g.layerId).layer,g.disabled=void 0!==t.options.minZoom&&I<t.options.minZoom||void 0!==t.options.maxZoom&&I>t.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var g=this._section;this._preventClick=!0,Kt(g,"click",Dt),this.expand();var t=this;setTimeout((function(){Et(g,"click",Dt),t._preventClick=!1}))}}),le=function(g,t,e){return new ie(g,t,e)},oe=ne.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(g){var t="leaflet-control-zoom",e=At("div",t+" leaflet-bar"),I=this.options;return this._zoomInButton=this._createButton(I.zoomInText,I.zoomInTitle,t+"-in",e,this._zoomIn),this._zoomOutButton=this._createButton(I.zoomOutText,I.zoomOutTitle,t+"-out",e,this._zoomOut),this._updateDisabled(),g.on("zoomend zoomlevelschange",this._updateDisabled,this),e},onRemove:function(g){g.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(g){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(g.shiftKey?3:1))},_zoomOut:function(g){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(g.shiftKey?3:1))},_createButton:function(g,t,e,I,n){var C=At("a",e,I);return C.innerHTML=g,C.href="#",C.title=t,C.setAttribute("role","button"),C.setAttribute("aria-label",t),Qt(C),Kt(C,"click",_t),Kt(C,"click",n,this),Kt(C,"click",this._refocusOnMap,this),C},_updateDisabled:function(){var g=this._map,t="leaflet-disabled";Gt(this._zoomInButton,t),Gt(this._zoomOutButton,t),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||g._zoom===g.getMinZoom())&&(bt(this._zoomOutButton,t),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||g._zoom===g.getMaxZoom())&&(bt(this._zoomInButton,t),this._zoomInButton.setAttribute("aria-disabled","true"))}});ee.mergeOptions({zoomControl:!0}),ee.addInitHook((function(){this.options.zoomControl&&(this.zoomControl=new oe,this.addControl(this.zoomControl))}));var se=function(g){return new oe(g)},ae=ne.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(g){var t="leaflet-control-scale",e=At("div",t),I=this.options;return this._addScales(I,t+"-line",e),g.on(I.updateWhenIdle?"moveend":"move",this._update,this),g.whenReady(this._update,this),e},onRemove:function(g){g.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(g,t,e){g.metric&&(this._mScale=At("div",t,e)),g.imperial&&(this._iScale=At("div",t,e))},_update:function(){var g=this._map,t=g.getSize().y/2,e=g.distance(g.containerPointToLatLng([0,t]),g.containerPointToLatLng([this.options.maxWidth,t]));this._updateScales(e)},_updateScales:function(g){this.options.metric&&g&&this._updateMetric(g),this.options.imperial&&g&&this._updateImperial(g)},_updateMetric:function(g){var t=this._getRoundNum(g),e=t<1e3?t+" m":t/1e3+" km";this._updateScale(this._mScale,e,t/g)},_updateImperial:function(g){var t,e,I,n=3.2808399*g;n>5280?(t=n/5280,e=this._getRoundNum(t),this._updateScale(this._iScale,e+" mi",e/t)):(I=this._getRoundNum(n),this._updateScale(this._iScale,I+" ft",I/n))},_updateScale:function(g,t,e){g.style.width=Math.round(this.options.maxWidth*e)+"px",g.innerHTML=t},_getRoundNum:function(g){var t=Math.pow(10,(Math.floor(g)+"").length-1),e=g/t;return t*(e=e>=10?10:e>=5?5:e>=3?3:e>=2?2:1)}}),re=function(g){return new ae(g)},ce='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Ae=ne.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Ng.inlineSvg?ce+" ":"")+"Leaflet</a>"},initialize:function(g){A(this,g),this._attributions={}},onAdd:function(g){for(var t in g.attributionControl=this,this._container=At("div","leaflet-control-attribution"),Qt(this._container),g._layers)g._layers[t].getAttribution&&this.addAttribution(g._layers[t].getAttribution());return this._update(),g.on("layeradd",this._addAttribution,this),this._container},onRemove:function(g){g.off("layeradd",this._addAttribution,this)},_addAttribution:function(g){g.layer.getAttribution&&(this.addAttribution(g.layer.getAttribution()),g.layer.once("remove",(function(){this.removeAttribution(g.layer.getAttribution())}),this))},setPrefix:function(g){return this.options.prefix=g,this._update(),this},addAttribution:function(g){return g?(this._attributions[g]||(this._attributions[g]=0),this._attributions[g]++,this._update(),this):this},removeAttribution:function(g){return g?(this._attributions[g]&&(this._attributions[g]--,this._update()),this):this},_update:function(){if(this._map){var g=[];for(var t in this._attributions)this._attributions[t]&&g.push(t);var e=[];this.options.prefix&&e.push(this.options.prefix),g.length&&e.push(g.join(", ")),this._container.innerHTML=e.join(' <span aria-hidden="true">|</span> ')}}});ee.mergeOptions({attributionControl:!0}),ee.addInitHook((function(){this.options.attributionControl&&(new Ae).addTo(this)}));var de=function(g){return new Ae(g)};ne.Layers=ie,ne.Zoom=oe,ne.Scale=ae,ne.Attribution=Ae,Ce.layers=le,Ce.zoom=se,Ce.scale=re,Ce.attribution=de;var ue=f.extend({initialize:function(g){this._map=g},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});ue.addTo=function(g,t){return g.addHandler(t,this),this};var he={Events:J},me=Ng.touch?"touchstart mousedown":"mousedown",Ze=v.extend({options:{clickTolerance:3},initialize:function(g,t,e,I){A(this,I),this._element=g,this._dragStartTarget=t||g,this._preventOutline=e},enable:function(){this._enabled||(Kt(this._dragStartTarget,me,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Ze._dragging===this&&this.finishDrag(!0),Et(this._dragStartTarget,me,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(g){if(this._enabled&&(this._moved=!1,!Zt(this._element,"leaflet-zoom-anim")))if(g.touches&&1!==g.touches.length)Ze._dragging===this&&this.finishDrag();else if(!(Ze._dragging||g.shiftKey||1!==g.which&&1!==g.button&&!g.touches)&&(Ze._dragging=this,this._preventOutline&&kt(this._element),Jt(),It(),!this._moving)){this.fire("down");var t=g.touches?g.touches[0]:g,e=Ht(this._element);this._startPoint=new k(t.clientX,t.clientY),this._startPos=ft(this._element),this._parentScale=wt(e);var I="mousedown"===g.type;Kt(document,I?"mousemove":"touchmove",this._onMove,this),Kt(document,I?"mouseup":"touchend touchcancel",this._onUp,this)}},_onMove:function(g){if(this._enabled)if(g.touches&&g.touches.length>1)this._moved=!0;else{var t=g.touches&&1===g.touches.length?g.touches[0]:g,e=new k(t.clientX,t.clientY)._subtract(this._startPoint);(e.x||e.y)&&(Math.abs(e.x)+Math.abs(e.y)<this.options.clickTolerance||(e.x/=this._parentScale.x,e.y/=this._parentScale.y,Dt(g),this._moved||(this.fire("dragstart"),this._moved=!0,bt(document.body,"leaflet-dragging"),this._lastTarget=g.target||g.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),bt(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(e),this._moving=!0,this._lastEvent=g,this._updatePosition()))}},_updatePosition:function(){var g={originalEvent:this._lastEvent};this.fire("predrag",g),Rt(this._element,this._newPos),this.fire("drag",g)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(g){Gt(document.body,"leaflet-dragging"),this._lastTarget&&(Gt(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Et(document,"mousemove touchmove",this._onMove,this),Et(document,"mouseup touchend touchcancel",this._onUp,this),vt(),nt();var t=this._moved&&this._moving;this._moving=!1,Ze._dragging=!1,t&&this.fire("dragend",{noInertia:g,distance:this._newPos.distanceTo(this._startPos)})}});function be(g,t,e){var I,n,C,i,l,o,s,a,r,c=[1,4,2,8];for(n=0,s=g.length;n<s;n++)g[n]._code=ke(g[n],t);for(i=0;i<4;i++){for(a=c[i],I=[],n=0,C=(s=g.length)-1;n<s;C=n++)l=g[n],o=g[C],l._code&a?o._code&a||((r=ve(o,l,a,t,e))._code=ke(r,t),I.push(r)):(o._code&a&&((r=ve(o,l,a,t,e))._code=ke(r,t),I.push(r)),I.push(l));g=I}return g}function Ge(g,t){var e,I,n,C,i,l,o,s,a;if(!g||0===g.length)throw new Error("latlngs not passed");we(g)||(console.warn("latlngs are not flat! Only the first ring will be used"),g=g[0]);var r=z([0,0]),c=F(g);c.getNorthWest().distanceTo(c.getSouthWest())*c.getNorthEast().distanceTo(c.getNorthWest())<1700&&(r=pe(g));var A=g.length,d=[];for(e=0;e<A;e++){var u=z(g[e]);d.push(t.project(z([u.lat-r.lat,u.lng-r.lng])))}for(l=o=s=0,e=0,I=A-1;e<A;I=e++)n=d[e],C=d[I],i=n.y*C.x-C.y*n.x,o+=(n.x+C.x)*i,s+=(n.y+C.y)*i,l+=3*i;a=0===l?d[0]:[o/l,s/l];var h=t.unproject(H(a));return z([h.lat+r.lat,h.lng+r.lng])}function pe(g){for(var t=0,e=0,I=0,n=0;n<g.length;n++){var C=z(g[n]);t+=C.lat,e+=C.lng,I++}return z([t/I,e/I])}var ye,Be={__proto__:null,clipPolygon:be,polygonCenter:Ge,centroid:pe};function Ve(g,t){if(!t||!g.length)return g.slice();var e=t*t;return g=Re(g=Xe(g,e),e)}function We(g,t,e){return Math.sqrt(He(g,t,e,!0))}function Se(g,t,e){return He(g,t,e)}function Re(g,t){var e=g.length,I=new(typeof Uint8Array!==void 0+""?Uint8Array:Array)(e);I[0]=I[e-1]=1,fe(g,I,t,0,e-1);var n,C=[];for(n=0;n<e;n++)I[n]&&C.push(g[n]);return C}function fe(g,t,e,I,n){var C,i,l,o=0;for(i=I+1;i<=n-1;i++)(l=He(g[i],g[I],g[n],!0))>o&&(C=i,o=l);o>e&&(t[C]=1,fe(g,t,e,I,C),fe(g,t,e,C,n))}function Xe(g,t){for(var e=[g[0]],I=1,n=0,C=g.length;I<C;I++)Ye(g[I],g[n])>t&&(e.push(g[I]),n=I);return n<C-1&&e.push(g[C-1]),e}function Je(g,t,e,I,n){var C,i,l,o=I?ye:ke(g,e),s=ke(t,e);for(ye=s;;){if(!(o|s))return[g,t];if(o&s)return!1;l=ke(i=ve(g,t,C=o||s,e,n),e),C===o?(g=i,o=l):(t=i,s=l)}}function ve(g,t,e,I,n){var C,i,l=t.x-g.x,o=t.y-g.y,s=I.min,a=I.max;return 8&e?(C=g.x+l*(a.y-g.y)/o,i=a.y):4&e?(C=g.x+l*(s.y-g.y)/o,i=s.y):2&e?(C=a.x,i=g.y+o*(a.x-g.x)/l):1&e&&(C=s.x,i=g.y+o*(s.x-g.x)/l),new k(C,i,n)}function ke(g,t){var e=0;return g.x<t.min.x?e|=1:g.x>t.max.x&&(e|=2),g.y<t.min.y?e|=4:g.y>t.max.y&&(e|=8),e}function Ye(g,t){var e=t.x-g.x,I=t.y-g.y;return e*e+I*I}function He(g,t,e,I){var n,C=t.x,i=t.y,l=e.x-C,o=e.y-i,s=l*l+o*o;return s>0&&((n=((g.x-C)*l+(g.y-i)*o)/s)>1?(C=e.x,i=e.y):n>0&&(C+=l*n,i+=o*n)),l=g.x-C,o=g.y-i,I?l*l+o*o:new k(C,i)}function we(g){return!m(g[0])||"object"!==typeof g[0][0]&&"undefined"!==typeof g[0][0]}function Ne(g){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),we(g)}function Ke(g,t){var e,I,n,C,i,l,o,s;if(!g||0===g.length)throw new Error("latlngs not passed");we(g)||(console.warn("latlngs are not flat! Only the first ring will be used"),g=g[0]);var a=z([0,0]),r=F(g);r.getNorthWest().distanceTo(r.getSouthWest())*r.getNorthEast().distanceTo(r.getNorthWest())<1700&&(a=pe(g));var c=g.length,A=[];for(e=0;e<c;e++){var d=z(g[e]);A.push(t.project(z([d.lat-a.lat,d.lng-a.lng])))}for(e=0,I=0;e<c-1;e++)I+=A[e].distanceTo(A[e+1])/2;if(0===I)s=A[0];else for(e=0,C=0;e<c-1;e++)if(i=A[e],l=A[e+1],(C+=n=i.distanceTo(l))>I){o=(C-I)/n,s=[l.x-o*(l.x-i.x),l.y-o*(l.y-i.y)];break}var u=t.unproject(H(s));return z([u.lat+a.lat,u.lng+a.lng])}var Fe={__proto__:null,simplify:Ve,pointToSegmentDistance:We,closestPointOnSegment:Se,clipSegment:Je,_getEdgeIntersection:ve,_getBitCode:ke,_sqClosestPointOnSegment:He,isFlat:we,_flat:Ne,polylineCenter:Ke},Ee={project:function(g){return new k(g.lng,g.lat)},unproject:function(g){return new E(g.y,g.x)},bounds:new w([-180,-90],[180,90])},ze={R:6378137,R_MINOR:6356752.314245179,bounds:new w([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(g){var t=Math.PI/180,e=this.R,I=g.lat*t,n=this.R_MINOR/e,C=Math.sqrt(1-n*n),i=C*Math.sin(I),l=Math.tan(Math.PI/4-I/2)/Math.pow((1-i)/(1+i),C/2);return I=-e*Math.log(Math.max(l,1e-10)),new k(g.lng*t*e,I)},unproject:function(g){for(var t,e=180/Math.PI,I=this.R,n=this.R_MINOR/I,C=Math.sqrt(1-n*n),i=Math.exp(-g.y/I),l=Math.PI/2-2*Math.atan(i),o=0,s=.1;o<15&&Math.abs(s)>1e-7;o++)t=C*Math.sin(l),t=Math.pow((1-t)/(1+t),C/2),l+=s=Math.PI/2-2*Math.atan(i*t)-l;return new E(l*e,g.x*e/I)}},xe={__proto__:null,LonLat:Ee,Mercator:ze,SphericalMercator:T},Le=e({},M,{code:"EPSG:3395",projection:ze,transformation:function(){var g=.5/(Math.PI*ze.R);return D(g,.5,-g,.5)}()}),Me=e({},M,{code:"EPSG:4326",projection:Ee,transformation:D(1/180,1,-1/180,.5)}),Ue=e({},x,{projection:Ee,transformation:D(1,0,-1,0),scale:function(g){return Math.pow(2,g)},zoom:function(g){return Math.log(g)/Math.LN2},distance:function(g,t){var e=t.lng-g.lng,I=t.lat-g.lat;return Math.sqrt(e*e+I*I)},infinite:!0});x.Earth=M,x.EPSG3395=Le,x.EPSG3857=_,x.EPSG900913=j,x.EPSG4326=Me,x.Simple=Ue;var Te=v.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(g){return g.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(g){return g&&g.removeLayer(this),this},getPane:function(g){return this._map.getPane(g?this.options[g]||g:this.options.pane)},addInteractiveTarget:function(g){return this._map._targets[i(g)]=this,this},removeInteractiveTarget:function(g){return delete this._map._targets[i(g)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(g){var t=g.target;if(t.hasLayer(this)){if(this._map=t,this._zoomAnimated=t._zoomAnimated,this.getEvents){var e=this.getEvents();t.on(e,this),this.once("remove",(function(){t.off(e,this)}),this)}this.onAdd(t),this.fire("add"),t.fire("layeradd",{layer:this})}}});ee.include({addLayer:function(g){if(!g._layerAdd)throw new Error("The provided object is not a Layer.");var t=i(g);return this._layers[t]||(this._layers[t]=g,g._mapToAdd=this,g.beforeAdd&&g.beforeAdd(this),this.whenReady(g._layerAdd,g)),this},removeLayer:function(g){var t=i(g);return this._layers[t]?(this._loaded&&g.onRemove(this),delete this._layers[t],this._loaded&&(this.fire("layerremove",{layer:g}),g.fire("remove")),g._map=g._mapToAdd=null,this):this},hasLayer:function(g){return i(g)in this._layers},eachLayer:function(g,t){for(var e in this._layers)g.call(t,this._layers[e]);return this},_addLayers:function(g){for(var t=0,e=(g=g?m(g)?g:[g]:[]).length;t<e;t++)this.addLayer(g[t])},_addZoomLimit:function(g){isNaN(g.options.maxZoom)&&isNaN(g.options.minZoom)||(this._zoomBoundLayers[i(g)]=g,this._updateZoomLevels())},_removeZoomLimit:function(g){var t=i(g);this._zoomBoundLayers[t]&&(delete this._zoomBoundLayers[t],this._updateZoomLevels())},_updateZoomLevels:function(){var g=1/0,t=-1/0,e=this._getZoomSpan();for(var I in this._zoomBoundLayers){var n=this._zoomBoundLayers[I].options;g=void 0===n.minZoom?g:Math.min(g,n.minZoom),t=void 0===n.maxZoom?t:Math.max(t,n.maxZoom)}this._layersMaxZoom=t===-1/0?void 0:t,this._layersMinZoom=g===1/0?void 0:g,e!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Qe=Te.extend({initialize:function(g,t){var e,I;if(A(this,t),this._layers={},g)for(e=0,I=g.length;e<I;e++)this.addLayer(g[e])},addLayer:function(g){var t=this.getLayerId(g);return this._layers[t]=g,this._map&&this._map.addLayer(g),this},removeLayer:function(g){var t=g in this._layers?g:this.getLayerId(g);return this._map&&this._layers[t]&&this._map.removeLayer(this._layers[t]),delete this._layers[t],this},hasLayer:function(g){return("number"===typeof g?g:this.getLayerId(g))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(g){var t,e,I=Array.prototype.slice.call(arguments,1);for(t in this._layers)(e=this._layers[t])[g]&&e[g].apply(e,I);return this},onAdd:function(g){this.eachLayer(g.addLayer,g)},onRemove:function(g){this.eachLayer(g.removeLayer,g)},eachLayer:function(g,t){for(var e in this._layers)g.call(t,this._layers[e]);return this},getLayer:function(g){return this._layers[g]},getLayers:function(){var g=[];return this.eachLayer(g.push,g),g},setZIndex:function(g){return this.invoke("setZIndex",g)},getLayerId:function(g){return i(g)}}),De=function(g,t){return new Qe(g,t)},_e=Qe.extend({addLayer:function(g){return this.hasLayer(g)?this:(g.addEventParent(this),Qe.prototype.addLayer.call(this,g),this.fire("layeradd",{layer:g}))},removeLayer:function(g){return this.hasLayer(g)?(g in this._layers&&(g=this._layers[g]),g.removeEventParent(this),Qe.prototype.removeLayer.call(this,g),this.fire("layerremove",{layer:g})):this},setStyle:function(g){return this.invoke("setStyle",g)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var g=new K;for(var t in this._layers){var e=this._layers[t];g.extend(e.getBounds?e.getBounds():e.getLatLng())}return g}}),je=function(g,t){return new _e(g,t)},Pe=f.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(g){A(this,g)},createIcon:function(g){return this._createIcon("icon",g)},createShadow:function(g){return this._createIcon("shadow",g)},_createIcon:function(g,t){var e=this._getIconUrl(g);if(!e){if("icon"===g)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var I=this._createImg(e,t&&"IMG"===t.tagName?t:null);return this._setIconStyles(I,g),(this.options.crossOrigin||""===this.options.crossOrigin)&&(I.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),I},_setIconStyles:function(g,t){var e=this.options,I=e[t+"Size"];"number"===typeof I&&(I=[I,I]);var n=H(I),C=H("shadow"===t&&e.shadowAnchor||e.iconAnchor||n&&n.divideBy(2,!0));g.className="leaflet-marker-"+t+" "+(e.className||""),C&&(g.style.marginLeft=-C.x+"px",g.style.marginTop=-C.y+"px"),n&&(g.style.width=n.x+"px",g.style.height=n.y+"px")},_createImg:function(g,t){return(t=t||document.createElement("img")).src=g,t},_getIconUrl:function(g){return Ng.retina&&this.options[g+"RetinaUrl"]||this.options[g+"Url"]}});function Oe(g){return new Pe(g)}var qe=Pe.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(g){return"string"!==typeof qe.imagePath&&(qe.imagePath=this._detectIconPath()),(this.options.imagePath||qe.imagePath)+Pe.prototype._getIconUrl.call(this,g)},_stripUrl:function(g){var t=function(g,t,e){var I=t.exec(g);return I&&I[e]};return(g=t(g,/^url\((['"])?(.+)\1\)$/,2))&&t(g,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var g=At("div","leaflet-default-icon-path",document.body),t=ct(g,"background-image")||ct(g,"backgroundImage");if(document.body.removeChild(g),t=this._stripUrl(t))return t;var e=document.querySelector('link[href$="leaflet.css"]');return e?e.href.substring(0,e.href.length-11-1):""}}),$e=ue.extend({initialize:function(g){this._marker=g},addHooks:function(){var g=this._marker._icon;this._draggable||(this._draggable=new Ze(g,g,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),bt(g,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Gt(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(g){var t=this._marker,e=t._map,I=this._marker.options.autoPanSpeed,n=this._marker.options.autoPanPadding,C=ft(t._icon),i=e.getPixelBounds(),l=e.getPixelOrigin(),o=N(i.min._subtract(l).add(n),i.max._subtract(l).subtract(n));if(!o.contains(C)){var s=H((Math.max(o.max.x,C.x)-o.max.x)/(i.max.x-o.max.x)-(Math.min(o.min.x,C.x)-o.min.x)/(i.min.x-o.min.x),(Math.max(o.max.y,C.y)-o.max.y)/(i.max.y-o.max.y)-(Math.min(o.min.y,C.y)-o.min.y)/(i.min.y-o.min.y)).multiplyBy(I);e.panBy(s,{animate:!1}),this._draggable._newPos._add(s),this._draggable._startPos._add(s),Rt(t._icon,this._draggable._newPos),this._onDrag(g),this._panRequest=W(this._adjustPan.bind(this,g))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(g){this._marker.options.autoPan&&(S(this._panRequest),this._panRequest=W(this._adjustPan.bind(this,g)))},_onDrag:function(g){var t=this._marker,e=t._shadow,I=ft(t._icon),n=t._map.layerPointToLatLng(I);e&&Rt(e,I),t._latlng=n,g.latlng=n,g.oldLatLng=this._oldLatLng,t.fire("move",g).fire("drag",g)},_onDragEnd:function(g){S(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",g)}}),gI=Te.extend({options:{icon:new qe,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(g,t){A(this,t),this._latlng=z(g)},onAdd:function(g){this._zoomAnimated=this._zoomAnimated&&g.options.markerZoomAnimation,this._zoomAnimated&&g.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(g){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&g.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(g){var t=this._latlng;return this._latlng=z(g),this.update(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},setZIndexOffset:function(g){return this.options.zIndexOffset=g,this.update()},getIcon:function(){return this.options.icon},setIcon:function(g){return this.options.icon=g,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var g=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(g)}return this},_initIcon:function(){var g=this.options,t="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),e=g.icon.createIcon(this._icon),I=!1;e!==this._icon&&(this._icon&&this._removeIcon(),I=!0,g.title&&(e.title=g.title),"IMG"===e.tagName&&(e.alt=g.alt||"")),bt(e,t),g.keyboard&&(e.tabIndex="0",e.setAttribute("role","button")),this._icon=e,g.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Kt(e,"focus",this._panOnFocus,this);var n=g.icon.createShadow(this._shadow),C=!1;n!==this._shadow&&(this._removeShadow(),C=!0),n&&(bt(n,t),n.alt=""),this._shadow=n,g.opacity<1&&this._updateOpacity(),I&&this.getPane().appendChild(this._icon),this._initInteraction(),n&&C&&this.getPane(g.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Et(this._icon,"focus",this._panOnFocus,this),dt(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&dt(this._shadow),this._shadow=null},_setPos:function(g){this._icon&&Rt(this._icon,g),this._shadow&&Rt(this._shadow,g),this._zIndex=g.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(g){this._icon&&(this._icon.style.zIndex=this._zIndex+g)},_animateZoom:function(g){var t=this._map._latLngToNewLayerPoint(this._latlng,g.zoom,g.center).round();this._setPos(t)},_initInteraction:function(){if(this.options.interactive&&(bt(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),$e)){var g=this.options.draggable;this.dragging&&(g=this.dragging.enabled(),this.dragging.disable()),this.dragging=new $e(this),g&&this.dragging.enable()}},setOpacity:function(g){return this.options.opacity=g,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var g=this.options.opacity;this._icon&&Bt(this._icon,g),this._shadow&&Bt(this._shadow,g)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var g=this._map;if(g){var t=this.options.icon.options,e=t.iconSize?H(t.iconSize):H(0,0),I=t.iconAnchor?H(t.iconAnchor):H(0,0);g.panInside(this._latlng,{paddingTopLeft:I,paddingBottomRight:e.subtract(I)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function tI(g,t){return new gI(g,t)}var eI=Te.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(g){this._renderer=g.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(g){return A(this,g),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&g&&Object.prototype.hasOwnProperty.call(g,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),II=eI.extend({options:{fill:!0,radius:10},initialize:function(g,t){A(this,t),this._latlng=z(g),this._radius=this.options.radius},setLatLng:function(g){var t=this._latlng;return this._latlng=z(g),this.redraw(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(g){return this.options.radius=this._radius=g,this.redraw()},getRadius:function(){return this._radius},setStyle:function(g){var t=g&&g.radius||this._radius;return eI.prototype.setStyle.call(this,g),this.setRadius(t),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var g=this._radius,t=this._radiusY||g,e=this._clickTolerance(),I=[g+e,t+e];this._pxBounds=new w(this._point.subtract(I),this._point.add(I))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(g){return g.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function nI(g,t){return new II(g,t)}var CI=II.extend({initialize:function(g,t,I){if("number"===typeof t&&(t=e({},I,{radius:t})),A(this,t),this._latlng=z(g),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(g){return this._mRadius=g,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var g=[this._radius,this._radiusY||this._radius];return new K(this._map.layerPointToLatLng(this._point.subtract(g)),this._map.layerPointToLatLng(this._point.add(g)))},setStyle:eI.prototype.setStyle,_project:function(){var g=this._latlng.lng,t=this._latlng.lat,e=this._map,I=e.options.crs;if(I.distance===M.distance){var n=Math.PI/180,C=this._mRadius/M.R/n,i=e.project([t+C,g]),l=e.project([t-C,g]),o=i.add(l).divideBy(2),s=e.unproject(o).lat,a=Math.acos((Math.cos(C*n)-Math.sin(t*n)*Math.sin(s*n))/(Math.cos(t*n)*Math.cos(s*n)))/n;(isNaN(a)||0===a)&&(a=C/Math.cos(Math.PI/180*t)),this._point=o.subtract(e.getPixelOrigin()),this._radius=isNaN(a)?0:o.x-e.project([s,g-a]).x,this._radiusY=o.y-i.y}else{var r=I.unproject(I.project(this._latlng).subtract([this._mRadius,0]));this._point=e.latLngToLayerPoint(this._latlng),this._radius=this._point.x-e.latLngToLayerPoint(r).x}this._updateBounds()}});function iI(g,t,e){return new CI(g,t,e)}var lI=eI.extend({options:{smoothFactor:1,noClip:!1},initialize:function(g,t){A(this,t),this._setLatLngs(g)},getLatLngs:function(){return this._latlngs},setLatLngs:function(g){return this._setLatLngs(g),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(g){for(var t,e,I=1/0,n=null,C=He,i=0,l=this._parts.length;i<l;i++)for(var o=this._parts[i],s=1,a=o.length;s<a;s++){var r=C(g,t=o[s-1],e=o[s],!0);r<I&&(I=r,n=C(g,t,e))}return n&&(n.distance=Math.sqrt(I)),n},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Ke(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(g,t){return t=t||this._defaultShape(),g=z(g),t.push(g),this._bounds.extend(g),this.redraw()},_setLatLngs:function(g){this._bounds=new K,this._latlngs=this._convertLatLngs(g)},_defaultShape:function(){return we(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(g){for(var t=[],e=we(g),I=0,n=g.length;I<n;I++)e?(t[I]=z(g[I]),this._bounds.extend(t[I])):t[I]=this._convertLatLngs(g[I]);return t},_project:function(){var g=new w;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,g),this._bounds.isValid()&&g.isValid()&&(this._rawPxBounds=g,this._updateBounds())},_updateBounds:function(){var g=this._clickTolerance(),t=new k(g,g);this._rawPxBounds&&(this._pxBounds=new w([this._rawPxBounds.min.subtract(t),this._rawPxBounds.max.add(t)]))},_projectLatlngs:function(g,t,e){var I,n,C=g[0]instanceof E,i=g.length;if(C){for(n=[],I=0;I<i;I++)n[I]=this._map.latLngToLayerPoint(g[I]),e.extend(n[I]);t.push(n)}else for(I=0;I<i;I++)this._projectLatlngs(g[I],t,e)},_clipPoints:function(){var g=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(g))if(this.options.noClip)this._parts=this._rings;else{var t,e,I,n,C,i,l,o=this._parts;for(t=0,I=0,n=this._rings.length;t<n;t++)for(e=0,C=(l=this._rings[t]).length;e<C-1;e++)(i=Je(l[e],l[e+1],g,e,!0))&&(o[I]=o[I]||[],o[I].push(i[0]),i[1]===l[e+1]&&e!==C-2||(o[I].push(i[1]),I++))}},_simplifyPoints:function(){for(var g=this._parts,t=this.options.smoothFactor,e=0,I=g.length;e<I;e++)g[e]=Ve(g[e],t)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(g,t){var e,I,n,C,i,l,o=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(g))return!1;for(e=0,C=this._parts.length;e<C;e++)for(I=0,n=(i=(l=this._parts[e]).length)-1;I<i;n=I++)if((t||0!==I)&&We(g,l[n],l[I])<=o)return!0;return!1}});function oI(g,t){return new lI(g,t)}lI._flat=Ne;var sI=lI.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Ge(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(g){var t=lI.prototype._convertLatLngs.call(this,g),e=t.length;return e>=2&&t[0]instanceof E&&t[0].equals(t[e-1])&&t.pop(),t},_setLatLngs:function(g){lI.prototype._setLatLngs.call(this,g),we(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return we(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var g=this._renderer._bounds,t=this.options.weight,e=new k(t,t);if(g=new w(g.min.subtract(e),g.max.add(e)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(g))if(this.options.noClip)this._parts=this._rings;else for(var I,n=0,C=this._rings.length;n<C;n++)(I=be(this._rings[n],g,!0)).length&&this._parts.push(I)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(g){var t,e,I,n,C,i,l,o,s=!1;if(!this._pxBounds||!this._pxBounds.contains(g))return!1;for(n=0,l=this._parts.length;n<l;n++)for(C=0,i=(o=(t=this._parts[n]).length)-1;C<o;i=C++)e=t[C],I=t[i],e.y>g.y!==I.y>g.y&&g.x<(I.x-e.x)*(g.y-e.y)/(I.y-e.y)+e.x&&(s=!s);return s||lI.prototype._containsPoint.call(this,g,!0)}});function aI(g,t){return new sI(g,t)}var rI=_e.extend({initialize:function(g,t){A(this,t),this._layers={},g&&this.addData(g)},addData:function(g){var t,e,I,n=m(g)?g:g.features;if(n){for(t=0,e=n.length;t<e;t++)((I=n[t]).geometries||I.geometry||I.features||I.coordinates)&&this.addData(I);return this}var C=this.options;if(C.filter&&!C.filter(g))return this;var i=cI(g,C);return i?(i.feature=bI(g),i.defaultOptions=i.options,this.resetStyle(i),C.onEachFeature&&C.onEachFeature(g,i),this.addLayer(i)):this},resetStyle:function(g){return void 0===g?this.eachLayer(this.resetStyle,this):(g.options=e({},g.defaultOptions),this._setLayerStyle(g,this.options.style),this)},setStyle:function(g){return this.eachLayer((function(t){this._setLayerStyle(t,g)}),this)},_setLayerStyle:function(g,t){g.setStyle&&("function"===typeof t&&(t=t(g.feature)),g.setStyle(t))}});function cI(g,t){var e,I,n,C,i="Feature"===g.type?g.geometry:g,l=i?i.coordinates:null,o=[],s=t&&t.pointToLayer,a=t&&t.coordsToLatLng||dI;if(!l&&!i)return null;switch(i.type){case"Point":return AI(s,g,e=a(l),t);case"MultiPoint":for(n=0,C=l.length;n<C;n++)e=a(l[n]),o.push(AI(s,g,e,t));return new _e(o);case"LineString":case"MultiLineString":return I=uI(l,"LineString"===i.type?0:1,a),new lI(I,t);case"Polygon":case"MultiPolygon":return I=uI(l,"Polygon"===i.type?1:2,a),new sI(I,t);case"GeometryCollection":for(n=0,C=i.geometries.length;n<C;n++){var r=cI({geometry:i.geometries[n],type:"Feature",properties:g.properties},t);r&&o.push(r)}return new _e(o);case"FeatureCollection":for(n=0,C=i.features.length;n<C;n++){var c=cI(i.features[n],t);c&&o.push(c)}return new _e(o);default:throw new Error("Invalid GeoJSON object.")}}function AI(g,t,e,I){return g?g(t,e):new gI(e,I&&I.markersInheritOptions&&I)}function dI(g){return new E(g[1],g[0],g[2])}function uI(g,t,e){for(var I,n=[],C=0,i=g.length;C<i;C++)I=t?uI(g[C],t-1,e):(e||dI)(g[C]),n.push(I);return n}function hI(g,t){return void 0!==(g=z(g)).alt?[a(g.lng,t),a(g.lat,t),a(g.alt,t)]:[a(g.lng,t),a(g.lat,t)]}function mI(g,t,e,I){for(var n=[],C=0,i=g.length;C<i;C++)n.push(t?mI(g[C],we(g[C])?0:t-1,e,I):hI(g[C],I));return!t&&e&&n.length>0&&n.push(n[0].slice()),n}function ZI(g,t){return g.feature?e({},g.feature,{geometry:t}):bI(t)}function bI(g){return"Feature"===g.type||"FeatureCollection"===g.type?g:{type:"Feature",properties:{},geometry:g}}var GI={toGeoJSON:function(g){return ZI(this,{type:"Point",coordinates:hI(this.getLatLng(),g)})}};function pI(g,t){return new rI(g,t)}gI.include(GI),CI.include(GI),II.include(GI),lI.include({toGeoJSON:function(g){var t=!we(this._latlngs);return ZI(this,{type:(t?"Multi":"")+"LineString",coordinates:mI(this._latlngs,t?1:0,!1,g)})}}),sI.include({toGeoJSON:function(g){var t=!we(this._latlngs),e=t&&!we(this._latlngs[0]),I=mI(this._latlngs,e?2:t?1:0,!0,g);return t||(I=[I]),ZI(this,{type:(e?"Multi":"")+"Polygon",coordinates:I})}}),Qe.include({toMultiPoint:function(g){var t=[];return this.eachLayer((function(e){t.push(e.toGeoJSON(g).geometry.coordinates)})),ZI(this,{type:"MultiPoint",coordinates:t})},toGeoJSON:function(g){var t=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===t)return this.toMultiPoint(g);var e="GeometryCollection"===t,I=[];return this.eachLayer((function(t){if(t.toGeoJSON){var n=t.toGeoJSON(g);if(e)I.push(n.geometry);else{var C=bI(n);"FeatureCollection"===C.type?I.push.apply(I,C.features):I.push(C)}}})),e?ZI(this,{geometries:I,type:"GeometryCollection"}):{type:"FeatureCollection",features:I}}});var yI=pI,BI=Te.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(g,t,e){this._url=g,this._bounds=F(t),A(this,e)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(bt(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){dt(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(g){return this.options.opacity=g,this._image&&this._updateOpacity(),this},setStyle:function(g){return g.opacity&&this.setOpacity(g.opacity),this},bringToFront:function(){return this._map&&ht(this._image),this},bringToBack:function(){return this._map&&mt(this._image),this},setUrl:function(g){return this._url=g,this._image&&(this._image.src=g),this},setBounds:function(g){return this._bounds=F(g),this._map&&this._reset(),this},getEvents:function(){var g={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(g.zoomanim=this._animateZoom),g},setZIndex:function(g){return this.options.zIndex=g,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var g="IMG"===this._url.tagName,t=this._image=g?this._url:At("img");bt(t,"leaflet-image-layer"),this._zoomAnimated&&bt(t,"leaflet-zoom-animated"),this.options.className&&bt(t,this.options.className),t.onselectstart=s,t.onmousemove=s,t.onload=n(this.fire,this,"load"),t.onerror=n(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(t.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),g?this._url=t.src:(t.src=this._url,t.alt=this.options.alt)},_animateZoom:function(g){var t=this._map.getZoomScale(g.zoom),e=this._map._latLngBoundsToNewLayerBounds(this._bounds,g.zoom,g.center).min;St(this._image,e,t)},_reset:function(){var g=this._image,t=new w(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),e=t.getSize();Rt(g,t.min),g.style.width=e.x+"px",g.style.height=e.y+"px"},_updateOpacity:function(){Bt(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var g=this.options.errorOverlayUrl;g&&this._url!==g&&(this._url=g,this._image.src=g)},getCenter:function(){return this._bounds.getCenter()}}),VI=function(g,t,e){return new BI(g,t,e)},WI=BI.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var g="VIDEO"===this._url.tagName,t=this._image=g?this._url:At("video");if(bt(t,"leaflet-image-layer"),this._zoomAnimated&&bt(t,"leaflet-zoom-animated"),this.options.className&&bt(t,this.options.className),t.onselectstart=s,t.onmousemove=s,t.onloadeddata=n(this.fire,this,"load"),g){for(var e=t.getElementsByTagName("source"),I=[],C=0;C<e.length;C++)I.push(e[C].src);this._url=e.length>0?I:[t.src]}else{m(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(t.style,"objectFit")&&(t.style.objectFit="fill"),t.autoplay=!!this.options.autoplay,t.loop=!!this.options.loop,t.muted=!!this.options.muted,t.playsInline=!!this.options.playsInline;for(var i=0;i<this._url.length;i++){var l=At("source");l.src=this._url[i],t.appendChild(l)}}}});function SI(g,t,e){return new WI(g,t,e)}var RI=BI.extend({_initImage:function(){var g=this._image=this._url;bt(g,"leaflet-image-layer"),this._zoomAnimated&&bt(g,"leaflet-zoom-animated"),this.options.className&&bt(g,this.options.className),g.onselectstart=s,g.onmousemove=s}});function fI(g,t,e){return new RI(g,t,e)}var XI=Te.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(g,t){g&&(g instanceof E||m(g))?(this._latlng=z(g),A(this,t)):(A(this,g),this._source=t),this.options.content&&(this._content=this.options.content)},openOn:function(g){return(g=arguments.length?g:this._source._map).hasLayer(this)||g.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(g){return this._map?this.close():(arguments.length?this._source=g:g=this._source,this._prepareOpen(),this.openOn(g._map)),this},onAdd:function(g){this._zoomAnimated=g._zoomAnimated,this._container||this._initLayout(),g._fadeAnimated&&Bt(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),g._fadeAnimated&&Bt(this._container,1),this.bringToFront(),this.options.interactive&&(bt(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(g){g._fadeAnimated?(Bt(this._container,0),this._removeTimeout=setTimeout(n(dt,void 0,this._container),200)):dt(this._container),this.options.interactive&&(Gt(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(g){return this._latlng=z(g),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(g){return this._content=g,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var g={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(g.zoomanim=this._animateZoom),g},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&ht(this._container),this},bringToBack:function(){return this._map&&mt(this._container),this},_prepareOpen:function(g){var t=this._source;if(!t._map)return!1;if(t instanceof _e){t=null;var e=this._source._layers;for(var I in e)if(e[I]._map){t=e[I];break}if(!t)return!1;this._source=t}if(!g)if(t.getCenter)g=t.getCenter();else if(t.getLatLng)g=t.getLatLng();else{if(!t.getBounds)throw new Error("Unable to get source layer LatLng.");g=t.getBounds().getCenter()}return this.setLatLng(g),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var g=this._contentNode,t="function"===typeof this._content?this._content(this._source||this):this._content;if("string"===typeof t)g.innerHTML=t;else{for(;g.hasChildNodes();)g.removeChild(g.firstChild);g.appendChild(t)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var g=this._map.latLngToLayerPoint(this._latlng),t=H(this.options.offset),e=this._getAnchor();this._zoomAnimated?Rt(this._container,g.add(e)):t=t.add(g).add(e);var I=this._containerBottom=-t.y,n=this._containerLeft=-Math.round(this._containerWidth/2)+t.x;this._container.style.bottom=I+"px",this._container.style.left=n+"px"}},_getAnchor:function(){return[0,0]}});ee.include({_initOverlay:function(g,t,e,I){var n=t;return n instanceof g||(n=new g(I).setContent(t)),e&&n.setLatLng(e),n}}),Te.include({_initOverlay:function(g,t,e,I){var n=e;return n instanceof g?(A(n,I),n._source=this):(n=t&&!I?t:new g(I,this)).setContent(e),n}});var JI=XI.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(g){return!(g=arguments.length?g:this._source._map).hasLayer(this)&&g._popup&&g._popup.options.autoClose&&g.removeLayer(g._popup),g._popup=this,XI.prototype.openOn.call(this,g)},onAdd:function(g){XI.prototype.onAdd.call(this,g),g.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof eI||this._source.on("preclick",Ut))},onRemove:function(g){XI.prototype.onRemove.call(this,g),g.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof eI||this._source.off("preclick",Ut))},getEvents:function(){var g=XI.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(g.preclick=this.close),this.options.keepInView&&(g.moveend=this._adjustPan),g},_initLayout:function(){var g="leaflet-popup",t=this._container=At("div",g+" "+(this.options.className||"")+" leaflet-zoom-animated"),e=this._wrapper=At("div",g+"-content-wrapper",t);if(this._contentNode=At("div",g+"-content",e),Qt(t),Tt(this._contentNode),Kt(t,"contextmenu",Ut),this._tipContainer=At("div",g+"-tip-container",t),this._tip=At("div",g+"-tip",this._tipContainer),this.options.closeButton){var I=this._closeButton=At("a",g+"-close-button",t);I.setAttribute("role","button"),I.setAttribute("aria-label","Close popup"),I.href="#close",I.innerHTML='<span aria-hidden="true">&#215;</span>',Kt(I,"click",(function(g){Dt(g),this.close()}),this)}},_updateLayout:function(){var g=this._contentNode,t=g.style;t.width="",t.whiteSpace="nowrap";var e=g.offsetWidth;e=Math.min(e,this.options.maxWidth),e=Math.max(e,this.options.minWidth),t.width=e+1+"px",t.whiteSpace="",t.height="";var I=g.offsetHeight,n=this.options.maxHeight,C="leaflet-popup-scrolled";n&&I>n?(t.height=n+"px",bt(g,C)):Gt(g,C),this._containerWidth=this._container.offsetWidth},_animateZoom:function(g){var t=this._map._latLngToNewLayerPoint(this._latlng,g.zoom,g.center),e=this._getAnchor();Rt(this._container,t.add(e))},_adjustPan:function(){if(this.options.autoPan)if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning)this._autopanning=!1;else{var g=this._map,t=parseInt(ct(this._container,"marginBottom"),10)||0,e=this._container.offsetHeight+t,I=this._containerWidth,n=new k(this._containerLeft,-e-this._containerBottom);n._add(ft(this._container));var C=g.layerPointToContainerPoint(n),i=H(this.options.autoPanPadding),l=H(this.options.autoPanPaddingTopLeft||i),o=H(this.options.autoPanPaddingBottomRight||i),s=g.getSize(),a=0,r=0;C.x+I+o.x>s.x&&(a=C.x+I-s.x+o.x),C.x-a-l.x<0&&(a=C.x-l.x),C.y+e+o.y>s.y&&(r=C.y+e-s.y+o.y),C.y-r-l.y<0&&(r=C.y-l.y),(a||r)&&(this.options.keepInView&&(this._autopanning=!0),g.fire("autopanstart").panBy([a,r]))}},_getAnchor:function(){return H(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),vI=function(g,t){return new JI(g,t)};ee.mergeOptions({closePopupOnClick:!0}),ee.include({openPopup:function(g,t,e){return this._initOverlay(JI,g,t,e).openOn(this),this},closePopup:function(g){return(g=arguments.length?g:this._popup)&&g.close(),this}}),Te.include({bindPopup:function(g,t){return this._popup=this._initOverlay(JI,this._popup,g,t),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(g){return this._popup&&(this instanceof _e||(this._popup._source=this),this._popup._prepareOpen(g||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(g){return this._popup&&this._popup.setContent(g),this},getPopup:function(){return this._popup},_openPopup:function(g){if(this._popup&&this._map){_t(g);var t=g.layer||g.target;this._popup._source!==t||t instanceof eI?(this._popup._source=t,this.openPopup(g.latlng)):this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(g.latlng)}},_movePopup:function(g){this._popup.setLatLng(g.latlng)},_onKeyPress:function(g){13===g.originalEvent.keyCode&&this._openPopup(g)}});var kI=XI.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(g){XI.prototype.onAdd.call(this,g),this.setOpacity(this.options.opacity),g.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(g){XI.prototype.onRemove.call(this,g),g.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var g=XI.prototype.getEvents.call(this);return this.options.permanent||(g.preclick=this.close),g},_initLayout:function(){var g="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=At("div",g),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+i(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(g){var t,e,I=this._map,n=this._container,C=I.latLngToContainerPoint(I.getCenter()),i=I.layerPointToContainerPoint(g),l=this.options.direction,o=n.offsetWidth,s=n.offsetHeight,a=H(this.options.offset),r=this._getAnchor();"top"===l?(t=o/2,e=s):"bottom"===l?(t=o/2,e=0):"center"===l?(t=o/2,e=s/2):"right"===l?(t=0,e=s/2):"left"===l?(t=o,e=s/2):i.x<C.x?(l="right",t=0,e=s/2):(l="left",t=o+2*(a.x+r.x),e=s/2),g=g.subtract(H(t,e,!0)).add(a).add(r),Gt(n,"leaflet-tooltip-right"),Gt(n,"leaflet-tooltip-left"),Gt(n,"leaflet-tooltip-top"),Gt(n,"leaflet-tooltip-bottom"),bt(n,"leaflet-tooltip-"+l),Rt(n,g)},_updatePosition:function(){var g=this._map.latLngToLayerPoint(this._latlng);this._setPosition(g)},setOpacity:function(g){this.options.opacity=g,this._container&&Bt(this._container,g)},_animateZoom:function(g){var t=this._map._latLngToNewLayerPoint(this._latlng,g.zoom,g.center);this._setPosition(t)},_getAnchor:function(){return H(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),YI=function(g,t){return new kI(g,t)};ee.include({openTooltip:function(g,t,e){return this._initOverlay(kI,g,t,e).openOn(this),this},closeTooltip:function(g){return g.close(),this}}),Te.include({bindTooltip:function(g,t){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(kI,this._tooltip,g,t),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(g){if(g||!this._tooltipHandlersAdded){var t=g?"off":"on",e={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?e.add=this._openTooltip:(e.mouseover=this._openTooltip,e.mouseout=this.closeTooltip,e.click=this._openTooltip,this._map?this._addFocusListeners():e.add=this._addFocusListeners),this._tooltip.options.sticky&&(e.mousemove=this._moveTooltip),this[t](e),this._tooltipHandlersAdded=!g}},openTooltip:function(g){return this._tooltip&&(this instanceof _e||(this._tooltip._source=this),this._tooltip._prepareOpen(g)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(g){return this._tooltip&&this._tooltip.setContent(g),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(g){var t="function"===typeof g.getElement&&g.getElement();t&&(Kt(t,"focus",(function(){this._tooltip._source=g,this.openTooltip()}),this),Kt(t,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(g){var t="function"===typeof g.getElement&&g.getElement();t&&t.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(g){if(this._tooltip&&this._map)if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var t=this;this._map.once("moveend",(function(){t._openOnceFlag=!1,t._openTooltip(g)}))}else this._tooltip._source=g.layer||g.target,this.openTooltip(this._tooltip.options.sticky?g.latlng:void 0)},_moveTooltip:function(g){var t,e,I=g.latlng;this._tooltip.options.sticky&&g.originalEvent&&(t=this._map.mouseEventToContainerPoint(g.originalEvent),e=this._map.containerPointToLayerPoint(t),I=this._map.layerPointToLatLng(e)),this._tooltip.setLatLng(I)}});var HI=Pe.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(g){var t=g&&"DIV"===g.tagName?g:document.createElement("div"),e=this.options;if(e.html instanceof Element?(ut(t),t.appendChild(e.html)):t.innerHTML=!1!==e.html?e.html:"",e.bgPos){var I=H(e.bgPos);t.style.backgroundPosition=-I.x+"px "+-I.y+"px"}return this._setIconStyles(t,"icon"),t},createShadow:function(){return null}});function wI(g){return new HI(g)}Pe.Default=qe;var NI=Te.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Ng.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(g){A(this,g)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(g){g._addZoomLimit(this)},onRemove:function(g){this._removeAllTiles(),dt(this._container),g._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(ht(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(mt(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(g){return this.options.opacity=g,this._updateOpacity(),this},setZIndex:function(g){return this.options.zIndex=g,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var g=this._clampZoom(this._map.getZoom());g!==this._tileZoom&&(this._tileZoom=g,this._updateLevels()),this._update()}return this},getEvents:function(){var g={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=l(this._onMoveEnd,this.options.updateInterval,this)),g.move=this._onMove),this._zoomAnimated&&(g.zoomanim=this._animateZoom),g},createTile:function(){return document.createElement("div")},getTileSize:function(){var g=this.options.tileSize;return g instanceof k?g:new k(g,g)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(g){for(var t,e=this.getPane().children,I=-g(-1/0,1/0),n=0,C=e.length;n<C;n++)t=e[n].style.zIndex,e[n]!==this._container&&t&&(I=g(I,+t));isFinite(I)&&(this.options.zIndex=I+g(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Ng.ielt9){Bt(this._container,this.options.opacity);var g=+new Date,t=!1,e=!1;for(var I in this._tiles){var n=this._tiles[I];if(n.current&&n.loaded){var C=Math.min(1,(g-n.loaded)/200);Bt(n.el,C),C<1?t=!0:(n.active?e=!0:this._onOpaqueTile(n),n.active=!0)}}e&&!this._noPrune&&this._pruneTiles(),t&&(S(this._fadeFrame),this._fadeFrame=W(this._updateOpacity,this))}},_onOpaqueTile:s,_initContainer:function(){this._container||(this._container=At("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var g=this._tileZoom,t=this.options.maxZoom;if(void 0!==g){for(var e in this._levels)e=Number(e),this._levels[e].el.children.length||e===g?(this._levels[e].el.style.zIndex=t-Math.abs(g-e),this._onUpdateLevel(e)):(dt(this._levels[e].el),this._removeTilesAtZoom(e),this._onRemoveLevel(e),delete this._levels[e]);var I=this._levels[g],n=this._map;return I||((I=this._levels[g]={}).el=At("div","leaflet-tile-container leaflet-zoom-animated",this._container),I.el.style.zIndex=t,I.origin=n.project(n.unproject(n.getPixelOrigin()),g).round(),I.zoom=g,this._setZoomTransform(I,n.getCenter(),n.getZoom()),s(I.el.offsetWidth),this._onCreateLevel(I)),this._level=I,I}},_onUpdateLevel:s,_onRemoveLevel:s,_onCreateLevel:s,_pruneTiles:function(){if(this._map){var g,t,e=this._map.getZoom();if(e>this.options.maxZoom||e<this.options.minZoom)this._removeAllTiles();else{for(g in this._tiles)(t=this._tiles[g]).retain=t.current;for(g in this._tiles)if((t=this._tiles[g]).current&&!t.active){var I=t.coords;this._retainParent(I.x,I.y,I.z,I.z-5)||this._retainChildren(I.x,I.y,I.z,I.z+2)}for(g in this._tiles)this._tiles[g].retain||this._removeTile(g)}}},_removeTilesAtZoom:function(g){for(var t in this._tiles)this._tiles[t].coords.z===g&&this._removeTile(t)},_removeAllTiles:function(){for(var g in this._tiles)this._removeTile(g)},_invalidateAll:function(){for(var g in this._levels)dt(this._levels[g].el),this._onRemoveLevel(Number(g)),delete this._levels[g];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(g,t,e,I){var n=Math.floor(g/2),C=Math.floor(t/2),i=e-1,l=new k(+n,+C);l.z=+i;var o=this._tileCoordsToKey(l),s=this._tiles[o];return s&&s.active?(s.retain=!0,!0):(s&&s.loaded&&(s.retain=!0),i>I&&this._retainParent(n,C,i,I))},_retainChildren:function(g,t,e,I){for(var n=2*g;n<2*g+2;n++)for(var C=2*t;C<2*t+2;C++){var i=new k(n,C);i.z=e+1;var l=this._tileCoordsToKey(i),o=this._tiles[l];o&&o.active?o.retain=!0:(o&&o.loaded&&(o.retain=!0),e+1<I&&this._retainChildren(n,C,e+1,I))}},_resetView:function(g){var t=g&&(g.pinch||g.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),t,t)},_animateZoom:function(g){this._setView(g.center,g.zoom,!0,g.noUpdate)},_clampZoom:function(g){var t=this.options;return void 0!==t.minNativeZoom&&g<t.minNativeZoom?t.minNativeZoom:void 0!==t.maxNativeZoom&&t.maxNativeZoom<g?t.maxNativeZoom:g},_setView:function(g,t,e,I){var n=Math.round(t);n=void 0!==this.options.maxZoom&&n>this.options.maxZoom||void 0!==this.options.minZoom&&n<this.options.minZoom?void 0:this._clampZoom(n);var C=this.options.updateWhenZooming&&n!==this._tileZoom;I&&!C||(this._tileZoom=n,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==n&&this._update(g),e||this._pruneTiles(),this._noPrune=!!e),this._setZoomTransforms(g,t)},_setZoomTransforms:function(g,t){for(var e in this._levels)this._setZoomTransform(this._levels[e],g,t)},_setZoomTransform:function(g,t,e){var I=this._map.getZoomScale(e,g.zoom),n=g.origin.multiplyBy(I).subtract(this._map._getNewPixelOrigin(t,e)).round();Ng.any3d?St(g.el,n,I):Rt(g.el,n)},_resetGrid:function(){var g=this._map,t=g.options.crs,e=this._tileSize=this.getTileSize(),I=this._tileZoom,n=this._map.getPixelWorldBounds(this._tileZoom);n&&(this._globalTileRange=this._pxBoundsToTileRange(n)),this._wrapX=t.wrapLng&&!this.options.noWrap&&[Math.floor(g.project([0,t.wrapLng[0]],I).x/e.x),Math.ceil(g.project([0,t.wrapLng[1]],I).x/e.y)],this._wrapY=t.wrapLat&&!this.options.noWrap&&[Math.floor(g.project([t.wrapLat[0],0],I).y/e.x),Math.ceil(g.project([t.wrapLat[1],0],I).y/e.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(g){var t=this._map,e=t._animatingZoom?Math.max(t._animateToZoom,t.getZoom()):t.getZoom(),I=t.getZoomScale(e,this._tileZoom),n=t.project(g,this._tileZoom).floor(),C=t.getSize().divideBy(2*I);return new w(n.subtract(C),n.add(C))},_update:function(g){var t=this._map;if(t){var e=this._clampZoom(t.getZoom());if(void 0===g&&(g=t.getCenter()),void 0!==this._tileZoom){var I=this._getTiledPixelBounds(g),n=this._pxBoundsToTileRange(I),C=n.getCenter(),i=[],l=this.options.keepBuffer,o=new w(n.getBottomLeft().subtract([l,-l]),n.getTopRight().add([l,-l]));if(!(isFinite(n.min.x)&&isFinite(n.min.y)&&isFinite(n.max.x)&&isFinite(n.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var s in this._tiles){var a=this._tiles[s].coords;a.z===this._tileZoom&&o.contains(new k(a.x,a.y))||(this._tiles[s].current=!1)}if(Math.abs(e-this._tileZoom)>1)this._setView(g,e);else{for(var r=n.min.y;r<=n.max.y;r++)for(var c=n.min.x;c<=n.max.x;c++){var A=new k(c,r);if(A.z=this._tileZoom,this._isValidTile(A)){var d=this._tiles[this._tileCoordsToKey(A)];d?d.current=!0:i.push(A)}}if(i.sort((function(g,t){return g.distanceTo(C)-t.distanceTo(C)})),0!==i.length){this._loading||(this._loading=!0,this.fire("loading"));var u=document.createDocumentFragment();for(c=0;c<i.length;c++)this._addTile(i[c],u);this._level.el.appendChild(u)}}}}},_isValidTile:function(g){var t=this._map.options.crs;if(!t.infinite){var e=this._globalTileRange;if(!t.wrapLng&&(g.x<e.min.x||g.x>e.max.x)||!t.wrapLat&&(g.y<e.min.y||g.y>e.max.y))return!1}if(!this.options.bounds)return!0;var I=this._tileCoordsToBounds(g);return F(this.options.bounds).overlaps(I)},_keyToBounds:function(g){return this._tileCoordsToBounds(this._keyToTileCoords(g))},_tileCoordsToNwSe:function(g){var t=this._map,e=this.getTileSize(),I=g.scaleBy(e),n=I.add(e);return[t.unproject(I,g.z),t.unproject(n,g.z)]},_tileCoordsToBounds:function(g){var t=this._tileCoordsToNwSe(g),e=new K(t[0],t[1]);return this.options.noWrap||(e=this._map.wrapLatLngBounds(e)),e},_tileCoordsToKey:function(g){return g.x+":"+g.y+":"+g.z},_keyToTileCoords:function(g){var t=g.split(":"),e=new k(+t[0],+t[1]);return e.z=+t[2],e},_removeTile:function(g){var t=this._tiles[g];t&&(dt(t.el),delete this._tiles[g],this.fire("tileunload",{tile:t.el,coords:this._keyToTileCoords(g)}))},_initTile:function(g){bt(g,"leaflet-tile");var t=this.getTileSize();g.style.width=t.x+"px",g.style.height=t.y+"px",g.onselectstart=s,g.onmousemove=s,Ng.ielt9&&this.options.opacity<1&&Bt(g,this.options.opacity)},_addTile:function(g,t){var e=this._getTilePos(g),I=this._tileCoordsToKey(g),C=this.createTile(this._wrapCoords(g),n(this._tileReady,this,g));this._initTile(C),this.createTile.length<2&&W(n(this._tileReady,this,g,null,C)),Rt(C,e),this._tiles[I]={el:C,coords:g,current:!0},t.appendChild(C),this.fire("tileloadstart",{tile:C,coords:g})},_tileReady:function(g,t,e){t&&this.fire("tileerror",{error:t,tile:e,coords:g});var I=this._tileCoordsToKey(g);(e=this._tiles[I])&&(e.loaded=+new Date,this._map._fadeAnimated?(Bt(e.el,0),S(this._fadeFrame),this._fadeFrame=W(this._updateOpacity,this)):(e.active=!0,this._pruneTiles()),t||(bt(e.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:e.el,coords:g})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Ng.ielt9||!this._map._fadeAnimated?W(this._pruneTiles,this):setTimeout(n(this._pruneTiles,this),250)))},_getTilePos:function(g){return g.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(g){var t=new k(this._wrapX?o(g.x,this._wrapX):g.x,this._wrapY?o(g.y,this._wrapY):g.y);return t.z=g.z,t},_pxBoundsToTileRange:function(g){var t=this.getTileSize();return new w(g.min.unscaleBy(t).floor(),g.max.unscaleBy(t).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var g in this._tiles)if(!this._tiles[g].loaded)return!1;return!0}});function KI(g){return new NI(g)}var FI=NI.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(g,t){this._url=g,(t=A(this,t)).detectRetina&&Ng.retina&&t.maxZoom>0?(t.tileSize=Math.floor(t.tileSize/2),t.zoomReverse?(t.zoomOffset--,t.minZoom=Math.min(t.maxZoom,t.minZoom+1)):(t.zoomOffset++,t.maxZoom=Math.max(t.minZoom,t.maxZoom-1)),t.minZoom=Math.max(0,t.minZoom)):t.zoomReverse?t.minZoom=Math.min(t.maxZoom,t.minZoom):t.maxZoom=Math.max(t.minZoom,t.maxZoom),"string"===typeof t.subdomains&&(t.subdomains=t.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(g,t){return this._url===g&&void 0===t&&(t=!0),this._url=g,t||this.redraw(),this},createTile:function(g,t){var e=document.createElement("img");return Kt(e,"load",n(this._tileOnLoad,this,t,e)),Kt(e,"error",n(this._tileOnError,this,t,e)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(e.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),"string"===typeof this.options.referrerPolicy&&(e.referrerPolicy=this.options.referrerPolicy),e.alt="",e.src=this.getTileUrl(g),e},getTileUrl:function(g){var t={r:Ng.retina?"@2x":"",s:this._getSubdomain(g),x:g.x,y:g.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var I=this._globalTileRange.max.y-g.y;this.options.tms&&(t.y=I),t["-y"]=I}return h(this._url,e(t,this.options))},_tileOnLoad:function(g,t){Ng.ielt9?setTimeout(n(g,this,null,t),0):g(null,t)},_tileOnError:function(g,t,e){var I=this.options.errorTileUrl;I&&t.getAttribute("src")!==I&&(t.src=I),g(e,t)},_onTileRemove:function(g){g.tile.onload=null},_getZoomForUrl:function(){var g=this._tileZoom,t=this.options.maxZoom;return this.options.zoomReverse&&(g=t-g),g+this.options.zoomOffset},_getSubdomain:function(g){var t=Math.abs(g.x+g.y)%this.options.subdomains.length;return this.options.subdomains[t]},_abortLoading:function(){var g,t;for(g in this._tiles)if(this._tiles[g].coords.z!==this._tileZoom&&((t=this._tiles[g].el).onload=s,t.onerror=s,!t.complete)){t.src=b;var e=this._tiles[g].coords;dt(t),delete this._tiles[g],this.fire("tileabort",{tile:t,coords:e})}},_removeTile:function(g){var t=this._tiles[g];if(t)return t.el.setAttribute("src",b),NI.prototype._removeTile.call(this,g)},_tileReady:function(g,t,e){if(this._map&&(!e||e.getAttribute("src")!==b))return NI.prototype._tileReady.call(this,g,t,e)}});function EI(g,t){return new FI(g,t)}var zI=FI.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(g,t){this._url=g;var I=e({},this.defaultWmsParams);for(var n in t)n in this.options||(I[n]=t[n]);var C=(t=A(this,t)).detectRetina&&Ng.retina?2:1,i=this.getTileSize();I.width=i.x*C,I.height=i.y*C,this.wmsParams=I},onAdd:function(g){this._crs=this.options.crs||g.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var t=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[t]=this._crs.code,FI.prototype.onAdd.call(this,g)},getTileUrl:function(g){var t=this._tileCoordsToNwSe(g),e=this._crs,I=N(e.project(t[0]),e.project(t[1])),n=I.min,C=I.max,i=(this._wmsVersion>=1.3&&this._crs===Me?[n.y,n.x,C.y,C.x]:[n.x,n.y,C.x,C.y]).join(","),l=FI.prototype.getTileUrl.call(this,g);return l+d(this.wmsParams,l,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+i},setParams:function(g,t){return e(this.wmsParams,g),t||this.redraw(),this}});function xI(g,t){return new zI(g,t)}FI.WMS=zI,EI.wms=xI;var LI=Te.extend({options:{padding:.1},initialize:function(g){A(this,g),i(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),bt(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var g={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(g.zoomanim=this._onAnimZoom),g},_onAnimZoom:function(g){this._updateTransform(g.center,g.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(g,t){var e=this._map.getZoomScale(t,this._zoom),I=this._map.getSize().multiplyBy(.5+this.options.padding),n=this._map.project(this._center,t),C=I.multiplyBy(-e).add(n).subtract(this._map._getNewPixelOrigin(g,t));Ng.any3d?St(this._container,C,e):Rt(this._container,C)},_reset:function(){for(var g in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[g]._reset()},_onZoomEnd:function(){for(var g in this._layers)this._layers[g]._project()},_updatePaths:function(){for(var g in this._layers)this._layers[g]._update()},_update:function(){var g=this.options.padding,t=this._map.getSize(),e=this._map.containerPointToLayerPoint(t.multiplyBy(-g)).round();this._bounds=new w(e,e.add(t.multiplyBy(1+2*g)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),MI=LI.extend({options:{tolerance:0},getEvents:function(){var g=LI.prototype.getEvents.call(this);return g.viewprereset=this._onViewPreReset,g},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){LI.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var g=this._container=document.createElement("canvas");Kt(g,"mousemove",this._onMouseMove,this),Kt(g,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Kt(g,"mouseout",this._handleMouseOut,this),g._leaflet_disable_events=!0,this._ctx=g.getContext("2d")},_destroyContainer:function(){S(this._redrawRequest),delete this._ctx,dt(this._container),Et(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var g in this._redrawBounds=null,this._layers)this._layers[g]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){LI.prototype._update.call(this);var g=this._bounds,t=this._container,e=g.getSize(),I=Ng.retina?2:1;Rt(t,g.min),t.width=I*e.x,t.height=I*e.y,t.style.width=e.x+"px",t.style.height=e.y+"px",Ng.retina&&this._ctx.scale(2,2),this._ctx.translate(-g.min.x,-g.min.y),this.fire("update")}},_reset:function(){LI.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(g){this._updateDashArray(g),this._layers[i(g)]=g;var t=g._order={layer:g,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=t),this._drawLast=t,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(g){this._requestRedraw(g)},_removePath:function(g){var t=g._order,e=t.next,I=t.prev;e?e.prev=I:this._drawLast=I,I?I.next=e:this._drawFirst=e,delete g._order,delete this._layers[i(g)],this._requestRedraw(g)},_updatePath:function(g){this._extendRedrawBounds(g),g._project(),g._update(),this._requestRedraw(g)},_updateStyle:function(g){this._updateDashArray(g),this._requestRedraw(g)},_updateDashArray:function(g){if("string"===typeof g.options.dashArray){var t,e,I=g.options.dashArray.split(/[, ]+/),n=[];for(e=0;e<I.length;e++){if(t=Number(I[e]),isNaN(t))return;n.push(t)}g.options._dashArray=n}else g.options._dashArray=g.options.dashArray},_requestRedraw:function(g){this._map&&(this._extendRedrawBounds(g),this._redrawRequest=this._redrawRequest||W(this._redraw,this))},_extendRedrawBounds:function(g){if(g._pxBounds){var t=(g.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new w,this._redrawBounds.extend(g._pxBounds.min.subtract([t,t])),this._redrawBounds.extend(g._pxBounds.max.add([t,t]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var g=this._redrawBounds;if(g){var t=g.getSize();this._ctx.clearRect(g.min.x,g.min.y,t.x,t.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var g,t=this._redrawBounds;if(this._ctx.save(),t){var e=t.getSize();this._ctx.beginPath(),this._ctx.rect(t.min.x,t.min.y,e.x,e.y),this._ctx.clip()}this._drawing=!0;for(var I=this._drawFirst;I;I=I.next)g=I.layer,(!t||g._pxBounds&&g._pxBounds.intersects(t))&&g._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(g,t){if(this._drawing){var e,I,n,C,i=g._parts,l=i.length,o=this._ctx;if(l){for(o.beginPath(),e=0;e<l;e++){for(I=0,n=i[e].length;I<n;I++)C=i[e][I],o[I?"lineTo":"moveTo"](C.x,C.y);t&&o.closePath()}this._fillStroke(o,g)}}},_updateCircle:function(g){if(this._drawing&&!g._empty()){var t=g._point,e=this._ctx,I=Math.max(Math.round(g._radius),1),n=(Math.max(Math.round(g._radiusY),1)||I)/I;1!==n&&(e.save(),e.scale(1,n)),e.beginPath(),e.arc(t.x,t.y/n,I,0,2*Math.PI,!1),1!==n&&e.restore(),this._fillStroke(e,g)}},_fillStroke:function(g,t){var e=t.options;e.fill&&(g.globalAlpha=e.fillOpacity,g.fillStyle=e.fillColor||e.color,g.fill(e.fillRule||"evenodd")),e.stroke&&0!==e.weight&&(g.setLineDash&&g.setLineDash(t.options&&t.options._dashArray||[]),g.globalAlpha=e.opacity,g.lineWidth=e.weight,g.strokeStyle=e.color,g.lineCap=e.lineCap,g.lineJoin=e.lineJoin,g.stroke())},_onClick:function(g){for(var t,e,I=this._map.mouseEventToLayerPoint(g),n=this._drawFirst;n;n=n.next)(t=n.layer).options.interactive&&t._containsPoint(I)&&("click"!==g.type&&"preclick"!==g.type||!this._map._draggableMoved(t))&&(e=t);this._fireEvent(!!e&&[e],g)},_onMouseMove:function(g){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var t=this._map.mouseEventToLayerPoint(g);this._handleMouseHover(g,t)}},_handleMouseOut:function(g){var t=this._hoveredLayer;t&&(Gt(this._container,"leaflet-interactive"),this._fireEvent([t],g,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(g,t){if(!this._mouseHoverThrottled){for(var e,I,C=this._drawFirst;C;C=C.next)(e=C.layer).options.interactive&&e._containsPoint(t)&&(I=e);I!==this._hoveredLayer&&(this._handleMouseOut(g),I&&(bt(this._container,"leaflet-interactive"),this._fireEvent([I],g,"mouseover"),this._hoveredLayer=I)),this._fireEvent(!!this._hoveredLayer&&[this._hoveredLayer],g),this._mouseHoverThrottled=!0,setTimeout(n((function(){this._mouseHoverThrottled=!1}),this),32)}},_fireEvent:function(g,t,e){this._map._fireDOMEvent(t,e||t.type,g)},_bringToFront:function(g){var t=g._order;if(t){var e=t.next,I=t.prev;e&&(e.prev=I,I?I.next=e:e&&(this._drawFirst=e),t.prev=this._drawLast,this._drawLast.next=t,t.next=null,this._drawLast=t,this._requestRedraw(g))}},_bringToBack:function(g){var t=g._order;if(t){var e=t.next,I=t.prev;I&&(I.next=e,e?e.prev=I:I&&(this._drawLast=I),t.prev=null,t.next=this._drawFirst,this._drawFirst.prev=t,this._drawFirst=t,this._requestRedraw(g))}}});function UI(g){return Ng.canvas?new MI(g):null}var TI=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(g){return document.createElement("<lvml:"+g+' class="lvml">')}}catch(g){}return function(g){return document.createElement("<"+g+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),QI={_initContainer:function(){this._container=At("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(LI.prototype._update.call(this),this.fire("update"))},_initPath:function(g){var t=g._container=TI("shape");bt(t,"leaflet-vml-shape "+(this.options.className||"")),t.coordsize="1 1",g._path=TI("path"),t.appendChild(g._path),this._updateStyle(g),this._layers[i(g)]=g},_addPath:function(g){var t=g._container;this._container.appendChild(t),g.options.interactive&&g.addInteractiveTarget(t)},_removePath:function(g){var t=g._container;dt(t),g.removeInteractiveTarget(t),delete this._layers[i(g)]},_updateStyle:function(g){var t=g._stroke,e=g._fill,I=g.options,n=g._container;n.stroked=!!I.stroke,n.filled=!!I.fill,I.stroke?(t||(t=g._stroke=TI("stroke")),n.appendChild(t),t.weight=I.weight+"px",t.color=I.color,t.opacity=I.opacity,I.dashArray?t.dashStyle=m(I.dashArray)?I.dashArray.join(" "):I.dashArray.replace(/( *, *)/g," "):t.dashStyle="",t.endcap=I.lineCap.replace("butt","flat"),t.joinstyle=I.lineJoin):t&&(n.removeChild(t),g._stroke=null),I.fill?(e||(e=g._fill=TI("fill")),n.appendChild(e),e.color=I.fillColor||I.color,e.opacity=I.fillOpacity):e&&(n.removeChild(e),g._fill=null)},_updateCircle:function(g){var t=g._point.round(),e=Math.round(g._radius),I=Math.round(g._radiusY||e);this._setPath(g,g._empty()?"M0 0":"AL "+t.x+","+t.y+" "+e+","+I+" 0,23592600")},_setPath:function(g,t){g._path.v=t},_bringToFront:function(g){ht(g._container)},_bringToBack:function(g){mt(g._container)}},DI=Ng.vml?TI:P,_I=LI.extend({_initContainer:function(){this._container=DI("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=DI("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){dt(this._container),Et(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!this._map._animatingZoom||!this._bounds){LI.prototype._update.call(this);var g=this._bounds,t=g.getSize(),e=this._container;this._svgSize&&this._svgSize.equals(t)||(this._svgSize=t,e.setAttribute("width",t.x),e.setAttribute("height",t.y)),Rt(e,g.min),e.setAttribute("viewBox",[g.min.x,g.min.y,t.x,t.y].join(" ")),this.fire("update")}},_initPath:function(g){var t=g._path=DI("path");g.options.className&&bt(t,g.options.className),g.options.interactive&&bt(t,"leaflet-interactive"),this._updateStyle(g),this._layers[i(g)]=g},_addPath:function(g){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(g._path),g.addInteractiveTarget(g._path)},_removePath:function(g){dt(g._path),g.removeInteractiveTarget(g._path),delete this._layers[i(g)]},_updatePath:function(g){g._project(),g._update()},_updateStyle:function(g){var t=g._path,e=g.options;t&&(e.stroke?(t.setAttribute("stroke",e.color),t.setAttribute("stroke-opacity",e.opacity),t.setAttribute("stroke-width",e.weight),t.setAttribute("stroke-linecap",e.lineCap),t.setAttribute("stroke-linejoin",e.lineJoin),e.dashArray?t.setAttribute("stroke-dasharray",e.dashArray):t.removeAttribute("stroke-dasharray"),e.dashOffset?t.setAttribute("stroke-dashoffset",e.dashOffset):t.removeAttribute("stroke-dashoffset")):t.setAttribute("stroke","none"),e.fill?(t.setAttribute("fill",e.fillColor||e.color),t.setAttribute("fill-opacity",e.fillOpacity),t.setAttribute("fill-rule",e.fillRule||"evenodd")):t.setAttribute("fill","none"))},_updatePoly:function(g,t){this._setPath(g,O(g._parts,t))},_updateCircle:function(g){var t=g._point,e=Math.max(Math.round(g._radius),1),I="a"+e+","+(Math.max(Math.round(g._radiusY),1)||e)+" 0 1,0 ",n=g._empty()?"M0 0":"M"+(t.x-e)+","+t.y+I+2*e+",0 "+I+2*-e+",0 ";this._setPath(g,n)},_setPath:function(g,t){g._path.setAttribute("d",t)},_bringToFront:function(g){ht(g._path)},_bringToBack:function(g){mt(g._path)}});function jI(g){return Ng.svg||Ng.vml?new _I(g):null}Ng.vml&&_I.include(QI),ee.include({getRenderer:function(g){var t=g.options.renderer||this._getPaneRenderer(g.options.pane)||this.options.renderer||this._renderer;return t||(t=this._renderer=this._createRenderer()),this.hasLayer(t)||this.addLayer(t),t},_getPaneRenderer:function(g){if("overlayPane"===g||void 0===g)return!1;var t=this._paneRenderers[g];return void 0===t&&(t=this._createRenderer({pane:g}),this._paneRenderers[g]=t),t},_createRenderer:function(g){return this.options.preferCanvas&&UI(g)||jI(g)}});var PI=sI.extend({initialize:function(g,t){sI.prototype.initialize.call(this,this._boundsToLatLngs(g),t)},setBounds:function(g){return this.setLatLngs(this._boundsToLatLngs(g))},_boundsToLatLngs:function(g){return[(g=F(g)).getSouthWest(),g.getNorthWest(),g.getNorthEast(),g.getSouthEast()]}});function OI(g,t){return new PI(g,t)}_I.create=DI,_I.pointsToPath=O,rI.geometryToLayer=cI,rI.coordsToLatLng=dI,rI.coordsToLatLngs=uI,rI.latLngToCoords=hI,rI.latLngsToCoords=mI,rI.getFeature=ZI,rI.asFeature=bI,ee.mergeOptions({boxZoom:!0});var qI=ue.extend({initialize:function(g){this._map=g,this._container=g._container,this._pane=g._panes.overlayPane,this._resetStateTimeout=0,g.on("unload",this._destroy,this)},addHooks:function(){Kt(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Et(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){dt(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(g){if(!g.shiftKey||1!==g.which&&1!==g.button)return!1;this._clearDeferredResetState(),this._resetState(),It(),Jt(),this._startPoint=this._map.mouseEventToContainerPoint(g),Kt(document,{contextmenu:_t,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(g){this._moved||(this._moved=!0,this._box=At("div","leaflet-zoom-box",this._container),bt(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(g);var t=new w(this._point,this._startPoint),e=t.getSize();Rt(this._box,t.min),this._box.style.width=e.x+"px",this._box.style.height=e.y+"px"},_finish:function(){this._moved&&(dt(this._box),Gt(this._container,"leaflet-crosshair")),nt(),vt(),Et(document,{contextmenu:_t,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(g){if((1===g.which||1===g.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(n(this._resetState,this),0);var t=new K(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(t).fire("boxzoomend",{boxZoomBounds:t})}},_onKeyDown:function(g){27===g.keyCode&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});ee.addInitHook("addHandler","boxZoom",qI),ee.mergeOptions({doubleClickZoom:!0});var $I=ue.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(g){var t=this._map,e=t.getZoom(),I=t.options.zoomDelta,n=g.originalEvent.shiftKey?e-I:e+I;"center"===t.options.doubleClickZoom?t.setZoom(n):t.setZoomAround(g.containerPoint,n)}});ee.addInitHook("addHandler","doubleClickZoom",$I),ee.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var gn=ue.extend({addHooks:function(){if(!this._draggable){var g=this._map;this._draggable=new Ze(g._mapPane,g._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),g.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),g.on("zoomend",this._onZoomEnd,this),g.whenReady(this._onZoomEnd,this))}bt(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Gt(this._map._container,"leaflet-grab"),Gt(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var g=this._map;if(g._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var t=F(this._map.options.maxBounds);this._offsetLimit=N(this._map.latLngToContainerPoint(t.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(t.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;g.fire("movestart").fire("dragstart"),g.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(g){if(this._map.options.inertia){var t=this._lastTime=+new Date,e=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(e),this._times.push(t),this._prunePositions(t)}this._map.fire("move",g).fire("drag",g)},_prunePositions:function(g){for(;this._positions.length>1&&g-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var g=this._map.getSize().divideBy(2),t=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=t.subtract(g).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(g,t){return g-(g-t)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var g=this._draggable._newPos.subtract(this._draggable._startPos),t=this._offsetLimit;g.x<t.min.x&&(g.x=this._viscousLimit(g.x,t.min.x)),g.y<t.min.y&&(g.y=this._viscousLimit(g.y,t.min.y)),g.x>t.max.x&&(g.x=this._viscousLimit(g.x,t.max.x)),g.y>t.max.y&&(g.y=this._viscousLimit(g.y,t.max.y)),this._draggable._newPos=this._draggable._startPos.add(g)}},_onPreDragWrap:function(){var g=this._worldWidth,t=Math.round(g/2),e=this._initialWorldOffset,I=this._draggable._newPos.x,n=(I-t+e)%g+t-e,C=(I+t+e)%g-t-e,i=Math.abs(n+e)<Math.abs(C+e)?n:C;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=i},_onDragEnd:function(g){var t=this._map,e=t.options,I=!e.inertia||g.noInertia||this._times.length<2;if(t.fire("dragend",g),I)t.fire("moveend");else{this._prunePositions(+new Date);var n=this._lastPos.subtract(this._positions[0]),C=(this._lastTime-this._times[0])/1e3,i=e.easeLinearity,l=n.multiplyBy(i/C),o=l.distanceTo([0,0]),s=Math.min(e.inertiaMaxSpeed,o),a=l.multiplyBy(s/o),r=s/(e.inertiaDeceleration*i),c=a.multiplyBy(-r/2).round();c.x||c.y?(c=t._limitOffset(c,t.options.maxBounds),W((function(){t.panBy(c,{duration:r,easeLinearity:i,noMoveStart:!0,animate:!0})}))):t.fire("moveend")}}});ee.addInitHook("addHandler","dragging",gn),ee.mergeOptions({keyboard:!0,keyboardPanDelta:80});var tn=ue.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(g){this._map=g,this._setPanDelta(g.options.keyboardPanDelta),this._setZoomDelta(g.options.zoomDelta)},addHooks:function(){var g=this._map._container;g.tabIndex<=0&&(g.tabIndex="0"),Kt(g,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Et(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var g=document.body,t=document.documentElement,e=g.scrollTop||t.scrollTop,I=g.scrollLeft||t.scrollLeft;this._map._container.focus(),window.scrollTo(I,e)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(g){var t,e,I=this._panKeys={},n=this.keyCodes;for(t=0,e=n.left.length;t<e;t++)I[n.left[t]]=[-1*g,0];for(t=0,e=n.right.length;t<e;t++)I[n.right[t]]=[g,0];for(t=0,e=n.down.length;t<e;t++)I[n.down[t]]=[0,g];for(t=0,e=n.up.length;t<e;t++)I[n.up[t]]=[0,-1*g]},_setZoomDelta:function(g){var t,e,I=this._zoomKeys={},n=this.keyCodes;for(t=0,e=n.zoomIn.length;t<e;t++)I[n.zoomIn[t]]=g;for(t=0,e=n.zoomOut.length;t<e;t++)I[n.zoomOut[t]]=-g},_addHooks:function(){Kt(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Et(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(g){if(!(g.altKey||g.ctrlKey||g.metaKey)){var t,e=g.keyCode,I=this._map;if(e in this._panKeys){if(!I._panAnim||!I._panAnim._inProgress)if(t=this._panKeys[e],g.shiftKey&&(t=H(t).multiplyBy(3)),I.options.maxBounds&&(t=I._limitOffset(H(t),I.options.maxBounds)),I.options.worldCopyJump){var n=I.wrapLatLng(I.unproject(I.project(I.getCenter()).add(t)));I.panTo(n)}else I.panBy(t)}else if(e in this._zoomKeys)I.setZoom(I.getZoom()+(g.shiftKey?3:1)*this._zoomKeys[e]);else{if(27!==e||!I._popup||!I._popup.options.closeOnEscapeKey)return;I.closePopup()}_t(g)}}});ee.addInitHook("addHandler","keyboard",tn),ee.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var en=ue.extend({addHooks:function(){Kt(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Et(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(g){var t=qt(g),e=this._map.options.wheelDebounceTime;this._delta+=t,this._lastMousePos=this._map.mouseEventToContainerPoint(g),this._startTime||(this._startTime=+new Date);var I=Math.max(e-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(n(this._performZoom,this),I),_t(g)},_performZoom:function(){var g=this._map,t=g.getZoom(),e=this._map.options.zoomSnap||0;g._stop();var I=this._delta/(4*this._map.options.wheelPxPerZoomLevel),n=4*Math.log(2/(1+Math.exp(-Math.abs(I))))/Math.LN2,C=e?Math.ceil(n/e)*e:n,i=g._limitZoom(t+(this._delta>0?C:-C))-t;this._delta=0,this._startTime=null,i&&("center"===g.options.scrollWheelZoom?g.setZoom(t+i):g.setZoomAround(this._lastMousePos,t+i))}});ee.addInitHook("addHandler","scrollWheelZoom",en);var In=600;ee.mergeOptions({tapHold:Ng.touchNative&&Ng.safari&&Ng.mobile,tapTolerance:15});var nn=ue.extend({addHooks:function(){Kt(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Et(this._map._container,"touchstart",this._onDown,this)},_onDown:function(g){if(clearTimeout(this._holdTimeout),1===g.touches.length){var t=g.touches[0];this._startPos=this._newPos=new k(t.clientX,t.clientY),this._holdTimeout=setTimeout(n((function(){this._cancel(),this._isTapValid()&&(Kt(document,"touchend",Dt),Kt(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",t))}),this),In),Kt(document,"touchend touchcancel contextmenu",this._cancel,this),Kt(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function g(){Et(document,"touchend",Dt),Et(document,"touchend touchcancel",g)},_cancel:function(){clearTimeout(this._holdTimeout),Et(document,"touchend touchcancel contextmenu",this._cancel,this),Et(document,"touchmove",this._onMove,this)},_onMove:function(g){var t=g.touches[0];this._newPos=new k(t.clientX,t.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(g,t){var e=new MouseEvent(g,{bubbles:!0,cancelable:!0,view:window,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY});e._simulated=!0,t.target.dispatchEvent(e)}});ee.addInitHook("addHandler","tapHold",nn),ee.mergeOptions({touchZoom:Ng.touch,bounceAtZoomLimits:!0});var Cn=ue.extend({addHooks:function(){bt(this._map._container,"leaflet-touch-zoom"),Kt(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Gt(this._map._container,"leaflet-touch-zoom"),Et(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(g){var t=this._map;if(g.touches&&2===g.touches.length&&!t._animatingZoom&&!this._zooming){var e=t.mouseEventToContainerPoint(g.touches[0]),I=t.mouseEventToContainerPoint(g.touches[1]);this._centerPoint=t.getSize()._divideBy(2),this._startLatLng=t.containerPointToLatLng(this._centerPoint),"center"!==t.options.touchZoom&&(this._pinchStartLatLng=t.containerPointToLatLng(e.add(I)._divideBy(2))),this._startDist=e.distanceTo(I),this._startZoom=t.getZoom(),this._moved=!1,this._zooming=!0,t._stop(),Kt(document,"touchmove",this._onTouchMove,this),Kt(document,"touchend touchcancel",this._onTouchEnd,this),Dt(g)}},_onTouchMove:function(g){if(g.touches&&2===g.touches.length&&this._zooming){var t=this._map,e=t.mouseEventToContainerPoint(g.touches[0]),I=t.mouseEventToContainerPoint(g.touches[1]),C=e.distanceTo(I)/this._startDist;if(this._zoom=t.getScaleZoom(C,this._startZoom),!t.options.bounceAtZoomLimits&&(this._zoom<t.getMinZoom()&&C<1||this._zoom>t.getMaxZoom()&&C>1)&&(this._zoom=t._limitZoom(this._zoom)),"center"===t.options.touchZoom){if(this._center=this._startLatLng,1===C)return}else{var i=e._add(I)._divideBy(2)._subtract(this._centerPoint);if(1===C&&0===i.x&&0===i.y)return;this._center=t.unproject(t.project(this._pinchStartLatLng,this._zoom).subtract(i),this._zoom)}this._moved||(t._moveStart(!0,!1),this._moved=!0),S(this._animRequest);var l=n(t._move,t,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=W(l,this,!0),Dt(g)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,S(this._animRequest),Et(document,"touchmove",this._onTouchMove,this),Et(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});ee.addInitHook("addHandler","touchZoom",Cn),ee.BoxZoom=qI,ee.DoubleClickZoom=$I,ee.Drag=gn,ee.Keyboard=tn,ee.ScrollWheelZoom=en,ee.TapHold=nn,ee.TouchZoom=Cn,g.Bounds=w,g.Browser=Ng,g.CRS=x,g.Canvas=MI,g.Circle=CI,g.CircleMarker=II,g.Class=f,g.Control=ne,g.DivIcon=HI,g.DivOverlay=XI,g.DomEvent=ge,g.DomUtil=Nt,g.Draggable=Ze,g.Evented=v,g.FeatureGroup=_e,g.GeoJSON=rI,g.GridLayer=NI,g.Handler=ue,g.Icon=Pe,g.ImageOverlay=BI,g.LatLng=E,g.LatLngBounds=K,g.Layer=Te,g.LayerGroup=Qe,g.LineUtil=Fe,g.Map=ee,g.Marker=gI,g.Mixin=he,g.Path=eI,g.Point=k,g.PolyUtil=Be,g.Polygon=sI,g.Polyline=lI,g.Popup=JI,g.PosAnimation=te,g.Projection=xe,g.Rectangle=PI,g.Renderer=LI,g.SVG=_I,g.SVGOverlay=RI,g.TileLayer=FI,g.Tooltip=kI,g.Transformation=Q,g.Util=R,g.VideoOverlay=WI,g.bind=n,g.bounds=N,g.canvas=UI,g.circle=iI,g.circleMarker=nI,g.control=Ce,g.divIcon=wI,g.extend=e,g.featureGroup=je,g.geoJSON=pI,g.geoJson=yI,g.gridLayer=KI,g.icon=Oe,g.imageOverlay=VI,g.latLng=z,g.latLngBounds=F,g.layerGroup=De,g.map=Ie,g.marker=tI,g.point=H,g.polygon=aI,g.polyline=oI,g.popup=vI,g.rectangle=OI,g.setOptions=A,g.stamp=i,g.svg=jI,g.svgOverlay=fI,g.tileLayer=EI,g.tooltip=YI,g.transformation=D,g.version=t,g.videoOverlay=SI;var ln=window.L;g.noConflict=function(){return window.L=ln,this},window.L=g}(t)},970:(g,t,e)=>{const I=e(116),n=e(772),C=e(182),i=e(487);function l(g,t,e,C,i){const l=[].slice.call(arguments,1),o=l.length,s="function"===typeof l[o-1];if(!s&&!I())throw new Error("Callback required as last argument");if(!s){if(o<1)throw new Error("Too few arguments provided");return 1===o?(e=t,t=C=void 0):2!==o||t.getContext||(C=e,e=t,t=void 0),new Promise((function(I,i){try{const i=n.create(e,C);I(g(i,t,C))}catch(l){i(l)}}))}if(o<2)throw new Error("Too few arguments provided");2===o?(i=e,e=t,t=C=void 0):3===o&&(t.getContext&&"undefined"===typeof i?(i=C,C=void 0):(i=C,C=e,e=t,t=void 0));try{const I=n.create(e,C);i(null,g(I,t,C))}catch(a){i(a)}}t.create=n.create,t.toCanvas=l.bind(null,C.render),t.toDataURL=l.bind(null,C.renderToDataURL),t.toString=l.bind(null,(function(g,t,e){return i.render(g,e)}))},116:g=>{g.exports=function(){return"function"===typeof Promise&&Promise.prototype&&Promise.prototype.then}},382:(g,t,e)=>{const I=e(969).getSymbolSize;t.getRowColCoords=function(g){if(1===g)return[];const t=Math.floor(g/7)+2,e=I(g),n=145===e?26:2*Math.ceil((e-13)/(2*t-2)),C=[e-7];for(let I=1;I<t-1;I++)C[I]=C[I-1]-n;return C.push(6),C.reverse()},t.getPositions=function(g){const e=[],I=t.getRowColCoords(g),n=I.length;for(let t=0;t<n;t++)for(let g=0;g<n;g++)0===t&&0===g||0===t&&g===n-1||t===n-1&&0===g||e.push([I[t],I[g]]);return e}},642:(g,t,e)=>{const I=e(421),n=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function C(g){this.mode=I.ALPHANUMERIC,this.data=g}C.getBitsLength=function(g){return 11*Math.floor(g/2)+g%2*6},C.prototype.getLength=function(){return this.data.length},C.prototype.getBitsLength=function(){return C.getBitsLength(this.data.length)},C.prototype.write=function(g){let t;for(t=0;t+2<=this.data.length;t+=2){let e=45*n.indexOf(this.data[t]);e+=n.indexOf(this.data[t+1]),g.put(e,11)}this.data.length%2&&g.put(n.indexOf(this.data[t]),6)},g.exports=C},566:g=>{function t(){this.buffer=[],this.length=0}t.prototype={get:function(g){const t=Math.floor(g/8);return 1===(this.buffer[t]>>>7-g%8&1)},put:function(g,t){for(let e=0;e<t;e++)this.putBit(1===(g>>>t-e-1&1))},getLengthInBits:function(){return this.length},putBit:function(g){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),g&&(this.buffer[t]|=128>>>this.length%8),this.length++}},g.exports=t},661:g=>{function t(g){if(!g||g<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=g,this.data=new Uint8Array(g*g),this.reservedBit=new Uint8Array(g*g)}t.prototype.set=function(g,t,e,I){const n=g*this.size+t;this.data[n]=e,I&&(this.reservedBit[n]=!0)},t.prototype.get=function(g,t){return this.data[g*this.size+t]},t.prototype.xor=function(g,t,e){this.data[g*this.size+t]^=e},t.prototype.isReserved=function(g,t){return this.reservedBit[g*this.size+t]},g.exports=t},697:(g,t,e)=>{const I=e(421);function n(g){this.mode=I.BYTE,this.data="string"===typeof g?(new TextEncoder).encode(g):new Uint8Array(g)}n.getBitsLength=function(g){return 8*g},n.prototype.getLength=function(){return this.data.length},n.prototype.getBitsLength=function(){return n.getBitsLength(this.data.length)},n.prototype.write=function(g){for(let t=0,e=this.data.length;t<e;t++)g.put(this.data[t],8)},g.exports=n},805:(g,t,e)=>{const I=e(272),n=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],C=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];t.getBlocksCount=function(g,t){switch(t){case I.L:return n[4*(g-1)+0];case I.M:return n[4*(g-1)+1];case I.Q:return n[4*(g-1)+2];case I.H:return n[4*(g-1)+3];default:return}},t.getTotalCodewordsCount=function(g,t){switch(t){case I.L:return C[4*(g-1)+0];case I.M:return C[4*(g-1)+1];case I.Q:return C[4*(g-1)+2];case I.H:return C[4*(g-1)+3];default:return}}},272:(g,t)=>{t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2},t.isValid=function(g){return g&&"undefined"!==typeof g.bit&&g.bit>=0&&g.bit<4},t.from=function(g,e){if(t.isValid(g))return g;try{return function(g){if("string"!==typeof g)throw new Error("Param is not a string");switch(g.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+g)}}(g)}catch(I){return e}}},21:(g,t,e)=>{const I=e(969).getSymbolSize;t.getPositions=function(g){const t=I(g);return[[0,0],[t-7,0],[0,t-7]]}},350:(g,t,e)=>{const I=e(969),n=I.getBCHDigit(1335);t.getEncodedBits=function(g,t){const e=g.bit<<3|t;let C=e<<10;for(;I.getBCHDigit(C)-n>=0;)C^=1335<<I.getBCHDigit(C)-n;return 21522^(e<<10|C)}},166:(g,t)=>{const e=new Uint8Array(512),I=new Uint8Array(256);!function(){let g=1;for(let t=0;t<255;t++)e[t]=g,I[g]=t,g<<=1,256&g&&(g^=285);for(let t=255;t<512;t++)e[t]=e[t-255]}(),t.log=function(g){if(g<1)throw new Error("log("+g+")");return I[g]},t.exp=function(g){return e[g]},t.mul=function(g,t){return 0===g||0===t?0:e[I[g]+I[t]]}},200:(g,t,e)=>{const I=e(421),n=e(969);function C(g){this.mode=I.KANJI,this.data=g}C.getBitsLength=function(g){return 13*g},C.prototype.getLength=function(){return this.data.length},C.prototype.getBitsLength=function(){return C.getBitsLength(this.data.length)},C.prototype.write=function(g){let t;for(t=0;t<this.data.length;t++){let e=n.toSJIS(this.data[t]);if(e>=33088&&e<=40956)e-=33088;else{if(!(e>=57408&&e<=60351))throw new Error("Invalid SJIS character: "+this.data[t]+"\nMake sure your charset is UTF-8");e-=49472}e=192*(e>>>8&255)+(255&e),g.put(e,13)}},g.exports=C},833:(g,t)=>{t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const e=3,I=3,n=40,C=10;function i(g,e,I){switch(g){case t.Patterns.PATTERN000:return(e+I)%2===0;case t.Patterns.PATTERN001:return e%2===0;case t.Patterns.PATTERN010:return I%3===0;case t.Patterns.PATTERN011:return(e+I)%3===0;case t.Patterns.PATTERN100:return(Math.floor(e/2)+Math.floor(I/3))%2===0;case t.Patterns.PATTERN101:return e*I%2+e*I%3===0;case t.Patterns.PATTERN110:return(e*I%2+e*I%3)%2===0;case t.Patterns.PATTERN111:return(e*I%3+(e+I)%2)%2===0;default:throw new Error("bad maskPattern:"+g)}}t.isValid=function(g){return null!=g&&""!==g&&!isNaN(g)&&g>=0&&g<=7},t.from=function(g){return t.isValid(g)?parseInt(g,10):void 0},t.getPenaltyN1=function(g){const t=g.size;let I=0,n=0,C=0,i=null,l=null;for(let o=0;o<t;o++){n=C=0,i=l=null;for(let s=0;s<t;s++){let t=g.get(o,s);t===i?n++:(n>=5&&(I+=e+(n-5)),i=t,n=1),t=g.get(s,o),t===l?C++:(C>=5&&(I+=e+(C-5)),l=t,C=1)}n>=5&&(I+=e+(n-5)),C>=5&&(I+=e+(C-5))}return I},t.getPenaltyN2=function(g){const t=g.size;let e=0;for(let I=0;I<t-1;I++)for(let n=0;n<t-1;n++){const t=g.get(I,n)+g.get(I,n+1)+g.get(I+1,n)+g.get(I+1,n+1);4!==t&&0!==t||e++}return e*I},t.getPenaltyN3=function(g){const t=g.size;let e=0,I=0,C=0;for(let n=0;n<t;n++){I=C=0;for(let i=0;i<t;i++)I=I<<1&2047|g.get(n,i),i>=10&&(1488===I||93===I)&&e++,C=C<<1&2047|g.get(i,n),i>=10&&(1488===C||93===C)&&e++}return e*n},t.getPenaltyN4=function(g){let t=0;const e=g.data.length;for(let I=0;I<e;I++)t+=g.data[I];return Math.abs(Math.ceil(100*t/e/5)-10)*C},t.applyMask=function(g,t){const e=t.size;for(let I=0;I<e;I++)for(let n=0;n<e;n++)t.isReserved(n,I)||t.xor(n,I,i(g,n,I))},t.getBestMask=function(g,e){const I=Object.keys(t.Patterns).length;let n=0,C=1/0;for(let i=0;i<I;i++){e(i),t.applyMask(i,g);const I=t.getPenaltyN1(g)+t.getPenaltyN2(g)+t.getPenaltyN3(g)+t.getPenaltyN4(g);t.applyMask(i,g),I<C&&(C=I,n=i)}return n}},421:(g,t,e)=>{const I=e(257),n=e(511);t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(g,t){if(!g.ccBits)throw new Error("Invalid mode: "+g);if(!I.isValid(t))throw new Error("Invalid version: "+t);return t>=1&&t<10?g.ccBits[0]:t<27?g.ccBits[1]:g.ccBits[2]},t.getBestModeForData=function(g){return n.testNumeric(g)?t.NUMERIC:n.testAlphanumeric(g)?t.ALPHANUMERIC:n.testKanji(g)?t.KANJI:t.BYTE},t.toString=function(g){if(g&&g.id)return g.id;throw new Error("Invalid mode")},t.isValid=function(g){return g&&g.bit&&g.ccBits},t.from=function(g,e){if(t.isValid(g))return g;try{return function(g){if("string"!==typeof g)throw new Error("Param is not a string");switch(g.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+g)}}(g)}catch(I){return e}}},900:(g,t,e)=>{const I=e(421);function n(g){this.mode=I.NUMERIC,this.data=g.toString()}n.getBitsLength=function(g){return 10*Math.floor(g/3)+(g%3?g%3*3+1:0)},n.prototype.getLength=function(){return this.data.length},n.prototype.getBitsLength=function(){return n.getBitsLength(this.data.length)},n.prototype.write=function(g){let t,e,I;for(t=0;t+3<=this.data.length;t+=3)e=this.data.substr(t,3),I=parseInt(e,10),g.put(I,10);const n=this.data.length-t;n>0&&(e=this.data.substr(t),I=parseInt(e,10),g.put(I,3*n+1))},g.exports=n},312:(g,t,e)=>{const I=e(166);t.mul=function(g,t){const e=new Uint8Array(g.length+t.length-1);for(let n=0;n<g.length;n++)for(let C=0;C<t.length;C++)e[n+C]^=I.mul(g[n],t[C]);return e},t.mod=function(g,t){let e=new Uint8Array(g);for(;e.length-t.length>=0;){const g=e[0];for(let C=0;C<t.length;C++)e[C]^=I.mul(t[C],g);let n=0;for(;n<e.length&&0===e[n];)n++;e=e.slice(n)}return e},t.generateECPolynomial=function(g){let e=new Uint8Array([1]);for(let n=0;n<g;n++)e=t.mul(e,new Uint8Array([1,I.exp(n)]));return e}},772:(g,t,e)=>{const I=e(969),n=e(272),C=e(566),i=e(661),l=e(382),o=e(21),s=e(833),a=e(805),r=e(177),c=e(980),A=e(350),d=e(421),u=e(4);function h(g,t,e){const I=g.size,n=A.getEncodedBits(t,e);let C,i;for(C=0;C<15;C++)i=1===(n>>C&1),C<6?g.set(C,8,i,!0):C<8?g.set(C+1,8,i,!0):g.set(I-15+C,8,i,!0),C<8?g.set(8,I-C-1,i,!0):C<9?g.set(8,15-C-1+1,i,!0):g.set(8,15-C-1,i,!0);g.set(I-8,8,1,!0)}function m(g,t,e){const n=new C;e.forEach((function(t){n.put(t.mode.bit,4),n.put(t.getLength(),d.getCharCountIndicator(t.mode,g)),t.write(n)}));const i=8*(I.getSymbolTotalCodewords(g)-a.getTotalCodewordsCount(g,t));for(n.getLengthInBits()+4<=i&&n.put(0,4);n.getLengthInBits()%8!==0;)n.putBit(0);const l=(i-n.getLengthInBits())/8;for(let I=0;I<l;I++)n.put(I%2?17:236,8);return function(g,t,e){const n=I.getSymbolTotalCodewords(t),C=a.getTotalCodewordsCount(t,e),i=n-C,l=a.getBlocksCount(t,e),o=n%l,s=l-o,c=Math.floor(n/l),A=Math.floor(i/l),d=A+1,u=c-A,h=new r(u);let m=0;const Z=new Array(l),b=new Array(l);let G=0;const p=new Uint8Array(g.buffer);for(let I=0;I<l;I++){const g=I<s?A:d;Z[I]=p.slice(m,m+g),b[I]=h.encode(Z[I]),m+=g,G=Math.max(G,g)}const y=new Uint8Array(n);let B,V,W=0;for(B=0;B<G;B++)for(V=0;V<l;V++)B<Z[V].length&&(y[W++]=Z[V][B]);for(B=0;B<u;B++)for(V=0;V<l;V++)y[W++]=b[V][B];return y}(n,g,t)}function Z(g,t,e,n){let C;if(Array.isArray(g))C=u.fromArray(g);else{if("string"!==typeof g)throw new Error("Invalid data");{let I=t;if(!I){const t=u.rawSplit(g);I=c.getBestVersionForData(t,e)}C=u.fromString(g,I||40)}}const a=c.getBestVersionForData(C,e);if(!a)throw new Error("The amount of data is too big to be stored in a QR Code");if(t){if(t<a)throw new Error("\nThe chosen QR Code version cannot contain this amount of data.\nMinimum version required to store current data is: "+a+".\n")}else t=a;const r=m(t,e,C),A=I.getSymbolSize(t),d=new i(A);return function(g,t){const e=g.size,I=o.getPositions(t);for(let n=0;n<I.length;n++){const t=I[n][0],C=I[n][1];for(let I=-1;I<=7;I++)if(!(t+I<=-1||e<=t+I))for(let n=-1;n<=7;n++)C+n<=-1||e<=C+n||(I>=0&&I<=6&&(0===n||6===n)||n>=0&&n<=6&&(0===I||6===I)||I>=2&&I<=4&&n>=2&&n<=4?g.set(t+I,C+n,!0,!0):g.set(t+I,C+n,!1,!0))}}(d,t),function(g){const t=g.size;for(let e=8;e<t-8;e++){const t=e%2===0;g.set(e,6,t,!0),g.set(6,e,t,!0)}}(d),function(g,t){const e=l.getPositions(t);for(let I=0;I<e.length;I++){const t=e[I][0],n=e[I][1];for(let e=-2;e<=2;e++)for(let I=-2;I<=2;I++)-2===e||2===e||-2===I||2===I||0===e&&0===I?g.set(t+e,n+I,!0,!0):g.set(t+e,n+I,!1,!0)}}(d,t),h(d,e,0),t>=7&&function(g,t){const e=g.size,I=c.getEncodedBits(t);let n,C,i;for(let l=0;l<18;l++)n=Math.floor(l/3),C=l%3+e-8-3,i=1===(I>>l&1),g.set(n,C,i,!0),g.set(C,n,i,!0)}(d,t),function(g,t){const e=g.size;let I=-1,n=e-1,C=7,i=0;for(let l=e-1;l>0;l-=2)for(6===l&&l--;;){for(let e=0;e<2;e++)if(!g.isReserved(n,l-e)){let I=!1;i<t.length&&(I=1===(t[i]>>>C&1)),g.set(n,l-e,I),C--,-1===C&&(i++,C=7)}if(n+=I,n<0||e<=n){n-=I,I=-I;break}}}(d,r),isNaN(n)&&(n=s.getBestMask(d,h.bind(null,d,e))),s.applyMask(n,d),h(d,e,n),{modules:d,version:t,errorCorrectionLevel:e,maskPattern:n,segments:C}}t.create=function(g,t){if("undefined"===typeof g||""===g)throw new Error("No input text");let e,C,i=n.M;return"undefined"!==typeof t&&(i=n.from(t.errorCorrectionLevel,n.M),e=c.from(t.version),C=s.from(t.maskPattern),t.toSJISFunc&&I.setToSJISFunction(t.toSJISFunc)),Z(g,e,i,C)}},177:(g,t,e)=>{const I=e(312);function n(g){this.genPoly=void 0,this.degree=g,this.degree&&this.initialize(this.degree)}n.prototype.initialize=function(g){this.degree=g,this.genPoly=I.generateECPolynomial(this.degree)},n.prototype.encode=function(g){if(!this.genPoly)throw new Error("Encoder not initialized");const t=new Uint8Array(g.length+this.degree);t.set(g);const e=I.mod(t,this.genPoly),n=this.degree-e.length;if(n>0){const g=new Uint8Array(this.degree);return g.set(e,n),g}return e},g.exports=n},511:(g,t)=>{const e="[0-9]+";let I="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";I=I.replace(/u/g,"\\u");const n="(?:(?![A-Z0-9 $%*+\\-./:]|"+I+")(?:.|[\r\n]))+";t.KANJI=new RegExp(I,"g"),t.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),t.BYTE=new RegExp(n,"g"),t.NUMERIC=new RegExp(e,"g"),t.ALPHANUMERIC=new RegExp("[A-Z $%*+\\-./:]+","g");const C=new RegExp("^"+I+"$"),i=new RegExp("^"+e+"$"),l=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");t.testKanji=function(g){return C.test(g)},t.testNumeric=function(g){return i.test(g)},t.testAlphanumeric=function(g){return l.test(g)}},4:(g,t,e)=>{const I=e(421),n=e(900),C=e(642),i=e(697),l=e(200),o=e(511),s=e(969),a=e(347);function r(g){return unescape(encodeURIComponent(g)).length}function c(g,t,e){const I=[];let n;for(;null!==(n=g.exec(e));)I.push({data:n[0],index:n.index,mode:t,length:n[0].length});return I}function A(g){const t=c(o.NUMERIC,I.NUMERIC,g),e=c(o.ALPHANUMERIC,I.ALPHANUMERIC,g);let n,C;s.isKanjiModeEnabled()?(n=c(o.BYTE,I.BYTE,g),C=c(o.KANJI,I.KANJI,g)):(n=c(o.BYTE_KANJI,I.BYTE,g),C=[]);return t.concat(e,n,C).sort((function(g,t){return g.index-t.index})).map((function(g){return{data:g.data,mode:g.mode,length:g.length}}))}function d(g,t){switch(t){case I.NUMERIC:return n.getBitsLength(g);case I.ALPHANUMERIC:return C.getBitsLength(g);case I.KANJI:return l.getBitsLength(g);case I.BYTE:return i.getBitsLength(g)}}function u(g,t){let e;const o=I.getBestModeForData(g);if(e=I.from(t,o),e!==I.BYTE&&e.bit<o.bit)throw new Error('"'+g+'" cannot be encoded with mode '+I.toString(e)+".\n Suggested mode is: "+I.toString(o));switch(e!==I.KANJI||s.isKanjiModeEnabled()||(e=I.BYTE),e){case I.NUMERIC:return new n(g);case I.ALPHANUMERIC:return new C(g);case I.KANJI:return new l(g);case I.BYTE:return new i(g)}}t.fromArray=function(g){return g.reduce((function(g,t){return"string"===typeof t?g.push(u(t,null)):t.data&&g.push(u(t.data,t.mode)),g}),[])},t.fromString=function(g,e){const n=function(g){const t=[];for(let e=0;e<g.length;e++){const n=g[e];switch(n.mode){case I.NUMERIC:t.push([n,{data:n.data,mode:I.ALPHANUMERIC,length:n.length},{data:n.data,mode:I.BYTE,length:n.length}]);break;case I.ALPHANUMERIC:t.push([n,{data:n.data,mode:I.BYTE,length:n.length}]);break;case I.KANJI:t.push([n,{data:n.data,mode:I.BYTE,length:r(n.data)}]);break;case I.BYTE:t.push([{data:n.data,mode:I.BYTE,length:r(n.data)}])}}return t}(A(g,s.isKanjiModeEnabled())),C=function(g,t){const e={},n={start:{}};let C=["start"];for(let i=0;i<g.length;i++){const l=g[i],o=[];for(let g=0;g<l.length;g++){const s=l[g],a=""+i+g;o.push(a),e[a]={node:s,lastCount:0},n[a]={};for(let g=0;g<C.length;g++){const i=C[g];e[i]&&e[i].node.mode===s.mode?(n[i][a]=d(e[i].lastCount+s.length,s.mode)-d(e[i].lastCount,s.mode),e[i].lastCount+=s.length):(e[i]&&(e[i].lastCount=s.length),n[i][a]=d(s.length,s.mode)+4+I.getCharCountIndicator(s.mode,t))}}C=o}for(let I=0;I<C.length;I++)n[C[I]].end=0;return{map:n,table:e}}(n,e),i=a.find_path(C.map,"start","end"),l=[];for(let t=1;t<i.length-1;t++)l.push(C.table[i[t]].node);return t.fromArray(function(g){return g.reduce((function(g,t){const e=g.length-1>=0?g[g.length-1]:null;return e&&e.mode===t.mode?(g[g.length-1].data+=t.data,g):(g.push(t),g)}),[])}(l))},t.rawSplit=function(g){return t.fromArray(A(g,s.isKanjiModeEnabled()))}},969:(g,t)=>{let e;const I=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];t.getSymbolSize=function(g){if(!g)throw new Error('"version" cannot be null or undefined');if(g<1||g>40)throw new Error('"version" should be in range from 1 to 40');return 4*g+17},t.getSymbolTotalCodewords=function(g){return I[g]},t.getBCHDigit=function(g){let t=0;for(;0!==g;)t++,g>>>=1;return t},t.setToSJISFunction=function(g){if("function"!==typeof g)throw new Error('"toSJISFunc" is not a valid function.');e=g},t.isKanjiModeEnabled=function(){return"undefined"!==typeof e},t.toSJIS=function(g){return e(g)}},257:(g,t)=>{t.isValid=function(g){return!isNaN(g)&&g>=1&&g<=40}},980:(g,t,e)=>{const I=e(969),n=e(805),C=e(272),i=e(421),l=e(257),o=I.getBCHDigit(7973);function s(g,t){return i.getCharCountIndicator(g,t)+4}function a(g,t){let e=0;return g.forEach((function(g){const I=s(g.mode,t);e+=I+g.getBitsLength()})),e}t.from=function(g,t){return l.isValid(g)?parseInt(g,10):t},t.getCapacity=function(g,t,e){if(!l.isValid(g))throw new Error("Invalid QR Code version");"undefined"===typeof e&&(e=i.BYTE);const C=8*(I.getSymbolTotalCodewords(g)-n.getTotalCodewordsCount(g,t));if(e===i.MIXED)return C;const o=C-s(e,g);switch(e){case i.NUMERIC:return Math.floor(o/10*3);case i.ALPHANUMERIC:return Math.floor(o/11*2);case i.KANJI:return Math.floor(o/13);case i.BYTE:default:return Math.floor(o/8)}},t.getBestVersionForData=function(g,e){let I;const n=C.from(e,C.M);if(Array.isArray(g)){if(g.length>1)return function(g,e){for(let I=1;I<=40;I++)if(a(g,I)<=t.getCapacity(I,e,i.MIXED))return I}(g,n);if(0===g.length)return 1;I=g[0]}else I=g;return function(g,e,I){for(let n=1;n<=40;n++)if(e<=t.getCapacity(n,I,g))return n}(I.mode,I.getLength(),n)},t.getEncodedBits=function(g){if(!l.isValid(g)||g<7)throw new Error("Invalid QR Code version");let t=g<<12;for(;I.getBCHDigit(t)-o>=0;)t^=7973<<I.getBCHDigit(t)-o;return g<<12|t}},182:(g,t,e)=>{const I=e(293);t.render=function(g,t,e){let n=e,C=t;"undefined"!==typeof n||t&&t.getContext||(n=t,t=void 0),t||(C=function(){try{return document.createElement("canvas")}catch(g){throw new Error("You need to specify a canvas element")}}()),n=I.getOptions(n);const i=I.getImageWidth(g.modules.size,n),l=C.getContext("2d"),o=l.createImageData(i,i);return I.qrToImageData(o.data,g,n),function(g,t,e){g.clearRect(0,0,t.width,t.height),t.style||(t.style={}),t.height=e,t.width=e,t.style.height=e+"px",t.style.width=e+"px"}(l,C,i),l.putImageData(o,0,0),C},t.renderToDataURL=function(g,e,I){let n=I;"undefined"!==typeof n||e&&e.getContext||(n=e,e=void 0),n||(n={});const C=t.render(g,e,n),i=n.type||"image/png",l=n.rendererOpts||{};return C.toDataURL(i,l.quality)}},487:(g,t,e)=>{const I=e(293);function n(g,t){const e=g.a/255,I=t+'="'+g.hex+'"';return e<1?I+" "+t+'-opacity="'+e.toFixed(2).slice(1)+'"':I}function C(g,t,e){let I=g+t;return"undefined"!==typeof e&&(I+=" "+e),I}t.render=function(g,t,e){const i=I.getOptions(t),l=g.modules.size,o=g.modules.data,s=l+2*i.margin,a=i.color.light.a?"<path "+n(i.color.light,"fill")+' d="M0 0h'+s+"v"+s+'H0z"/>':"",r="<path "+n(i.color.dark,"stroke")+' d="'+function(g,t,e){let I="",n=0,i=!1,l=0;for(let o=0;o<g.length;o++){const s=Math.floor(o%t),a=Math.floor(o/t);s||i||(i=!0),g[o]?(l++,o>0&&s>0&&g[o-1]||(I+=i?C("M",s+e,.5+a+e):C("m",n,0),n=0,i=!1),s+1<t&&g[o+1]||(I+=C("h",l),l=0)):n++}return I}(o,l,i.margin)+'"/>',c='viewBox="0 0 '+s+" "+s+'"',A='<svg xmlns="http://www.w3.org/2000/svg" '+(i.width?'width="'+i.width+'" height="'+i.width+'" ':"")+c+' shape-rendering="crispEdges">'+a+r+"</svg>\n";return"function"===typeof e&&e(null,A),A}},293:(g,t)=>{function e(g){if("number"===typeof g&&(g=g.toString()),"string"!==typeof g)throw new Error("Color should be defined as hex string");let t=g.slice().replace("#","").split("");if(t.length<3||5===t.length||t.length>8)throw new Error("Invalid hex color: "+g);3!==t.length&&4!==t.length||(t=Array.prototype.concat.apply([],t.map((function(g){return[g,g]})))),6===t.length&&t.push("F","F");const e=parseInt(t.join(""),16);return{r:e>>24&255,g:e>>16&255,b:e>>8&255,a:255&e,hex:"#"+t.slice(0,6).join("")}}t.getOptions=function(g){g||(g={}),g.color||(g.color={});const t="undefined"===typeof g.margin||null===g.margin||g.margin<0?4:g.margin,I=g.width&&g.width>=21?g.width:void 0,n=g.scale||4;return{width:I,scale:I?4:n,margin:t,color:{dark:e(g.color.dark||"#000000ff"),light:e(g.color.light||"#ffffffff")},type:g.type,rendererOpts:g.rendererOpts||{}}},t.getScale=function(g,t){return t.width&&t.width>=g+2*t.margin?t.width/(g+2*t.margin):t.scale},t.getImageWidth=function(g,e){const I=t.getScale(g,e);return Math.floor((g+2*e.margin)*I)},t.qrToImageData=function(g,e,I){const n=e.modules.size,C=e.modules.data,i=t.getScale(n,I),l=Math.floor((n+2*I.margin)*i),o=I.margin*i,s=[I.color.light,I.color.dark];for(let t=0;t<l;t++)for(let e=0;e<l;e++){let a=4*(t*l+e),r=I.color.light;if(t>=o&&e>=o&&t<l-o&&e<l-o){r=s[C[Math.floor((t-o)/i)*n+Math.floor((e-o)/i)]?1:0]}g[a++]=r.r,g[a++]=r.g,g[a++]=r.b,g[a]=r.a}}},730:(g,t,e)=>{"use strict";var I=e(43),n=e(853);function C(g){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+g,e=1;e<arguments.length;e++)t+="&args[]="+encodeURIComponent(arguments[e]);return"Minified React error #"+g+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,l={};function o(g,t){s(g,t),s(g+"Capture",t)}function s(g,t){for(l[g]=t,g=0;g<t.length;g++)i.add(t[g])}var a=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),r=Object.prototype.hasOwnProperty,c=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,A={},d={};function u(g,t,e,I,n,C,i){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=I,this.attributeNamespace=n,this.mustUseProperty=e,this.propertyName=g,this.type=t,this.sanitizeURL=C,this.removeEmptyString=i}var h={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(g){h[g]=new u(g,0,!1,g,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(g){var t=g[0];h[t]=new u(t,1,!1,g[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(g){h[g]=new u(g,2,!1,g.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(g){h[g]=new u(g,2,!1,g,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(g){h[g]=new u(g,3,!1,g.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(g){h[g]=new u(g,3,!0,g,null,!1,!1)})),["capture","download"].forEach((function(g){h[g]=new u(g,4,!1,g,null,!1,!1)})),["cols","rows","size","span"].forEach((function(g){h[g]=new u(g,6,!1,g,null,!1,!1)})),["rowSpan","start"].forEach((function(g){h[g]=new u(g,5,!1,g.toLowerCase(),null,!1,!1)}));var m=/[\-:]([a-z])/g;function Z(g){return g[1].toUpperCase()}function b(g,t,e,I){var n=h.hasOwnProperty(t)?h[t]:null;(null!==n?0!==n.type:I||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(g,t,e,I){if(null===t||"undefined"===typeof t||function(g,t,e,I){if(null!==e&&0===e.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!I&&(null!==e?!e.acceptsBooleans:"data-"!==(g=g.toLowerCase().slice(0,5))&&"aria-"!==g);default:return!1}}(g,t,e,I))return!0;if(I)return!1;if(null!==e)switch(e.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,e,n,I)&&(e=null),I||null===n?function(g){return!!r.call(d,g)||!r.call(A,g)&&(c.test(g)?d[g]=!0:(A[g]=!0,!1))}(t)&&(null===e?g.removeAttribute(t):g.setAttribute(t,""+e)):n.mustUseProperty?g[n.propertyName]=null===e?3!==n.type&&"":e:(t=n.attributeName,I=n.attributeNamespace,null===e?g.removeAttribute(t):(e=3===(n=n.type)||4===n&&!0===e?"":""+e,I?g.setAttributeNS(I,t,e):g.setAttribute(t,e))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(g){var t=g.replace(m,Z);h[t]=new u(t,1,!1,g,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(g){var t=g.replace(m,Z);h[t]=new u(t,1,!1,g,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(g){var t=g.replace(m,Z);h[t]=new u(t,1,!1,g,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(g){h[g]=new u(g,1,!1,g.toLowerCase(),null,!1,!1)})),h.xlinkHref=new u("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(g){h[g]=new u(g,1,!1,g.toLowerCase(),null,!0,!0)}));var G=I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,p=Symbol.for("react.element"),y=Symbol.for("react.portal"),B=Symbol.for("react.fragment"),V=Symbol.for("react.strict_mode"),W=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),R=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),X=Symbol.for("react.suspense"),J=Symbol.for("react.suspense_list"),v=Symbol.for("react.memo"),k=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var Y=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var H=Symbol.iterator;function w(g){return null===g||"object"!==typeof g?null:"function"===typeof(g=H&&g[H]||g["@@iterator"])?g:null}var N,K=Object.assign;function F(g){if(void 0===N)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);N=t&&t[1]||""}return"\n"+N+g}var E=!1;function z(g,t){if(!g||E)return"";E=!0;var e=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(s){var I=s}Reflect.construct(g,[],t)}else{try{t.call()}catch(s){I=s}g.call(t.prototype)}else{try{throw Error()}catch(s){I=s}g()}}catch(s){if(s&&I&&"string"===typeof s.stack){for(var n=s.stack.split("\n"),C=I.stack.split("\n"),i=n.length-1,l=C.length-1;1<=i&&0<=l&&n[i]!==C[l];)l--;for(;1<=i&&0<=l;i--,l--)if(n[i]!==C[l]){if(1!==i||1!==l)do{if(i--,0>--l||n[i]!==C[l]){var o="\n"+n[i].replace(" at new "," at ");return g.displayName&&o.includes("<anonymous>")&&(o=o.replace("<anonymous>",g.displayName)),o}}while(1<=i&&0<=l);break}}}finally{E=!1,Error.prepareStackTrace=e}return(g=g?g.displayName||g.name:"")?F(g):""}function x(g){switch(g.tag){case 5:return F(g.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return g=z(g.type,!1);case 11:return g=z(g.type.render,!1);case 1:return g=z(g.type,!0);default:return""}}function L(g){if(null==g)return null;if("function"===typeof g)return g.displayName||g.name||null;if("string"===typeof g)return g;switch(g){case B:return"Fragment";case y:return"Portal";case W:return"Profiler";case V:return"StrictMode";case X:return"Suspense";case J:return"SuspenseList"}if("object"===typeof g)switch(g.$$typeof){case R:return(g.displayName||"Context")+".Consumer";case S:return(g._context.displayName||"Context")+".Provider";case f:var t=g.render;return(g=g.displayName)||(g=""!==(g=t.displayName||t.name||"")?"ForwardRef("+g+")":"ForwardRef"),g;case v:return null!==(t=g.displayName||null)?t:L(g.type)||"Memo";case k:t=g._payload,g=g._init;try{return L(g(t))}catch(e){}}return null}function M(g){var t=g.type;switch(g.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return g=(g=t.render).displayName||g.name||"",t.displayName||(""!==g?"ForwardRef("+g+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return L(t);case 8:return t===V?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function U(g){switch(typeof g){case"boolean":case"number":case"string":case"undefined":case"object":return g;default:return""}}function T(g){var t=g.type;return(g=g.nodeName)&&"input"===g.toLowerCase()&&("checkbox"===t||"radio"===t)}function Q(g){g._valueTracker||(g._valueTracker=function(g){var t=T(g)?"checked":"value",e=Object.getOwnPropertyDescriptor(g.constructor.prototype,t),I=""+g[t];if(!g.hasOwnProperty(t)&&"undefined"!==typeof e&&"function"===typeof e.get&&"function"===typeof e.set){var n=e.get,C=e.set;return Object.defineProperty(g,t,{configurable:!0,get:function(){return n.call(this)},set:function(g){I=""+g,C.call(this,g)}}),Object.defineProperty(g,t,{enumerable:e.enumerable}),{getValue:function(){return I},setValue:function(g){I=""+g},stopTracking:function(){g._valueTracker=null,delete g[t]}}}}(g))}function D(g){if(!g)return!1;var t=g._valueTracker;if(!t)return!0;var e=t.getValue(),I="";return g&&(I=T(g)?g.checked?"true":"false":g.value),(g=I)!==e&&(t.setValue(g),!0)}function _(g){if("undefined"===typeof(g=g||("undefined"!==typeof document?document:void 0)))return null;try{return g.activeElement||g.body}catch(t){return g.body}}function j(g,t){var e=t.checked;return K({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=e?e:g._wrapperState.initialChecked})}function P(g,t){var e=null==t.defaultValue?"":t.defaultValue,I=null!=t.checked?t.checked:t.defaultChecked;e=U(null!=t.value?t.value:e),g._wrapperState={initialChecked:I,initialValue:e,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function O(g,t){null!=(t=t.checked)&&b(g,"checked",t,!1)}function q(g,t){O(g,t);var e=U(t.value),I=t.type;if(null!=e)"number"===I?(0===e&&""===g.value||g.value!=e)&&(g.value=""+e):g.value!==""+e&&(g.value=""+e);else if("submit"===I||"reset"===I)return void g.removeAttribute("value");t.hasOwnProperty("value")?gg(g,t.type,e):t.hasOwnProperty("defaultValue")&&gg(g,t.type,U(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(g.defaultChecked=!!t.defaultChecked)}function $(g,t,e){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var I=t.type;if(!("submit"!==I&&"reset"!==I||void 0!==t.value&&null!==t.value))return;t=""+g._wrapperState.initialValue,e||t===g.value||(g.value=t),g.defaultValue=t}""!==(e=g.name)&&(g.name=""),g.defaultChecked=!!g._wrapperState.initialChecked,""!==e&&(g.name=e)}function gg(g,t,e){"number"===t&&_(g.ownerDocument)===g||(null==e?g.defaultValue=""+g._wrapperState.initialValue:g.defaultValue!==""+e&&(g.defaultValue=""+e))}var tg=Array.isArray;function eg(g,t,e,I){if(g=g.options,t){t={};for(var n=0;n<e.length;n++)t["$"+e[n]]=!0;for(e=0;e<g.length;e++)n=t.hasOwnProperty("$"+g[e].value),g[e].selected!==n&&(g[e].selected=n),n&&I&&(g[e].defaultSelected=!0)}else{for(e=""+U(e),t=null,n=0;n<g.length;n++){if(g[n].value===e)return g[n].selected=!0,void(I&&(g[n].defaultSelected=!0));null!==t||g[n].disabled||(t=g[n])}null!==t&&(t.selected=!0)}}function Ig(g,t){if(null!=t.dangerouslySetInnerHTML)throw Error(C(91));return K({},t,{value:void 0,defaultValue:void 0,children:""+g._wrapperState.initialValue})}function ng(g,t){var e=t.value;if(null==e){if(e=t.children,t=t.defaultValue,null!=e){if(null!=t)throw Error(C(92));if(tg(e)){if(1<e.length)throw Error(C(93));e=e[0]}t=e}null==t&&(t=""),e=t}g._wrapperState={initialValue:U(e)}}function Cg(g,t){var e=U(t.value),I=U(t.defaultValue);null!=e&&((e=""+e)!==g.value&&(g.value=e),null==t.defaultValue&&g.defaultValue!==e&&(g.defaultValue=e)),null!=I&&(g.defaultValue=""+I)}function ig(g){var t=g.textContent;t===g._wrapperState.initialValue&&""!==t&&null!==t&&(g.value=t)}function lg(g){switch(g){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function og(g,t){return null==g||"http://www.w3.org/1999/xhtml"===g?lg(t):"http://www.w3.org/2000/svg"===g&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":g}var sg,ag,rg=(ag=function(g,t){if("http://www.w3.org/2000/svg"!==g.namespaceURI||"innerHTML"in g)g.innerHTML=t;else{for((sg=sg||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=sg.firstChild;g.firstChild;)g.removeChild(g.firstChild);for(;t.firstChild;)g.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(g,t,e,I){MSApp.execUnsafeLocalFunction((function(){return ag(g,t)}))}:ag);function cg(g,t){if(t){var e=g.firstChild;if(e&&e===g.lastChild&&3===e.nodeType)return void(e.nodeValue=t)}g.textContent=t}var Ag={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},dg=["Webkit","ms","Moz","O"];function ug(g,t,e){return null==t||"boolean"===typeof t||""===t?"":e||"number"!==typeof t||0===t||Ag.hasOwnProperty(g)&&Ag[g]?(""+t).trim():t+"px"}function hg(g,t){for(var e in g=g.style,t)if(t.hasOwnProperty(e)){var I=0===e.indexOf("--"),n=ug(e,t[e],I);"float"===e&&(e="cssFloat"),I?g.setProperty(e,n):g[e]=n}}Object.keys(Ag).forEach((function(g){dg.forEach((function(t){t=t+g.charAt(0).toUpperCase()+g.substring(1),Ag[t]=Ag[g]}))}));var mg=K({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Zg(g,t){if(t){if(mg[g]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(C(137,g));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(C(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(C(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(C(62))}}function bg(g,t){if(-1===g.indexOf("-"))return"string"===typeof t.is;switch(g){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Gg=null;function pg(g){return(g=g.target||g.srcElement||window).correspondingUseElement&&(g=g.correspondingUseElement),3===g.nodeType?g.parentNode:g}var yg=null,Bg=null,Vg=null;function Wg(g){if(g=bn(g)){if("function"!==typeof yg)throw Error(C(280));var t=g.stateNode;t&&(t=pn(t),yg(g.stateNode,g.type,t))}}function Sg(g){Bg?Vg?Vg.push(g):Vg=[g]:Bg=g}function Rg(){if(Bg){var g=Bg,t=Vg;if(Vg=Bg=null,Wg(g),t)for(g=0;g<t.length;g++)Wg(t[g])}}function fg(g,t){return g(t)}function Xg(){}var Jg=!1;function vg(g,t,e){if(Jg)return g(t,e);Jg=!0;try{return fg(g,t,e)}finally{Jg=!1,(null!==Bg||null!==Vg)&&(Xg(),Rg())}}function kg(g,t){var e=g.stateNode;if(null===e)return null;var I=pn(e);if(null===I)return null;e=I[t];g:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(I=!I.disabled)||(I=!("button"===(g=g.type)||"input"===g||"select"===g||"textarea"===g)),g=!I;break g;default:g=!1}if(g)return null;if(e&&"function"!==typeof e)throw Error(C(231,t,typeof e));return e}var Yg=!1;if(a)try{var Hg={};Object.defineProperty(Hg,"passive",{get:function(){Yg=!0}}),window.addEventListener("test",Hg,Hg),window.removeEventListener("test",Hg,Hg)}catch(ag){Yg=!1}function wg(g,t,e,I,n,C,i,l,o){var s=Array.prototype.slice.call(arguments,3);try{t.apply(e,s)}catch(a){this.onError(a)}}var Ng=!1,Kg=null,Fg=!1,Eg=null,zg={onError:function(g){Ng=!0,Kg=g}};function xg(g,t,e,I,n,C,i,l,o){Ng=!1,Kg=null,wg.apply(zg,arguments)}function Lg(g){var t=g,e=g;if(g.alternate)for(;t.return;)t=t.return;else{g=t;do{0!==(4098&(t=g).flags)&&(e=t.return),g=t.return}while(g)}return 3===t.tag?e:null}function Mg(g){if(13===g.tag){var t=g.memoizedState;if(null===t&&(null!==(g=g.alternate)&&(t=g.memoizedState)),null!==t)return t.dehydrated}return null}function Ug(g){if(Lg(g)!==g)throw Error(C(188))}function Tg(g){return null!==(g=function(g){var t=g.alternate;if(!t){if(null===(t=Lg(g)))throw Error(C(188));return t!==g?null:g}for(var e=g,I=t;;){var n=e.return;if(null===n)break;var i=n.alternate;if(null===i){if(null!==(I=n.return)){e=I;continue}break}if(n.child===i.child){for(i=n.child;i;){if(i===e)return Ug(n),g;if(i===I)return Ug(n),t;i=i.sibling}throw Error(C(188))}if(e.return!==I.return)e=n,I=i;else{for(var l=!1,o=n.child;o;){if(o===e){l=!0,e=n,I=i;break}if(o===I){l=!0,I=n,e=i;break}o=o.sibling}if(!l){for(o=i.child;o;){if(o===e){l=!0,e=i,I=n;break}if(o===I){l=!0,I=i,e=n;break}o=o.sibling}if(!l)throw Error(C(189))}}if(e.alternate!==I)throw Error(C(190))}if(3!==e.tag)throw Error(C(188));return e.stateNode.current===e?g:t}(g))?Qg(g):null}function Qg(g){if(5===g.tag||6===g.tag)return g;for(g=g.child;null!==g;){var t=Qg(g);if(null!==t)return t;g=g.sibling}return null}var Dg=n.unstable_scheduleCallback,_g=n.unstable_cancelCallback,jg=n.unstable_shouldYield,Pg=n.unstable_requestPaint,Og=n.unstable_now,qg=n.unstable_getCurrentPriorityLevel,$g=n.unstable_ImmediatePriority,gt=n.unstable_UserBlockingPriority,tt=n.unstable_NormalPriority,et=n.unstable_LowPriority,It=n.unstable_IdlePriority,nt=null,Ct=null;var it=Math.clz32?Math.clz32:function(g){return g>>>=0,0===g?32:31-(lt(g)/ot|0)|0},lt=Math.log,ot=Math.LN2;var st=64,at=4194304;function rt(g){switch(g&-g){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&g;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&g;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return g}}function ct(g,t){var e=g.pendingLanes;if(0===e)return 0;var I=0,n=g.suspendedLanes,C=g.pingedLanes,i=268435455&e;if(0!==i){var l=i&~n;0!==l?I=rt(l):0!==(C&=i)&&(I=rt(C))}else 0!==(i=e&~n)?I=rt(i):0!==C&&(I=rt(C));if(0===I)return 0;if(0!==t&&t!==I&&0===(t&n)&&((n=I&-I)>=(C=t&-t)||16===n&&0!==(4194240&C)))return t;if(0!==(4&I)&&(I|=16&e),0!==(t=g.entangledLanes))for(g=g.entanglements,t&=I;0<t;)n=1<<(e=31-it(t)),I|=g[e],t&=~n;return I}function At(g,t){switch(g){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function dt(g){return 0!==(g=-1073741825&g.pendingLanes)?g:1073741824&g?1073741824:0}function ut(){var g=st;return 0===(4194240&(st<<=1))&&(st=64),g}function ht(g){for(var t=[],e=0;31>e;e++)t.push(g);return t}function mt(g,t,e){g.pendingLanes|=t,536870912!==t&&(g.suspendedLanes=0,g.pingedLanes=0),(g=g.eventTimes)[t=31-it(t)]=e}function Zt(g,t){var e=g.entangledLanes|=t;for(g=g.entanglements;e;){var I=31-it(e),n=1<<I;n&t|g[I]&t&&(g[I]|=t),e&=~n}}var bt=0;function Gt(g){return 1<(g&=-g)?4<g?0!==(268435455&g)?16:536870912:4:1}var pt,yt,Bt,Vt,Wt,St=!1,Rt=[],ft=null,Xt=null,Jt=null,vt=new Map,kt=new Map,Yt=[],Ht="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function wt(g,t){switch(g){case"focusin":case"focusout":ft=null;break;case"dragenter":case"dragleave":Xt=null;break;case"mouseover":case"mouseout":Jt=null;break;case"pointerover":case"pointerout":vt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":kt.delete(t.pointerId)}}function Nt(g,t,e,I,n,C){return null===g||g.nativeEvent!==C?(g={blockedOn:t,domEventName:e,eventSystemFlags:I,nativeEvent:C,targetContainers:[n]},null!==t&&(null!==(t=bn(t))&&yt(t)),g):(g.eventSystemFlags|=I,t=g.targetContainers,null!==n&&-1===t.indexOf(n)&&t.push(n),g)}function Kt(g){var t=Zn(g.target);if(null!==t){var e=Lg(t);if(null!==e)if(13===(t=e.tag)){if(null!==(t=Mg(e)))return g.blockedOn=t,void Wt(g.priority,(function(){Bt(e)}))}else if(3===t&&e.stateNode.current.memoizedState.isDehydrated)return void(g.blockedOn=3===e.tag?e.stateNode.containerInfo:null)}g.blockedOn=null}function Ft(g){if(null!==g.blockedOn)return!1;for(var t=g.targetContainers;0<t.length;){var e=jt(g.domEventName,g.eventSystemFlags,t[0],g.nativeEvent);if(null!==e)return null!==(t=bn(e))&&yt(t),g.blockedOn=e,!1;var I=new(e=g.nativeEvent).constructor(e.type,e);Gg=I,e.target.dispatchEvent(I),Gg=null,t.shift()}return!0}function Et(g,t,e){Ft(g)&&e.delete(t)}function zt(){St=!1,null!==ft&&Ft(ft)&&(ft=null),null!==Xt&&Ft(Xt)&&(Xt=null),null!==Jt&&Ft(Jt)&&(Jt=null),vt.forEach(Et),kt.forEach(Et)}function xt(g,t){g.blockedOn===t&&(g.blockedOn=null,St||(St=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,zt)))}function Lt(g){function t(t){return xt(t,g)}if(0<Rt.length){xt(Rt[0],g);for(var e=1;e<Rt.length;e++){var I=Rt[e];I.blockedOn===g&&(I.blockedOn=null)}}for(null!==ft&&xt(ft,g),null!==Xt&&xt(Xt,g),null!==Jt&&xt(Jt,g),vt.forEach(t),kt.forEach(t),e=0;e<Yt.length;e++)(I=Yt[e]).blockedOn===g&&(I.blockedOn=null);for(;0<Yt.length&&null===(e=Yt[0]).blockedOn;)Kt(e),null===e.blockedOn&&Yt.shift()}var Mt=G.ReactCurrentBatchConfig,Ut=!0;function Tt(g,t,e,I){var n=bt,C=Mt.transition;Mt.transition=null;try{bt=1,Dt(g,t,e,I)}finally{bt=n,Mt.transition=C}}function Qt(g,t,e,I){var n=bt,C=Mt.transition;Mt.transition=null;try{bt=4,Dt(g,t,e,I)}finally{bt=n,Mt.transition=C}}function Dt(g,t,e,I){if(Ut){var n=jt(g,t,e,I);if(null===n)MI(g,t,I,_t,e),wt(g,I);else if(function(g,t,e,I,n){switch(t){case"focusin":return ft=Nt(ft,g,t,e,I,n),!0;case"dragenter":return Xt=Nt(Xt,g,t,e,I,n),!0;case"mouseover":return Jt=Nt(Jt,g,t,e,I,n),!0;case"pointerover":var C=n.pointerId;return vt.set(C,Nt(vt.get(C)||null,g,t,e,I,n)),!0;case"gotpointercapture":return C=n.pointerId,kt.set(C,Nt(kt.get(C)||null,g,t,e,I,n)),!0}return!1}(n,g,t,e,I))I.stopPropagation();else if(wt(g,I),4&t&&-1<Ht.indexOf(g)){for(;null!==n;){var C=bn(n);if(null!==C&&pt(C),null===(C=jt(g,t,e,I))&&MI(g,t,I,_t,e),C===n)break;n=C}null!==n&&I.stopPropagation()}else MI(g,t,I,null,e)}}var _t=null;function jt(g,t,e,I){if(_t=null,null!==(g=Zn(g=pg(I))))if(null===(t=Lg(g)))g=null;else if(13===(e=t.tag)){if(null!==(g=Mg(t)))return g;g=null}else if(3===e){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;g=null}else t!==g&&(g=null);return _t=g,null}function Pt(g){switch(g){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(qg()){case $g:return 1;case gt:return 4;case tt:case et:return 16;case It:return 536870912;default:return 16}default:return 16}}var Ot=null,qt=null,$t=null;function ge(){if($t)return $t;var g,t,e=qt,I=e.length,n="value"in Ot?Ot.value:Ot.textContent,C=n.length;for(g=0;g<I&&e[g]===n[g];g++);var i=I-g;for(t=1;t<=i&&e[I-t]===n[C-t];t++);return $t=n.slice(g,1<t?1-t:void 0)}function te(g){var t=g.keyCode;return"charCode"in g?0===(g=g.charCode)&&13===t&&(g=13):g=t,10===g&&(g=13),32<=g||13===g?g:0}function ee(){return!0}function Ie(){return!1}function ne(g){function t(t,e,I,n,C){for(var i in this._reactName=t,this._targetInst=I,this.type=e,this.nativeEvent=n,this.target=C,this.currentTarget=null,g)g.hasOwnProperty(i)&&(t=g[i],this[i]=t?t(n):n[i]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?ee:Ie,this.isPropagationStopped=Ie,this}return K(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var g=this.nativeEvent;g&&(g.preventDefault?g.preventDefault():"unknown"!==typeof g.returnValue&&(g.returnValue=!1),this.isDefaultPrevented=ee)},stopPropagation:function(){var g=this.nativeEvent;g&&(g.stopPropagation?g.stopPropagation():"unknown"!==typeof g.cancelBubble&&(g.cancelBubble=!0),this.isPropagationStopped=ee)},persist:function(){},isPersistent:ee}),t}var Ce,ie,le,oe={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(g){return g.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},se=ne(oe),ae=K({},oe,{view:0,detail:0}),re=ne(ae),ce=K({},ae,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ve,button:0,buttons:0,relatedTarget:function(g){return void 0===g.relatedTarget?g.fromElement===g.srcElement?g.toElement:g.fromElement:g.relatedTarget},movementX:function(g){return"movementX"in g?g.movementX:(g!==le&&(le&&"mousemove"===g.type?(Ce=g.screenX-le.screenX,ie=g.screenY-le.screenY):ie=Ce=0,le=g),Ce)},movementY:function(g){return"movementY"in g?g.movementY:ie}}),Ae=ne(ce),de=ne(K({},ce,{dataTransfer:0})),ue=ne(K({},ae,{relatedTarget:0})),he=ne(K({},oe,{animationName:0,elapsedTime:0,pseudoElement:0})),me=K({},oe,{clipboardData:function(g){return"clipboardData"in g?g.clipboardData:window.clipboardData}}),Ze=ne(me),be=ne(K({},oe,{data:0})),Ge={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},pe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ye={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Be(g){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(g):!!(g=ye[g])&&!!t[g]}function Ve(){return Be}var We=K({},ae,{key:function(g){if(g.key){var t=Ge[g.key]||g.key;if("Unidentified"!==t)return t}return"keypress"===g.type?13===(g=te(g))?"Enter":String.fromCharCode(g):"keydown"===g.type||"keyup"===g.type?pe[g.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ve,charCode:function(g){return"keypress"===g.type?te(g):0},keyCode:function(g){return"keydown"===g.type||"keyup"===g.type?g.keyCode:0},which:function(g){return"keypress"===g.type?te(g):"keydown"===g.type||"keyup"===g.type?g.keyCode:0}}),Se=ne(We),Re=ne(K({},ce,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),fe=ne(K({},ae,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ve})),Xe=ne(K({},oe,{propertyName:0,elapsedTime:0,pseudoElement:0})),Je=K({},ce,{deltaX:function(g){return"deltaX"in g?g.deltaX:"wheelDeltaX"in g?-g.wheelDeltaX:0},deltaY:function(g){return"deltaY"in g?g.deltaY:"wheelDeltaY"in g?-g.wheelDeltaY:"wheelDelta"in g?-g.wheelDelta:0},deltaZ:0,deltaMode:0}),ve=ne(Je),ke=[9,13,27,32],Ye=a&&"CompositionEvent"in window,He=null;a&&"documentMode"in document&&(He=document.documentMode);var we=a&&"TextEvent"in window&&!He,Ne=a&&(!Ye||He&&8<He&&11>=He),Ke=String.fromCharCode(32),Fe=!1;function Ee(g,t){switch(g){case"keyup":return-1!==ke.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ze(g){return"object"===typeof(g=g.detail)&&"data"in g?g.data:null}var xe=!1;var Le={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Me(g){var t=g&&g.nodeName&&g.nodeName.toLowerCase();return"input"===t?!!Le[g.type]:"textarea"===t}function Ue(g,t,e,I){Sg(I),0<(t=TI(t,"onChange")).length&&(e=new se("onChange","change",null,e,I),g.push({event:e,listeners:t}))}var Te=null,Qe=null;function De(g){KI(g,0)}function _e(g){if(D(Gn(g)))return g}function je(g,t){if("change"===g)return t}var Pe=!1;if(a){var Oe;if(a){var qe="oninput"in document;if(!qe){var $e=document.createElement("div");$e.setAttribute("oninput","return;"),qe="function"===typeof $e.oninput}Oe=qe}else Oe=!1;Pe=Oe&&(!document.documentMode||9<document.documentMode)}function gI(){Te&&(Te.detachEvent("onpropertychange",tI),Qe=Te=null)}function tI(g){if("value"===g.propertyName&&_e(Qe)){var t=[];Ue(t,Qe,g,pg(g)),vg(De,t)}}function eI(g,t,e){"focusin"===g?(gI(),Qe=e,(Te=t).attachEvent("onpropertychange",tI)):"focusout"===g&&gI()}function II(g){if("selectionchange"===g||"keyup"===g||"keydown"===g)return _e(Qe)}function nI(g,t){if("click"===g)return _e(t)}function CI(g,t){if("input"===g||"change"===g)return _e(t)}var iI="function"===typeof Object.is?Object.is:function(g,t){return g===t&&(0!==g||1/g===1/t)||g!==g&&t!==t};function lI(g,t){if(iI(g,t))return!0;if("object"!==typeof g||null===g||"object"!==typeof t||null===t)return!1;var e=Object.keys(g),I=Object.keys(t);if(e.length!==I.length)return!1;for(I=0;I<e.length;I++){var n=e[I];if(!r.call(t,n)||!iI(g[n],t[n]))return!1}return!0}function oI(g){for(;g&&g.firstChild;)g=g.firstChild;return g}function sI(g,t){var e,I=oI(g);for(g=0;I;){if(3===I.nodeType){if(e=g+I.textContent.length,g<=t&&e>=t)return{node:I,offset:t-g};g=e}g:{for(;I;){if(I.nextSibling){I=I.nextSibling;break g}I=I.parentNode}I=void 0}I=oI(I)}}function aI(g,t){return!(!g||!t)&&(g===t||(!g||3!==g.nodeType)&&(t&&3===t.nodeType?aI(g,t.parentNode):"contains"in g?g.contains(t):!!g.compareDocumentPosition&&!!(16&g.compareDocumentPosition(t))))}function rI(){for(var g=window,t=_();t instanceof g.HTMLIFrameElement;){try{var e="string"===typeof t.contentWindow.location.href}catch(I){e=!1}if(!e)break;t=_((g=t.contentWindow).document)}return t}function cI(g){var t=g&&g.nodeName&&g.nodeName.toLowerCase();return t&&("input"===t&&("text"===g.type||"search"===g.type||"tel"===g.type||"url"===g.type||"password"===g.type)||"textarea"===t||"true"===g.contentEditable)}function AI(g){var t=rI(),e=g.focusedElem,I=g.selectionRange;if(t!==e&&e&&e.ownerDocument&&aI(e.ownerDocument.documentElement,e)){if(null!==I&&cI(e))if(t=I.start,void 0===(g=I.end)&&(g=t),"selectionStart"in e)e.selectionStart=t,e.selectionEnd=Math.min(g,e.value.length);else if((g=(t=e.ownerDocument||document)&&t.defaultView||window).getSelection){g=g.getSelection();var n=e.textContent.length,C=Math.min(I.start,n);I=void 0===I.end?C:Math.min(I.end,n),!g.extend&&C>I&&(n=I,I=C,C=n),n=sI(e,C);var i=sI(e,I);n&&i&&(1!==g.rangeCount||g.anchorNode!==n.node||g.anchorOffset!==n.offset||g.focusNode!==i.node||g.focusOffset!==i.offset)&&((t=t.createRange()).setStart(n.node,n.offset),g.removeAllRanges(),C>I?(g.addRange(t),g.extend(i.node,i.offset)):(t.setEnd(i.node,i.offset),g.addRange(t)))}for(t=[],g=e;g=g.parentNode;)1===g.nodeType&&t.push({element:g,left:g.scrollLeft,top:g.scrollTop});for("function"===typeof e.focus&&e.focus(),e=0;e<t.length;e++)(g=t[e]).element.scrollLeft=g.left,g.element.scrollTop=g.top}}var dI=a&&"documentMode"in document&&11>=document.documentMode,uI=null,hI=null,mI=null,ZI=!1;function bI(g,t,e){var I=e.window===e?e.document:9===e.nodeType?e:e.ownerDocument;ZI||null==uI||uI!==_(I)||("selectionStart"in(I=uI)&&cI(I)?I={start:I.selectionStart,end:I.selectionEnd}:I={anchorNode:(I=(I.ownerDocument&&I.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:I.anchorOffset,focusNode:I.focusNode,focusOffset:I.focusOffset},mI&&lI(mI,I)||(mI=I,0<(I=TI(hI,"onSelect")).length&&(t=new se("onSelect","select",null,t,e),g.push({event:t,listeners:I}),t.target=uI)))}function GI(g,t){var e={};return e[g.toLowerCase()]=t.toLowerCase(),e["Webkit"+g]="webkit"+t,e["Moz"+g]="moz"+t,e}var pI={animationend:GI("Animation","AnimationEnd"),animationiteration:GI("Animation","AnimationIteration"),animationstart:GI("Animation","AnimationStart"),transitionend:GI("Transition","TransitionEnd")},yI={},BI={};function VI(g){if(yI[g])return yI[g];if(!pI[g])return g;var t,e=pI[g];for(t in e)if(e.hasOwnProperty(t)&&t in BI)return yI[g]=e[t];return g}a&&(BI=document.createElement("div").style,"AnimationEvent"in window||(delete pI.animationend.animation,delete pI.animationiteration.animation,delete pI.animationstart.animation),"TransitionEvent"in window||delete pI.transitionend.transition);var WI=VI("animationend"),SI=VI("animationiteration"),RI=VI("animationstart"),fI=VI("transitionend"),XI=new Map,JI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function vI(g,t){XI.set(g,t),o(t,[g])}for(var kI=0;kI<JI.length;kI++){var YI=JI[kI];vI(YI.toLowerCase(),"on"+(YI[0].toUpperCase()+YI.slice(1)))}vI(WI,"onAnimationEnd"),vI(SI,"onAnimationIteration"),vI(RI,"onAnimationStart"),vI("dblclick","onDoubleClick"),vI("focusin","onFocus"),vI("focusout","onBlur"),vI(fI,"onTransitionEnd"),s("onMouseEnter",["mouseout","mouseover"]),s("onMouseLeave",["mouseout","mouseover"]),s("onPointerEnter",["pointerout","pointerover"]),s("onPointerLeave",["pointerout","pointerover"]),o("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),o("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),o("onBeforeInput",["compositionend","keypress","textInput","paste"]),o("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var HI="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),wI=new Set("cancel close invalid load scroll toggle".split(" ").concat(HI));function NI(g,t,e){var I=g.type||"unknown-event";g.currentTarget=e,function(g,t,e,I,n,i,l,o,s){if(xg.apply(this,arguments),Ng){if(!Ng)throw Error(C(198));var a=Kg;Ng=!1,Kg=null,Fg||(Fg=!0,Eg=a)}}(I,t,void 0,g),g.currentTarget=null}function KI(g,t){t=0!==(4&t);for(var e=0;e<g.length;e++){var I=g[e],n=I.event;I=I.listeners;g:{var C=void 0;if(t)for(var i=I.length-1;0<=i;i--){var l=I[i],o=l.instance,s=l.currentTarget;if(l=l.listener,o!==C&&n.isPropagationStopped())break g;NI(n,l,s),C=o}else for(i=0;i<I.length;i++){if(o=(l=I[i]).instance,s=l.currentTarget,l=l.listener,o!==C&&n.isPropagationStopped())break g;NI(n,l,s),C=o}}}if(Fg)throw g=Eg,Fg=!1,Eg=null,g}function FI(g,t){var e=t[un];void 0===e&&(e=t[un]=new Set);var I=g+"__bubble";e.has(I)||(LI(t,g,2,!1),e.add(I))}function EI(g,t,e){var I=0;t&&(I|=4),LI(e,g,I,t)}var zI="_reactListening"+Math.random().toString(36).slice(2);function xI(g){if(!g[zI]){g[zI]=!0,i.forEach((function(t){"selectionchange"!==t&&(wI.has(t)||EI(t,!1,g),EI(t,!0,g))}));var t=9===g.nodeType?g:g.ownerDocument;null===t||t[zI]||(t[zI]=!0,EI("selectionchange",!1,t))}}function LI(g,t,e,I){switch(Pt(t)){case 1:var n=Tt;break;case 4:n=Qt;break;default:n=Dt}e=n.bind(null,t,e,g),n=void 0,!Yg||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(n=!0),I?void 0!==n?g.addEventListener(t,e,{capture:!0,passive:n}):g.addEventListener(t,e,!0):void 0!==n?g.addEventListener(t,e,{passive:n}):g.addEventListener(t,e,!1)}function MI(g,t,e,I,n){var C=I;if(0===(1&t)&&0===(2&t)&&null!==I)g:for(;;){if(null===I)return;var i=I.tag;if(3===i||4===i){var l=I.stateNode.containerInfo;if(l===n||8===l.nodeType&&l.parentNode===n)break;if(4===i)for(i=I.return;null!==i;){var o=i.tag;if((3===o||4===o)&&((o=i.stateNode.containerInfo)===n||8===o.nodeType&&o.parentNode===n))return;i=i.return}for(;null!==l;){if(null===(i=Zn(l)))return;if(5===(o=i.tag)||6===o){I=C=i;continue g}l=l.parentNode}}I=I.return}vg((function(){var I=C,n=pg(e),i=[];g:{var l=XI.get(g);if(void 0!==l){var o=se,s=g;switch(g){case"keypress":if(0===te(e))break g;case"keydown":case"keyup":o=Se;break;case"focusin":s="focus",o=ue;break;case"focusout":s="blur",o=ue;break;case"beforeblur":case"afterblur":o=ue;break;case"click":if(2===e.button)break g;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":o=Ae;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":o=de;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":o=fe;break;case WI:case SI:case RI:o=he;break;case fI:o=Xe;break;case"scroll":o=re;break;case"wheel":o=ve;break;case"copy":case"cut":case"paste":o=Ze;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":o=Re}var a=0!==(4&t),r=!a&&"scroll"===g,c=a?null!==l?l+"Capture":null:l;a=[];for(var A,d=I;null!==d;){var u=(A=d).stateNode;if(5===A.tag&&null!==u&&(A=u,null!==c&&(null!=(u=kg(d,c))&&a.push(UI(d,u,A)))),r)break;d=d.return}0<a.length&&(l=new o(l,s,null,e,n),i.push({event:l,listeners:a}))}}if(0===(7&t)){if(o="mouseout"===g||"pointerout"===g,(!(l="mouseover"===g||"pointerover"===g)||e===Gg||!(s=e.relatedTarget||e.fromElement)||!Zn(s)&&!s[dn])&&(o||l)&&(l=n.window===n?n:(l=n.ownerDocument)?l.defaultView||l.parentWindow:window,o?(o=I,null!==(s=(s=e.relatedTarget||e.toElement)?Zn(s):null)&&(s!==(r=Lg(s))||5!==s.tag&&6!==s.tag)&&(s=null)):(o=null,s=I),o!==s)){if(a=Ae,u="onMouseLeave",c="onMouseEnter",d="mouse","pointerout"!==g&&"pointerover"!==g||(a=Re,u="onPointerLeave",c="onPointerEnter",d="pointer"),r=null==o?l:Gn(o),A=null==s?l:Gn(s),(l=new a(u,d+"leave",o,e,n)).target=r,l.relatedTarget=A,u=null,Zn(n)===I&&((a=new a(c,d+"enter",s,e,n)).target=A,a.relatedTarget=r,u=a),r=u,o&&s)g:{for(c=s,d=0,A=a=o;A;A=QI(A))d++;for(A=0,u=c;u;u=QI(u))A++;for(;0<d-A;)a=QI(a),d--;for(;0<A-d;)c=QI(c),A--;for(;d--;){if(a===c||null!==c&&a===c.alternate)break g;a=QI(a),c=QI(c)}a=null}else a=null;null!==o&&DI(i,l,o,a,!1),null!==s&&null!==r&&DI(i,r,s,a,!0)}if("select"===(o=(l=I?Gn(I):window).nodeName&&l.nodeName.toLowerCase())||"input"===o&&"file"===l.type)var h=je;else if(Me(l))if(Pe)h=CI;else{h=II;var m=eI}else(o=l.nodeName)&&"input"===o.toLowerCase()&&("checkbox"===l.type||"radio"===l.type)&&(h=nI);switch(h&&(h=h(g,I))?Ue(i,h,e,n):(m&&m(g,l,I),"focusout"===g&&(m=l._wrapperState)&&m.controlled&&"number"===l.type&&gg(l,"number",l.value)),m=I?Gn(I):window,g){case"focusin":(Me(m)||"true"===m.contentEditable)&&(uI=m,hI=I,mI=null);break;case"focusout":mI=hI=uI=null;break;case"mousedown":ZI=!0;break;case"contextmenu":case"mouseup":case"dragend":ZI=!1,bI(i,e,n);break;case"selectionchange":if(dI)break;case"keydown":case"keyup":bI(i,e,n)}var Z;if(Ye)g:{switch(g){case"compositionstart":var b="onCompositionStart";break g;case"compositionend":b="onCompositionEnd";break g;case"compositionupdate":b="onCompositionUpdate";break g}b=void 0}else xe?Ee(g,e)&&(b="onCompositionEnd"):"keydown"===g&&229===e.keyCode&&(b="onCompositionStart");b&&(Ne&&"ko"!==e.locale&&(xe||"onCompositionStart"!==b?"onCompositionEnd"===b&&xe&&(Z=ge()):(qt="value"in(Ot=n)?Ot.value:Ot.textContent,xe=!0)),0<(m=TI(I,b)).length&&(b=new be(b,g,null,e,n),i.push({event:b,listeners:m}),Z?b.data=Z:null!==(Z=ze(e))&&(b.data=Z))),(Z=we?function(g,t){switch(g){case"compositionend":return ze(t);case"keypress":return 32!==t.which?null:(Fe=!0,Ke);case"textInput":return(g=t.data)===Ke&&Fe?null:g;default:return null}}(g,e):function(g,t){if(xe)return"compositionend"===g||!Ye&&Ee(g,t)?(g=ge(),$t=qt=Ot=null,xe=!1,g):null;switch(g){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ne&&"ko"!==t.locale?null:t.data}}(g,e))&&(0<(I=TI(I,"onBeforeInput")).length&&(n=new be("onBeforeInput","beforeinput",null,e,n),i.push({event:n,listeners:I}),n.data=Z))}KI(i,t)}))}function UI(g,t,e){return{instance:g,listener:t,currentTarget:e}}function TI(g,t){for(var e=t+"Capture",I=[];null!==g;){var n=g,C=n.stateNode;5===n.tag&&null!==C&&(n=C,null!=(C=kg(g,e))&&I.unshift(UI(g,C,n)),null!=(C=kg(g,t))&&I.push(UI(g,C,n))),g=g.return}return I}function QI(g){if(null===g)return null;do{g=g.return}while(g&&5!==g.tag);return g||null}function DI(g,t,e,I,n){for(var C=t._reactName,i=[];null!==e&&e!==I;){var l=e,o=l.alternate,s=l.stateNode;if(null!==o&&o===I)break;5===l.tag&&null!==s&&(l=s,n?null!=(o=kg(e,C))&&i.unshift(UI(e,o,l)):n||null!=(o=kg(e,C))&&i.push(UI(e,o,l))),e=e.return}0!==i.length&&g.push({event:t,listeners:i})}var _I=/\r\n?/g,jI=/\u0000|\uFFFD/g;function PI(g){return("string"===typeof g?g:""+g).replace(_I,"\n").replace(jI,"")}function OI(g,t,e){if(t=PI(t),PI(g)!==t&&e)throw Error(C(425))}function qI(){}var $I=null,gn=null;function tn(g,t){return"textarea"===g||"noscript"===g||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var en="function"===typeof setTimeout?setTimeout:void 0,In="function"===typeof clearTimeout?clearTimeout:void 0,nn="function"===typeof Promise?Promise:void 0,Cn="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof nn?function(g){return nn.resolve(null).then(g).catch(ln)}:en;function ln(g){setTimeout((function(){throw g}))}function on(g,t){var e=t,I=0;do{var n=e.nextSibling;if(g.removeChild(e),n&&8===n.nodeType)if("/$"===(e=n.data)){if(0===I)return g.removeChild(n),void Lt(t);I--}else"$"!==e&&"$?"!==e&&"$!"!==e||I++;e=n}while(e);Lt(t)}function sn(g){for(;null!=g;g=g.nextSibling){var t=g.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=g.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return g}function an(g){g=g.previousSibling;for(var t=0;g;){if(8===g.nodeType){var e=g.data;if("$"===e||"$!"===e||"$?"===e){if(0===t)return g;t--}else"/$"===e&&t++}g=g.previousSibling}return null}var rn=Math.random().toString(36).slice(2),cn="__reactFiber$"+rn,An="__reactProps$"+rn,dn="__reactContainer$"+rn,un="__reactEvents$"+rn,hn="__reactListeners$"+rn,mn="__reactHandles$"+rn;function Zn(g){var t=g[cn];if(t)return t;for(var e=g.parentNode;e;){if(t=e[dn]||e[cn]){if(e=t.alternate,null!==t.child||null!==e&&null!==e.child)for(g=an(g);null!==g;){if(e=g[cn])return e;g=an(g)}return t}e=(g=e).parentNode}return null}function bn(g){return!(g=g[cn]||g[dn])||5!==g.tag&&6!==g.tag&&13!==g.tag&&3!==g.tag?null:g}function Gn(g){if(5===g.tag||6===g.tag)return g.stateNode;throw Error(C(33))}function pn(g){return g[An]||null}var yn=[],Bn=-1;function Vn(g){return{current:g}}function Wn(g){0>Bn||(g.current=yn[Bn],yn[Bn]=null,Bn--)}function Sn(g,t){Bn++,yn[Bn]=g.current,g.current=t}var Rn={},fn=Vn(Rn),Xn=Vn(!1),Jn=Rn;function vn(g,t){var e=g.type.contextTypes;if(!e)return Rn;var I=g.stateNode;if(I&&I.__reactInternalMemoizedUnmaskedChildContext===t)return I.__reactInternalMemoizedMaskedChildContext;var n,C={};for(n in e)C[n]=t[n];return I&&((g=g.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,g.__reactInternalMemoizedMaskedChildContext=C),C}function kn(g){return null!==(g=g.childContextTypes)&&void 0!==g}function Yn(){Wn(Xn),Wn(fn)}function Hn(g,t,e){if(fn.current!==Rn)throw Error(C(168));Sn(fn,t),Sn(Xn,e)}function wn(g,t,e){var I=g.stateNode;if(t=t.childContextTypes,"function"!==typeof I.getChildContext)return e;for(var n in I=I.getChildContext())if(!(n in t))throw Error(C(108,M(g)||"Unknown",n));return K({},e,I)}function Nn(g){return g=(g=g.stateNode)&&g.__reactInternalMemoizedMergedChildContext||Rn,Jn=fn.current,Sn(fn,g),Sn(Xn,Xn.current),!0}function Kn(g,t,e){var I=g.stateNode;if(!I)throw Error(C(169));e?(g=wn(g,t,Jn),I.__reactInternalMemoizedMergedChildContext=g,Wn(Xn),Wn(fn),Sn(fn,g)):Wn(Xn),Sn(Xn,e)}var Fn=null,En=!1,zn=!1;function xn(g){null===Fn?Fn=[g]:Fn.push(g)}function Ln(){if(!zn&&null!==Fn){zn=!0;var g=0,t=bt;try{var e=Fn;for(bt=1;g<e.length;g++){var I=e[g];do{I=I(!0)}while(null!==I)}Fn=null,En=!1}catch(n){throw null!==Fn&&(Fn=Fn.slice(g+1)),Dg($g,Ln),n}finally{bt=t,zn=!1}}return null}var Mn=[],Un=0,Tn=null,Qn=0,Dn=[],_n=0,jn=null,Pn=1,On="";function qn(g,t){Mn[Un++]=Qn,Mn[Un++]=Tn,Tn=g,Qn=t}function $n(g,t,e){Dn[_n++]=Pn,Dn[_n++]=On,Dn[_n++]=jn,jn=g;var I=Pn;g=On;var n=32-it(I)-1;I&=~(1<<n),e+=1;var C=32-it(t)+n;if(30<C){var i=n-n%5;C=(I&(1<<i)-1).toString(32),I>>=i,n-=i,Pn=1<<32-it(t)+n|e<<n|I,On=C+g}else Pn=1<<C|e<<n|I,On=g}function gC(g){null!==g.return&&(qn(g,1),$n(g,1,0))}function tC(g){for(;g===Tn;)Tn=Mn[--Un],Mn[Un]=null,Qn=Mn[--Un],Mn[Un]=null;for(;g===jn;)jn=Dn[--_n],Dn[_n]=null,On=Dn[--_n],Dn[_n]=null,Pn=Dn[--_n],Dn[_n]=null}var eC=null,IC=null,nC=!1,CC=null;function iC(g,t){var e=vs(5,null,null,0);e.elementType="DELETED",e.stateNode=t,e.return=g,null===(t=g.deletions)?(g.deletions=[e],g.flags|=16):t.push(e)}function lC(g,t){switch(g.tag){case 5:var e=g.type;return null!==(t=1!==t.nodeType||e.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(g.stateNode=t,eC=g,IC=sn(t.firstChild),!0);case 6:return null!==(t=""===g.pendingProps||3!==t.nodeType?null:t)&&(g.stateNode=t,eC=g,IC=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(e=null!==jn?{id:Pn,overflow:On}:null,g.memoizedState={dehydrated:t,treeContext:e,retryLane:1073741824},(e=vs(18,null,null,0)).stateNode=t,e.return=g,g.child=e,eC=g,IC=null,!0);default:return!1}}function oC(g){return 0!==(1&g.mode)&&0===(128&g.flags)}function sC(g){if(nC){var t=IC;if(t){var e=t;if(!lC(g,t)){if(oC(g))throw Error(C(418));t=sn(e.nextSibling);var I=eC;t&&lC(g,t)?iC(I,e):(g.flags=-4097&g.flags|2,nC=!1,eC=g)}}else{if(oC(g))throw Error(C(418));g.flags=-4097&g.flags|2,nC=!1,eC=g}}}function aC(g){for(g=g.return;null!==g&&5!==g.tag&&3!==g.tag&&13!==g.tag;)g=g.return;eC=g}function rC(g){if(g!==eC)return!1;if(!nC)return aC(g),nC=!0,!1;var t;if((t=3!==g.tag)&&!(t=5!==g.tag)&&(t="head"!==(t=g.type)&&"body"!==t&&!tn(g.type,g.memoizedProps)),t&&(t=IC)){if(oC(g))throw cC(),Error(C(418));for(;t;)iC(g,t),t=sn(t.nextSibling)}if(aC(g),13===g.tag){if(!(g=null!==(g=g.memoizedState)?g.dehydrated:null))throw Error(C(317));g:{for(g=g.nextSibling,t=0;g;){if(8===g.nodeType){var e=g.data;if("/$"===e){if(0===t){IC=sn(g.nextSibling);break g}t--}else"$"!==e&&"$!"!==e&&"$?"!==e||t++}g=g.nextSibling}IC=null}}else IC=eC?sn(g.stateNode.nextSibling):null;return!0}function cC(){for(var g=IC;g;)g=sn(g.nextSibling)}function AC(){IC=eC=null,nC=!1}function dC(g){null===CC?CC=[g]:CC.push(g)}var uC=G.ReactCurrentBatchConfig;function hC(g,t,e){if(null!==(g=e.ref)&&"function"!==typeof g&&"object"!==typeof g){if(e._owner){if(e=e._owner){if(1!==e.tag)throw Error(C(309));var I=e.stateNode}if(!I)throw Error(C(147,g));var n=I,i=""+g;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===i?t.ref:(t=function(g){var t=n.refs;null===g?delete t[i]:t[i]=g},t._stringRef=i,t)}if("string"!==typeof g)throw Error(C(284));if(!e._owner)throw Error(C(290,g))}return g}function mC(g,t){throw g=Object.prototype.toString.call(t),Error(C(31,"[object Object]"===g?"object with keys {"+Object.keys(t).join(", ")+"}":g))}function ZC(g){return(0,g._init)(g._payload)}function bC(g){function t(t,e){if(g){var I=t.deletions;null===I?(t.deletions=[e],t.flags|=16):I.push(e)}}function e(e,I){if(!g)return null;for(;null!==I;)t(e,I),I=I.sibling;return null}function I(g,t){for(g=new Map;null!==t;)null!==t.key?g.set(t.key,t):g.set(t.index,t),t=t.sibling;return g}function n(g,t){return(g=Ys(g,t)).index=0,g.sibling=null,g}function i(t,e,I){return t.index=I,g?null!==(I=t.alternate)?(I=I.index)<e?(t.flags|=2,e):I:(t.flags|=2,e):(t.flags|=1048576,e)}function l(t){return g&&null===t.alternate&&(t.flags|=2),t}function o(g,t,e,I){return null===t||6!==t.tag?((t=Ks(e,g.mode,I)).return=g,t):((t=n(t,e)).return=g,t)}function s(g,t,e,I){var C=e.type;return C===B?r(g,t,e.props.children,I,e.key):null!==t&&(t.elementType===C||"object"===typeof C&&null!==C&&C.$$typeof===k&&ZC(C)===t.type)?((I=n(t,e.props)).ref=hC(g,t,e),I.return=g,I):((I=Hs(e.type,e.key,e.props,null,g.mode,I)).ref=hC(g,t,e),I.return=g,I)}function a(g,t,e,I){return null===t||4!==t.tag||t.stateNode.containerInfo!==e.containerInfo||t.stateNode.implementation!==e.implementation?((t=Fs(e,g.mode,I)).return=g,t):((t=n(t,e.children||[])).return=g,t)}function r(g,t,e,I,C){return null===t||7!==t.tag?((t=ws(e,g.mode,I,C)).return=g,t):((t=n(t,e)).return=g,t)}function c(g,t,e){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Ks(""+t,g.mode,e)).return=g,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case p:return(e=Hs(t.type,t.key,t.props,null,g.mode,e)).ref=hC(g,null,t),e.return=g,e;case y:return(t=Fs(t,g.mode,e)).return=g,t;case k:return c(g,(0,t._init)(t._payload),e)}if(tg(t)||w(t))return(t=ws(t,g.mode,e,null)).return=g,t;mC(g,t)}return null}function A(g,t,e,I){var n=null!==t?t.key:null;if("string"===typeof e&&""!==e||"number"===typeof e)return null!==n?null:o(g,t,""+e,I);if("object"===typeof e&&null!==e){switch(e.$$typeof){case p:return e.key===n?s(g,t,e,I):null;case y:return e.key===n?a(g,t,e,I):null;case k:return A(g,t,(n=e._init)(e._payload),I)}if(tg(e)||w(e))return null!==n?null:r(g,t,e,I,null);mC(g,e)}return null}function d(g,t,e,I,n){if("string"===typeof I&&""!==I||"number"===typeof I)return o(t,g=g.get(e)||null,""+I,n);if("object"===typeof I&&null!==I){switch(I.$$typeof){case p:return s(t,g=g.get(null===I.key?e:I.key)||null,I,n);case y:return a(t,g=g.get(null===I.key?e:I.key)||null,I,n);case k:return d(g,t,e,(0,I._init)(I._payload),n)}if(tg(I)||w(I))return r(t,g=g.get(e)||null,I,n,null);mC(t,I)}return null}function u(n,C,l,o){for(var s=null,a=null,r=C,u=C=0,h=null;null!==r&&u<l.length;u++){r.index>u?(h=r,r=null):h=r.sibling;var m=A(n,r,l[u],o);if(null===m){null===r&&(r=h);break}g&&r&&null===m.alternate&&t(n,r),C=i(m,C,u),null===a?s=m:a.sibling=m,a=m,r=h}if(u===l.length)return e(n,r),nC&&qn(n,u),s;if(null===r){for(;u<l.length;u++)null!==(r=c(n,l[u],o))&&(C=i(r,C,u),null===a?s=r:a.sibling=r,a=r);return nC&&qn(n,u),s}for(r=I(n,r);u<l.length;u++)null!==(h=d(r,n,u,l[u],o))&&(g&&null!==h.alternate&&r.delete(null===h.key?u:h.key),C=i(h,C,u),null===a?s=h:a.sibling=h,a=h);return g&&r.forEach((function(g){return t(n,g)})),nC&&qn(n,u),s}function h(n,l,o,s){var a=w(o);if("function"!==typeof a)throw Error(C(150));if(null==(o=a.call(o)))throw Error(C(151));for(var r=a=null,u=l,h=l=0,m=null,Z=o.next();null!==u&&!Z.done;h++,Z=o.next()){u.index>h?(m=u,u=null):m=u.sibling;var b=A(n,u,Z.value,s);if(null===b){null===u&&(u=m);break}g&&u&&null===b.alternate&&t(n,u),l=i(b,l,h),null===r?a=b:r.sibling=b,r=b,u=m}if(Z.done)return e(n,u),nC&&qn(n,h),a;if(null===u){for(;!Z.done;h++,Z=o.next())null!==(Z=c(n,Z.value,s))&&(l=i(Z,l,h),null===r?a=Z:r.sibling=Z,r=Z);return nC&&qn(n,h),a}for(u=I(n,u);!Z.done;h++,Z=o.next())null!==(Z=d(u,n,h,Z.value,s))&&(g&&null!==Z.alternate&&u.delete(null===Z.key?h:Z.key),l=i(Z,l,h),null===r?a=Z:r.sibling=Z,r=Z);return g&&u.forEach((function(g){return t(n,g)})),nC&&qn(n,h),a}return function g(I,C,i,o){if("object"===typeof i&&null!==i&&i.type===B&&null===i.key&&(i=i.props.children),"object"===typeof i&&null!==i){switch(i.$$typeof){case p:g:{for(var s=i.key,a=C;null!==a;){if(a.key===s){if((s=i.type)===B){if(7===a.tag){e(I,a.sibling),(C=n(a,i.props.children)).return=I,I=C;break g}}else if(a.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===k&&ZC(s)===a.type){e(I,a.sibling),(C=n(a,i.props)).ref=hC(I,a,i),C.return=I,I=C;break g}e(I,a);break}t(I,a),a=a.sibling}i.type===B?((C=ws(i.props.children,I.mode,o,i.key)).return=I,I=C):((o=Hs(i.type,i.key,i.props,null,I.mode,o)).ref=hC(I,C,i),o.return=I,I=o)}return l(I);case y:g:{for(a=i.key;null!==C;){if(C.key===a){if(4===C.tag&&C.stateNode.containerInfo===i.containerInfo&&C.stateNode.implementation===i.implementation){e(I,C.sibling),(C=n(C,i.children||[])).return=I,I=C;break g}e(I,C);break}t(I,C),C=C.sibling}(C=Fs(i,I.mode,o)).return=I,I=C}return l(I);case k:return g(I,C,(a=i._init)(i._payload),o)}if(tg(i))return u(I,C,i,o);if(w(i))return h(I,C,i,o);mC(I,i)}return"string"===typeof i&&""!==i||"number"===typeof i?(i=""+i,null!==C&&6===C.tag?(e(I,C.sibling),(C=n(C,i)).return=I,I=C):(e(I,C),(C=Ks(i,I.mode,o)).return=I,I=C),l(I)):e(I,C)}}var GC=bC(!0),pC=bC(!1),yC=Vn(null),BC=null,VC=null,WC=null;function SC(){WC=VC=BC=null}function RC(g){var t=yC.current;Wn(yC),g._currentValue=t}function fC(g,t,e){for(;null!==g;){var I=g.alternate;if((g.childLanes&t)!==t?(g.childLanes|=t,null!==I&&(I.childLanes|=t)):null!==I&&(I.childLanes&t)!==t&&(I.childLanes|=t),g===e)break;g=g.return}}function XC(g,t){BC=g,WC=VC=null,null!==(g=g.dependencies)&&null!==g.firstContext&&(0!==(g.lanes&t)&&(Zl=!0),g.firstContext=null)}function JC(g){var t=g._currentValue;if(WC!==g)if(g={context:g,memoizedValue:t,next:null},null===VC){if(null===BC)throw Error(C(308));VC=g,BC.dependencies={lanes:0,firstContext:g}}else VC=VC.next=g;return t}var vC=null;function kC(g){null===vC?vC=[g]:vC.push(g)}function YC(g,t,e,I){var n=t.interleaved;return null===n?(e.next=e,kC(t)):(e.next=n.next,n.next=e),t.interleaved=e,HC(g,I)}function HC(g,t){g.lanes|=t;var e=g.alternate;for(null!==e&&(e.lanes|=t),e=g,g=g.return;null!==g;)g.childLanes|=t,null!==(e=g.alternate)&&(e.childLanes|=t),e=g,g=g.return;return 3===e.tag?e.stateNode:null}var wC=!1;function NC(g){g.updateQueue={baseState:g.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function KC(g,t){g=g.updateQueue,t.updateQueue===g&&(t.updateQueue={baseState:g.baseState,firstBaseUpdate:g.firstBaseUpdate,lastBaseUpdate:g.lastBaseUpdate,shared:g.shared,effects:g.effects})}function FC(g,t){return{eventTime:g,lane:t,tag:0,payload:null,callback:null,next:null}}function EC(g,t,e){var I=g.updateQueue;if(null===I)return null;if(I=I.shared,0!==(2&fo)){var n=I.pending;return null===n?t.next=t:(t.next=n.next,n.next=t),I.pending=t,HC(g,e)}return null===(n=I.interleaved)?(t.next=t,kC(I)):(t.next=n.next,n.next=t),I.interleaved=t,HC(g,e)}function zC(g,t,e){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&e))){var I=t.lanes;e|=I&=g.pendingLanes,t.lanes=e,Zt(g,e)}}function xC(g,t){var e=g.updateQueue,I=g.alternate;if(null!==I&&e===(I=I.updateQueue)){var n=null,C=null;if(null!==(e=e.firstBaseUpdate)){do{var i={eventTime:e.eventTime,lane:e.lane,tag:e.tag,payload:e.payload,callback:e.callback,next:null};null===C?n=C=i:C=C.next=i,e=e.next}while(null!==e);null===C?n=C=t:C=C.next=t}else n=C=t;return e={baseState:I.baseState,firstBaseUpdate:n,lastBaseUpdate:C,shared:I.shared,effects:I.effects},void(g.updateQueue=e)}null===(g=e.lastBaseUpdate)?e.firstBaseUpdate=t:g.next=t,e.lastBaseUpdate=t}function LC(g,t,e,I){var n=g.updateQueue;wC=!1;var C=n.firstBaseUpdate,i=n.lastBaseUpdate,l=n.shared.pending;if(null!==l){n.shared.pending=null;var o=l,s=o.next;o.next=null,null===i?C=s:i.next=s,i=o;var a=g.alternate;null!==a&&((l=(a=a.updateQueue).lastBaseUpdate)!==i&&(null===l?a.firstBaseUpdate=s:l.next=s,a.lastBaseUpdate=o))}if(null!==C){var r=n.baseState;for(i=0,a=s=o=null,l=C;;){var c=l.lane,A=l.eventTime;if((I&c)===c){null!==a&&(a=a.next={eventTime:A,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});g:{var d=g,u=l;switch(c=t,A=e,u.tag){case 1:if("function"===typeof(d=u.payload)){r=d.call(A,r,c);break g}r=d;break g;case 3:d.flags=-65537&d.flags|128;case 0:if(null===(c="function"===typeof(d=u.payload)?d.call(A,r,c):d)||void 0===c)break g;r=K({},r,c);break g;case 2:wC=!0}}null!==l.callback&&0!==l.lane&&(g.flags|=64,null===(c=n.effects)?n.effects=[l]:c.push(l))}else A={eventTime:A,lane:c,tag:l.tag,payload:l.payload,callback:l.callback,next:null},null===a?(s=a=A,o=r):a=a.next=A,i|=c;if(null===(l=l.next)){if(null===(l=n.shared.pending))break;l=(c=l).next,c.next=null,n.lastBaseUpdate=c,n.shared.pending=null}}if(null===a&&(o=r),n.baseState=o,n.firstBaseUpdate=s,n.lastBaseUpdate=a,null!==(t=n.shared.interleaved)){n=t;do{i|=n.lane,n=n.next}while(n!==t)}else null===C&&(n.shared.lanes=0);No|=i,g.lanes=i,g.memoizedState=r}}function MC(g,t,e){if(g=t.effects,t.effects=null,null!==g)for(t=0;t<g.length;t++){var I=g[t],n=I.callback;if(null!==n){if(I.callback=null,I=e,"function"!==typeof n)throw Error(C(191,n));n.call(I)}}}var UC={},TC=Vn(UC),QC=Vn(UC),DC=Vn(UC);function _C(g){if(g===UC)throw Error(C(174));return g}function jC(g,t){switch(Sn(DC,t),Sn(QC,g),Sn(TC,UC),g=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:og(null,"");break;default:t=og(t=(g=8===g?t.parentNode:t).namespaceURI||null,g=g.tagName)}Wn(TC),Sn(TC,t)}function PC(){Wn(TC),Wn(QC),Wn(DC)}function OC(g){_C(DC.current);var t=_C(TC.current),e=og(t,g.type);t!==e&&(Sn(QC,g),Sn(TC,e))}function qC(g){QC.current===g&&(Wn(TC),Wn(QC))}var $C=Vn(0);function gi(g){for(var t=g;null!==t;){if(13===t.tag){var e=t.memoizedState;if(null!==e&&(null===(e=e.dehydrated)||"$?"===e.data||"$!"===e.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===g)break;for(;null===t.sibling;){if(null===t.return||t.return===g)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ti=[];function ei(){for(var g=0;g<ti.length;g++)ti[g]._workInProgressVersionPrimary=null;ti.length=0}var Ii=G.ReactCurrentDispatcher,ni=G.ReactCurrentBatchConfig,Ci=0,ii=null,li=null,oi=null,si=!1,ai=!1,ri=0,ci=0;function Ai(){throw Error(C(321))}function di(g,t){if(null===t)return!1;for(var e=0;e<t.length&&e<g.length;e++)if(!iI(g[e],t[e]))return!1;return!0}function ui(g,t,e,I,n,i){if(Ci=i,ii=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Ii.current=null===g||null===g.memoizedState?qi:$i,g=e(I,n),ai){i=0;do{if(ai=!1,ri=0,25<=i)throw Error(C(301));i+=1,oi=li=null,t.updateQueue=null,Ii.current=gl,g=e(I,n)}while(ai)}if(Ii.current=Oi,t=null!==li&&null!==li.next,Ci=0,oi=li=ii=null,si=!1,t)throw Error(C(300));return g}function hi(){var g=0!==ri;return ri=0,g}function mi(){var g={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===oi?ii.memoizedState=oi=g:oi=oi.next=g,oi}function Zi(){if(null===li){var g=ii.alternate;g=null!==g?g.memoizedState:null}else g=li.next;var t=null===oi?ii.memoizedState:oi.next;if(null!==t)oi=t,li=g;else{if(null===g)throw Error(C(310));g={memoizedState:(li=g).memoizedState,baseState:li.baseState,baseQueue:li.baseQueue,queue:li.queue,next:null},null===oi?ii.memoizedState=oi=g:oi=oi.next=g}return oi}function bi(g,t){return"function"===typeof t?t(g):t}function Gi(g){var t=Zi(),e=t.queue;if(null===e)throw Error(C(311));e.lastRenderedReducer=g;var I=li,n=I.baseQueue,i=e.pending;if(null!==i){if(null!==n){var l=n.next;n.next=i.next,i.next=l}I.baseQueue=n=i,e.pending=null}if(null!==n){i=n.next,I=I.baseState;var o=l=null,s=null,a=i;do{var r=a.lane;if((Ci&r)===r)null!==s&&(s=s.next={lane:0,action:a.action,hasEagerState:a.hasEagerState,eagerState:a.eagerState,next:null}),I=a.hasEagerState?a.eagerState:g(I,a.action);else{var c={lane:r,action:a.action,hasEagerState:a.hasEagerState,eagerState:a.eagerState,next:null};null===s?(o=s=c,l=I):s=s.next=c,ii.lanes|=r,No|=r}a=a.next}while(null!==a&&a!==i);null===s?l=I:s.next=o,iI(I,t.memoizedState)||(Zl=!0),t.memoizedState=I,t.baseState=l,t.baseQueue=s,e.lastRenderedState=I}if(null!==(g=e.interleaved)){n=g;do{i=n.lane,ii.lanes|=i,No|=i,n=n.next}while(n!==g)}else null===n&&(e.lanes=0);return[t.memoizedState,e.dispatch]}function pi(g){var t=Zi(),e=t.queue;if(null===e)throw Error(C(311));e.lastRenderedReducer=g;var I=e.dispatch,n=e.pending,i=t.memoizedState;if(null!==n){e.pending=null;var l=n=n.next;do{i=g(i,l.action),l=l.next}while(l!==n);iI(i,t.memoizedState)||(Zl=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),e.lastRenderedState=i}return[i,I]}function yi(){}function Bi(g,t){var e=ii,I=Zi(),n=t(),i=!iI(I.memoizedState,n);if(i&&(I.memoizedState=n,Zl=!0),I=I.queue,wi(Si.bind(null,e,I,g),[g]),I.getSnapshot!==t||i||null!==oi&&1&oi.memoizedState.tag){if(e.flags|=2048,Ji(9,Wi.bind(null,e,I,n,t),void 0,null),null===Xo)throw Error(C(349));0!==(30&Ci)||Vi(e,t,n)}return n}function Vi(g,t,e){g.flags|=16384,g={getSnapshot:t,value:e},null===(t=ii.updateQueue)?(t={lastEffect:null,stores:null},ii.updateQueue=t,t.stores=[g]):null===(e=t.stores)?t.stores=[g]:e.push(g)}function Wi(g,t,e,I){t.value=e,t.getSnapshot=I,Ri(t)&&fi(g)}function Si(g,t,e){return e((function(){Ri(t)&&fi(g)}))}function Ri(g){var t=g.getSnapshot;g=g.value;try{var e=t();return!iI(g,e)}catch(I){return!0}}function fi(g){var t=HC(g,1);null!==t&&es(t,g,1,-1)}function Xi(g){var t=mi();return"function"===typeof g&&(g=g()),t.memoizedState=t.baseState=g,g={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:bi,lastRenderedState:g},t.queue=g,g=g.dispatch=Di.bind(null,ii,g),[t.memoizedState,g]}function Ji(g,t,e,I){return g={tag:g,create:t,destroy:e,deps:I,next:null},null===(t=ii.updateQueue)?(t={lastEffect:null,stores:null},ii.updateQueue=t,t.lastEffect=g.next=g):null===(e=t.lastEffect)?t.lastEffect=g.next=g:(I=e.next,e.next=g,g.next=I,t.lastEffect=g),g}function vi(){return Zi().memoizedState}function ki(g,t,e,I){var n=mi();ii.flags|=g,n.memoizedState=Ji(1|t,e,void 0,void 0===I?null:I)}function Yi(g,t,e,I){var n=Zi();I=void 0===I?null:I;var C=void 0;if(null!==li){var i=li.memoizedState;if(C=i.destroy,null!==I&&di(I,i.deps))return void(n.memoizedState=Ji(t,e,C,I))}ii.flags|=g,n.memoizedState=Ji(1|t,e,C,I)}function Hi(g,t){return ki(8390656,8,g,t)}function wi(g,t){return Yi(2048,8,g,t)}function Ni(g,t){return Yi(4,2,g,t)}function Ki(g,t){return Yi(4,4,g,t)}function Fi(g,t){return"function"===typeof t?(g=g(),t(g),function(){t(null)}):null!==t&&void 0!==t?(g=g(),t.current=g,function(){t.current=null}):void 0}function Ei(g,t,e){return e=null!==e&&void 0!==e?e.concat([g]):null,Yi(4,4,Fi.bind(null,t,g),e)}function zi(){}function xi(g,t){var e=Zi();t=void 0===t?null:t;var I=e.memoizedState;return null!==I&&null!==t&&di(t,I[1])?I[0]:(e.memoizedState=[g,t],g)}function Li(g,t){var e=Zi();t=void 0===t?null:t;var I=e.memoizedState;return null!==I&&null!==t&&di(t,I[1])?I[0]:(g=g(),e.memoizedState=[g,t],g)}function Mi(g,t,e){return 0===(21&Ci)?(g.baseState&&(g.baseState=!1,Zl=!0),g.memoizedState=e):(iI(e,t)||(e=ut(),ii.lanes|=e,No|=e,g.baseState=!0),t)}function Ui(g,t){var e=bt;bt=0!==e&&4>e?e:4,g(!0);var I=ni.transition;ni.transition={};try{g(!1),t()}finally{bt=e,ni.transition=I}}function Ti(){return Zi().memoizedState}function Qi(g,t,e){var I=ts(g);if(e={lane:I,action:e,hasEagerState:!1,eagerState:null,next:null},_i(g))ji(t,e);else if(null!==(e=YC(g,t,e,I))){es(e,g,I,gs()),Pi(e,t,I)}}function Di(g,t,e){var I=ts(g),n={lane:I,action:e,hasEagerState:!1,eagerState:null,next:null};if(_i(g))ji(t,n);else{var C=g.alternate;if(0===g.lanes&&(null===C||0===C.lanes)&&null!==(C=t.lastRenderedReducer))try{var i=t.lastRenderedState,l=C(i,e);if(n.hasEagerState=!0,n.eagerState=l,iI(l,i)){var o=t.interleaved;return null===o?(n.next=n,kC(t)):(n.next=o.next,o.next=n),void(t.interleaved=n)}}catch(s){}null!==(e=YC(g,t,n,I))&&(es(e,g,I,n=gs()),Pi(e,t,I))}}function _i(g){var t=g.alternate;return g===ii||null!==t&&t===ii}function ji(g,t){ai=si=!0;var e=g.pending;null===e?t.next=t:(t.next=e.next,e.next=t),g.pending=t}function Pi(g,t,e){if(0!==(4194240&e)){var I=t.lanes;e|=I&=g.pendingLanes,t.lanes=e,Zt(g,e)}}var Oi={readContext:JC,useCallback:Ai,useContext:Ai,useEffect:Ai,useImperativeHandle:Ai,useInsertionEffect:Ai,useLayoutEffect:Ai,useMemo:Ai,useReducer:Ai,useRef:Ai,useState:Ai,useDebugValue:Ai,useDeferredValue:Ai,useTransition:Ai,useMutableSource:Ai,useSyncExternalStore:Ai,useId:Ai,unstable_isNewReconciler:!1},qi={readContext:JC,useCallback:function(g,t){return mi().memoizedState=[g,void 0===t?null:t],g},useContext:JC,useEffect:Hi,useImperativeHandle:function(g,t,e){return e=null!==e&&void 0!==e?e.concat([g]):null,ki(4194308,4,Fi.bind(null,t,g),e)},useLayoutEffect:function(g,t){return ki(4194308,4,g,t)},useInsertionEffect:function(g,t){return ki(4,2,g,t)},useMemo:function(g,t){var e=mi();return t=void 0===t?null:t,g=g(),e.memoizedState=[g,t],g},useReducer:function(g,t,e){var I=mi();return t=void 0!==e?e(t):t,I.memoizedState=I.baseState=t,g={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:g,lastRenderedState:t},I.queue=g,g=g.dispatch=Qi.bind(null,ii,g),[I.memoizedState,g]},useRef:function(g){return g={current:g},mi().memoizedState=g},useState:Xi,useDebugValue:zi,useDeferredValue:function(g){return mi().memoizedState=g},useTransition:function(){var g=Xi(!1),t=g[0];return g=Ui.bind(null,g[1]),mi().memoizedState=g,[t,g]},useMutableSource:function(){},useSyncExternalStore:function(g,t,e){var I=ii,n=mi();if(nC){if(void 0===e)throw Error(C(407));e=e()}else{if(e=t(),null===Xo)throw Error(C(349));0!==(30&Ci)||Vi(I,t,e)}n.memoizedState=e;var i={value:e,getSnapshot:t};return n.queue=i,Hi(Si.bind(null,I,i,g),[g]),I.flags|=2048,Ji(9,Wi.bind(null,I,i,e,t),void 0,null),e},useId:function(){var g=mi(),t=Xo.identifierPrefix;if(nC){var e=On;t=":"+t+"R"+(e=(Pn&~(1<<32-it(Pn)-1)).toString(32)+e),0<(e=ri++)&&(t+="H"+e.toString(32)),t+=":"}else t=":"+t+"r"+(e=ci++).toString(32)+":";return g.memoizedState=t},unstable_isNewReconciler:!1},$i={readContext:JC,useCallback:xi,useContext:JC,useEffect:wi,useImperativeHandle:Ei,useInsertionEffect:Ni,useLayoutEffect:Ki,useMemo:Li,useReducer:Gi,useRef:vi,useState:function(){return Gi(bi)},useDebugValue:zi,useDeferredValue:function(g){return Mi(Zi(),li.memoizedState,g)},useTransition:function(){return[Gi(bi)[0],Zi().memoizedState]},useMutableSource:yi,useSyncExternalStore:Bi,useId:Ti,unstable_isNewReconciler:!1},gl={readContext:JC,useCallback:xi,useContext:JC,useEffect:wi,useImperativeHandle:Ei,useInsertionEffect:Ni,useLayoutEffect:Ki,useMemo:Li,useReducer:pi,useRef:vi,useState:function(){return pi(bi)},useDebugValue:zi,useDeferredValue:function(g){var t=Zi();return null===li?t.memoizedState=g:Mi(t,li.memoizedState,g)},useTransition:function(){return[pi(bi)[0],Zi().memoizedState]},useMutableSource:yi,useSyncExternalStore:Bi,useId:Ti,unstable_isNewReconciler:!1};function tl(g,t){if(g&&g.defaultProps){for(var e in t=K({},t),g=g.defaultProps)void 0===t[e]&&(t[e]=g[e]);return t}return t}function el(g,t,e,I){e=null===(e=e(I,t=g.memoizedState))||void 0===e?t:K({},t,e),g.memoizedState=e,0===g.lanes&&(g.updateQueue.baseState=e)}var Il={isMounted:function(g){return!!(g=g._reactInternals)&&Lg(g)===g},enqueueSetState:function(g,t,e){g=g._reactInternals;var I=gs(),n=ts(g),C=FC(I,n);C.payload=t,void 0!==e&&null!==e&&(C.callback=e),null!==(t=EC(g,C,n))&&(es(t,g,n,I),zC(t,g,n))},enqueueReplaceState:function(g,t,e){g=g._reactInternals;var I=gs(),n=ts(g),C=FC(I,n);C.tag=1,C.payload=t,void 0!==e&&null!==e&&(C.callback=e),null!==(t=EC(g,C,n))&&(es(t,g,n,I),zC(t,g,n))},enqueueForceUpdate:function(g,t){g=g._reactInternals;var e=gs(),I=ts(g),n=FC(e,I);n.tag=2,void 0!==t&&null!==t&&(n.callback=t),null!==(t=EC(g,n,I))&&(es(t,g,I,e),zC(t,g,I))}};function nl(g,t,e,I,n,C,i){return"function"===typeof(g=g.stateNode).shouldComponentUpdate?g.shouldComponentUpdate(I,C,i):!t.prototype||!t.prototype.isPureReactComponent||(!lI(e,I)||!lI(n,C))}function Cl(g,t,e){var I=!1,n=Rn,C=t.contextType;return"object"===typeof C&&null!==C?C=JC(C):(n=kn(t)?Jn:fn.current,C=(I=null!==(I=t.contextTypes)&&void 0!==I)?vn(g,n):Rn),t=new t(e,C),g.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Il,g.stateNode=t,t._reactInternals=g,I&&((g=g.stateNode).__reactInternalMemoizedUnmaskedChildContext=n,g.__reactInternalMemoizedMaskedChildContext=C),t}function il(g,t,e,I){g=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(e,I),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(e,I),t.state!==g&&Il.enqueueReplaceState(t,t.state,null)}function ll(g,t,e,I){var n=g.stateNode;n.props=e,n.state=g.memoizedState,n.refs={},NC(g);var C=t.contextType;"object"===typeof C&&null!==C?n.context=JC(C):(C=kn(t)?Jn:fn.current,n.context=vn(g,C)),n.state=g.memoizedState,"function"===typeof(C=t.getDerivedStateFromProps)&&(el(g,t,C,e),n.state=g.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof n.getSnapshotBeforeUpdate||"function"!==typeof n.UNSAFE_componentWillMount&&"function"!==typeof n.componentWillMount||(t=n.state,"function"===typeof n.componentWillMount&&n.componentWillMount(),"function"===typeof n.UNSAFE_componentWillMount&&n.UNSAFE_componentWillMount(),t!==n.state&&Il.enqueueReplaceState(n,n.state,null),LC(g,e,n,I),n.state=g.memoizedState),"function"===typeof n.componentDidMount&&(g.flags|=4194308)}function ol(g,t){try{var e="",I=t;do{e+=x(I),I=I.return}while(I);var n=e}catch(C){n="\nError generating stack: "+C.message+"\n"+C.stack}return{value:g,source:t,stack:n,digest:null}}function sl(g,t,e){return{value:g,source:null,stack:null!=e?e:null,digest:null!=t?t:null}}function al(g,t){try{console.error(t.value)}catch(e){setTimeout((function(){throw e}))}}var rl="function"===typeof WeakMap?WeakMap:Map;function cl(g,t,e){(e=FC(-1,e)).tag=3,e.payload={element:null};var I=t.value;return e.callback=function(){Uo||(Uo=!0,To=I),al(0,t)},e}function Al(g,t,e){(e=FC(-1,e)).tag=3;var I=g.type.getDerivedStateFromError;if("function"===typeof I){var n=t.value;e.payload=function(){return I(n)},e.callback=function(){al(0,t)}}var C=g.stateNode;return null!==C&&"function"===typeof C.componentDidCatch&&(e.callback=function(){al(0,t),"function"!==typeof I&&(null===Qo?Qo=new Set([this]):Qo.add(this));var g=t.stack;this.componentDidCatch(t.value,{componentStack:null!==g?g:""})}),e}function dl(g,t,e){var I=g.pingCache;if(null===I){I=g.pingCache=new rl;var n=new Set;I.set(t,n)}else void 0===(n=I.get(t))&&(n=new Set,I.set(t,n));n.has(e)||(n.add(e),g=Ws.bind(null,g,t,e),t.then(g,g))}function ul(g){do{var t;if((t=13===g.tag)&&(t=null===(t=g.memoizedState)||null!==t.dehydrated),t)return g;g=g.return}while(null!==g);return null}function hl(g,t,e,I,n){return 0===(1&g.mode)?(g===t?g.flags|=65536:(g.flags|=128,e.flags|=131072,e.flags&=-52805,1===e.tag&&(null===e.alternate?e.tag=17:((t=FC(-1,1)).tag=2,EC(e,t,1))),e.lanes|=1),g):(g.flags|=65536,g.lanes=n,g)}var ml=G.ReactCurrentOwner,Zl=!1;function bl(g,t,e,I){t.child=null===g?pC(t,null,e,I):GC(t,g.child,e,I)}function Gl(g,t,e,I,n){e=e.render;var C=t.ref;return XC(t,n),I=ui(g,t,e,I,C,n),e=hi(),null===g||Zl?(nC&&e&&gC(t),t.flags|=1,bl(g,t,I,n),t.child):(t.updateQueue=g.updateQueue,t.flags&=-2053,g.lanes&=~n,Ml(g,t,n))}function pl(g,t,e,I,n){if(null===g){var C=e.type;return"function"!==typeof C||ks(C)||void 0!==C.defaultProps||null!==e.compare||void 0!==e.defaultProps?((g=Hs(e.type,null,I,t,t.mode,n)).ref=t.ref,g.return=t,t.child=g):(t.tag=15,t.type=C,yl(g,t,C,I,n))}if(C=g.child,0===(g.lanes&n)){var i=C.memoizedProps;if((e=null!==(e=e.compare)?e:lI)(i,I)&&g.ref===t.ref)return Ml(g,t,n)}return t.flags|=1,(g=Ys(C,I)).ref=t.ref,g.return=t,t.child=g}function yl(g,t,e,I,n){if(null!==g){var C=g.memoizedProps;if(lI(C,I)&&g.ref===t.ref){if(Zl=!1,t.pendingProps=I=C,0===(g.lanes&n))return t.lanes=g.lanes,Ml(g,t,n);0!==(131072&g.flags)&&(Zl=!0)}}return Wl(g,t,e,I,n)}function Bl(g,t,e){var I=t.pendingProps,n=I.children,C=null!==g?g.memoizedState:null;if("hidden"===I.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Sn(Yo,ko),ko|=e;else{if(0===(1073741824&e))return g=null!==C?C.baseLanes|e:e,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:g,cachePool:null,transitions:null},t.updateQueue=null,Sn(Yo,ko),ko|=g,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},I=null!==C?C.baseLanes:e,Sn(Yo,ko),ko|=I}else null!==C?(I=C.baseLanes|e,t.memoizedState=null):I=e,Sn(Yo,ko),ko|=I;return bl(g,t,n,e),t.child}function Vl(g,t){var e=t.ref;(null===g&&null!==e||null!==g&&g.ref!==e)&&(t.flags|=512,t.flags|=2097152)}function Wl(g,t,e,I,n){var C=kn(e)?Jn:fn.current;return C=vn(t,C),XC(t,n),e=ui(g,t,e,I,C,n),I=hi(),null===g||Zl?(nC&&I&&gC(t),t.flags|=1,bl(g,t,e,n),t.child):(t.updateQueue=g.updateQueue,t.flags&=-2053,g.lanes&=~n,Ml(g,t,n))}function Sl(g,t,e,I,n){if(kn(e)){var C=!0;Nn(t)}else C=!1;if(XC(t,n),null===t.stateNode)Ll(g,t),Cl(t,e,I),ll(t,e,I,n),I=!0;else if(null===g){var i=t.stateNode,l=t.memoizedProps;i.props=l;var o=i.context,s=e.contextType;"object"===typeof s&&null!==s?s=JC(s):s=vn(t,s=kn(e)?Jn:fn.current);var a=e.getDerivedStateFromProps,r="function"===typeof a||"function"===typeof i.getSnapshotBeforeUpdate;r||"function"!==typeof i.UNSAFE_componentWillReceiveProps&&"function"!==typeof i.componentWillReceiveProps||(l!==I||o!==s)&&il(t,i,I,s),wC=!1;var c=t.memoizedState;i.state=c,LC(t,I,i,n),o=t.memoizedState,l!==I||c!==o||Xn.current||wC?("function"===typeof a&&(el(t,e,a,I),o=t.memoizedState),(l=wC||nl(t,e,l,I,c,o,s))?(r||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||("function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount()),"function"===typeof i.componentDidMount&&(t.flags|=4194308)):("function"===typeof i.componentDidMount&&(t.flags|=4194308),t.memoizedProps=I,t.memoizedState=o),i.props=I,i.state=o,i.context=s,I=l):("function"===typeof i.componentDidMount&&(t.flags|=4194308),I=!1)}else{i=t.stateNode,KC(g,t),l=t.memoizedProps,s=t.type===t.elementType?l:tl(t.type,l),i.props=s,r=t.pendingProps,c=i.context,"object"===typeof(o=e.contextType)&&null!==o?o=JC(o):o=vn(t,o=kn(e)?Jn:fn.current);var A=e.getDerivedStateFromProps;(a="function"===typeof A||"function"===typeof i.getSnapshotBeforeUpdate)||"function"!==typeof i.UNSAFE_componentWillReceiveProps&&"function"!==typeof i.componentWillReceiveProps||(l!==r||c!==o)&&il(t,i,I,o),wC=!1,c=t.memoizedState,i.state=c,LC(t,I,i,n);var d=t.memoizedState;l!==r||c!==d||Xn.current||wC?("function"===typeof A&&(el(t,e,A,I),d=t.memoizedState),(s=wC||nl(t,e,s,I,c,d,o)||!1)?(a||"function"!==typeof i.UNSAFE_componentWillUpdate&&"function"!==typeof i.componentWillUpdate||("function"===typeof i.componentWillUpdate&&i.componentWillUpdate(I,d,o),"function"===typeof i.UNSAFE_componentWillUpdate&&i.UNSAFE_componentWillUpdate(I,d,o)),"function"===typeof i.componentDidUpdate&&(t.flags|=4),"function"===typeof i.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof i.componentDidUpdate||l===g.memoizedProps&&c===g.memoizedState||(t.flags|=4),"function"!==typeof i.getSnapshotBeforeUpdate||l===g.memoizedProps&&c===g.memoizedState||(t.flags|=1024),t.memoizedProps=I,t.memoizedState=d),i.props=I,i.state=d,i.context=o,I=s):("function"!==typeof i.componentDidUpdate||l===g.memoizedProps&&c===g.memoizedState||(t.flags|=4),"function"!==typeof i.getSnapshotBeforeUpdate||l===g.memoizedProps&&c===g.memoizedState||(t.flags|=1024),I=!1)}return Rl(g,t,e,I,C,n)}function Rl(g,t,e,I,n,C){Vl(g,t);var i=0!==(128&t.flags);if(!I&&!i)return n&&Kn(t,e,!1),Ml(g,t,C);I=t.stateNode,ml.current=t;var l=i&&"function"!==typeof e.getDerivedStateFromError?null:I.render();return t.flags|=1,null!==g&&i?(t.child=GC(t,g.child,null,C),t.child=GC(t,null,l,C)):bl(g,t,l,C),t.memoizedState=I.state,n&&Kn(t,e,!0),t.child}function fl(g){var t=g.stateNode;t.pendingContext?Hn(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Hn(0,t.context,!1),jC(g,t.containerInfo)}function Xl(g,t,e,I,n){return AC(),dC(n),t.flags|=256,bl(g,t,e,I),t.child}var Jl,vl,kl,Yl,Hl={dehydrated:null,treeContext:null,retryLane:0};function wl(g){return{baseLanes:g,cachePool:null,transitions:null}}function Nl(g,t,e){var I,n=t.pendingProps,i=$C.current,l=!1,o=0!==(128&t.flags);if((I=o)||(I=(null===g||null!==g.memoizedState)&&0!==(2&i)),I?(l=!0,t.flags&=-129):null!==g&&null===g.memoizedState||(i|=1),Sn($C,1&i),null===g)return sC(t),null!==(g=t.memoizedState)&&null!==(g=g.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===g.data?t.lanes=8:t.lanes=1073741824,null):(o=n.children,g=n.fallback,l?(n=t.mode,l=t.child,o={mode:"hidden",children:o},0===(1&n)&&null!==l?(l.childLanes=0,l.pendingProps=o):l=Ns(o,n,0,null),g=ws(g,n,e,null),l.return=t,g.return=t,l.sibling=g,t.child=l,t.child.memoizedState=wl(e),t.memoizedState=Hl,g):Kl(t,o));if(null!==(i=g.memoizedState)&&null!==(I=i.dehydrated))return function(g,t,e,I,n,i,l){if(e)return 256&t.flags?(t.flags&=-257,Fl(g,t,l,I=sl(Error(C(422))))):null!==t.memoizedState?(t.child=g.child,t.flags|=128,null):(i=I.fallback,n=t.mode,I=Ns({mode:"visible",children:I.children},n,0,null),(i=ws(i,n,l,null)).flags|=2,I.return=t,i.return=t,I.sibling=i,t.child=I,0!==(1&t.mode)&&GC(t,g.child,null,l),t.child.memoizedState=wl(l),t.memoizedState=Hl,i);if(0===(1&t.mode))return Fl(g,t,l,null);if("$!"===n.data){if(I=n.nextSibling&&n.nextSibling.dataset)var o=I.dgst;return I=o,Fl(g,t,l,I=sl(i=Error(C(419)),I,void 0))}if(o=0!==(l&g.childLanes),Zl||o){if(null!==(I=Xo)){switch(l&-l){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}0!==(n=0!==(n&(I.suspendedLanes|l))?0:n)&&n!==i.retryLane&&(i.retryLane=n,HC(g,n),es(I,g,n,-1))}return us(),Fl(g,t,l,I=sl(Error(C(421))))}return"$?"===n.data?(t.flags|=128,t.child=g.child,t=Rs.bind(null,g),n._reactRetry=t,null):(g=i.treeContext,IC=sn(n.nextSibling),eC=t,nC=!0,CC=null,null!==g&&(Dn[_n++]=Pn,Dn[_n++]=On,Dn[_n++]=jn,Pn=g.id,On=g.overflow,jn=t),t=Kl(t,I.children),t.flags|=4096,t)}(g,t,o,n,I,i,e);if(l){l=n.fallback,o=t.mode,I=(i=g.child).sibling;var s={mode:"hidden",children:n.children};return 0===(1&o)&&t.child!==i?((n=t.child).childLanes=0,n.pendingProps=s,t.deletions=null):(n=Ys(i,s)).subtreeFlags=14680064&i.subtreeFlags,null!==I?l=Ys(I,l):(l=ws(l,o,e,null)).flags|=2,l.return=t,n.return=t,n.sibling=l,t.child=n,n=l,l=t.child,o=null===(o=g.child.memoizedState)?wl(e):{baseLanes:o.baseLanes|e,cachePool:null,transitions:o.transitions},l.memoizedState=o,l.childLanes=g.childLanes&~e,t.memoizedState=Hl,n}return g=(l=g.child).sibling,n=Ys(l,{mode:"visible",children:n.children}),0===(1&t.mode)&&(n.lanes=e),n.return=t,n.sibling=null,null!==g&&(null===(e=t.deletions)?(t.deletions=[g],t.flags|=16):e.push(g)),t.child=n,t.memoizedState=null,n}function Kl(g,t){return(t=Ns({mode:"visible",children:t},g.mode,0,null)).return=g,g.child=t}function Fl(g,t,e,I){return null!==I&&dC(I),GC(t,g.child,null,e),(g=Kl(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,g}function El(g,t,e){g.lanes|=t;var I=g.alternate;null!==I&&(I.lanes|=t),fC(g.return,t,e)}function zl(g,t,e,I,n){var C=g.memoizedState;null===C?g.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:I,tail:e,tailMode:n}:(C.isBackwards=t,C.rendering=null,C.renderingStartTime=0,C.last=I,C.tail=e,C.tailMode=n)}function xl(g,t,e){var I=t.pendingProps,n=I.revealOrder,C=I.tail;if(bl(g,t,I.children,e),0!==(2&(I=$C.current)))I=1&I|2,t.flags|=128;else{if(null!==g&&0!==(128&g.flags))g:for(g=t.child;null!==g;){if(13===g.tag)null!==g.memoizedState&&El(g,e,t);else if(19===g.tag)El(g,e,t);else if(null!==g.child){g.child.return=g,g=g.child;continue}if(g===t)break g;for(;null===g.sibling;){if(null===g.return||g.return===t)break g;g=g.return}g.sibling.return=g.return,g=g.sibling}I&=1}if(Sn($C,I),0===(1&t.mode))t.memoizedState=null;else switch(n){case"forwards":for(e=t.child,n=null;null!==e;)null!==(g=e.alternate)&&null===gi(g)&&(n=e),e=e.sibling;null===(e=n)?(n=t.child,t.child=null):(n=e.sibling,e.sibling=null),zl(t,!1,n,e,C);break;case"backwards":for(e=null,n=t.child,t.child=null;null!==n;){if(null!==(g=n.alternate)&&null===gi(g)){t.child=n;break}g=n.sibling,n.sibling=e,e=n,n=g}zl(t,!0,e,null,C);break;case"together":zl(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ll(g,t){0===(1&t.mode)&&null!==g&&(g.alternate=null,t.alternate=null,t.flags|=2)}function Ml(g,t,e){if(null!==g&&(t.dependencies=g.dependencies),No|=t.lanes,0===(e&t.childLanes))return null;if(null!==g&&t.child!==g.child)throw Error(C(153));if(null!==t.child){for(e=Ys(g=t.child,g.pendingProps),t.child=e,e.return=t;null!==g.sibling;)g=g.sibling,(e=e.sibling=Ys(g,g.pendingProps)).return=t;e.sibling=null}return t.child}function Ul(g,t){if(!nC)switch(g.tailMode){case"hidden":t=g.tail;for(var e=null;null!==t;)null!==t.alternate&&(e=t),t=t.sibling;null===e?g.tail=null:e.sibling=null;break;case"collapsed":e=g.tail;for(var I=null;null!==e;)null!==e.alternate&&(I=e),e=e.sibling;null===I?t||null===g.tail?g.tail=null:g.tail.sibling=null:I.sibling=null}}function Tl(g){var t=null!==g.alternate&&g.alternate.child===g.child,e=0,I=0;if(t)for(var n=g.child;null!==n;)e|=n.lanes|n.childLanes,I|=14680064&n.subtreeFlags,I|=14680064&n.flags,n.return=g,n=n.sibling;else for(n=g.child;null!==n;)e|=n.lanes|n.childLanes,I|=n.subtreeFlags,I|=n.flags,n.return=g,n=n.sibling;return g.subtreeFlags|=I,g.childLanes=e,t}function Ql(g,t,e){var I=t.pendingProps;switch(tC(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Tl(t),null;case 1:case 17:return kn(t.type)&&Yn(),Tl(t),null;case 3:return I=t.stateNode,PC(),Wn(Xn),Wn(fn),ei(),I.pendingContext&&(I.context=I.pendingContext,I.pendingContext=null),null!==g&&null!==g.child||(rC(t)?t.flags|=4:null===g||g.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==CC&&(is(CC),CC=null))),vl(g,t),Tl(t),null;case 5:qC(t);var n=_C(DC.current);if(e=t.type,null!==g&&null!=t.stateNode)kl(g,t,e,I,n),g.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!I){if(null===t.stateNode)throw Error(C(166));return Tl(t),null}if(g=_C(TC.current),rC(t)){I=t.stateNode,e=t.type;var i=t.memoizedProps;switch(I[cn]=t,I[An]=i,g=0!==(1&t.mode),e){case"dialog":FI("cancel",I),FI("close",I);break;case"iframe":case"object":case"embed":FI("load",I);break;case"video":case"audio":for(n=0;n<HI.length;n++)FI(HI[n],I);break;case"source":FI("error",I);break;case"img":case"image":case"link":FI("error",I),FI("load",I);break;case"details":FI("toggle",I);break;case"input":P(I,i),FI("invalid",I);break;case"select":I._wrapperState={wasMultiple:!!i.multiple},FI("invalid",I);break;case"textarea":ng(I,i),FI("invalid",I)}for(var o in Zg(e,i),n=null,i)if(i.hasOwnProperty(o)){var s=i[o];"children"===o?"string"===typeof s?I.textContent!==s&&(!0!==i.suppressHydrationWarning&&OI(I.textContent,s,g),n=["children",s]):"number"===typeof s&&I.textContent!==""+s&&(!0!==i.suppressHydrationWarning&&OI(I.textContent,s,g),n=["children",""+s]):l.hasOwnProperty(o)&&null!=s&&"onScroll"===o&&FI("scroll",I)}switch(e){case"input":Q(I),$(I,i,!0);break;case"textarea":Q(I),ig(I);break;case"select":case"option":break;default:"function"===typeof i.onClick&&(I.onclick=qI)}I=n,t.updateQueue=I,null!==I&&(t.flags|=4)}else{o=9===n.nodeType?n:n.ownerDocument,"http://www.w3.org/1999/xhtml"===g&&(g=lg(e)),"http://www.w3.org/1999/xhtml"===g?"script"===e?((g=o.createElement("div")).innerHTML="<script><\/script>",g=g.removeChild(g.firstChild)):"string"===typeof I.is?g=o.createElement(e,{is:I.is}):(g=o.createElement(e),"select"===e&&(o=g,I.multiple?o.multiple=!0:I.size&&(o.size=I.size))):g=o.createElementNS(g,e),g[cn]=t,g[An]=I,Jl(g,t,!1,!1),t.stateNode=g;g:{switch(o=bg(e,I),e){case"dialog":FI("cancel",g),FI("close",g),n=I;break;case"iframe":case"object":case"embed":FI("load",g),n=I;break;case"video":case"audio":for(n=0;n<HI.length;n++)FI(HI[n],g);n=I;break;case"source":FI("error",g),n=I;break;case"img":case"image":case"link":FI("error",g),FI("load",g),n=I;break;case"details":FI("toggle",g),n=I;break;case"input":P(g,I),n=j(g,I),FI("invalid",g);break;case"option":default:n=I;break;case"select":g._wrapperState={wasMultiple:!!I.multiple},n=K({},I,{value:void 0}),FI("invalid",g);break;case"textarea":ng(g,I),n=Ig(g,I),FI("invalid",g)}for(i in Zg(e,n),s=n)if(s.hasOwnProperty(i)){var a=s[i];"style"===i?hg(g,a):"dangerouslySetInnerHTML"===i?null!=(a=a?a.__html:void 0)&&rg(g,a):"children"===i?"string"===typeof a?("textarea"!==e||""!==a)&&cg(g,a):"number"===typeof a&&cg(g,""+a):"suppressContentEditableWarning"!==i&&"suppressHydrationWarning"!==i&&"autoFocus"!==i&&(l.hasOwnProperty(i)?null!=a&&"onScroll"===i&&FI("scroll",g):null!=a&&b(g,i,a,o))}switch(e){case"input":Q(g),$(g,I,!1);break;case"textarea":Q(g),ig(g);break;case"option":null!=I.value&&g.setAttribute("value",""+U(I.value));break;case"select":g.multiple=!!I.multiple,null!=(i=I.value)?eg(g,!!I.multiple,i,!1):null!=I.defaultValue&&eg(g,!!I.multiple,I.defaultValue,!0);break;default:"function"===typeof n.onClick&&(g.onclick=qI)}switch(e){case"button":case"input":case"select":case"textarea":I=!!I.autoFocus;break g;case"img":I=!0;break g;default:I=!1}}I&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Tl(t),null;case 6:if(g&&null!=t.stateNode)Yl(g,t,g.memoizedProps,I);else{if("string"!==typeof I&&null===t.stateNode)throw Error(C(166));if(e=_C(DC.current),_C(TC.current),rC(t)){if(I=t.stateNode,e=t.memoizedProps,I[cn]=t,(i=I.nodeValue!==e)&&null!==(g=eC))switch(g.tag){case 3:OI(I.nodeValue,e,0!==(1&g.mode));break;case 5:!0!==g.memoizedProps.suppressHydrationWarning&&OI(I.nodeValue,e,0!==(1&g.mode))}i&&(t.flags|=4)}else(I=(9===e.nodeType?e:e.ownerDocument).createTextNode(I))[cn]=t,t.stateNode=I}return Tl(t),null;case 13:if(Wn($C),I=t.memoizedState,null===g||null!==g.memoizedState&&null!==g.memoizedState.dehydrated){if(nC&&null!==IC&&0!==(1&t.mode)&&0===(128&t.flags))cC(),AC(),t.flags|=98560,i=!1;else if(i=rC(t),null!==I&&null!==I.dehydrated){if(null===g){if(!i)throw Error(C(318));if(!(i=null!==(i=t.memoizedState)?i.dehydrated:null))throw Error(C(317));i[cn]=t}else AC(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Tl(t),i=!1}else null!==CC&&(is(CC),CC=null),i=!0;if(!i)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=e,t):((I=null!==I)!==(null!==g&&null!==g.memoizedState)&&I&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===g||0!==(1&$C.current)?0===Ho&&(Ho=3):us())),null!==t.updateQueue&&(t.flags|=4),Tl(t),null);case 4:return PC(),vl(g,t),null===g&&xI(t.stateNode.containerInfo),Tl(t),null;case 10:return RC(t.type._context),Tl(t),null;case 19:if(Wn($C),null===(i=t.memoizedState))return Tl(t),null;if(I=0!==(128&t.flags),null===(o=i.rendering))if(I)Ul(i,!1);else{if(0!==Ho||null!==g&&0!==(128&g.flags))for(g=t.child;null!==g;){if(null!==(o=gi(g))){for(t.flags|=128,Ul(i,!1),null!==(I=o.updateQueue)&&(t.updateQueue=I,t.flags|=4),t.subtreeFlags=0,I=e,e=t.child;null!==e;)g=I,(i=e).flags&=14680066,null===(o=i.alternate)?(i.childLanes=0,i.lanes=g,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,g=o.dependencies,i.dependencies=null===g?null:{lanes:g.lanes,firstContext:g.firstContext}),e=e.sibling;return Sn($C,1&$C.current|2),t.child}g=g.sibling}null!==i.tail&&Og()>Lo&&(t.flags|=128,I=!0,Ul(i,!1),t.lanes=4194304)}else{if(!I)if(null!==(g=gi(o))){if(t.flags|=128,I=!0,null!==(e=g.updateQueue)&&(t.updateQueue=e,t.flags|=4),Ul(i,!0),null===i.tail&&"hidden"===i.tailMode&&!o.alternate&&!nC)return Tl(t),null}else 2*Og()-i.renderingStartTime>Lo&&1073741824!==e&&(t.flags|=128,I=!0,Ul(i,!1),t.lanes=4194304);i.isBackwards?(o.sibling=t.child,t.child=o):(null!==(e=i.last)?e.sibling=o:t.child=o,i.last=o)}return null!==i.tail?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Og(),t.sibling=null,e=$C.current,Sn($C,I?1&e|2:1&e),t):(Tl(t),null);case 22:case 23:return rs(),I=null!==t.memoizedState,null!==g&&null!==g.memoizedState!==I&&(t.flags|=8192),I&&0!==(1&t.mode)?0!==(1073741824&ko)&&(Tl(t),6&t.subtreeFlags&&(t.flags|=8192)):Tl(t),null;case 24:case 25:return null}throw Error(C(156,t.tag))}function Dl(g,t){switch(tC(t),t.tag){case 1:return kn(t.type)&&Yn(),65536&(g=t.flags)?(t.flags=-65537&g|128,t):null;case 3:return PC(),Wn(Xn),Wn(fn),ei(),0!==(65536&(g=t.flags))&&0===(128&g)?(t.flags=-65537&g|128,t):null;case 5:return qC(t),null;case 13:if(Wn($C),null!==(g=t.memoizedState)&&null!==g.dehydrated){if(null===t.alternate)throw Error(C(340));AC()}return 65536&(g=t.flags)?(t.flags=-65537&g|128,t):null;case 19:return Wn($C),null;case 4:return PC(),null;case 10:return RC(t.type._context),null;case 22:case 23:return rs(),null;default:return null}}Jl=function(g,t){for(var e=t.child;null!==e;){if(5===e.tag||6===e.tag)g.appendChild(e.stateNode);else if(4!==e.tag&&null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return;e=e.return}e.sibling.return=e.return,e=e.sibling}},vl=function(){},kl=function(g,t,e,I){var n=g.memoizedProps;if(n!==I){g=t.stateNode,_C(TC.current);var C,i=null;switch(e){case"input":n=j(g,n),I=j(g,I),i=[];break;case"select":n=K({},n,{value:void 0}),I=K({},I,{value:void 0}),i=[];break;case"textarea":n=Ig(g,n),I=Ig(g,I),i=[];break;default:"function"!==typeof n.onClick&&"function"===typeof I.onClick&&(g.onclick=qI)}for(a in Zg(e,I),e=null,n)if(!I.hasOwnProperty(a)&&n.hasOwnProperty(a)&&null!=n[a])if("style"===a){var o=n[a];for(C in o)o.hasOwnProperty(C)&&(e||(e={}),e[C]="")}else"dangerouslySetInnerHTML"!==a&&"children"!==a&&"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(l.hasOwnProperty(a)?i||(i=[]):(i=i||[]).push(a,null));for(a in I){var s=I[a];if(o=null!=n?n[a]:void 0,I.hasOwnProperty(a)&&s!==o&&(null!=s||null!=o))if("style"===a)if(o){for(C in o)!o.hasOwnProperty(C)||s&&s.hasOwnProperty(C)||(e||(e={}),e[C]="");for(C in s)s.hasOwnProperty(C)&&o[C]!==s[C]&&(e||(e={}),e[C]=s[C])}else e||(i||(i=[]),i.push(a,e)),e=s;else"dangerouslySetInnerHTML"===a?(s=s?s.__html:void 0,o=o?o.__html:void 0,null!=s&&o!==s&&(i=i||[]).push(a,s)):"children"===a?"string"!==typeof s&&"number"!==typeof s||(i=i||[]).push(a,""+s):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&(l.hasOwnProperty(a)?(null!=s&&"onScroll"===a&&FI("scroll",g),i||o===s||(i=[])):(i=i||[]).push(a,s))}e&&(i=i||[]).push("style",e);var a=i;(t.updateQueue=a)&&(t.flags|=4)}},Yl=function(g,t,e,I){e!==I&&(t.flags|=4)};var _l=!1,jl=!1,Pl="function"===typeof WeakSet?WeakSet:Set,Ol=null;function ql(g,t){var e=g.ref;if(null!==e)if("function"===typeof e)try{e(null)}catch(I){Vs(g,t,I)}else e.current=null}function $l(g,t,e){try{e()}catch(I){Vs(g,t,I)}}var go=!1;function to(g,t,e){var I=t.updateQueue;if(null!==(I=null!==I?I.lastEffect:null)){var n=I=I.next;do{if((n.tag&g)===g){var C=n.destroy;n.destroy=void 0,void 0!==C&&$l(t,e,C)}n=n.next}while(n!==I)}}function eo(g,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var e=t=t.next;do{if((e.tag&g)===g){var I=e.create;e.destroy=I()}e=e.next}while(e!==t)}}function Io(g){var t=g.ref;if(null!==t){var e=g.stateNode;g.tag,g=e,"function"===typeof t?t(g):t.current=g}}function no(g){var t=g.alternate;null!==t&&(g.alternate=null,no(t)),g.child=null,g.deletions=null,g.sibling=null,5===g.tag&&(null!==(t=g.stateNode)&&(delete t[cn],delete t[An],delete t[un],delete t[hn],delete t[mn])),g.stateNode=null,g.return=null,g.dependencies=null,g.memoizedProps=null,g.memoizedState=null,g.pendingProps=null,g.stateNode=null,g.updateQueue=null}function Co(g){return 5===g.tag||3===g.tag||4===g.tag}function io(g){g:for(;;){for(;null===g.sibling;){if(null===g.return||Co(g.return))return null;g=g.return}for(g.sibling.return=g.return,g=g.sibling;5!==g.tag&&6!==g.tag&&18!==g.tag;){if(2&g.flags)continue g;if(null===g.child||4===g.tag)continue g;g.child.return=g,g=g.child}if(!(2&g.flags))return g.stateNode}}function lo(g,t,e){var I=g.tag;if(5===I||6===I)g=g.stateNode,t?8===e.nodeType?e.parentNode.insertBefore(g,t):e.insertBefore(g,t):(8===e.nodeType?(t=e.parentNode).insertBefore(g,e):(t=e).appendChild(g),null!==(e=e._reactRootContainer)&&void 0!==e||null!==t.onclick||(t.onclick=qI));else if(4!==I&&null!==(g=g.child))for(lo(g,t,e),g=g.sibling;null!==g;)lo(g,t,e),g=g.sibling}function oo(g,t,e){var I=g.tag;if(5===I||6===I)g=g.stateNode,t?e.insertBefore(g,t):e.appendChild(g);else if(4!==I&&null!==(g=g.child))for(oo(g,t,e),g=g.sibling;null!==g;)oo(g,t,e),g=g.sibling}var so=null,ao=!1;function ro(g,t,e){for(e=e.child;null!==e;)co(g,t,e),e=e.sibling}function co(g,t,e){if(Ct&&"function"===typeof Ct.onCommitFiberUnmount)try{Ct.onCommitFiberUnmount(nt,e)}catch(l){}switch(e.tag){case 5:jl||ql(e,t);case 6:var I=so,n=ao;so=null,ro(g,t,e),ao=n,null!==(so=I)&&(ao?(g=so,e=e.stateNode,8===g.nodeType?g.parentNode.removeChild(e):g.removeChild(e)):so.removeChild(e.stateNode));break;case 18:null!==so&&(ao?(g=so,e=e.stateNode,8===g.nodeType?on(g.parentNode,e):1===g.nodeType&&on(g,e),Lt(g)):on(so,e.stateNode));break;case 4:I=so,n=ao,so=e.stateNode.containerInfo,ao=!0,ro(g,t,e),so=I,ao=n;break;case 0:case 11:case 14:case 15:if(!jl&&(null!==(I=e.updateQueue)&&null!==(I=I.lastEffect))){n=I=I.next;do{var C=n,i=C.destroy;C=C.tag,void 0!==i&&(0!==(2&C)||0!==(4&C))&&$l(e,t,i),n=n.next}while(n!==I)}ro(g,t,e);break;case 1:if(!jl&&(ql(e,t),"function"===typeof(I=e.stateNode).componentWillUnmount))try{I.props=e.memoizedProps,I.state=e.memoizedState,I.componentWillUnmount()}catch(l){Vs(e,t,l)}ro(g,t,e);break;case 21:ro(g,t,e);break;case 22:1&e.mode?(jl=(I=jl)||null!==e.memoizedState,ro(g,t,e),jl=I):ro(g,t,e);break;default:ro(g,t,e)}}function Ao(g){var t=g.updateQueue;if(null!==t){g.updateQueue=null;var e=g.stateNode;null===e&&(e=g.stateNode=new Pl),t.forEach((function(t){var I=fs.bind(null,g,t);e.has(t)||(e.add(t),t.then(I,I))}))}}function uo(g,t){var e=t.deletions;if(null!==e)for(var I=0;I<e.length;I++){var n=e[I];try{var i=g,l=t,o=l;g:for(;null!==o;){switch(o.tag){case 5:so=o.stateNode,ao=!1;break g;case 3:case 4:so=o.stateNode.containerInfo,ao=!0;break g}o=o.return}if(null===so)throw Error(C(160));co(i,l,n),so=null,ao=!1;var s=n.alternate;null!==s&&(s.return=null),n.return=null}catch(a){Vs(n,t,a)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)ho(t,g),t=t.sibling}function ho(g,t){var e=g.alternate,I=g.flags;switch(g.tag){case 0:case 11:case 14:case 15:if(uo(t,g),mo(g),4&I){try{to(3,g,g.return),eo(3,g)}catch(h){Vs(g,g.return,h)}try{to(5,g,g.return)}catch(h){Vs(g,g.return,h)}}break;case 1:uo(t,g),mo(g),512&I&&null!==e&&ql(e,e.return);break;case 5:if(uo(t,g),mo(g),512&I&&null!==e&&ql(e,e.return),32&g.flags){var n=g.stateNode;try{cg(n,"")}catch(h){Vs(g,g.return,h)}}if(4&I&&null!=(n=g.stateNode)){var i=g.memoizedProps,l=null!==e?e.memoizedProps:i,o=g.type,s=g.updateQueue;if(g.updateQueue=null,null!==s)try{"input"===o&&"radio"===i.type&&null!=i.name&&O(n,i),bg(o,l);var a=bg(o,i);for(l=0;l<s.length;l+=2){var r=s[l],c=s[l+1];"style"===r?hg(n,c):"dangerouslySetInnerHTML"===r?rg(n,c):"children"===r?cg(n,c):b(n,r,c,a)}switch(o){case"input":q(n,i);break;case"textarea":Cg(n,i);break;case"select":var A=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!i.multiple;var d=i.value;null!=d?eg(n,!!i.multiple,d,!1):A!==!!i.multiple&&(null!=i.defaultValue?eg(n,!!i.multiple,i.defaultValue,!0):eg(n,!!i.multiple,i.multiple?[]:"",!1))}n[An]=i}catch(h){Vs(g,g.return,h)}}break;case 6:if(uo(t,g),mo(g),4&I){if(null===g.stateNode)throw Error(C(162));n=g.stateNode,i=g.memoizedProps;try{n.nodeValue=i}catch(h){Vs(g,g.return,h)}}break;case 3:if(uo(t,g),mo(g),4&I&&null!==e&&e.memoizedState.isDehydrated)try{Lt(t.containerInfo)}catch(h){Vs(g,g.return,h)}break;case 4:default:uo(t,g),mo(g);break;case 13:uo(t,g),mo(g),8192&(n=g.child).flags&&(i=null!==n.memoizedState,n.stateNode.isHidden=i,!i||null!==n.alternate&&null!==n.alternate.memoizedState||(xo=Og())),4&I&&Ao(g);break;case 22:if(r=null!==e&&null!==e.memoizedState,1&g.mode?(jl=(a=jl)||r,uo(t,g),jl=a):uo(t,g),mo(g),8192&I){if(a=null!==g.memoizedState,(g.stateNode.isHidden=a)&&!r&&0!==(1&g.mode))for(Ol=g,r=g.child;null!==r;){for(c=Ol=r;null!==Ol;){switch(d=(A=Ol).child,A.tag){case 0:case 11:case 14:case 15:to(4,A,A.return);break;case 1:ql(A,A.return);var u=A.stateNode;if("function"===typeof u.componentWillUnmount){I=A,e=A.return;try{t=I,u.props=t.memoizedProps,u.state=t.memoizedState,u.componentWillUnmount()}catch(h){Vs(I,e,h)}}break;case 5:ql(A,A.return);break;case 22:if(null!==A.memoizedState){po(c);continue}}null!==d?(d.return=A,Ol=d):po(c)}r=r.sibling}g:for(r=null,c=g;;){if(5===c.tag){if(null===r){r=c;try{n=c.stateNode,a?"function"===typeof(i=n.style).setProperty?i.setProperty("display","none","important"):i.display="none":(o=c.stateNode,l=void 0!==(s=c.memoizedProps.style)&&null!==s&&s.hasOwnProperty("display")?s.display:null,o.style.display=ug("display",l))}catch(h){Vs(g,g.return,h)}}}else if(6===c.tag){if(null===r)try{c.stateNode.nodeValue=a?"":c.memoizedProps}catch(h){Vs(g,g.return,h)}}else if((22!==c.tag&&23!==c.tag||null===c.memoizedState||c===g)&&null!==c.child){c.child.return=c,c=c.child;continue}if(c===g)break g;for(;null===c.sibling;){if(null===c.return||c.return===g)break g;r===c&&(r=null),c=c.return}r===c&&(r=null),c.sibling.return=c.return,c=c.sibling}}break;case 19:uo(t,g),mo(g),4&I&&Ao(g);case 21:}}function mo(g){var t=g.flags;if(2&t){try{g:{for(var e=g.return;null!==e;){if(Co(e)){var I=e;break g}e=e.return}throw Error(C(160))}switch(I.tag){case 5:var n=I.stateNode;32&I.flags&&(cg(n,""),I.flags&=-33),oo(g,io(g),n);break;case 3:case 4:var i=I.stateNode.containerInfo;lo(g,io(g),i);break;default:throw Error(C(161))}}catch(l){Vs(g,g.return,l)}g.flags&=-3}4096&t&&(g.flags&=-4097)}function Zo(g,t,e){Ol=g,bo(g,t,e)}function bo(g,t,e){for(var I=0!==(1&g.mode);null!==Ol;){var n=Ol,C=n.child;if(22===n.tag&&I){var i=null!==n.memoizedState||_l;if(!i){var l=n.alternate,o=null!==l&&null!==l.memoizedState||jl;l=_l;var s=jl;if(_l=i,(jl=o)&&!s)for(Ol=n;null!==Ol;)o=(i=Ol).child,22===i.tag&&null!==i.memoizedState?yo(n):null!==o?(o.return=i,Ol=o):yo(n);for(;null!==C;)Ol=C,bo(C,t,e),C=C.sibling;Ol=n,_l=l,jl=s}Go(g)}else 0!==(8772&n.subtreeFlags)&&null!==C?(C.return=n,Ol=C):Go(g)}}function Go(g){for(;null!==Ol;){var t=Ol;if(0!==(8772&t.flags)){var e=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:jl||eo(5,t);break;case 1:var I=t.stateNode;if(4&t.flags&&!jl)if(null===e)I.componentDidMount();else{var n=t.elementType===t.type?e.memoizedProps:tl(t.type,e.memoizedProps);I.componentDidUpdate(n,e.memoizedState,I.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;null!==i&&MC(t,i,I);break;case 3:var l=t.updateQueue;if(null!==l){if(e=null,null!==t.child)switch(t.child.tag){case 5:case 1:e=t.child.stateNode}MC(t,l,e)}break;case 5:var o=t.stateNode;if(null===e&&4&t.flags){e=o;var s=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":s.autoFocus&&e.focus();break;case"img":s.src&&(e.src=s.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var a=t.alternate;if(null!==a){var r=a.memoizedState;if(null!==r){var c=r.dehydrated;null!==c&&Lt(c)}}}break;default:throw Error(C(163))}jl||512&t.flags&&Io(t)}catch(A){Vs(t,t.return,A)}}if(t===g){Ol=null;break}if(null!==(e=t.sibling)){e.return=t.return,Ol=e;break}Ol=t.return}}function po(g){for(;null!==Ol;){var t=Ol;if(t===g){Ol=null;break}var e=t.sibling;if(null!==e){e.return=t.return,Ol=e;break}Ol=t.return}}function yo(g){for(;null!==Ol;){var t=Ol;try{switch(t.tag){case 0:case 11:case 15:var e=t.return;try{eo(4,t)}catch(o){Vs(t,e,o)}break;case 1:var I=t.stateNode;if("function"===typeof I.componentDidMount){var n=t.return;try{I.componentDidMount()}catch(o){Vs(t,n,o)}}var C=t.return;try{Io(t)}catch(o){Vs(t,C,o)}break;case 5:var i=t.return;try{Io(t)}catch(o){Vs(t,i,o)}}}catch(o){Vs(t,t.return,o)}if(t===g){Ol=null;break}var l=t.sibling;if(null!==l){l.return=t.return,Ol=l;break}Ol=t.return}}var Bo,Vo=Math.ceil,Wo=G.ReactCurrentDispatcher,So=G.ReactCurrentOwner,Ro=G.ReactCurrentBatchConfig,fo=0,Xo=null,Jo=null,vo=0,ko=0,Yo=Vn(0),Ho=0,wo=null,No=0,Ko=0,Fo=0,Eo=null,zo=null,xo=0,Lo=1/0,Mo=null,Uo=!1,To=null,Qo=null,Do=!1,_o=null,jo=0,Po=0,Oo=null,qo=-1,$o=0;function gs(){return 0!==(6&fo)?Og():-1!==qo?qo:qo=Og()}function ts(g){return 0===(1&g.mode)?1:0!==(2&fo)&&0!==vo?vo&-vo:null!==uC.transition?(0===$o&&($o=ut()),$o):0!==(g=bt)?g:g=void 0===(g=window.event)?16:Pt(g.type)}function es(g,t,e,I){if(50<Po)throw Po=0,Oo=null,Error(C(185));mt(g,e,I),0!==(2&fo)&&g===Xo||(g===Xo&&(0===(2&fo)&&(Ko|=e),4===Ho&&ls(g,vo)),Is(g,I),1===e&&0===fo&&0===(1&t.mode)&&(Lo=Og()+500,En&&Ln()))}function Is(g,t){var e=g.callbackNode;!function(g,t){for(var e=g.suspendedLanes,I=g.pingedLanes,n=g.expirationTimes,C=g.pendingLanes;0<C;){var i=31-it(C),l=1<<i,o=n[i];-1===o?0!==(l&e)&&0===(l&I)||(n[i]=At(l,t)):o<=t&&(g.expiredLanes|=l),C&=~l}}(g,t);var I=ct(g,g===Xo?vo:0);if(0===I)null!==e&&_g(e),g.callbackNode=null,g.callbackPriority=0;else if(t=I&-I,g.callbackPriority!==t){if(null!=e&&_g(e),1===t)0===g.tag?function(g){En=!0,xn(g)}(os.bind(null,g)):xn(os.bind(null,g)),Cn((function(){0===(6&fo)&&Ln()})),e=null;else{switch(Gt(I)){case 1:e=$g;break;case 4:e=gt;break;case 16:default:e=tt;break;case 536870912:e=It}e=Xs(e,ns.bind(null,g))}g.callbackPriority=t,g.callbackNode=e}}function ns(g,t){if(qo=-1,$o=0,0!==(6&fo))throw Error(C(327));var e=g.callbackNode;if(ys()&&g.callbackNode!==e)return null;var I=ct(g,g===Xo?vo:0);if(0===I)return null;if(0!==(30&I)||0!==(I&g.expiredLanes)||t)t=hs(g,I);else{t=I;var n=fo;fo|=2;var i=ds();for(Xo===g&&vo===t||(Mo=null,Lo=Og()+500,cs(g,t));;)try{Zs();break}catch(o){As(g,o)}SC(),Wo.current=i,fo=n,null!==Jo?t=0:(Xo=null,vo=0,t=Ho)}if(0!==t){if(2===t&&(0!==(n=dt(g))&&(I=n,t=Cs(g,n))),1===t)throw e=wo,cs(g,0),ls(g,I),Is(g,Og()),e;if(6===t)ls(g,I);else{if(n=g.current.alternate,0===(30&I)&&!function(g){for(var t=g;;){if(16384&t.flags){var e=t.updateQueue;if(null!==e&&null!==(e=e.stores))for(var I=0;I<e.length;I++){var n=e[I],C=n.getSnapshot;n=n.value;try{if(!iI(C(),n))return!1}catch(l){return!1}}}if(e=t.child,16384&t.subtreeFlags&&null!==e)e.return=t,t=e;else{if(t===g)break;for(;null===t.sibling;){if(null===t.return||t.return===g)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(n)&&(2===(t=hs(g,I))&&(0!==(i=dt(g))&&(I=i,t=Cs(g,i))),1===t))throw e=wo,cs(g,0),ls(g,I),Is(g,Og()),e;switch(g.finishedWork=n,g.finishedLanes=I,t){case 0:case 1:throw Error(C(345));case 2:case 5:ps(g,zo,Mo);break;case 3:if(ls(g,I),(130023424&I)===I&&10<(t=xo+500-Og())){if(0!==ct(g,0))break;if(((n=g.suspendedLanes)&I)!==I){gs(),g.pingedLanes|=g.suspendedLanes&n;break}g.timeoutHandle=en(ps.bind(null,g,zo,Mo),t);break}ps(g,zo,Mo);break;case 4:if(ls(g,I),(4194240&I)===I)break;for(t=g.eventTimes,n=-1;0<I;){var l=31-it(I);i=1<<l,(l=t[l])>n&&(n=l),I&=~i}if(I=n,10<(I=(120>(I=Og()-I)?120:480>I?480:1080>I?1080:1920>I?1920:3e3>I?3e3:4320>I?4320:1960*Vo(I/1960))-I)){g.timeoutHandle=en(ps.bind(null,g,zo,Mo),I);break}ps(g,zo,Mo);break;default:throw Error(C(329))}}}return Is(g,Og()),g.callbackNode===e?ns.bind(null,g):null}function Cs(g,t){var e=Eo;return g.current.memoizedState.isDehydrated&&(cs(g,t).flags|=256),2!==(g=hs(g,t))&&(t=zo,zo=e,null!==t&&is(t)),g}function is(g){null===zo?zo=g:zo.push.apply(zo,g)}function ls(g,t){for(t&=~Fo,t&=~Ko,g.suspendedLanes|=t,g.pingedLanes&=~t,g=g.expirationTimes;0<t;){var e=31-it(t),I=1<<e;g[e]=-1,t&=~I}}function os(g){if(0!==(6&fo))throw Error(C(327));ys();var t=ct(g,0);if(0===(1&t))return Is(g,Og()),null;var e=hs(g,t);if(0!==g.tag&&2===e){var I=dt(g);0!==I&&(t=I,e=Cs(g,I))}if(1===e)throw e=wo,cs(g,0),ls(g,t),Is(g,Og()),e;if(6===e)throw Error(C(345));return g.finishedWork=g.current.alternate,g.finishedLanes=t,ps(g,zo,Mo),Is(g,Og()),null}function ss(g,t){var e=fo;fo|=1;try{return g(t)}finally{0===(fo=e)&&(Lo=Og()+500,En&&Ln())}}function as(g){null!==_o&&0===_o.tag&&0===(6&fo)&&ys();var t=fo;fo|=1;var e=Ro.transition,I=bt;try{if(Ro.transition=null,bt=1,g)return g()}finally{bt=I,Ro.transition=e,0===(6&(fo=t))&&Ln()}}function rs(){ko=Yo.current,Wn(Yo)}function cs(g,t){g.finishedWork=null,g.finishedLanes=0;var e=g.timeoutHandle;if(-1!==e&&(g.timeoutHandle=-1,In(e)),null!==Jo)for(e=Jo.return;null!==e;){var I=e;switch(tC(I),I.tag){case 1:null!==(I=I.type.childContextTypes)&&void 0!==I&&Yn();break;case 3:PC(),Wn(Xn),Wn(fn),ei();break;case 5:qC(I);break;case 4:PC();break;case 13:case 19:Wn($C);break;case 10:RC(I.type._context);break;case 22:case 23:rs()}e=e.return}if(Xo=g,Jo=g=Ys(g.current,null),vo=ko=t,Ho=0,wo=null,Fo=Ko=No=0,zo=Eo=null,null!==vC){for(t=0;t<vC.length;t++)if(null!==(I=(e=vC[t]).interleaved)){e.interleaved=null;var n=I.next,C=e.pending;if(null!==C){var i=C.next;C.next=n,I.next=i}e.pending=I}vC=null}return g}function As(g,t){for(;;){var e=Jo;try{if(SC(),Ii.current=Oi,si){for(var I=ii.memoizedState;null!==I;){var n=I.queue;null!==n&&(n.pending=null),I=I.next}si=!1}if(Ci=0,oi=li=ii=null,ai=!1,ri=0,So.current=null,null===e||null===e.return){Ho=1,wo=t,Jo=null;break}g:{var i=g,l=e.return,o=e,s=t;if(t=vo,o.flags|=32768,null!==s&&"object"===typeof s&&"function"===typeof s.then){var a=s,r=o,c=r.tag;if(0===(1&r.mode)&&(0===c||11===c||15===c)){var A=r.alternate;A?(r.updateQueue=A.updateQueue,r.memoizedState=A.memoizedState,r.lanes=A.lanes):(r.updateQueue=null,r.memoizedState=null)}var d=ul(l);if(null!==d){d.flags&=-257,hl(d,l,o,0,t),1&d.mode&&dl(i,a,t),s=a;var u=(t=d).updateQueue;if(null===u){var h=new Set;h.add(s),t.updateQueue=h}else u.add(s);break g}if(0===(1&t)){dl(i,a,t),us();break g}s=Error(C(426))}else if(nC&&1&o.mode){var m=ul(l);if(null!==m){0===(65536&m.flags)&&(m.flags|=256),hl(m,l,o,0,t),dC(ol(s,o));break g}}i=s=ol(s,o),4!==Ho&&(Ho=2),null===Eo?Eo=[i]:Eo.push(i),i=l;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t,xC(i,cl(0,s,t));break g;case 1:o=s;var Z=i.type,b=i.stateNode;if(0===(128&i.flags)&&("function"===typeof Z.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Qo||!Qo.has(b)))){i.flags|=65536,t&=-t,i.lanes|=t,xC(i,Al(i,o,t));break g}}i=i.return}while(null!==i)}Gs(e)}catch(G){t=G,Jo===e&&null!==e&&(Jo=e=e.return);continue}break}}function ds(){var g=Wo.current;return Wo.current=Oi,null===g?Oi:g}function us(){0!==Ho&&3!==Ho&&2!==Ho||(Ho=4),null===Xo||0===(268435455&No)&&0===(268435455&Ko)||ls(Xo,vo)}function hs(g,t){var e=fo;fo|=2;var I=ds();for(Xo===g&&vo===t||(Mo=null,cs(g,t));;)try{ms();break}catch(n){As(g,n)}if(SC(),fo=e,Wo.current=I,null!==Jo)throw Error(C(261));return Xo=null,vo=0,Ho}function ms(){for(;null!==Jo;)bs(Jo)}function Zs(){for(;null!==Jo&&!jg();)bs(Jo)}function bs(g){var t=Bo(g.alternate,g,ko);g.memoizedProps=g.pendingProps,null===t?Gs(g):Jo=t,So.current=null}function Gs(g){var t=g;do{var e=t.alternate;if(g=t.return,0===(32768&t.flags)){if(null!==(e=Ql(e,t,ko)))return void(Jo=e)}else{if(null!==(e=Dl(e,t)))return e.flags&=32767,void(Jo=e);if(null===g)return Ho=6,void(Jo=null);g.flags|=32768,g.subtreeFlags=0,g.deletions=null}if(null!==(t=t.sibling))return void(Jo=t);Jo=t=g}while(null!==t);0===Ho&&(Ho=5)}function ps(g,t,e){var I=bt,n=Ro.transition;try{Ro.transition=null,bt=1,function(g,t,e,I){do{ys()}while(null!==_o);if(0!==(6&fo))throw Error(C(327));e=g.finishedWork;var n=g.finishedLanes;if(null===e)return null;if(g.finishedWork=null,g.finishedLanes=0,e===g.current)throw Error(C(177));g.callbackNode=null,g.callbackPriority=0;var i=e.lanes|e.childLanes;if(function(g,t){var e=g.pendingLanes&~t;g.pendingLanes=t,g.suspendedLanes=0,g.pingedLanes=0,g.expiredLanes&=t,g.mutableReadLanes&=t,g.entangledLanes&=t,t=g.entanglements;var I=g.eventTimes;for(g=g.expirationTimes;0<e;){var n=31-it(e),C=1<<n;t[n]=0,I[n]=-1,g[n]=-1,e&=~C}}(g,i),g===Xo&&(Jo=Xo=null,vo=0),0===(2064&e.subtreeFlags)&&0===(2064&e.flags)||Do||(Do=!0,Xs(tt,(function(){return ys(),null}))),i=0!==(15990&e.flags),0!==(15990&e.subtreeFlags)||i){i=Ro.transition,Ro.transition=null;var l=bt;bt=1;var o=fo;fo|=4,So.current=null,function(g,t){if($I=Ut,cI(g=rI())){if("selectionStart"in g)var e={start:g.selectionStart,end:g.selectionEnd};else g:{var I=(e=(e=g.ownerDocument)&&e.defaultView||window).getSelection&&e.getSelection();if(I&&0!==I.rangeCount){e=I.anchorNode;var n=I.anchorOffset,i=I.focusNode;I=I.focusOffset;try{e.nodeType,i.nodeType}catch(p){e=null;break g}var l=0,o=-1,s=-1,a=0,r=0,c=g,A=null;t:for(;;){for(var d;c!==e||0!==n&&3!==c.nodeType||(o=l+n),c!==i||0!==I&&3!==c.nodeType||(s=l+I),3===c.nodeType&&(l+=c.nodeValue.length),null!==(d=c.firstChild);)A=c,c=d;for(;;){if(c===g)break t;if(A===e&&++a===n&&(o=l),A===i&&++r===I&&(s=l),null!==(d=c.nextSibling))break;A=(c=A).parentNode}c=d}e=-1===o||-1===s?null:{start:o,end:s}}else e=null}e=e||{start:0,end:0}}else e=null;for(gn={focusedElem:g,selectionRange:e},Ut=!1,Ol=t;null!==Ol;)if(g=(t=Ol).child,0!==(1028&t.subtreeFlags)&&null!==g)g.return=t,Ol=g;else for(;null!==Ol;){t=Ol;try{var u=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==u){var h=u.memoizedProps,m=u.memoizedState,Z=t.stateNode,b=Z.getSnapshotBeforeUpdate(t.elementType===t.type?h:tl(t.type,h),m);Z.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var G=t.stateNode.containerInfo;1===G.nodeType?G.textContent="":9===G.nodeType&&G.documentElement&&G.removeChild(G.documentElement);break;default:throw Error(C(163))}}catch(p){Vs(t,t.return,p)}if(null!==(g=t.sibling)){g.return=t.return,Ol=g;break}Ol=t.return}u=go,go=!1}(g,e),ho(e,g),AI(gn),Ut=!!$I,gn=$I=null,g.current=e,Zo(e,g,n),Pg(),fo=o,bt=l,Ro.transition=i}else g.current=e;if(Do&&(Do=!1,_o=g,jo=n),i=g.pendingLanes,0===i&&(Qo=null),function(g){if(Ct&&"function"===typeof Ct.onCommitFiberRoot)try{Ct.onCommitFiberRoot(nt,g,void 0,128===(128&g.current.flags))}catch(t){}}(e.stateNode),Is(g,Og()),null!==t)for(I=g.onRecoverableError,e=0;e<t.length;e++)n=t[e],I(n.value,{componentStack:n.stack,digest:n.digest});if(Uo)throw Uo=!1,g=To,To=null,g;0!==(1&jo)&&0!==g.tag&&ys(),i=g.pendingLanes,0!==(1&i)?g===Oo?Po++:(Po=0,Oo=g):Po=0,Ln()}(g,t,e,I)}finally{Ro.transition=n,bt=I}return null}function ys(){if(null!==_o){var g=Gt(jo),t=Ro.transition,e=bt;try{if(Ro.transition=null,bt=16>g?16:g,null===_o)var I=!1;else{if(g=_o,_o=null,jo=0,0!==(6&fo))throw Error(C(331));var n=fo;for(fo|=4,Ol=g.current;null!==Ol;){var i=Ol,l=i.child;if(0!==(16&Ol.flags)){var o=i.deletions;if(null!==o){for(var s=0;s<o.length;s++){var a=o[s];for(Ol=a;null!==Ol;){var r=Ol;switch(r.tag){case 0:case 11:case 15:to(8,r,i)}var c=r.child;if(null!==c)c.return=r,Ol=c;else for(;null!==Ol;){var A=(r=Ol).sibling,d=r.return;if(no(r),r===a){Ol=null;break}if(null!==A){A.return=d,Ol=A;break}Ol=d}}}var u=i.alternate;if(null!==u){var h=u.child;if(null!==h){u.child=null;do{var m=h.sibling;h.sibling=null,h=m}while(null!==h)}}Ol=i}}if(0!==(2064&i.subtreeFlags)&&null!==l)l.return=i,Ol=l;else g:for(;null!==Ol;){if(0!==(2048&(i=Ol).flags))switch(i.tag){case 0:case 11:case 15:to(9,i,i.return)}var Z=i.sibling;if(null!==Z){Z.return=i.return,Ol=Z;break g}Ol=i.return}}var b=g.current;for(Ol=b;null!==Ol;){var G=(l=Ol).child;if(0!==(2064&l.subtreeFlags)&&null!==G)G.return=l,Ol=G;else g:for(l=b;null!==Ol;){if(0!==(2048&(o=Ol).flags))try{switch(o.tag){case 0:case 11:case 15:eo(9,o)}}catch(y){Vs(o,o.return,y)}if(o===l){Ol=null;break g}var p=o.sibling;if(null!==p){p.return=o.return,Ol=p;break g}Ol=o.return}}if(fo=n,Ln(),Ct&&"function"===typeof Ct.onPostCommitFiberRoot)try{Ct.onPostCommitFiberRoot(nt,g)}catch(y){}I=!0}return I}finally{bt=e,Ro.transition=t}}return!1}function Bs(g,t,e){g=EC(g,t=cl(0,t=ol(e,t),1),1),t=gs(),null!==g&&(mt(g,1,t),Is(g,t))}function Vs(g,t,e){if(3===g.tag)Bs(g,g,e);else for(;null!==t;){if(3===t.tag){Bs(t,g,e);break}if(1===t.tag){var I=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof I.componentDidCatch&&(null===Qo||!Qo.has(I))){t=EC(t,g=Al(t,g=ol(e,g),1),1),g=gs(),null!==t&&(mt(t,1,g),Is(t,g));break}}t=t.return}}function Ws(g,t,e){var I=g.pingCache;null!==I&&I.delete(t),t=gs(),g.pingedLanes|=g.suspendedLanes&e,Xo===g&&(vo&e)===e&&(4===Ho||3===Ho&&(130023424&vo)===vo&&500>Og()-xo?cs(g,0):Fo|=e),Is(g,t)}function Ss(g,t){0===t&&(0===(1&g.mode)?t=1:(t=at,0===(130023424&(at<<=1))&&(at=4194304)));var e=gs();null!==(g=HC(g,t))&&(mt(g,t,e),Is(g,e))}function Rs(g){var t=g.memoizedState,e=0;null!==t&&(e=t.retryLane),Ss(g,e)}function fs(g,t){var e=0;switch(g.tag){case 13:var I=g.stateNode,n=g.memoizedState;null!==n&&(e=n.retryLane);break;case 19:I=g.stateNode;break;default:throw Error(C(314))}null!==I&&I.delete(t),Ss(g,e)}function Xs(g,t){return Dg(g,t)}function Js(g,t,e,I){this.tag=g,this.key=e,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=I,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vs(g,t,e,I){return new Js(g,t,e,I)}function ks(g){return!(!(g=g.prototype)||!g.isReactComponent)}function Ys(g,t){var e=g.alternate;return null===e?((e=vs(g.tag,t,g.key,g.mode)).elementType=g.elementType,e.type=g.type,e.stateNode=g.stateNode,e.alternate=g,g.alternate=e):(e.pendingProps=t,e.type=g.type,e.flags=0,e.subtreeFlags=0,e.deletions=null),e.flags=14680064&g.flags,e.childLanes=g.childLanes,e.lanes=g.lanes,e.child=g.child,e.memoizedProps=g.memoizedProps,e.memoizedState=g.memoizedState,e.updateQueue=g.updateQueue,t=g.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},e.sibling=g.sibling,e.index=g.index,e.ref=g.ref,e}function Hs(g,t,e,I,n,i){var l=2;if(I=g,"function"===typeof g)ks(g)&&(l=1);else if("string"===typeof g)l=5;else g:switch(g){case B:return ws(e.children,n,i,t);case V:l=8,n|=8;break;case W:return(g=vs(12,e,t,2|n)).elementType=W,g.lanes=i,g;case X:return(g=vs(13,e,t,n)).elementType=X,g.lanes=i,g;case J:return(g=vs(19,e,t,n)).elementType=J,g.lanes=i,g;case Y:return Ns(e,n,i,t);default:if("object"===typeof g&&null!==g)switch(g.$$typeof){case S:l=10;break g;case R:l=9;break g;case f:l=11;break g;case v:l=14;break g;case k:l=16,I=null;break g}throw Error(C(130,null==g?g:typeof g,""))}return(t=vs(l,e,t,n)).elementType=g,t.type=I,t.lanes=i,t}function ws(g,t,e,I){return(g=vs(7,g,I,t)).lanes=e,g}function Ns(g,t,e,I){return(g=vs(22,g,I,t)).elementType=Y,g.lanes=e,g.stateNode={isHidden:!1},g}function Ks(g,t,e){return(g=vs(6,g,null,t)).lanes=e,g}function Fs(g,t,e){return(t=vs(4,null!==g.children?g.children:[],g.key,t)).lanes=e,t.stateNode={containerInfo:g.containerInfo,pendingChildren:null,implementation:g.implementation},t}function Es(g,t,e,I,n){this.tag=t,this.containerInfo=g,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ht(0),this.expirationTimes=ht(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ht(0),this.identifierPrefix=I,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function zs(g,t,e,I,n,C,i,l,o){return g=new Es(g,t,e,l,o),1===t?(t=1,!0===C&&(t|=8)):t=0,C=vs(3,null,null,t),g.current=C,C.stateNode=g,C.memoizedState={element:I,isDehydrated:e,cache:null,transitions:null,pendingSuspenseBoundaries:null},NC(C),g}function xs(g){if(!g)return Rn;g:{if(Lg(g=g._reactInternals)!==g||1!==g.tag)throw Error(C(170));var t=g;do{switch(t.tag){case 3:t=t.stateNode.context;break g;case 1:if(kn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break g}}t=t.return}while(null!==t);throw Error(C(171))}if(1===g.tag){var e=g.type;if(kn(e))return wn(g,e,t)}return t}function Ls(g,t,e,I,n,C,i,l,o){return(g=zs(e,I,!0,g,0,C,0,l,o)).context=xs(null),e=g.current,(C=FC(I=gs(),n=ts(e))).callback=void 0!==t&&null!==t?t:null,EC(e,C,n),g.current.lanes=n,mt(g,n,I),Is(g,I),g}function Ms(g,t,e,I){var n=t.current,C=gs(),i=ts(n);return e=xs(e),null===t.context?t.context=e:t.pendingContext=e,(t=FC(C,i)).payload={element:g},null!==(I=void 0===I?null:I)&&(t.callback=I),null!==(g=EC(n,t,i))&&(es(g,n,i,C),zC(g,n,i)),i}function Us(g){return(g=g.current).child?(g.child.tag,g.child.stateNode):null}function Ts(g,t){if(null!==(g=g.memoizedState)&&null!==g.dehydrated){var e=g.retryLane;g.retryLane=0!==e&&e<t?e:t}}function Qs(g,t){Ts(g,t),(g=g.alternate)&&Ts(g,t)}Bo=function(g,t,e){if(null!==g)if(g.memoizedProps!==t.pendingProps||Xn.current)Zl=!0;else{if(0===(g.lanes&e)&&0===(128&t.flags))return Zl=!1,function(g,t,e){switch(t.tag){case 3:fl(t),AC();break;case 5:OC(t);break;case 1:kn(t.type)&&Nn(t);break;case 4:jC(t,t.stateNode.containerInfo);break;case 10:var I=t.type._context,n=t.memoizedProps.value;Sn(yC,I._currentValue),I._currentValue=n;break;case 13:if(null!==(I=t.memoizedState))return null!==I.dehydrated?(Sn($C,1&$C.current),t.flags|=128,null):0!==(e&t.child.childLanes)?Nl(g,t,e):(Sn($C,1&$C.current),null!==(g=Ml(g,t,e))?g.sibling:null);Sn($C,1&$C.current);break;case 19:if(I=0!==(e&t.childLanes),0!==(128&g.flags)){if(I)return xl(g,t,e);t.flags|=128}if(null!==(n=t.memoizedState)&&(n.rendering=null,n.tail=null,n.lastEffect=null),Sn($C,$C.current),I)break;return null;case 22:case 23:return t.lanes=0,Bl(g,t,e)}return Ml(g,t,e)}(g,t,e);Zl=0!==(131072&g.flags)}else Zl=!1,nC&&0!==(1048576&t.flags)&&$n(t,Qn,t.index);switch(t.lanes=0,t.tag){case 2:var I=t.type;Ll(g,t),g=t.pendingProps;var n=vn(t,fn.current);XC(t,e),n=ui(null,t,I,g,n,e);var i=hi();return t.flags|=1,"object"===typeof n&&null!==n&&"function"===typeof n.render&&void 0===n.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,kn(I)?(i=!0,Nn(t)):i=!1,t.memoizedState=null!==n.state&&void 0!==n.state?n.state:null,NC(t),n.updater=Il,t.stateNode=n,n._reactInternals=t,ll(t,I,g,e),t=Rl(null,t,I,!0,i,e)):(t.tag=0,nC&&i&&gC(t),bl(null,t,n,e),t=t.child),t;case 16:I=t.elementType;g:{switch(Ll(g,t),g=t.pendingProps,I=(n=I._init)(I._payload),t.type=I,n=t.tag=function(g){if("function"===typeof g)return ks(g)?1:0;if(void 0!==g&&null!==g){if((g=g.$$typeof)===f)return 11;if(g===v)return 14}return 2}(I),g=tl(I,g),n){case 0:t=Wl(null,t,I,g,e);break g;case 1:t=Sl(null,t,I,g,e);break g;case 11:t=Gl(null,t,I,g,e);break g;case 14:t=pl(null,t,I,tl(I.type,g),e);break g}throw Error(C(306,I,""))}return t;case 0:return I=t.type,n=t.pendingProps,Wl(g,t,I,n=t.elementType===I?n:tl(I,n),e);case 1:return I=t.type,n=t.pendingProps,Sl(g,t,I,n=t.elementType===I?n:tl(I,n),e);case 3:g:{if(fl(t),null===g)throw Error(C(387));I=t.pendingProps,n=(i=t.memoizedState).element,KC(g,t),LC(t,I,null,e);var l=t.memoizedState;if(I=l.element,i.isDehydrated){if(i={element:I,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},t.updateQueue.baseState=i,t.memoizedState=i,256&t.flags){t=Xl(g,t,I,e,n=ol(Error(C(423)),t));break g}if(I!==n){t=Xl(g,t,I,e,n=ol(Error(C(424)),t));break g}for(IC=sn(t.stateNode.containerInfo.firstChild),eC=t,nC=!0,CC=null,e=pC(t,null,I,e),t.child=e;e;)e.flags=-3&e.flags|4096,e=e.sibling}else{if(AC(),I===n){t=Ml(g,t,e);break g}bl(g,t,I,e)}t=t.child}return t;case 5:return OC(t),null===g&&sC(t),I=t.type,n=t.pendingProps,i=null!==g?g.memoizedProps:null,l=n.children,tn(I,n)?l=null:null!==i&&tn(I,i)&&(t.flags|=32),Vl(g,t),bl(g,t,l,e),t.child;case 6:return null===g&&sC(t),null;case 13:return Nl(g,t,e);case 4:return jC(t,t.stateNode.containerInfo),I=t.pendingProps,null===g?t.child=GC(t,null,I,e):bl(g,t,I,e),t.child;case 11:return I=t.type,n=t.pendingProps,Gl(g,t,I,n=t.elementType===I?n:tl(I,n),e);case 7:return bl(g,t,t.pendingProps,e),t.child;case 8:case 12:return bl(g,t,t.pendingProps.children,e),t.child;case 10:g:{if(I=t.type._context,n=t.pendingProps,i=t.memoizedProps,l=n.value,Sn(yC,I._currentValue),I._currentValue=l,null!==i)if(iI(i.value,l)){if(i.children===n.children&&!Xn.current){t=Ml(g,t,e);break g}}else for(null!==(i=t.child)&&(i.return=t);null!==i;){var o=i.dependencies;if(null!==o){l=i.child;for(var s=o.firstContext;null!==s;){if(s.context===I){if(1===i.tag){(s=FC(-1,e&-e)).tag=2;var a=i.updateQueue;if(null!==a){var r=(a=a.shared).pending;null===r?s.next=s:(s.next=r.next,r.next=s),a.pending=s}}i.lanes|=e,null!==(s=i.alternate)&&(s.lanes|=e),fC(i.return,e,t),o.lanes|=e;break}s=s.next}}else if(10===i.tag)l=i.type===t.type?null:i.child;else if(18===i.tag){if(null===(l=i.return))throw Error(C(341));l.lanes|=e,null!==(o=l.alternate)&&(o.lanes|=e),fC(l,e,t),l=i.sibling}else l=i.child;if(null!==l)l.return=i;else for(l=i;null!==l;){if(l===t){l=null;break}if(null!==(i=l.sibling)){i.return=l.return,l=i;break}l=l.return}i=l}bl(g,t,n.children,e),t=t.child}return t;case 9:return n=t.type,I=t.pendingProps.children,XC(t,e),I=I(n=JC(n)),t.flags|=1,bl(g,t,I,e),t.child;case 14:return n=tl(I=t.type,t.pendingProps),pl(g,t,I,n=tl(I.type,n),e);case 15:return yl(g,t,t.type,t.pendingProps,e);case 17:return I=t.type,n=t.pendingProps,n=t.elementType===I?n:tl(I,n),Ll(g,t),t.tag=1,kn(I)?(g=!0,Nn(t)):g=!1,XC(t,e),Cl(t,I,n),ll(t,I,n,e),Rl(null,t,I,!0,g,e);case 19:return xl(g,t,e);case 22:return Bl(g,t,e)}throw Error(C(156,t.tag))};var Ds="function"===typeof reportError?reportError:function(g){console.error(g)};function _s(g){this._internalRoot=g}function js(g){this._internalRoot=g}function Ps(g){return!(!g||1!==g.nodeType&&9!==g.nodeType&&11!==g.nodeType)}function Os(g){return!(!g||1!==g.nodeType&&9!==g.nodeType&&11!==g.nodeType&&(8!==g.nodeType||" react-mount-point-unstable "!==g.nodeValue))}function qs(){}function $s(g,t,e,I,n){var C=e._reactRootContainer;if(C){var i=C;if("function"===typeof n){var l=n;n=function(){var g=Us(i);l.call(g)}}Ms(t,i,g,n)}else i=function(g,t,e,I,n){if(n){if("function"===typeof I){var C=I;I=function(){var g=Us(i);C.call(g)}}var i=Ls(t,I,g,0,null,!1,0,"",qs);return g._reactRootContainer=i,g[dn]=i.current,xI(8===g.nodeType?g.parentNode:g),as(),i}for(;n=g.lastChild;)g.removeChild(n);if("function"===typeof I){var l=I;I=function(){var g=Us(o);l.call(g)}}var o=zs(g,0,!1,null,0,!1,0,"",qs);return g._reactRootContainer=o,g[dn]=o.current,xI(8===g.nodeType?g.parentNode:g),as((function(){Ms(t,o,e,I)})),o}(e,t,g,n,I);return Us(i)}js.prototype.render=_s.prototype.render=function(g){var t=this._internalRoot;if(null===t)throw Error(C(409));Ms(g,t,null,null)},js.prototype.unmount=_s.prototype.unmount=function(){var g=this._internalRoot;if(null!==g){this._internalRoot=null;var t=g.containerInfo;as((function(){Ms(null,g,null,null)})),t[dn]=null}},js.prototype.unstable_scheduleHydration=function(g){if(g){var t=Vt();g={blockedOn:null,target:g,priority:t};for(var e=0;e<Yt.length&&0!==t&&t<Yt[e].priority;e++);Yt.splice(e,0,g),0===e&&Kt(g)}},pt=function(g){switch(g.tag){case 3:var t=g.stateNode;if(t.current.memoizedState.isDehydrated){var e=rt(t.pendingLanes);0!==e&&(Zt(t,1|e),Is(t,Og()),0===(6&fo)&&(Lo=Og()+500,Ln()))}break;case 13:as((function(){var t=HC(g,1);if(null!==t){var e=gs();es(t,g,1,e)}})),Qs(g,1)}},yt=function(g){if(13===g.tag){var t=HC(g,134217728);if(null!==t)es(t,g,134217728,gs());Qs(g,134217728)}},Bt=function(g){if(13===g.tag){var t=ts(g),e=HC(g,t);if(null!==e)es(e,g,t,gs());Qs(g,t)}},Vt=function(){return bt},Wt=function(g,t){var e=bt;try{return bt=g,t()}finally{bt=e}},yg=function(g,t,e){switch(t){case"input":if(q(g,e),t=e.name,"radio"===e.type&&null!=t){for(e=g;e.parentNode;)e=e.parentNode;for(e=e.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<e.length;t++){var I=e[t];if(I!==g&&I.form===g.form){var n=pn(I);if(!n)throw Error(C(90));D(I),q(I,n)}}}break;case"textarea":Cg(g,e);break;case"select":null!=(t=e.value)&&eg(g,!!e.multiple,t,!1)}},fg=ss,Xg=as;var ga={usingClientEntryPoint:!1,Events:[bn,Gn,pn,Sg,Rg,ss]},ta={findFiberByHostInstance:Zn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ea={bundleType:ta.bundleType,version:ta.version,rendererPackageName:ta.rendererPackageName,rendererConfig:ta.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:G.ReactCurrentDispatcher,findHostInstanceByFiber:function(g){return null===(g=Tg(g))?null:g.stateNode},findFiberByHostInstance:ta.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Ia=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ia.isDisabled&&Ia.supportsFiber)try{nt=Ia.inject(ea),Ct=Ia}catch(ag){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ga,t.createPortal=function(g,t){var e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Ps(t))throw Error(C(200));return function(g,t,e){var I=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:y,key:null==I?null:""+I,children:g,containerInfo:t,implementation:e}}(g,t,null,e)},t.createRoot=function(g,t){if(!Ps(g))throw Error(C(299));var e=!1,I="",n=Ds;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(e=!0),void 0!==t.identifierPrefix&&(I=t.identifierPrefix),void 0!==t.onRecoverableError&&(n=t.onRecoverableError)),t=zs(g,1,!1,null,0,e,0,I,n),g[dn]=t.current,xI(8===g.nodeType?g.parentNode:g),new _s(t)},t.findDOMNode=function(g){if(null==g)return null;if(1===g.nodeType)return g;var t=g._reactInternals;if(void 0===t){if("function"===typeof g.render)throw Error(C(188));throw g=Object.keys(g).join(","),Error(C(268,g))}return g=null===(g=Tg(t))?null:g.stateNode},t.flushSync=function(g){return as(g)},t.hydrate=function(g,t,e){if(!Os(t))throw Error(C(200));return $s(null,g,t,!0,e)},t.hydrateRoot=function(g,t,e){if(!Ps(g))throw Error(C(405));var I=null!=e&&e.hydratedSources||null,n=!1,i="",l=Ds;if(null!==e&&void 0!==e&&(!0===e.unstable_strictMode&&(n=!0),void 0!==e.identifierPrefix&&(i=e.identifierPrefix),void 0!==e.onRecoverableError&&(l=e.onRecoverableError)),t=Ls(t,null,g,1,null!=e?e:null,n,0,i,l),g[dn]=t.current,xI(g),I)for(g=0;g<I.length;g++)n=(n=(e=I[g])._getVersion)(e._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[e,n]:t.mutableSourceEagerHydrationData.push(e,n);return new js(t)},t.render=function(g,t,e){if(!Os(t))throw Error(C(200));return $s(null,g,t,!1,e)},t.unmountComponentAtNode=function(g){if(!Os(g))throw Error(C(40));return!!g._reactRootContainer&&(as((function(){$s(null,null,g,!1,(function(){g._reactRootContainer=null,g[dn]=null}))})),!0)},t.unstable_batchedUpdates=ss,t.unstable_renderSubtreeIntoContainer=function(g,t,e,I){if(!Os(e))throw Error(C(200));if(null==g||void 0===g._reactInternals)throw Error(C(38));return $s(g,t,e,!1,I)},t.version="18.3.1-next-f1338f8080-20240426"},391:(g,t,e)=>{"use strict";var I=e(950);t.createRoot=I.createRoot,t.hydrateRoot=I.hydrateRoot},950:(g,t,e)=>{"use strict";!function g(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(g)}catch(t){console.error(t)}}(),g.exports=e(730)},309:function(g,t,e){g.exports=function(g){"use strict";function t(g){if(g&&g.__esModule)return g;var t=Object.create(null);return g&&Object.keys(g).forEach((function(e){if("default"!==e){var I=Object.getOwnPropertyDescriptor(g,e);Object.defineProperty(t,e,I.get?I:{enumerable:!0,get:function(){return g[e]}})}})),t.default=g,Object.freeze(t)}var e=t(g);function I(){return I=Object.assign?Object.assign.bind():function(g){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var I in e)Object.prototype.hasOwnProperty.call(e,I)&&(g[I]=e[I])}return g},I.apply(this,arguments)}function n(g,t,e){return t in g?Object.defineProperty(g,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):g[t]=e,g}function C(g){if(Array.isArray(g))return g}function i(g,t){var e=null==g?null:"undefined"!==typeof Symbol&&g[Symbol.iterator]||g["@@iterator"];if(null!=e){var I,n,C=[],i=!0,l=!1;try{for(e=e.call(g);!(i=(I=e.next()).done)&&(C.push(I.value),!t||C.length!==t);i=!0);}catch(o){l=!0,n=o}finally{try{i||null==e.return||e.return()}finally{if(l)throw n}}return C}}function l(g,t){(null==t||t>g.length)&&(t=g.length);for(var e=0,I=new Array(t);e<t;e++)I[e]=g[e];return I}function o(g,t){if(g){if("string"===typeof g)return l(g,t);var e=Object.prototype.toString.call(g).slice(8,-1);return"Object"===e&&g.constructor&&(e=g.constructor.name),"Map"===e||"Set"===e?Array.from(g):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?l(g,t):void 0}}function s(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(g,t){return C(g)||i(g,t)||o(g,t)||s()}function r(g,t){if(null==g)return{};var e,I,n={},C=Object.keys(g);for(I=0;I<C.length;I++)e=C[I],t.indexOf(e)>=0||(n[e]=g[e]);return n}function c(g,t){if(null==g)return{};var e,I,n=r(g,t);if(Object.getOwnPropertySymbols){var C=Object.getOwnPropertySymbols(g);for(I=0;I<C.length;I++)e=C[I],t.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(g,e)&&(n[e]=g[e])}return n}var A={exports:{}},d={exports:{}},u={},h="function"===typeof Symbol&&Symbol.for,m=h?Symbol.for("react.element"):60103,Z=h?Symbol.for("react.portal"):60106,b=h?Symbol.for("react.fragment"):60107,G=h?Symbol.for("react.strict_mode"):60108,p=h?Symbol.for("react.profiler"):60114,y=h?Symbol.for("react.provider"):60109,B=h?Symbol.for("react.context"):60110,V=h?Symbol.for("react.async_mode"):60111,W=h?Symbol.for("react.concurrent_mode"):60111,S=h?Symbol.for("react.forward_ref"):60112,R=h?Symbol.for("react.suspense"):60113,f=h?Symbol.for("react.suspense_list"):60120,X=h?Symbol.for("react.memo"):60115,J=h?Symbol.for("react.lazy"):60116,v=h?Symbol.for("react.block"):60121,k=h?Symbol.for("react.fundamental"):60117,Y=h?Symbol.for("react.responder"):60118,H=h?Symbol.for("react.scope"):60119;function w(g){if("object"===typeof g&&null!==g){var t=g.$$typeof;switch(t){case m:switch(g=g.type){case V:case W:case b:case p:case G:case R:return g;default:switch(g=g&&g.$$typeof){case B:case S:case J:case X:case y:return g;default:return t}}case Z:return t}}}function N(g){return w(g)===W}u.AsyncMode=V,u.ConcurrentMode=W,u.ContextConsumer=B,u.ContextProvider=y,u.Element=m,u.ForwardRef=S,u.Fragment=b,u.Lazy=J,u.Memo=X,u.Portal=Z,u.Profiler=p,u.StrictMode=G,u.Suspense=R,u.isAsyncMode=function(g){return N(g)||w(g)===V},u.isConcurrentMode=N,u.isContextConsumer=function(g){return w(g)===B},u.isContextProvider=function(g){return w(g)===y},u.isElement=function(g){return"object"===typeof g&&null!==g&&g.$$typeof===m},u.isForwardRef=function(g){return w(g)===S},u.isFragment=function(g){return w(g)===b},u.isLazy=function(g){return w(g)===J},u.isMemo=function(g){return w(g)===X},u.isPortal=function(g){return w(g)===Z},u.isProfiler=function(g){return w(g)===p},u.isStrictMode=function(g){return w(g)===G},u.isSuspense=function(g){return w(g)===R},u.isValidElementType=function(g){return"string"===typeof g||"function"===typeof g||g===b||g===W||g===p||g===G||g===R||g===f||"object"===typeof g&&null!==g&&(g.$$typeof===J||g.$$typeof===X||g.$$typeof===y||g.$$typeof===B||g.$$typeof===S||g.$$typeof===k||g.$$typeof===Y||g.$$typeof===H||g.$$typeof===v)},u.typeOf=w,d.exports=u;Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;function K(){try{if(!Object.assign)return!1;var g=new String("abc");if(g[5]="de","5"===Object.getOwnPropertyNames(g)[0])return!1;for(var t={},e=0;e<10;e++)t["_"+String.fromCharCode(e)]=e;var I=Object.getOwnPropertyNames(t).map((function(g){return t[g]}));if("0123456789"!==I.join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(g){n[g]=g})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(C){return!1}}K()&&Object.assign;var F="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";function E(g,t,e,I,n){}Function.call.bind(Object.prototype.hasOwnProperty),E.resetWarningCache=function(){},d.exports;var z=F;function x(){}function L(){}L.resetWarningCache=x;var M=function(){function g(g,t,e,I,n,C){if(C!==z){var i=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw i.name="Invariant Violation",i}}function t(){return g}g.isRequired=g;var e={array:g,bigint:g,bool:g,func:g,number:g,object:g,string:g,symbol:g,any:g,arrayOf:t,element:g,elementType:g,instanceOf:t,node:g,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:L,resetWarningCache:x};return e.PropTypes=e,e};A.exports=M();var U=A.exports;function T(g,t){var e=atob(g);if(t){for(var I=new Uint8Array(e.length),n=0,C=e.length;n<C;++n)I[n]=e.charCodeAt(n);return String.fromCharCode.apply(null,new Uint16Array(I.buffer))}return e}function Q(g,t,e){var I=void 0===t?null:t,n=T(g,void 0!==e&&e),C=n.indexOf("\n",10)+1,i=n.substring(C)+(I?"//# sourceMappingURL="+I:""),l=new Blob([i],{type:"application/javascript"});return URL.createObjectURL(l)}function D(g,t,e){var I;return function(n){return I=I||Q(g,t,e),new Worker(I,n)}}var _=D("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewoJJ3VzZSBzdHJpY3QnOwoKCXZhciBjb21tb25qc0dsb2JhbCA9IHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbFRoaXMgOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHt9OwoKCWZ1bmN0aW9uIGdldEF1Z21lbnRlZE5hbWVzcGFjZShuKSB7CgkJaWYgKG4uX19lc01vZHVsZSkgcmV0dXJuIG47CgkJdmFyIGEgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sICdfX2VzTW9kdWxlJywge3ZhbHVlOiB0cnVlfSk7CgkJT2JqZWN0LmtleXMobikuZm9yRWFjaChmdW5jdGlvbiAoaykgewoJCQl2YXIgZCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iobiwgayk7CgkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShhLCBrLCBkLmdldCA/IGQgOiB7CgkJCQllbnVtZXJhYmxlOiB0cnVlLAoJCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgkJCQkJcmV0dXJuIG5ba107CgkJCQl9CgkJCX0pOwoJCX0pOwoJCXJldHVybiBhOwoJfQoKCXZhciBCaW5hcnlCaXRtYXAkMSA9IHt9OwoKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBFeGNlcHRpb24kMSA9IHt9OwoKCWZ1bmN0aW9uIGZpeFByb3RvKHRhcmdldCwgcHJvdG90eXBlKSB7CgkgIHZhciBzZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZjsKCSAgc2V0UHJvdG90eXBlT2YgPyBzZXRQcm90b3R5cGVPZih0YXJnZXQsIHByb3RvdHlwZSkgOiB0YXJnZXQuX19wcm90b19fID0gcHJvdG90eXBlOwoJfQoJZnVuY3Rpb24gZml4U3RhY2sodGFyZ2V0LCBmbikgewoJICBpZiAoZm4gPT09IHZvaWQgMCkgewoJICAgIGZuID0gdGFyZ2V0LmNvbnN0cnVjdG9yOwoJICB9CgoJICB2YXIgY2FwdHVyZVN0YWNrVHJhY2UgPSBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZTsKCSAgY2FwdHVyZVN0YWNrVHJhY2UgJiYgY2FwdHVyZVN0YWNrVHJhY2UodGFyZ2V0LCBmbik7Cgl9CgoJdmFyIF9fZXh0ZW5kcyRrID0gZnVuY3Rpb24gKCkgewoJICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCB7CgkgICAgICBfX3Byb3RvX186IFtdCgkgICAgfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICBkLl9fcHJvdG9fXyA9IGI7CgkgICAgfSB8fCBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgZm9yICh2YXIgcCBpbiBiKSB7IGlmIChiLmhhc093blByb3BlcnR5KHApKSB7IGRbcF0gPSBiW3BdOyB9IH0KCSAgICB9OwoKCSAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgfTsKCgkgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgoJICAgIGZ1bmN0aW9uIF9fKCkgewoJICAgICAgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7CgkgICAgfQoKCSAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgIH07Cgl9KCk7CgoJdmFyIEN1c3RvbUVycm9yID0gZnVuY3Rpb24gKF9zdXBlcikgewoJICBfX2V4dGVuZHMkayhDdXN0b21FcnJvciwgX3N1cGVyKTsKCgkgIGZ1bmN0aW9uIEN1c3RvbUVycm9yKG1lc3NhZ2UpIHsKCSAgICB2YXIgX25ld1RhcmdldCA9IHRoaXMuY29uc3RydWN0b3I7CgoJICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIG1lc3NhZ2UpIHx8IHRoaXM7CgoJICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShfdGhpcywgJ25hbWUnLCB7CgkgICAgICB2YWx1ZTogX25ld1RhcmdldC5uYW1lLAoJICAgICAgZW51bWVyYWJsZTogZmFsc2UsCgkgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICB9KTsKCSAgICBmaXhQcm90byhfdGhpcywgX25ld1RhcmdldC5wcm90b3R5cGUpOwoJICAgIGZpeFN0YWNrKF90aGlzKTsKCSAgICByZXR1cm4gX3RoaXM7CgkgIH0KCgkgIHJldHVybiBDdXN0b21FcnJvcjsKCX0oRXJyb3IpOwoKCXZhciBfX3NwcmVhZEFycmF5cyA9IGZ1bmN0aW9uICgpIHsKCSAgdmFyIGFyZ3VtZW50cyQxID0gYXJndW1lbnRzOwoKCSAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7IHMgKz0gYXJndW1lbnRzJDFbaV0ubGVuZ3RoOyB9CgoJICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspIHsgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspIHsgcltrXSA9IGFbal07IH0gfQoKCSAgcmV0dXJuIHI7Cgl9OwoJZnVuY3Rpb24gY3VzdG9tRXJyb3JGYWN0b3J5KGZuLCBwYXJlbnQpIHsKCSAgaWYgKHBhcmVudCA9PT0gdm9pZCAwKSB7CgkgICAgcGFyZW50ID0gRXJyb3I7CgkgIH0KCgkgIGZ1bmN0aW9uIEN1c3RvbUVycm9yKCkgewoJICAgIHZhciBhcmd1bWVudHMkMSA9IGFyZ3VtZW50czsKCgkgICAgdmFyIGFyZ3MgPSBbXTsKCgkgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzJDFbX2ldOwoJICAgIH0KCgkgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIEN1c3RvbUVycm9yKSkgeyByZXR1cm4gbmV3IChDdXN0b21FcnJvci5iaW5kLmFwcGx5KEN1c3RvbUVycm9yLCBfX3NwcmVhZEFycmF5cyhbdm9pZCAwXSwgYXJncykpKSgpOyB9CgkgICAgcGFyZW50LmFwcGx5KHRoaXMsIGFyZ3MpOwoJICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnbmFtZScsIHsKCSAgICAgIHZhbHVlOiBmbi5uYW1lIHx8IHBhcmVudC5uYW1lLAoJICAgICAgZW51bWVyYWJsZTogZmFsc2UsCgkgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICB9KTsKCSAgICBmbi5hcHBseSh0aGlzLCBhcmdzKTsKCSAgICBmaXhTdGFjayh0aGlzLCBDdXN0b21FcnJvcik7CgkgIH0KCgkgIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhDdXN0b21FcnJvciwgewoJICAgIHByb3RvdHlwZTogewoJICAgICAgdmFsdWU6IE9iamVjdC5jcmVhdGUocGFyZW50LnByb3RvdHlwZSwgewoJICAgICAgICBjb25zdHJ1Y3RvcjogewoJICAgICAgICAgIHZhbHVlOiBDdXN0b21FcnJvciwKCSAgICAgICAgICB3cml0YWJsZTogdHJ1ZSwKCSAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICAgICAgfQoJICAgICAgfSkKCSAgICB9CgkgIH0pOwoJfQoKCXZhciBjdXN0b21FcnJvciA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKCQlfX3Byb3RvX186IG51bGwsCgkJQ3VzdG9tRXJyb3I6IEN1c3RvbUVycm9yLAoJCWN1c3RvbUVycm9yRmFjdG9yeTogY3VzdG9tRXJyb3JGYWN0b3J5Cgl9KTsKCgl2YXIgcmVxdWlyZSQkMCA9IC8qQF9fUFVSRV9fKi9nZXRBdWdtZW50ZWROYW1lc3BhY2UoY3VzdG9tRXJyb3IpOwoKCXZhciBfX2V4dGVuZHMkaiA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIHRzX2N1c3RvbV9lcnJvcl8xID0gcmVxdWlyZSQkMDsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyRqKEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICAvKioKCSAgICAgKiBBbGxvd3MgRXhjZXB0aW9uIHRvIGJlIGNvbnN0cnVjdGVkIGRpcmVjdGx5CgkgICAgICogd2l0aCBzb21lIG1lc3NhZ2UgYW5kIHByb3RvdHlwZSBkZWZpbml0aW9uLgoJICAgICAqLwoJICAgIGZ1bmN0aW9uIEV4Y2VwdGlvbihtZXNzYWdlKSB7CgkgICAgICAgIGlmIChtZXNzYWdlID09PSB2b2lkIDApIHsgbWVzc2FnZSA9IHVuZGVmaW5lZDsgfQoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBtZXNzYWdlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBFeGNlcHRpb24ucHJvdG90eXBlLmdldEtpbmQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBleCA9IHRoaXMuY29uc3RydWN0b3I7CgkgICAgICAgIHJldHVybiBleC5raW5kOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogSXQncyB0eXBlZCBhcyBzdHJpbmcgc28gaXQgY2FuIGJlIGV4dGVuZGVkIGFuZCBvdmVycmlkZW4uCgkgICAgICovCgkgICAgRXhjZXB0aW9uLmtpbmQgPSAnRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gRXhjZXB0aW9uOwoJfSh0c19jdXN0b21fZXJyb3JfMS5DdXN0b21FcnJvcikpOwoJRXhjZXB0aW9uJDEuZGVmYXVsdCA9IEV4Y2VwdGlvbjsKCgl2YXIgX19leHRlbmRzJGkgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBFeGNlcHRpb25fMSQ5ID0gRXhjZXB0aW9uJDE7CgkvKioKCSAqIEN1c3RvbSBFcnJvciBjbGFzcyBvZiB0eXBlIEV4Y2VwdGlvbi4KCSAqLwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkaShJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCkgewoJICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7CgkgICAgfQoJICAgIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5raW5kID0gJ0lsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbic7CgkgICAgcmV0dXJuIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbjsKCX0oRXhjZXB0aW9uXzEkOS5kZWZhdWx0KSk7CglJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMS5kZWZhdWx0ID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmluYXJ5Qml0bWFwJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSRhID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7Cgl2YXIgQmluYXJ5Qml0bWFwID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEJpbmFyeUJpdG1hcChiaW5hcml6ZXIpIHsKCSAgICAgICAgdGhpcy5iaW5hcml6ZXIgPSBiaW5hcml6ZXI7CgkgICAgICAgIGlmIChiaW5hcml6ZXIgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSRhLmRlZmF1bHQoJ0JpbmFyaXplciBtdXN0IGJlIG5vbi1udWxsLicpOwoJICAgICAgICB9CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gVGhlIHdpZHRoIG9mIHRoZSBiaXRtYXAuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldFdpZHRoKCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSBoZWlnaHQgb2YgdGhlIGJpdG1hcC4KCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmdldEhlaWdodCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldEhlaWdodCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29udmVydHMgb25lIHJvdyBvZiBsdW1pbmFuY2UgZGF0YSB0byAxIGJpdCBkYXRhLiBNYXkgYWN0dWFsbHkgZG8gdGhlIGNvbnZlcnNpb24sIG9yIHJldHVybgoJICAgICAqIGNhY2hlZCBkYXRhLiBDYWxsZXJzIHNob3VsZCBhc3N1bWUgdGhpcyBtZXRob2QgaXMgZXhwZW5zaXZlIGFuZCBjYWxsIGl0IGFzIHNlbGRvbSBhcyBwb3NzaWJsZS4KCSAgICAgKiBUaGlzIG1ldGhvZCBpcyBpbnRlbmRlZCBmb3IgZGVjb2RpbmcgMUQgYmFyY29kZXMgYW5kIG1heSBjaG9vc2UgdG8gYXBwbHkgc2hhcnBlbmluZy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB5IFRoZSByb3cgdG8gZmV0Y2gsIHdoaWNoIG11c3QgYmUgaW4gWzAsIGJpdG1hcCBoZWlnaHQpCgkgICAgICogQHBhcmFtIHJvdyBBbiBvcHRpb25hbCBwcmVhbGxvY2F0ZWQgYXJyYXkuIElmIG51bGwgb3IgdG9vIHNtYWxsLCBpdCB3aWxsIGJlIGlnbm9yZWQuCgkgICAgICogICAgICAgICAgICBJZiB1c2VkLCB0aGUgQmluYXJpemVyIHdpbGwgY2FsbCBCaXRBcnJheS5jbGVhcigpLiBBbHdheXMgdXNlIHRoZSByZXR1cm5lZCBvYmplY3QuCgkgICAgICogQHJldHVybiBUaGUgYXJyYXkgb2YgYml0cyBmb3IgdGhpcyByb3cgKHRydWUgbWVhbnMgYmxhY2spLgoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgcm93IGNhbid0IGJlIGJpbmFyaXplZAoJICAgICAqLwoJICAgIEJpbmFyeUJpdG1hcC5wcm90b3R5cGUuZ2V0QmxhY2tSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldEJsYWNrUm93KHksIHJvdyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDb252ZXJ0cyBhIDJEIGFycmF5IG9mIGx1bWluYW5jZSBkYXRhIHRvIDEgYml0LiBBcyBhYm92ZSwgYXNzdW1lIHRoaXMgbWV0aG9kIGlzIGV4cGVuc2l2ZQoJICAgICAqIGFuZCBkbyBub3QgY2FsbCBpdCByZXBlYXRlZGx5LiBUaGlzIG1ldGhvZCBpcyBpbnRlbmRlZCBmb3IgZGVjb2RpbmcgMkQgYmFyY29kZXMgYW5kIG1heSBvcgoJICAgICAqIG1heSBub3QgYXBwbHkgc2hhcnBlbmluZy4gVGhlcmVmb3JlLCBhIHJvdyBmcm9tIHRoaXMgbWF0cml4IG1heSBub3QgYmUgaWRlbnRpY2FsIHRvIG9uZQoJICAgICAqIGZldGNoZWQgdXNpbmcgZ2V0QmxhY2tSb3coKSwgc28gZG9uJ3QgbWl4IGFuZCBtYXRjaCBiZXR3ZWVuIHRoZW0uCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIFRoZSAyRCBhcnJheSBvZiBiaXRzIGZvciB0aGUgaW1hZ2UgKHRydWUgbWVhbnMgYmxhY2spLgoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgaW1hZ2UgY2FuJ3QgYmUgYmluYXJpemVkIHRvIG1ha2UgYSBtYXRyaXgKCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmdldEJsYWNrTWF0cml4ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBUaGUgbWF0cml4IGlzIGNyZWF0ZWQgb24gZGVtYW5kIHRoZSBmaXJzdCB0aW1lIGl0IGlzIHJlcXVlc3RlZCwgdGhlbiBjYWNoZWQuIFRoZXJlIGFyZSB0d28KCSAgICAgICAgLy8gcmVhc29ucyBmb3IgdGhpczoKCSAgICAgICAgLy8gMS4gVGhpcyB3b3JrIHdpbGwgbmV2ZXIgYmUgZG9uZSBpZiB0aGUgY2FsbGVyIG9ubHkgaW5zdGFsbHMgMUQgUmVhZGVyIG9iamVjdHMsIG9yIGlmIGEKCSAgICAgICAgLy8gICAgMUQgUmVhZGVyIGZpbmRzIGEgYmFyY29kZSBiZWZvcmUgdGhlIDJEIFJlYWRlcnMgcnVuLgoJICAgICAgICAvLyAyLiBUaGlzIHdvcmsgd2lsbCBvbmx5IGJlIGRvbmUgb25jZSBldmVuIGlmIHRoZSBjYWxsZXIgaW5zdGFsbHMgbXVsdGlwbGUgMkQgUmVhZGVycy4KCSAgICAgICAgaWYgKHRoaXMubWF0cml4ID09PSBudWxsIHx8IHRoaXMubWF0cml4ID09PSB1bmRlZmluZWQpIHsKCSAgICAgICAgICAgIHRoaXMubWF0cml4ID0gdGhpcy5iaW5hcml6ZXIuZ2V0QmxhY2tNYXRyaXgoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5tYXRyaXg7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFdoZXRoZXIgdGhpcyBiaXRtYXAgY2FuIGJlIGNyb3BwZWQuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5pc0Nyb3BTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmJpbmFyaXplci5nZXRMdW1pbmFuY2VTb3VyY2UoKS5pc0Nyb3BTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggY3JvcHBlZCBpbWFnZSBkYXRhLiBJbXBsZW1lbnRhdGlvbnMgbWF5IGtlZXAgYSByZWZlcmVuY2UgdG8gdGhlCgkgICAgICogb3JpZ2luYWwgZGF0YSByYXRoZXIgdGhhbiBhIGNvcHkuIE9ubHkgY2FsbGFibGUgaWYgaXNDcm9wU3VwcG9ydGVkKCkgaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBsZWZ0IFRoZSBsZWZ0IGNvb3JkaW5hdGUsIHdoaWNoIG11c3QgYmUgaW4gWzAsZ2V0V2lkdGgoKSkKCSAgICAgKiBAcGFyYW0gdG9wIFRoZSB0b3AgY29vcmRpbmF0ZSwgd2hpY2ggbXVzdCBiZSBpbiBbMCxnZXRIZWlnaHQoKSkKCSAgICAgKiBAcGFyYW0gd2lkdGggVGhlIHdpZHRoIG9mIHRoZSByZWN0YW5nbGUgdG8gY3JvcC4KCSAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIHJlY3RhbmdsZSB0byBjcm9wLgoJICAgICAqIEByZXR1cm4gQSBjcm9wcGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5jcm9wID0gZnVuY3Rpb24gKGxlZnQgLyppbnQqLywgdG9wIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHZhciBuZXdTb3VyY2UgPSB0aGlzLmJpbmFyaXplci5nZXRMdW1pbmFuY2VTb3VyY2UoKS5jcm9wKGxlZnQsIHRvcCwgd2lkdGgsIGhlaWdodCk7CgkgICAgICAgIHJldHVybiBuZXcgQmluYXJ5Qml0bWFwKHRoaXMuYmluYXJpemVyLmNyZWF0ZUJpbmFyaXplcihuZXdTb3VyY2UpKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIGJpdG1hcCBzdXBwb3J0cyBjb3VudGVyLWNsb2Nrd2lzZSByb3RhdGlvbi4KCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmlzUm90YXRlU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkuaXNSb3RhdGVTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggcm90YXRlZCBpbWFnZSBkYXRhIGJ5IDkwIGRlZ3JlZXMgY291bnRlcmNsb2Nrd2lzZS4KCSAgICAgKiBPbmx5IGNhbGxhYmxlIGlmIHtAbGluayAjaXNSb3RhdGVTdXBwb3J0ZWQoKX0gaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gQSByb3RhdGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3U291cmNlID0gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkucm90YXRlQ291bnRlckNsb2Nrd2lzZSgpOwoJICAgICAgICByZXR1cm4gbmV3IEJpbmFyeUJpdG1hcCh0aGlzLmJpbmFyaXplci5jcmVhdGVCaW5hcml6ZXIobmV3U291cmNlKSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIGEgbmV3IG9iamVjdCB3aXRoIHJvdGF0ZWQgaW1hZ2UgZGF0YSBieSA0NSBkZWdyZWVzIGNvdW50ZXJjbG9ja3dpc2UuCgkgICAgICogT25seSBjYWxsYWJsZSBpZiB7QGxpbmsgI2lzUm90YXRlU3VwcG9ydGVkKCl9IGlzIHRydWUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIEEgcm90YXRlZCB2ZXJzaW9uIG9mIHRoaXMgb2JqZWN0LgoJICAgICAqLwoJICAgIEJpbmFyeUJpdG1hcC5wcm90b3R5cGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3U291cmNlID0gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1KCk7CgkgICAgICAgIHJldHVybiBuZXcgQmluYXJ5Qml0bWFwKHRoaXMuYmluYXJpemVyLmNyZWF0ZUJpbmFyaXplcihuZXdTb3VyY2UpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QmxhY2tNYXRyaXgoKS50b1N0cmluZygpOwoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlIC8qOiBOb3RGb3VuZEV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICByZXR1cm4gJyc7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHJldHVybiBCaW5hcnlCaXRtYXA7Cgl9KCkpOwoJdmFyIF9kZWZhdWx0JDMgPSBCaW5hcnlCaXRtYXAkMS5kZWZhdWx0ID0gQmluYXJ5Qml0bWFwOwoKCXZhciBIeWJyaWRCaW5hcml6ZXIkMSA9IHt9OwoKCXZhciBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMSA9IHt9OwoKCXZhciBCaW5hcml6ZXIkMSA9IHt9OwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmluYXJpemVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogVGhpcyBjbGFzcyBoaWVyYXJjaHkgcHJvdmlkZXMgYSBzZXQgb2YgbWV0aG9kcyB0byBjb252ZXJ0IGx1bWluYW5jZSBkYXRhIHRvIDEgYml0IGRhdGEuCgkgKiBJdCBhbGxvd3MgdGhlIGFsZ29yaXRobSB0byB2YXJ5IHBvbHltb3JwaGljYWxseSwgZm9yIGV4YW1wbGUgYWxsb3dpbmcgYSB2ZXJ5IGV4cGVuc2l2ZQoJICogdGhyZXNob2xkaW5nIHRlY2huaXF1ZSBmb3Igc2VydmVycyBhbmQgYSBmYXN0IG9uZSBmb3IgbW9iaWxlLiBJdCBhbHNvIHBlcm1pdHMgdGhlIGltcGxlbWVudGF0aW9uCgkgKiB0byB2YXJ5LCBlLmcuIGEgSk5JIHZlcnNpb24gZm9yIEFuZHJvaWQgYW5kIGEgSmF2YSBmYWxsYmFjayB2ZXJzaW9uIGZvciBvdGhlciBwbGF0Zm9ybXMuCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqLwoJdmFyIEJpbmFyaXplciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBCaW5hcml6ZXIoc291cmNlKSB7CgkgICAgICAgIHRoaXMuc291cmNlID0gc291cmNlOwoJICAgIH0KCSAgICBCaW5hcml6ZXIucHJvdG90eXBlLmdldEx1bWluYW5jZVNvdXJjZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlOwoJICAgIH07CgkgICAgQmluYXJpemVyLnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlLmdldFdpZHRoKCk7CgkgICAgfTsKCSAgICBCaW5hcml6ZXIucHJvdG90eXBlLmdldEhlaWdodCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlLmdldEhlaWdodCgpOwoJICAgIH07CgkgICAgcmV0dXJuIEJpbmFyaXplcjsKCX0oKSk7CglCaW5hcml6ZXIkMS5kZWZhdWx0ID0gQmluYXJpemVyOwoKCXZhciBCaXRBcnJheSQxID0ge307CgoJdmFyIEFycmF5cyQxID0ge307CgoJdmFyIFN5c3RlbSQxID0ge307CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN5c3RlbSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3lzdGVtID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIFN5c3RlbSgpIHsKCSAgICB9CgkgICAgLy8gcHVibGljIHN0YXRpYyB2b2lkIGFycmF5Y29weShPYmplY3Qgc3JjLCBpbnQgc3JjUG9zLCBPYmplY3QgZGVzdCwgaW50IGRlc3RQb3MsIGludCBsZW5ndGgpCgkgICAgLyoqCgkgICAgICogTWFrZXMgYSBjb3B5IG9mIGEgYXJyYXkuCgkgICAgICovCgkgICAgU3lzdGVtLmFycmF5Y29weSA9IGZ1bmN0aW9uIChzcmMsIHNyY1BvcywgZGVzdCwgZGVzdFBvcywgbGVuZ3RoKSB7CgkgICAgICAgIC8vIFRPRE86IGJldHRlciB1c2Ugc3BsaXQgb3Igc2V0PwoJICAgICAgICB3aGlsZSAobGVuZ3RoLS0pIHsKCSAgICAgICAgICAgIGRlc3RbZGVzdFBvcysrXSA9IHNyY1tzcmNQb3MrK107CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIGN1cnJlbnQgdGltZSBpbiBtaWxsaXNlY29uZHMuCgkgICAgICovCgkgICAgU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gRGF0ZS5ub3coKTsKCSAgICB9OwoJICAgIHJldHVybiBTeXN0ZW07Cgl9KCkpOwoJU3lzdGVtJDEuZGVmYXVsdCA9IFN5c3RlbTsKCgl2YXIgQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiQxID0ge307CgoJdmFyIF9fZXh0ZW5kcyRoID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDggPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkaChJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbi5raW5kID0gJ0luZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24nOwoJICAgIHJldHVybiBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQ4LmRlZmF1bHQpKTsKCUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMS5kZWZhdWx0ID0gSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbjsKCgl2YXIgX19leHRlbmRzJGcgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uXzEgPSBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDE7CgkvKioKCSAqIEN1c3RvbSBFcnJvciBjbGFzcyBvZiB0eXBlIEV4Y2VwdGlvbi4KCSAqLwoJdmFyIEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZyhBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uKGluZGV4LCBtZXNzYWdlKSB7CgkgICAgICAgIGlmIChpbmRleCA9PT0gdm9pZCAwKSB7IGluZGV4ID0gdW5kZWZpbmVkOyB9CgkgICAgICAgIGlmIChtZXNzYWdlID09PSB2b2lkIDApIHsgbWVzc2FnZSA9IHVuZGVmaW5lZDsgfQoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBtZXNzYWdlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5pbmRleCA9IGluZGV4OwoJICAgICAgICBfdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24ua2luZCA9ICdBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24nOwoJICAgIHJldHVybiBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb247Cgl9KEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMS5kZWZhdWx0KSk7CglBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMS5kZWZhdWx0ID0gQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uOwoKCXZhciBfX3ZhbHVlcyQ3ID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFycmF5cyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3lzdGVtXzEkNSA9IFN5c3RlbSQxOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDkgPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMSA9IEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiQxOwoJdmFyIEFycmF5cyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBBcnJheXMoKSB7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEFzc2lnbnMgdGhlIHNwZWNpZmllZCBpbnQgdmFsdWUgdG8gZWFjaCBlbGVtZW50IG9mIHRoZSBzcGVjaWZpZWQgYXJyYXkKCSAgICAgKiBvZiBpbnRzLgoJICAgICAqCgkgICAgICogQHBhcmFtIGEgdGhlIGFycmF5IHRvIGJlIGZpbGxlZAoJICAgICAqIEBwYXJhbSB2YWwgdGhlIHZhbHVlIHRvIGJlIHN0b3JlZCBpbiBhbGwgZWxlbWVudHMgb2YgdGhlIGFycmF5CgkgICAgICovCgkgICAgQXJyYXlzLmZpbGwgPSBmdW5jdGlvbiAoYSwgdmFsKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBhLmxlbmd0aDsgaSA8IGxlbjsgaSsrKQoJICAgICAgICAgICAgYVtpXSA9IHZhbDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEFzc2lnbnMgdGhlIHNwZWNpZmllZCBpbnQgdmFsdWUgdG8gZWFjaCBlbGVtZW50IG9mIHRoZSBzcGVjaWZpZWQKCSAgICAgKiByYW5nZSBvZiB0aGUgc3BlY2lmaWVkIGFycmF5IG9mIGludHMuICBUaGUgcmFuZ2UgdG8gYmUgZmlsbGVkCgkgICAgICogZXh0ZW5kcyBmcm9tIGluZGV4IHtAY29kZSBmcm9tSW5kZXh9LCBpbmNsdXNpdmUsIHRvIGluZGV4CgkgICAgICoge0Bjb2RlIHRvSW5kZXh9LCBleGNsdXNpdmUuICAoSWYge0Bjb2RlIGZyb21JbmRleD09dG9JbmRleH0sIHRoZQoJICAgICAqIHJhbmdlIHRvIGJlIGZpbGxlZCBpcyBlbXB0eS4pCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYSB0aGUgYXJyYXkgdG8gYmUgZmlsbGVkCgkgICAgICogQHBhcmFtIGZyb21JbmRleCB0aGUgaW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgKGluY2x1c2l2ZSkgdG8gYmUKCSAgICAgKiAgICAgICAgZmlsbGVkIHdpdGggdGhlIHNwZWNpZmllZCB2YWx1ZQoJICAgICAqIEBwYXJhbSB0b0luZGV4IHRoZSBpbmRleCBvZiB0aGUgbGFzdCBlbGVtZW50IChleGNsdXNpdmUpIHRvIGJlCgkgICAgICogICAgICAgIGZpbGxlZCB3aXRoIHRoZSBzcGVjaWZpZWQgdmFsdWUKCSAgICAgKiBAcGFyYW0gdmFsIHRoZSB2YWx1ZSB0byBiZSBzdG9yZWQgaW4gYWxsIGVsZW1lbnRzIG9mIHRoZSBhcnJheQoJICAgICAqIEB0aHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlmIHtAY29kZSBmcm9tSW5kZXggPiB0b0luZGV4fQoJICAgICAqIEB0aHJvd3MgQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uIGlmIHtAY29kZSBmcm9tSW5kZXggPCAwfSBvcgoJICAgICAqICAgICAgICAge0Bjb2RlIHRvSW5kZXggPiBhLmxlbmd0aH0KCSAgICAgKi8KCSAgICBBcnJheXMuZmlsbFdpdGhpbiA9IGZ1bmN0aW9uIChhLCBmcm9tSW5kZXgsIHRvSW5kZXgsIHZhbCkgewoJICAgICAgICBBcnJheXMucmFuZ2VDaGVjayhhLmxlbmd0aCwgZnJvbUluZGV4LCB0b0luZGV4KTsKCSAgICAgICAgZm9yICh2YXIgaSA9IGZyb21JbmRleDsgaSA8IHRvSW5kZXg7IGkrKykKCSAgICAgICAgICAgIGFbaV0gPSB2YWw7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDaGVja3MgdGhhdCB7QGNvZGUgZnJvbUluZGV4fSBhbmQge0Bjb2RlIHRvSW5kZXh9IGFyZSBpbgoJICAgICAqIHRoZSByYW5nZSBhbmQgdGhyb3dzIGFuIGV4Y2VwdGlvbiBpZiB0aGV5IGFyZW4ndC4KCSAgICAgKi8KCSAgICBBcnJheXMucmFuZ2VDaGVjayA9IGZ1bmN0aW9uIChhcnJheUxlbmd0aCwgZnJvbUluZGV4LCB0b0luZGV4KSB7CgkgICAgICAgIGlmIChmcm9tSW5kZXggPiB0b0luZGV4KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkOS5kZWZhdWx0KCdmcm9tSW5kZXgoJyArIGZyb21JbmRleCArICcpID4gdG9JbmRleCgnICsgdG9JbmRleCArICcpJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGZyb21JbmRleCA8IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMS5kZWZhdWx0KGZyb21JbmRleCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRvSW5kZXggPiBhcnJheUxlbmd0aCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbl8xLmRlZmF1bHQodG9JbmRleCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIEFycmF5cy5hc0xpc3QgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBhcmdzID0gW107CgkgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7CgkgICAgICAgICAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGFyZ3M7CgkgICAgfTsKCSAgICBBcnJheXMuY3JlYXRlID0gZnVuY3Rpb24gKHJvd3MsIGNvbHMsIHZhbHVlKSB7CgkgICAgICAgIHZhciBhcnIgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiByb3dzIH0pOwoJICAgICAgICByZXR1cm4gYXJyLm1hcChmdW5jdGlvbiAoeCkgeyByZXR1cm4gQXJyYXkuZnJvbSh7IGxlbmd0aDogY29scyB9KS5maWxsKHZhbHVlKTsgfSk7CgkgICAgfTsKCSAgICBBcnJheXMuY3JlYXRlSW50MzJBcnJheSA9IGZ1bmN0aW9uIChyb3dzLCBjb2xzLCB2YWx1ZSkgewoJICAgICAgICB2YXIgYXJyID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogcm93cyB9KTsKCSAgICAgICAgcmV0dXJuIGFyci5tYXAoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIEludDMyQXJyYXkuZnJvbSh7IGxlbmd0aDogY29scyB9KS5maWxsKHZhbHVlKTsgfSk7CgkgICAgfTsKCSAgICBBcnJheXMuZXF1YWxzID0gZnVuY3Rpb24gKGZpcnN0LCBzZWNvbmQpIHsKCSAgICAgICAgaWYgKCFmaXJzdCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIGlmICghc2Vjb25kKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKCFmaXJzdC5sZW5ndGgpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoIXNlY29uZC5sZW5ndGgpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZmlyc3QubGVuZ3RoICE9PSBzZWNvbmQubGVuZ3RoKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gZmlyc3QubGVuZ3RoOyBpIDwgbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgaWYgKGZpcnN0W2ldICE9PSBzZWNvbmRbaV0pIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICBBcnJheXMuaGFzaENvZGUgPSBmdW5jdGlvbiAoYSkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgaWYgKGEgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiAwOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSAxOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgYV8xID0gX192YWx1ZXMkNyhhKSwgYV8xXzEgPSBhXzEubmV4dCgpOyAhYV8xXzEuZG9uZTsgYV8xXzEgPSBhXzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBhXzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSAzMSAqIHJlc3VsdCArIGVsZW1lbnQ7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChhXzFfMSAmJiAhYV8xXzEuZG9uZSAmJiAoX2EgPSBhXzEucmV0dXJuKSkgX2EuY2FsbChhXzEpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZmluYWxseSB7IGlmIChlXzEpIHRocm93IGVfMS5lcnJvcjsgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfTsKCSAgICBBcnJheXMuZmlsbFVpbnQ4QXJyYXkgPSBmdW5jdGlvbiAoYSwgdmFsdWUpIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgIT09IGEubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIGFbaV0gPSB2YWx1ZTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgQXJyYXlzLmNvcHlPZiA9IGZ1bmN0aW9uIChvcmlnaW5hbCwgbmV3TGVuZ3RoKSB7CgkgICAgICAgIHJldHVybiBvcmlnaW5hbC5zbGljZSgwLCBuZXdMZW5ndGgpOwoJICAgIH07CgkgICAgQXJyYXlzLmNvcHlPZlVpbnQ4QXJyYXkgPSBmdW5jdGlvbiAob3JpZ2luYWwsIG5ld0xlbmd0aCkgewoJICAgICAgICBpZiAob3JpZ2luYWwubGVuZ3RoIDw9IG5ld0xlbmd0aCkgewoJICAgICAgICAgICAgdmFyIG5ld0FycmF5ID0gbmV3IFVpbnQ4QXJyYXkobmV3TGVuZ3RoKTsKCSAgICAgICAgICAgIG5ld0FycmF5LnNldChvcmlnaW5hbCk7CgkgICAgICAgICAgICByZXR1cm4gbmV3QXJyYXk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG9yaWdpbmFsLnNsaWNlKDAsIG5ld0xlbmd0aCk7CgkgICAgfTsKCSAgICBBcnJheXMuY29weU9mUmFuZ2UgPSBmdW5jdGlvbiAob3JpZ2luYWwsIGZyb20sIHRvKSB7CgkgICAgICAgIHZhciBuZXdMZW5ndGggPSB0byAtIGZyb207CgkgICAgICAgIHZhciBjb3B5ID0gbmV3IEludDMyQXJyYXkobmV3TGVuZ3RoKTsKCSAgICAgICAgU3lzdGVtXzEkNS5kZWZhdWx0LmFycmF5Y29weShvcmlnaW5hbCwgZnJvbSwgY29weSwgMCwgbmV3TGVuZ3RoKTsKCSAgICAgICAgcmV0dXJuIGNvcHk7CgkgICAgfTsKCSAgICAvKgoJICAgICogUmV0dXJucyB0aGUgaW5kZXggb2Ygb2YgdGhlIGVsZW1lbnQgaW4gYSBzb3J0ZWQgYXJyYXkgb3IgKC1uLTEpIHdoZXJlIG4gaXMgdGhlIGluc2VydGlvbiBwb2ludAoJICAgICogZm9yIHRoZSBuZXcgZWxlbWVudC4KCSAgICAqIFBhcmFtZXRlcnM6CgkgICAgKiAgICAgYXIgLSBBIHNvcnRlZCBhcnJheQoJICAgICogICAgIGVsIC0gQW4gZWxlbWVudCB0byBzZWFyY2ggZm9yCgkgICAgKiAgICAgY29tcGFyYXRvciAtIEEgY29tcGFyYXRvciBmdW5jdGlvbi4gVGhlIGZ1bmN0aW9uIHRha2VzIHR3byBhcmd1bWVudHM6IChhLCBiKSBhbmQgcmV0dXJuczoKCSAgICAqICAgICAgICBhIG5lZ2F0aXZlIG51bWJlciAgaWYgYSBpcyBsZXNzIHRoYW4gYjsKCSAgICAqICAgICAgICAwIGlmIGEgaXMgZXF1YWwgdG8gYjsKCSAgICAqICAgICAgICBhIHBvc2l0aXZlIG51bWJlciBvZiBhIGlzIGdyZWF0ZXIgdGhhbiBiLgoJICAgICogVGhlIGFycmF5IG1heSBjb250YWluIGR1cGxpY2F0ZSBlbGVtZW50cy4gSWYgdGhlcmUgYXJlIG1vcmUgdGhhbiBvbmUgZXF1YWwgZWxlbWVudHMgaW4gdGhlIGFycmF5LAoJICAgICogdGhlIHJldHVybmVkIHZhbHVlIGNhbiBiZSB0aGUgaW5kZXggb2YgYW55IG9uZSBvZiB0aGUgZXF1YWwgZWxlbWVudHMuCgkgICAgKgoJICAgICogaHR0cDovL2pzZmlkZGxlLm5ldC9hcnl6aG92L3BrZnN0NTUwLwoJICAgICovCgkgICAgQXJyYXlzLmJpbmFyeVNlYXJjaCA9IGZ1bmN0aW9uIChhciwgZWwsIGNvbXBhcmF0b3IpIHsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gY29tcGFyYXRvcikgewoJICAgICAgICAgICAgY29tcGFyYXRvciA9IEFycmF5cy5udW1iZXJDb21wYXJhdG9yOwoJICAgICAgICB9CgkgICAgICAgIHZhciBtID0gMDsKCSAgICAgICAgdmFyIG4gPSBhci5sZW5ndGggLSAxOwoJICAgICAgICB3aGlsZSAobSA8PSBuKSB7CgkgICAgICAgICAgICB2YXIgayA9IChuICsgbSkgPj4gMTsKCSAgICAgICAgICAgIHZhciBjbXAgPSBjb21wYXJhdG9yKGVsLCBhcltrXSk7CgkgICAgICAgICAgICBpZiAoY21wID4gMCkgewoJICAgICAgICAgICAgICAgIG0gPSBrICsgMTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKGNtcCA8IDApIHsKCSAgICAgICAgICAgICAgICBuID0gayAtIDE7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gazsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gLW0gLSAxOwoJICAgIH07CgkgICAgQXJyYXlzLm51bWJlckNvbXBhcmF0b3IgPSBmdW5jdGlvbiAoYSwgYikgewoJICAgICAgICByZXR1cm4gYSAtIGI7CgkgICAgfTsKCSAgICByZXR1cm4gQXJyYXlzOwoJfSgpKTsKCUFycmF5cyQxLmRlZmF1bHQgPSBBcnJheXM7CgoJdmFyIEludGVnZXIkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbnRlZ2VyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogUG9ueWZpbGwgZm9yIEphdmEncyBJbnRlZ2VyIGNsYXNzLgoJICovCgl2YXIgSW50ZWdlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBJbnRlZ2VyKCkgewoJICAgIH0KCSAgICBJbnRlZ2VyLm51bWJlck9mVHJhaWxpbmdaZXJvcyA9IGZ1bmN0aW9uIChpKSB7CgkgICAgICAgIHZhciB5OwoJICAgICAgICBpZiAoaSA9PT0gMCkKCSAgICAgICAgICAgIHJldHVybiAzMjsKCSAgICAgICAgdmFyIG4gPSAzMTsKCSAgICAgICAgeSA9IGkgPDwgMTY7CgkgICAgICAgIGlmICh5ICE9PSAwKSB7CgkgICAgICAgICAgICBuIC09IDE2OwoJICAgICAgICAgICAgaSA9IHk7CgkgICAgICAgIH0KCSAgICAgICAgeSA9IGkgPDwgODsKCSAgICAgICAgaWYgKHkgIT09IDApIHsKCSAgICAgICAgICAgIG4gLT0gODsKCSAgICAgICAgICAgIGkgPSB5OwoJICAgICAgICB9CgkgICAgICAgIHkgPSBpIDw8IDQ7CgkgICAgICAgIGlmICh5ICE9PSAwKSB7CgkgICAgICAgICAgICBuIC09IDQ7CgkgICAgICAgICAgICBpID0geTsKCSAgICAgICAgfQoJICAgICAgICB5ID0gaSA8PCAyOwoJICAgICAgICBpZiAoeSAhPT0gMCkgewoJICAgICAgICAgICAgbiAtPSAyOwoJICAgICAgICAgICAgaSA9IHk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG4gLSAoKGkgPDwgMSkgPj4+IDMxKTsKCSAgICB9OwoJICAgIEludGVnZXIubnVtYmVyT2ZMZWFkaW5nWmVyb3MgPSBmdW5jdGlvbiAoaSkgewoJICAgICAgICAvLyBIRCwgRmlndXJlIDUtNgoJICAgICAgICBpZiAoaSA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIDMyOwoJICAgICAgICB9CgkgICAgICAgIHZhciBuID0gMTsKCSAgICAgICAgaWYgKGkgPj4+IDE2ID09PSAwKSB7CgkgICAgICAgICAgICBuICs9IDE2OwoJICAgICAgICAgICAgaSA8PD0gMTY7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGkgPj4+IDI0ID09PSAwKSB7CgkgICAgICAgICAgICBuICs9IDg7CgkgICAgICAgICAgICBpIDw8PSA4OwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID4+PiAyOCA9PT0gMCkgewoJICAgICAgICAgICAgbiArPSA0OwoJICAgICAgICAgICAgaSA8PD0gNDsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaSA+Pj4gMzAgPT09IDApIHsKCSAgICAgICAgICAgIG4gKz0gMjsKCSAgICAgICAgICAgIGkgPDw9IDI7CgkgICAgICAgIH0KCSAgICAgICAgbiAtPSBpID4+PiAzMTsKCSAgICAgICAgcmV0dXJuIG47CgkgICAgfTsKCSAgICBJbnRlZ2VyLnRvSGV4U3RyaW5nID0gZnVuY3Rpb24gKGkpIHsKCSAgICAgICAgcmV0dXJuIGkudG9TdHJpbmcoMTYpOwoJICAgIH07CgkgICAgSW50ZWdlci50b0JpbmFyeVN0cmluZyA9IGZ1bmN0aW9uIChpbnROdW1iZXIpIHsKCSAgICAgICAgcmV0dXJuIFN0cmluZyhwYXJzZUludChTdHJpbmcoaW50TnVtYmVyKSwgMikpOwoJICAgIH07CgkgICAgLy8gUmV0dXJucyB0aGUgbnVtYmVyIG9mIG9uZS1iaXRzIGluIHRoZSB0d28ncyBjb21wbGVtZW50IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiB0aGUgc3BlY2lmaWVkIGludCB2YWx1ZS4gVGhpcyBmdW5jdGlvbiBpcyBzb21ldGltZXMgcmVmZXJyZWQgdG8gYXMgdGhlIHBvcHVsYXRpb24gY291bnQuCgkgICAgLy8gUmV0dXJuczoKCSAgICAvLyB0aGUgbnVtYmVyIG9mIG9uZS1iaXRzIGluIHRoZSB0d28ncyBjb21wbGVtZW50IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiB0aGUgc3BlY2lmaWVkIGludCB2YWx1ZS4KCSAgICBJbnRlZ2VyLmJpdENvdW50ID0gZnVuY3Rpb24gKGkpIHsKCSAgICAgICAgLy8gSEQsIEZpZ3VyZSA1LTIKCSAgICAgICAgaSA9IGkgLSAoKGkgPj4+IDEpICYgMHg1NTU1NTU1NSk7CgkgICAgICAgIGkgPSAoaSAmIDB4MzMzMzMzMzMpICsgKChpID4+PiAyKSAmIDB4MzMzMzMzMzMpOwoJICAgICAgICBpID0gKGkgKyAoaSA+Pj4gNCkpICYgMHgwZjBmMGYwZjsKCSAgICAgICAgaSA9IGkgKyAoaSA+Pj4gOCk7CgkgICAgICAgIGkgPSBpICsgKGkgPj4+IDE2KTsKCSAgICAgICAgcmV0dXJuIGkgJiAweDNmOwoJICAgIH07CgkgICAgSW50ZWdlci50cnVuY0RpdmlzaW9uID0gZnVuY3Rpb24gKGRpdmlkZW5kLCBkaXZpc29yKSB7CgkgICAgICAgIHJldHVybiBNYXRoLnRydW5jKGRpdmlkZW5kIC8gZGl2aXNvcik7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDb252ZXJ0cyBBIHN0cmluZyB0byBhbiBpbnRlZ2VyLgoJICAgICAqIEBwYXJhbSBzIEEgc3RyaW5nIHRvIGNvbnZlcnQgaW50byBhIG51bWJlci4KCSAgICAgKiBAcGFyYW0gcmFkaXggQSB2YWx1ZSBiZXR3ZWVuIDIgYW5kIDM2IHRoYXQgc3BlY2lmaWVzIHRoZSBiYXNlIG9mIHRoZSBudW1iZXIgaW4gbnVtU3RyaW5nLiBJZiB0aGlzIGFyZ3VtZW50IGlzIG5vdCBzdXBwbGllZCwgc3RyaW5ncyB3aXRoIGEgcHJlZml4IG9mICcweCcgYXJlIGNvbnNpZGVyZWQgaGV4YWRlY2ltYWwuIEFsbCBvdGhlciBzdHJpbmdzIGFyZSBjb25zaWRlcmVkIGRlY2ltYWwuCgkgICAgICovCgkgICAgSW50ZWdlci5wYXJzZUludCA9IGZ1bmN0aW9uIChudW0sIHJhZGl4KSB7CgkgICAgICAgIGlmIChyYWRpeCA9PT0gdm9pZCAwKSB7IHJhZGl4ID0gdW5kZWZpbmVkOyB9CgkgICAgICAgIHJldHVybiBwYXJzZUludChudW0sIHJhZGl4KTsKCSAgICB9OwoJICAgIEludGVnZXIuTUlOX1ZBTFVFXzMyX0JJVFMgPSAtMjE0NzQ4MzY0ODsKCSAgICBJbnRlZ2VyLk1BWF9WQUxVRSA9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSOwoJICAgIHJldHVybiBJbnRlZ2VyOwoJfSgpKTsKCUludGVnZXIkMS5kZWZhdWx0ID0gSW50ZWdlcjsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdEFycmF5JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5czsqLwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDggPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcnJheXNfMSQxID0gQXJyYXlzJDE7Cgl2YXIgSW50ZWdlcl8xJDIgPSBJbnRlZ2VyJDE7Cgl2YXIgU3lzdGVtXzEkNCA9IFN5c3RlbSQxOwoJLyoqCgkgKiA8cD5BIHNpbXBsZSwgZmFzdCBhcnJheSBvZiBiaXRzLCByZXByZXNlbnRlZCBjb21wYWN0bHkgYnkgYW4gYXJyYXkgb2YgaW50cyBpbnRlcm5hbGx5LjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgQml0QXJyYXkgLyppbXBsZW1lbnRzIENsb25lYWJsZSovID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3RvcigpIHsKCSAgICAvLyAgIHRoaXMuc2l6ZSA9IDAKCSAgICAvLyAgIHRoaXMuYml0cyA9IG5ldyBJbnQzMkFycmF5KDEpCgkgICAgLy8gfQoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3RvcihzaXplPzogbnVtYmVyIC8qaW50Ki8pIHsKCSAgICAvLyAgIGlmICh1bmRlZmluZWQgPT09IHNpemUpIHsKCSAgICAvLyAgICAgdGhpcy5zaXplID0gMAoJICAgIC8vICAgfSBlbHNlIHsKCSAgICAvLyAgICAgdGhpcy5zaXplID0gc2l6ZQoJICAgIC8vICAgfQoJICAgIC8vICAgdGhpcy5iaXRzID0gdGhpcy5tYWtlQXJyYXkoc2l6ZSkKCSAgICAvLyB9CgkgICAgLy8gRm9yIHRlc3Rpbmcgb25seQoJICAgIGZ1bmN0aW9uIEJpdEFycmF5KHNpemUgLyppbnQqLywgYml0cykgewoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSBzaXplKSB7CgkgICAgICAgICAgICB0aGlzLnNpemUgPSAwOwoJICAgICAgICAgICAgdGhpcy5iaXRzID0gbmV3IEludDMyQXJyYXkoMSk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICB0aGlzLnNpemUgPSBzaXplOwoJICAgICAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gYml0cyB8fCBudWxsID09PSBiaXRzKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5iaXRzID0gQml0QXJyYXkubWFrZUFycmF5KHNpemUpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhpcy5iaXRzID0gYml0czsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH0KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZ2V0U2l6ZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc2l6ZTsKCSAgICB9OwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXRTaXplSW5CeXRlcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoKHRoaXMuc2l6ZSArIDcpIC8gOCk7CgkgICAgfTsKCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZW5zdXJlQ2FwYWNpdHkgPSBmdW5jdGlvbiAoc2l6ZSAvKmludCovKSB7CgkgICAgICAgIGlmIChzaXplID4gdGhpcy5iaXRzLmxlbmd0aCAqIDMyKSB7CgkgICAgICAgICAgICB2YXIgbmV3Qml0cyA9IEJpdEFycmF5Lm1ha2VBcnJheShzaXplKTsKCSAgICAgICAgICAgIFN5c3RlbV8xJDQuZGVmYXVsdC5hcnJheWNvcHkodGhpcy5iaXRzLCAwLCBuZXdCaXRzLCAwLCB0aGlzLmJpdHMubGVuZ3RoKTsKCSAgICAgICAgICAgIHRoaXMuYml0cyA9IG5ld0JpdHM7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBpIGJpdCB0byBnZXQKCSAgICAgKiBAcmV0dXJuIHRydWUgaWZmIGJpdCBpIGlzIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoaSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiAodGhpcy5iaXRzW01hdGguZmxvb3IoaSAvIDMyKV0gJiAoMSA8PCAoaSAmIDB4MUYpKSkgIT09IDA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGJpdCBpLgoJICAgICAqCgkgICAgICogQHBhcmFtIGkgYml0IHRvIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoaSAvKmludCovKSB7CgkgICAgICAgIHRoaXMuYml0c1tNYXRoLmZsb29yKGkgLyAzMildIHw9IDEgPDwgKGkgJiAweDFGKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEZsaXBzIGJpdCBpLgoJICAgICAqCgkgICAgICogQHBhcmFtIGkgYml0IHRvIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5mbGlwID0gZnVuY3Rpb24gKGkgLyppbnQqLykgewoJICAgICAgICB0aGlzLmJpdHNbTWF0aC5mbG9vcihpIC8gMzIpXSBePSAxIDw8IChpICYgMHgxRik7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gZnJvbSBmaXJzdCBiaXQgdG8gY2hlY2sKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIGZpcnN0IGJpdCB0aGF0IGlzIHNldCwgc3RhcnRpbmcgZnJvbSB0aGUgZ2l2ZW4gaW5kZXgsIG9yIHNpemUgaWYgbm9uZSBhcmUgc2V0CgkgICAgICogIGF0IG9yIGJleW9uZCB0aGlzIGdpdmVuIGluZGV4CgkgICAgICogQHNlZSAjZ2V0TmV4dFVuc2V0KGludCkKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZ2V0TmV4dFNldCA9IGZ1bmN0aW9uIChmcm9tIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIHNpemUgPSB0aGlzLnNpemU7CgkgICAgICAgIGlmIChmcm9tID49IHNpemUpIHsKCSAgICAgICAgICAgIHJldHVybiBzaXplOwoJICAgICAgICB9CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IE1hdGguZmxvb3IoZnJvbSAvIDMyKTsKCSAgICAgICAgdmFyIGN1cnJlbnRCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgLy8gbWFzayBvZmYgbGVzc2VyIGJpdHMgZmlyc3QKCSAgICAgICAgY3VycmVudEJpdHMgJj0gfigoMSA8PCAoZnJvbSAmIDB4MUYpKSAtIDEpOwoJICAgICAgICB2YXIgbGVuZ3RoID0gYml0cy5sZW5ndGg7CgkgICAgICAgIHdoaWxlIChjdXJyZW50Qml0cyA9PT0gMCkgewoJICAgICAgICAgICAgaWYgKCsrYml0c09mZnNldCA9PT0gbGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIHNpemU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjdXJyZW50Qml0cyA9IGJpdHNbYml0c09mZnNldF07CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdCA9IChiaXRzT2Zmc2V0ICogMzIpICsgSW50ZWdlcl8xJDIuZGVmYXVsdC5udW1iZXJPZlRyYWlsaW5nWmVyb3MoY3VycmVudEJpdHMpOwoJICAgICAgICByZXR1cm4gcmVzdWx0ID4gc2l6ZSA/IHNpemUgOiByZXN1bHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gZnJvbSBpbmRleCB0byBzdGFydCBsb29raW5nIGZvciB1bnNldCBiaXQKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIG5leHQgdW5zZXQgYml0LCBvciB7QGNvZGUgc2l6ZX0gaWYgbm9uZSBhcmUgdW5zZXQgdW50aWwgdGhlIGVuZAoJICAgICAqIEBzZWUgI2dldE5leHRTZXQoaW50KQoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXROZXh0VW5zZXQgPSBmdW5jdGlvbiAoZnJvbSAvKmludCovKSB7CgkgICAgICAgIHZhciBzaXplID0gdGhpcy5zaXplOwoJICAgICAgICBpZiAoZnJvbSA+PSBzaXplKSB7CgkgICAgICAgICAgICByZXR1cm4gc2l6ZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgdmFyIGJpdHNPZmZzZXQgPSBNYXRoLmZsb29yKGZyb20gLyAzMik7CgkgICAgICAgIHZhciBjdXJyZW50Qml0cyA9IH5iaXRzW2JpdHNPZmZzZXRdOwoJICAgICAgICAvLyBtYXNrIG9mZiBsZXNzZXIgYml0cyBmaXJzdAoJICAgICAgICBjdXJyZW50Qml0cyAmPSB+KCgxIDw8IChmcm9tICYgMHgxRikpIC0gMSk7CgkgICAgICAgIHZhciBsZW5ndGggPSBiaXRzLmxlbmd0aDsKCSAgICAgICAgd2hpbGUgKGN1cnJlbnRCaXRzID09PSAwKSB7CgkgICAgICAgICAgICBpZiAoKytiaXRzT2Zmc2V0ID09PSBsZW5ndGgpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gc2l6ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGN1cnJlbnRCaXRzID0gfmJpdHNbYml0c09mZnNldF07CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdCA9IChiaXRzT2Zmc2V0ICogMzIpICsgSW50ZWdlcl8xJDIuZGVmYXVsdC5udW1iZXJPZlRyYWlsaW5nWmVyb3MoY3VycmVudEJpdHMpOwoJICAgICAgICByZXR1cm4gcmVzdWx0ID4gc2l6ZSA/IHNpemUgOiByZXN1bHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGEgYmxvY2sgb2YgMzIgYml0cywgc3RhcnRpbmcgYXQgYml0IGkuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gaSBmaXJzdCBiaXQgdG8gc2V0CgkgICAgICogQHBhcmFtIG5ld0JpdHMgdGhlIG5ldyB2YWx1ZSBvZiB0aGUgbmV4dCAzMiBiaXRzLiBOb3RlIGFnYWluIHRoYXQgdGhlIGxlYXN0LXNpZ25pZmljYW50IGJpdAoJICAgICAqIGNvcnJlc3BvbmRzIHRvIGJpdCBpLCB0aGUgbmV4dC1sZWFzdC1zaWduaWZpY2FudCB0byBpKzEsIGFuZCBzbyBvbi4KCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuc2V0QnVsayA9IGZ1bmN0aW9uIChpIC8qaW50Ki8sIG5ld0JpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLmJpdHNbTWF0aC5mbG9vcihpIC8gMzIpXSA9IG5ld0JpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGEgcmFuZ2Ugb2YgYml0cy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGFydCBzdGFydCBvZiByYW5nZSwgaW5jbHVzaXZlLgoJICAgICAqIEBwYXJhbSBlbmQgZW5kIG9mIHJhbmdlLCBleGNsdXNpdmUKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuc2V0UmFuZ2UgPSBmdW5jdGlvbiAoc3RhcnQgLyppbnQqLywgZW5kIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGVuZCA8IHN0YXJ0IHx8IHN0YXJ0IDwgMCB8fCBlbmQgPiB0aGlzLnNpemUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ4LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZW5kID09PSBzdGFydCkgewoJICAgICAgICAgICAgcmV0dXJuOwoJICAgICAgICB9CgkgICAgICAgIGVuZC0tOyAvLyB3aWxsIGJlIGVhc2llciB0byB0cmVhdCB0aGlzIGFzIHRoZSBsYXN0IGFjdHVhbGx5IHNldCBiaXQgLS0gaW5jbHVzaXZlCgkgICAgICAgIHZhciBmaXJzdEludCA9IE1hdGguZmxvb3Ioc3RhcnQgLyAzMik7CgkgICAgICAgIHZhciBsYXN0SW50ID0gTWF0aC5mbG9vcihlbmQgLyAzMik7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICBmb3IgKHZhciBpID0gZmlyc3RJbnQ7IGkgPD0gbGFzdEludDsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgZmlyc3RCaXQgPSBpID4gZmlyc3RJbnQgPyAwIDogc3RhcnQgJiAweDFGOwoJICAgICAgICAgICAgdmFyIGxhc3RCaXQgPSBpIDwgbGFzdEludCA/IDMxIDogZW5kICYgMHgxRjsKCSAgICAgICAgICAgIC8vIE9uZXMgZnJvbSBmaXJzdEJpdCB0byBsYXN0Qml0LCBpbmNsdXNpdmUKCSAgICAgICAgICAgIHZhciBtYXNrID0gKDIgPDwgbGFzdEJpdCkgLSAoMSA8PCBmaXJzdEJpdCk7CgkgICAgICAgICAgICBiaXRzW2ldIHw9IG1hc2s7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIENsZWFycyBhbGwgYml0cyAoc2V0cyB0byBmYWxzZSkuCgkgICAgICovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbWF4ID0gdGhpcy5iaXRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWF4OyBpKyspIHsKCSAgICAgICAgICAgIGJpdHNbaV0gPSAwOwoJICAgICAgICB9CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBFZmZpY2llbnQgbWV0aG9kIHRvIGNoZWNrIGlmIGEgcmFuZ2Ugb2YgYml0cyBpcyBzZXQsIG9yIG5vdCBzZXQuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gc3RhcnQgc3RhcnQgb2YgcmFuZ2UsIGluY2x1c2l2ZS4KCSAgICAgKiBAcGFyYW0gZW5kIGVuZCBvZiByYW5nZSwgZXhjbHVzaXZlCgkgICAgICogQHBhcmFtIHZhbHVlIGlmIHRydWUsIGNoZWNrcyB0aGF0IGJpdHMgaW4gcmFuZ2UgYXJlIHNldCwgb3RoZXJ3aXNlIGNoZWNrcyB0aGF0IHRoZXkgYXJlIG5vdCBzZXQKCSAgICAgKiBAcmV0dXJuIHRydWUgaWZmIGFsbCBiaXRzIGFyZSBzZXQgb3Igbm90IHNldCBpbiByYW5nZSwgYWNjb3JkaW5nIHRvIHZhbHVlIGFyZ3VtZW50CgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgZW5kIGlzIGxlc3MgdGhhbiBzdGFydCBvciB0aGUgcmFuZ2UgaXMgbm90IGNvbnRhaW5lZCBpbiB0aGUgYXJyYXkKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuaXNSYW5nZSA9IGZ1bmN0aW9uIChzdGFydCAvKmludCovLCBlbmQgLyppbnQqLywgdmFsdWUpIHsKCSAgICAgICAgaWYgKGVuZCA8IHN0YXJ0IHx8IHN0YXJ0IDwgMCB8fCBlbmQgPiB0aGlzLnNpemUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ4LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZW5kID09PSBzdGFydCkgewoJICAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vIGVtcHR5IHJhbmdlIG1hdGNoZXMKCSAgICAgICAgfQoJICAgICAgICBlbmQtLTsgLy8gd2lsbCBiZSBlYXNpZXIgdG8gdHJlYXQgdGhpcyBhcyB0aGUgbGFzdCBhY3R1YWxseSBzZXQgYml0IC0tIGluY2x1c2l2ZQoJICAgICAgICB2YXIgZmlyc3RJbnQgPSBNYXRoLmZsb29yKHN0YXJ0IC8gMzIpOwoJICAgICAgICB2YXIgbGFzdEludCA9IE1hdGguZmxvb3IoZW5kIC8gMzIpOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgaSA9IGZpcnN0SW50OyBpIDw9IGxhc3RJbnQ7IGkrKykgewoJICAgICAgICAgICAgdmFyIGZpcnN0Qml0ID0gaSA+IGZpcnN0SW50ID8gMCA6IHN0YXJ0ICYgMHgxRjsKCSAgICAgICAgICAgIHZhciBsYXN0Qml0ID0gaSA8IGxhc3RJbnQgPyAzMSA6IGVuZCAmIDB4MUY7CgkgICAgICAgICAgICAvLyBPbmVzIGZyb20gZmlyc3RCaXQgdG8gbGFzdEJpdCwgaW5jbHVzaXZlCgkgICAgICAgICAgICB2YXIgbWFzayA9ICgyIDw8IGxhc3RCaXQpIC0gKDEgPDwgZmlyc3RCaXQpICYgMHhGRkZGRkZGRjsKCSAgICAgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiAmIDB4RkZGRkZGRkYgYWRkZWQgdG8gZGlzY2FyZCBhbnl0aGluZyBhZnRlciAzMiBiaXRzLCBhcyBFUyBoYXMgNTMgYml0cwoJICAgICAgICAgICAgLy8gUmV0dXJuIGZhbHNlIGlmIHdlJ3JlIGxvb2tpbmcgZm9yIDFzIGFuZCB0aGUgbWFza2VkIGJpdHNbaV0gaXNuJ3QgYWxsIDFzIChpczogdGhhdCwKCSAgICAgICAgICAgIC8vIGVxdWFscyB0aGUgbWFzaywgb3Igd2UncmUgbG9va2luZyBmb3IgMHMgYW5kIHRoZSBtYXNrZWQgcG9ydGlvbiBpcyBub3QgYWxsIDBzCgkgICAgICAgICAgICBpZiAoKGJpdHNbaV0gJiBtYXNrKSAhPT0gKHZhbHVlID8gbWFzayA6IDApKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB0cnVlOwoJICAgIH07CgkgICAgQml0QXJyYXkucHJvdG90eXBlLmFwcGVuZEJpdCA9IGZ1bmN0aW9uIChiaXQpIHsKCSAgICAgICAgdGhpcy5lbnN1cmVDYXBhY2l0eSh0aGlzLnNpemUgKyAxKTsKCSAgICAgICAgaWYgKGJpdCkgewoJICAgICAgICAgICAgdGhpcy5iaXRzW01hdGguZmxvb3IodGhpcy5zaXplIC8gMzIpXSB8PSAxIDw8ICh0aGlzLnNpemUgJiAweDFGKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLnNpemUrKzsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEFwcGVuZHMgdGhlIGxlYXN0LXNpZ25pZmljYW50IGJpdHMsIGZyb20gdmFsdWUsIGluIG9yZGVyIGZyb20gbW9zdC1zaWduaWZpY2FudCB0bwoJICAgICAqIGxlYXN0LXNpZ25pZmljYW50LiBGb3IgZXhhbXBsZSwgYXBwZW5kaW5nIDYgYml0cyBmcm9tIDB4MDAwMDAxRSB3aWxsIGFwcGVuZCB0aGUgYml0cwoJICAgICAqIDAsIDEsIDEsIDEsIDEsIDAgaW4gdGhhdCBvcmRlci4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB2YWx1ZSB7QGNvZGUgaW50fSBjb250YWluaW5nIGJpdHMgdG8gYXBwZW5kCgkgICAgICogQHBhcmFtIG51bUJpdHMgYml0cyBmcm9tIHZhbHVlIHRvIGFwcGVuZAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5hcHBlbmRCaXRzID0gZnVuY3Rpb24gKHZhbHVlIC8qaW50Ki8sIG51bUJpdHMgLyppbnQqLykgewoJICAgICAgICBpZiAobnVtQml0cyA8IDAgfHwgbnVtQml0cyA+IDMyKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkOC5kZWZhdWx0KCdOdW0gYml0cyBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMzInKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLmVuc3VyZUNhcGFjaXR5KHRoaXMuc2l6ZSArIG51bUJpdHMpOwoJICAgICAgICAvLyBjb25zdCBhcHBlbmRCaXQgPSB0aGlzLmFwcGVuZEJpdDsKCSAgICAgICAgZm9yICh2YXIgbnVtQml0c0xlZnQgPSBudW1CaXRzOyBudW1CaXRzTGVmdCA+IDA7IG51bUJpdHNMZWZ0LS0pIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kQml0KCgodmFsdWUgPj4gKG51bUJpdHNMZWZ0IC0gMSkpICYgMHgwMSkgPT09IDEpOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBCaXRBcnJheS5wcm90b3R5cGUuYXBwZW5kQml0QXJyYXkgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgdmFyIG90aGVyU2l6ZSA9IG90aGVyLnNpemU7CgkgICAgICAgIHRoaXMuZW5zdXJlQ2FwYWNpdHkodGhpcy5zaXplICsgb3RoZXJTaXplKTsKCSAgICAgICAgLy8gY29uc3QgYXBwZW5kQml0ID0gdGhpcy5hcHBlbmRCaXQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3RoZXJTaXplOyBpKyspIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kQml0KG90aGVyLmdldChpKSk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS54b3IgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKHRoaXMuc2l6ZSAhPT0gb3RoZXIuc2l6ZSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDguZGVmYXVsdCgnU2l6ZXMgZG9uXCd0IG1hdGNoJyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IGJpdHMubGVuZ3RoOyBpIDwgbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgLy8gVGhlIGxhc3QgaW50IGNvdWxkIGJlIGluY29tcGxldGUgKGkuZS4gbm90IGhhdmUgMzIgYml0cyBpbgoJICAgICAgICAgICAgLy8gaXQpIGJ1dCB0aGVyZSBpcyBubyBwcm9ibGVtIHNpbmNlIDAgWE9SIDAgPT0gMC4KCSAgICAgICAgICAgIGJpdHNbaV0gXj0gb3RoZXIuYml0c1tpXTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYml0T2Zmc2V0IGZpcnN0IGJpdCB0byBzdGFydCB3cml0aW5nCgkgICAgICogQHBhcmFtIGFycmF5IGFycmF5IHRvIHdyaXRlIGludG8uIEJ5dGVzIGFyZSB3cml0dGVuIG1vc3Qtc2lnbmlmaWNhbnQgYnl0ZSBmaXJzdC4gVGhpcyBpcyB0aGUgb3Bwb3NpdGUKCSAgICAgKiAgb2YgdGhlIGludGVybmFsIHJlcHJlc2VudGF0aW9uLCB3aGljaCBpcyBleHBvc2VkIGJ5IHtAbGluayAjZ2V0Qml0QXJyYXkoKX0KCSAgICAgKiBAcGFyYW0gb2Zmc2V0IHBvc2l0aW9uIGluIGFycmF5IHRvIHN0YXJ0IHdyaXRpbmcKCSAgICAgKiBAcGFyYW0gbnVtQnl0ZXMgaG93IG1hbnkgYnl0ZXMgdG8gd3JpdGUKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUudG9CeXRlcyA9IGZ1bmN0aW9uIChiaXRPZmZzZXQgLyppbnQqLywgYXJyYXksIG9mZnNldCAvKmludCovLCBudW1CeXRlcyAvKmludCovKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtQnl0ZXM7IGkrKykgewoJICAgICAgICAgICAgdmFyIHRoZUJ5dGUgPSAwOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCA4OyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5nZXQoYml0T2Zmc2V0KSkgewoJICAgICAgICAgICAgICAgICAgICB0aGVCeXRlIHw9IDEgPDwgKDcgLSBqKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgYml0T2Zmc2V0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBhcnJheVtvZmZzZXQgKyBpXSA9IC8qKGJ5dGUpKi8gdGhlQnl0ZTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB1bmRlcmx5aW5nIGFycmF5IG9mIGludHMuIFRoZSBmaXJzdCBlbGVtZW50IGhvbGRzIHRoZSBmaXJzdCAzMiBiaXRzLCBhbmQgdGhlIGxlYXN0CgkgICAgICogICAgICAgICBzaWduaWZpY2FudCBiaXQgaXMgYml0IDAuCgkgICAgICovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLmdldEJpdEFycmF5ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRzOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV2ZXJzZXMgYWxsIGJpdHMgaW4gdGhlIGFycmF5LgoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5yZXZlcnNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3Qml0cyA9IG5ldyBJbnQzMkFycmF5KHRoaXMuYml0cy5sZW5ndGgpOwoJICAgICAgICAvLyByZXZlcnNlIGFsbCBpbnQncyBmaXJzdAoJICAgICAgICB2YXIgbGVuID0gTWF0aC5mbG9vcigodGhpcy5zaXplIC0gMSkgLyAzMik7CgkgICAgICAgIHZhciBvbGRCaXRzTGVuID0gbGVuICsgMTsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2xkQml0c0xlbjsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgeCA9IGJpdHNbaV07CgkgICAgICAgICAgICB4ID0gKCh4ID4+IDEpICYgMHg1NTU1NTU1NSkgfCAoKHggJiAweDU1NTU1NTU1KSA8PCAxKTsKCSAgICAgICAgICAgIHggPSAoKHggPj4gMikgJiAweDMzMzMzMzMzKSB8ICgoeCAmIDB4MzMzMzMzMzMpIDw8IDIpOwoJICAgICAgICAgICAgeCA9ICgoeCA+PiA0KSAmIDB4MGYwZjBmMGYpIHwgKCh4ICYgMHgwZjBmMGYwZikgPDwgNCk7CgkgICAgICAgICAgICB4ID0gKCh4ID4+IDgpICYgMHgwMGZmMDBmZikgfCAoKHggJiAweDAwZmYwMGZmKSA8PCA4KTsKCSAgICAgICAgICAgIHggPSAoKHggPj4gMTYpICYgMHgwMDAwZmZmZikgfCAoKHggJiAweDAwMDBmZmZmKSA8PCAxNik7CgkgICAgICAgICAgICBuZXdCaXRzW2xlbiAtIGldID0gLyooaW50KSovIHg7CgkgICAgICAgIH0KCSAgICAgICAgLy8gbm93IGNvcnJlY3QgdGhlIGludCdzIGlmIHRoZSBiaXQgc2l6ZSBpc24ndCBhIG11bHRpcGxlIG9mIDMyCgkgICAgICAgIGlmICh0aGlzLnNpemUgIT09IG9sZEJpdHNMZW4gKiAzMikgewoJICAgICAgICAgICAgdmFyIGxlZnRPZmZzZXQgPSBvbGRCaXRzTGVuICogMzIgLSB0aGlzLnNpemU7CgkgICAgICAgICAgICB2YXIgY3VycmVudEludCA9IG5ld0JpdHNbMF0gPj4+IGxlZnRPZmZzZXQ7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IG9sZEJpdHNMZW47IGkrKykgewoJICAgICAgICAgICAgICAgIHZhciBuZXh0SW50ID0gbmV3Qml0c1tpXTsKCSAgICAgICAgICAgICAgICBjdXJyZW50SW50IHw9IG5leHRJbnQgPDwgKDMyIC0gbGVmdE9mZnNldCk7CgkgICAgICAgICAgICAgICAgbmV3Qml0c1tpIC0gMV0gPSBjdXJyZW50SW50OwoJICAgICAgICAgICAgICAgIGN1cnJlbnRJbnQgPSBuZXh0SW50ID4+PiBsZWZ0T2Zmc2V0OwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgbmV3Qml0c1tvbGRCaXRzTGVuIC0gMV0gPSBjdXJyZW50SW50OwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0cyA9IG5ld0JpdHM7CgkgICAgfTsKCSAgICBCaXRBcnJheS5tYWtlQXJyYXkgPSBmdW5jdGlvbiAoc2l6ZSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiBuZXcgSW50MzJBcnJheShNYXRoLmZsb29yKChzaXplICsgMzEpIC8gMzIpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKG8pIHsKCSAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mIEJpdEFycmF5KSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLnNpemUgPT09IG90aGVyLnNpemUgJiYgQXJyYXlzXzEkMS5kZWZhdWx0LmVxdWFscyh0aGlzLmJpdHMsIG90aGVyLmJpdHMpOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDMxICogdGhpcy5zaXplICsgQXJyYXlzXzEkMS5kZWZhdWx0Lmhhc2hDb2RlKHRoaXMuYml0cyk7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgcmVzdWx0ID0gJyc7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBzaXplID0gdGhpcy5zaXplOyBpIDwgc2l6ZTsgaSsrKSB7CgkgICAgICAgICAgICBpZiAoKGkgJiAweDA3KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnICc7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQgKz0gdGhpcy5nZXQoaSkgPyAnWCcgOiAnLic7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgQml0QXJyYXkodGhpcy5zaXplLCB0aGlzLmJpdHMuc2xpY2UoKSk7CgkgICAgfTsKCSAgICByZXR1cm4gQml0QXJyYXk7Cgl9KCkpOwoJQml0QXJyYXkkMS5kZWZhdWx0ID0gQml0QXJyYXk7CgoJdmFyIEJpdE1hdHJpeCQxID0ge307CgoJdmFyIFN0cmluZ0J1aWxkZXIkMSA9IHt9OwoKCXZhciBTdHJpbmdVdGlscyQxID0ge307CgoJdmFyIERlY29kZUhpbnRUeXBlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KERlY29kZUhpbnRUeXBlJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcgeyovCgkvKioKCSAqIEVuY2Fwc3VsYXRlcyBhIHR5cGUgb2YgaGludCB0aGF0IGEgY2FsbGVyIG1heSBwYXNzIHRvIGEgYmFyY29kZSByZWFkZXIgdG8gaGVscCBpdAoJICogbW9yZSBxdWlja2x5IG9yIGFjY3VyYXRlbHkgZGVjb2RlIGl0LiBJdCBpcyB1cCB0byBpbXBsZW1lbnRhdGlvbnMgdG8gZGVjaWRlIHdoYXQsCgkgKiBpZiBhbnl0aGluZywgdG8gZG8gd2l0aCB0aGUgaW5mb3JtYXRpb24gdGhhdCBpcyBzdXBwbGllZC4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBzZWUgUmVhZGVyI2RlY29kZShCaW5hcnlCaXRtYXAsamF2YS51dGlsLk1hcCkKCSAqLwoJdmFyIERlY29kZUhpbnRUeXBlOwoJKGZ1bmN0aW9uIChEZWNvZGVIaW50VHlwZSkgewoJICAgIC8qKgoJICAgICAqIFVuc3BlY2lmaWVkLCBhcHBsaWNhdGlvbi1zcGVjaWZpYyBoaW50LiBNYXBzIHRvIGFuIHVuc3BlY2lmaWVkIHtAbGluayBPYmplY3R9LgoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJPVEhFUiJdID0gMF0gPSAiT1RIRVIiOyAvKihPYmplY3QuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBJbWFnZSBpcyBhIHB1cmUgbW9ub2Nocm9tZSBpbWFnZSBvZiBhIGJhcmNvZGUuIERvZXNuJ3QgbWF0dGVyIHdoYXQgaXQgbWFwcyB0bzsKCSAgICAgKiB1c2Uge0BsaW5rIEJvb2xlYW4jVFJVRX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIlBVUkVfQkFSQ09ERSJdID0gMV0gPSAiUFVSRV9CQVJDT0RFIjsgLyooVm9pZC5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIEltYWdlIGlzIGtub3duIHRvIGJlIG9mIG9uZSBvZiBhIGZldyBwb3NzaWJsZSBmb3JtYXRzLgoJICAgICAqIE1hcHMgdG8gYSB7QGxpbmsgTGlzdH0gb2Yge0BsaW5rIEJhcmNvZGVGb3JtYXR9cy4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiUE9TU0lCTEVfRk9STUFUUyJdID0gMl0gPSAiUE9TU0lCTEVfRk9STUFUUyI7IC8qKExpc3QuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBTcGVuZCBtb3JlIHRpbWUgdG8gdHJ5IHRvIGZpbmQgYSBiYXJjb2RlOyBvcHRpbWl6ZSBmb3IgYWNjdXJhY3ksIG5vdCBzcGVlZC4KCSAgICAgKiBEb2Vzbid0IG1hdHRlciB3aGF0IGl0IG1hcHMgdG87IHVzZSB7QGxpbmsgQm9vbGVhbiNUUlVFfS4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiVFJZX0hBUkRFUiJdID0gM10gPSAiVFJZX0hBUkRFUiI7IC8qKFZvaWQuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBTcGVjaWZpZXMgd2hhdCBjaGFyYWN0ZXIgZW5jb2RpbmcgdG8gdXNlIHdoZW4gZGVjb2RpbmcsIHdoZXJlIGFwcGxpY2FibGUgKHR5cGUgU3RyaW5nKQoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJDSEFSQUNURVJfU0VUIl0gPSA0XSA9ICJDSEFSQUNURVJfU0VUIjsgLyooU3RyaW5nLmNsYXNzKSovCgkgICAgLyoqCgkgICAgICogQWxsb3dlZCBsZW5ndGhzIG9mIGVuY29kZWQgZGF0YSAtLSByZWplY3QgYW55dGhpbmcgZWxzZS4gTWFwcyB0byBhbiB7QGNvZGUgSW50MzJBcnJheX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIkFMTE9XRURfTEVOR1RIUyJdID0gNV0gPSAiQUxMT1dFRF9MRU5HVEhTIjsgLyooSW50MzJBcnJheS5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIEFzc3VtZSBDb2RlIDM5IGNvZGVzIGVtcGxveSBhIGNoZWNrIGRpZ2l0LiBEb2Vzbid0IG1hdHRlciB3aGF0IGl0IG1hcHMgdG87CgkgICAgICogdXNlIHtAbGluayBCb29sZWFuI1RSVUV9LgoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJBU1NVTUVfQ09ERV8zOV9DSEVDS19ESUdJVCJdID0gNl0gPSAiQVNTVU1FX0NPREVfMzlfQ0hFQ0tfRElHSVQiOyAvKihWb2lkLmNsYXNzKSovCgkgICAgLyoqCgkgICAgICogQXNzdW1lIHRoZSBiYXJjb2RlIGlzIGJlaW5nIHByb2Nlc3NlZCBhcyBhIEdTMSBiYXJjb2RlLCBhbmQgbW9kaWZ5IGJlaGF2aW9yIGFzIG5lZWRlZC4KCSAgICAgKiBGb3IgZXhhbXBsZSB0aGlzIGFmZmVjdHMgRk5DMSBoYW5kbGluZyBmb3IgQ29kZSAxMjggKGFrYSBHUzEtMTI4KS4gRG9lc24ndCBtYXR0ZXIgd2hhdCBpdCBtYXBzIHRvOwoJICAgICAqIHVzZSB7QGxpbmsgQm9vbGVhbiNUUlVFfS4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiQVNTVU1FX0dTMSJdID0gN10gPSAiQVNTVU1FX0dTMSI7IC8qKFZvaWQuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBJZiB0cnVlLCByZXR1cm4gdGhlIHN0YXJ0IGFuZCBlbmQgZGlnaXRzIGluIGEgQ29kYWJhciBiYXJjb2RlIGluc3RlYWQgb2Ygc3RyaXBwaW5nIHRoZW0uIFRoZXkKCSAgICAgKiBhcmUgYWxwaGEsIHdoZXJlYXMgdGhlIHJlc3QgYXJlIG51bWVyaWMuIEJ5IGRlZmF1bHQsIHRoZXkgYXJlIHN0cmlwcGVkLCBidXQgdGhpcyBjYXVzZXMgdGhlbQoJICAgICAqIHRvIG5vdCBiZS4gRG9lc24ndCBtYXR0ZXIgd2hhdCBpdCBtYXBzIHRvOyB1c2Uge0BsaW5rIEJvb2xlYW4jVFJVRX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIlJFVFVSTl9DT0RBQkFSX1NUQVJUX0VORCJdID0gOF0gPSAiUkVUVVJOX0NPREFCQVJfU1RBUlRfRU5EIjsgLyooVm9pZC5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIFRoZSBjYWxsZXIgbmVlZHMgdG8gYmUgbm90aWZpZWQgdmlhIGNhbGxiYWNrIHdoZW4gYSBwb3NzaWJsZSB7QGxpbmsgUmVzdWx0UG9pbnR9CgkgICAgICogaXMgZm91bmQuIE1hcHMgdG8gYSB7QGxpbmsgUmVzdWx0UG9pbnRDYWxsYmFja30uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIk5FRURfUkVTVUxUX1BPSU5UX0NBTExCQUNLIl0gPSA5XSA9ICJORUVEX1JFU1VMVF9QT0lOVF9DQUxMQkFDSyI7IC8qKFJlc3VsdFBvaW50Q2FsbGJhY2suY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBBbGxvd2VkIGV4dGVuc2lvbiBsZW5ndGhzIGZvciBFQU4gb3IgVVBDIGJhcmNvZGVzLiBPdGhlciBmb3JtYXRzIHdpbGwgaWdub3JlIHRoaXMuCgkgICAgICogTWFwcyB0byBhbiB7QGNvZGUgSW50MzJBcnJheX0gb2YgdGhlIGFsbG93ZWQgZXh0ZW5zaW9uIGxlbmd0aHMsIGZvciBleGFtcGxlIFsyXSwgWzVdLCBvciBbMiwgNV0uCgkgICAgICogSWYgaXQgaXMgb3B0aW9uYWwgdG8gaGF2ZSBhbiBleHRlbnNpb24sIGRvIG5vdCBzZXQgdGhpcyBoaW50LiBJZiB0aGlzIGlzIHNldCwKCSAgICAgKiBhbmQgYSBVUEMgb3IgRUFOIGJhcmNvZGUgaXMgZm91bmQgYnV0IGFuIGV4dGVuc2lvbiBpcyBub3QsIHRoZW4gbm8gcmVzdWx0IHdpbGwgYmUgcmV0dXJuZWQKCSAgICAgKiBhdCBhbGwuCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIkFMTE9XRURfRUFOX0VYVEVOU0lPTlMiXSA9IDEwXSA9ICJBTExPV0VEX0VBTl9FWFRFTlNJT05TIjsgLyooSW50MzJBcnJheS5jbGFzcykqLwoJICAgIC8vIEVuZCBvZiBlbnVtZXJhdGlvbiB2YWx1ZXMuCgkgICAgLyoqCgkgICAgICogRGF0YSB0eXBlIHRoZSBoaW50IGlzIGV4cGVjdGluZy4KCSAgICAgKiBBbW9uZyB0aGUgcG9zc2libGUgdmFsdWVzIHRoZSB7QGxpbmsgVm9pZH0gc3RhbmRzIG91dCBhcyBiZWluZyB1c2VkIGZvcgoJICAgICAqIGhpbnRzIHRoYXQgZG8gbm90IGV4cGVjdCBhIHZhbHVlIHRvIGJlIHN1cHBsaWVkIChmbGFnIGhpbnRzKS4gU3VjaCBoaW50cwoJICAgICAqIHdpbGwgcG9zc2libHkgaGF2ZSB0aGVpciB2YWx1ZSBpZ25vcmVkLCBvciByZXBsYWNlZCBieSBhCgkgICAgICoge0BsaW5rIEJvb2xlYW4jVFJVRX0uIEhpbnQgc3VwcGxpZXJzIHNob3VsZCBwcm9iYWJseSB1c2UKCSAgICAgKiB7QGxpbmsgQm9vbGVhbiNUUlVFfSBhcyBkaXJlY3RlZCBieSB0aGUgYWN0dWFsIGhpbnQgZG9jdW1lbnRhdGlvbi4KCSAgICAgKi8KCSAgICAvLyBwcml2YXRlIHZhbHVlVHlwZTogQ2xhc3M8Pz4KCSAgICAvLyBEZWNvZGVIaW50VHlwZSh2YWx1ZVR5cGU6IENsYXNzPD8+KSB7CgkgICAgLy8gICB0aGlzLnZhbHVlVHlwZSA9IHZhbHVlVHlwZQoJICAgIC8vIH0KCSAgICAvLyBwdWJsaWMgZ2V0VmFsdWVUeXBlKCk6IENsYXNzPD8+IHsKCSAgICAvLyAgIHJldHVybiB2YWx1ZVR5cGUKCSAgICAvLyB9Cgl9KShEZWNvZGVIaW50VHlwZSB8fCAoRGVjb2RlSGludFR5cGUgPSB7fSkpOwoJRGVjb2RlSGludFR5cGUkMS5kZWZhdWx0ID0gRGVjb2RlSGludFR5cGU7CgoJdmFyIENoYXJhY3RlclNldEVDSSA9IHt9OwoKCXZhciBGb3JtYXRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZiA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShGb3JtYXRFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDcgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgRm9ybWF0RXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyRmKEZvcm1hdEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBGb3JtYXRFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgRm9ybWF0RXhjZXB0aW9uLmdldEZvcm1hdEluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEZvcm1hdEV4Y2VwdGlvbigpOwoJICAgIH07CgkgICAgRm9ybWF0RXhjZXB0aW9uLmtpbmQgPSAnRm9ybWF0RXhjZXB0aW9uJzsKCSAgICByZXR1cm4gRm9ybWF0RXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQ3LmRlZmF1bHQpKTsKCUZvcm1hdEV4Y2VwdGlvbiQxLmRlZmF1bHQgPSBGb3JtYXRFeGNlcHRpb247CgoJKGZ1bmN0aW9uIChleHBvcnRzKSB7CgkvKgoJICogQ29weXJpZ2h0IDIwMDggWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCWV4cG9ydHMuQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycyA9IHZvaWQgMDsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xID0gRm9ybWF0RXhjZXB0aW9uJDE7CgkvKmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsqLwoJLyppbXBvcnQgamF2YS51dGlsLk1hcDsqLwoJdmFyIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnM7CgkoZnVuY3Rpb24gKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMpIHsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkNwNDM3Il0gPSAwXSA9ICJDcDQzNyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEiXSA9IDFdID0gIklTTzg4NTlfMSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzIiXSA9IDJdID0gIklTTzg4NTlfMiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzMiXSA9IDNdID0gIklTTzg4NTlfMyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzQiXSA9IDRdID0gIklTTzg4NTlfNCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzUiXSA9IDVdID0gIklTTzg4NTlfNSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzYiXSA9IDZdID0gIklTTzg4NTlfNiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzciXSA9IDddID0gIklTTzg4NTlfNyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzgiXSA9IDhdID0gIklTTzg4NTlfOCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzkiXSA9IDldID0gIklTTzg4NTlfOSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEwIl0gPSAxMF0gPSAiSVNPODg1OV8xMCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzExIl0gPSAxMV0gPSAiSVNPODg1OV8xMSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEzIl0gPSAxMl0gPSAiSVNPODg1OV8xMyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE0Il0gPSAxM10gPSAiSVNPODg1OV8xNCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE1Il0gPSAxNF0gPSAiSVNPODg1OV8xNSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE2Il0gPSAxNV0gPSAiSVNPODg1OV8xNiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJTSklTIl0gPSAxNl0gPSAiU0pJUyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJDcDEyNTAiXSA9IDE3XSA9ICJDcDEyNTAiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siQ3AxMjUxIl0gPSAxOF0gPSAiQ3AxMjUxIjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkNwMTI1MiJdID0gMTldID0gIkNwMTI1MiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJDcDEyNTYiXSA9IDIwXSA9ICJDcDEyNTYiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siVW5pY29kZUJpZ1VubWFya2VkIl0gPSAyMV0gPSAiVW5pY29kZUJpZ1VubWFya2VkIjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIlVURjgiXSA9IDIyXSA9ICJVVEY4IjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkFTQ0lJIl0gPSAyM10gPSAiQVNDSUkiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siQmlnNSJdID0gMjRdID0gIkJpZzUiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siR0IxODAzMCJdID0gMjVdID0gIkdCMTgwMzAiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siRVVDX0tSIl0gPSAyNl0gPSAiRVVDX0tSIjsKCX0pKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMgPSBleHBvcnRzLkNoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMgfHwgKGV4cG9ydHMuQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycyA9IHt9KSk7CgkvKioKCSAqIEVuY2Fwc3VsYXRlcyBhIENoYXJhY3RlciBTZXQgRUNJLCBhY2NvcmRpbmcgdG8gIkV4dGVuZGVkIENoYW5uZWwgSW50ZXJwcmV0YXRpb25zIiA1LjMuMS4xCgkgKiBvZiBJU08gMTgwMDQuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIENoYXJhY3RlclNldEVDSSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBDaGFyYWN0ZXJTZXRFQ0kodmFsdWVJZGVudGlmaWVyLCB2YWx1ZXNQYXJhbSwgbmFtZSkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIG90aGVyRW5jb2RpbmdOYW1lcyA9IFtdOwoJICAgICAgICBmb3IgKHZhciBfaSA9IDM7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewoJICAgICAgICAgICAgb3RoZXJFbmNvZGluZ05hbWVzW19pIC0gM10gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMudmFsdWVJZGVudGlmaWVyID0gdmFsdWVJZGVudGlmaWVyOwoJICAgICAgICB0aGlzLm5hbWUgPSBuYW1lOwoJICAgICAgICBpZiAodHlwZW9mIHZhbHVlc1BhcmFtID09PSAnbnVtYmVyJykgewoJICAgICAgICAgICAgdGhpcy52YWx1ZXMgPSBJbnQzMkFycmF5LmZyb20oW3ZhbHVlc1BhcmFtXSk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICB0aGlzLnZhbHVlcyA9IHZhbHVlc1BhcmFtOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMub3RoZXJFbmNvZGluZ05hbWVzID0gb3RoZXJFbmNvZGluZ05hbWVzOwoJICAgICAgICBDaGFyYWN0ZXJTZXRFQ0kuVkFMVUVfSURFTlRJRklFUl9UT19FQ0kuc2V0KHZhbHVlSWRlbnRpZmllciwgdGhpcyk7CgkgICAgICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSS5zZXQobmFtZSwgdGhpcyk7CgkgICAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLnZhbHVlczsKCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gdmFsdWVzLmxlbmd0aDsgaSAhPT0gbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgdmFyIHYgPSB2YWx1ZXNbaV07CgkgICAgICAgICAgICBDaGFyYWN0ZXJTZXRFQ0kuVkFMVUVTX1RPX0VDSS5zZXQodiwgdGhpcyk7CgkgICAgICAgIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIG90aGVyRW5jb2RpbmdOYW1lc18xID0gX192YWx1ZXMob3RoZXJFbmNvZGluZ05hbWVzKSwgb3RoZXJFbmNvZGluZ05hbWVzXzFfMSA9IG90aGVyRW5jb2RpbmdOYW1lc18xLm5leHQoKTsgIW90aGVyRW5jb2RpbmdOYW1lc18xXzEuZG9uZTsgb3RoZXJFbmNvZGluZ05hbWVzXzFfMSA9IG90aGVyRW5jb2RpbmdOYW1lc18xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgIHZhciBvdGhlck5hbWUgPSBvdGhlckVuY29kaW5nTmFtZXNfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSS5zZXQob3RoZXJOYW1lLCB0aGlzKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKG90aGVyRW5jb2RpbmdOYW1lc18xXzEgJiYgIW90aGVyRW5jb2RpbmdOYW1lc18xXzEuZG9uZSAmJiAoX2EgPSBvdGhlckVuY29kaW5nTmFtZXNfMS5yZXR1cm4pKSBfYS5jYWxsKG90aGVyRW5jb2RpbmdOYW1lc18xKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgIH0KCSAgICAvLyBDaGFyYWN0ZXJTZXRFQ0kodmFsdWU6IG51bWJlciAvKmludCovKSB7CgkgICAgLy8gICB0aGlzKG5ldyBJbnQzMkFycmF5IHt2YWx1ZX0pCgkgICAgLy8gfQoJICAgIC8vIENoYXJhY3RlclNldEVDSSh2YWx1ZTogbnVtYmVyIC8qaW50Ki8sIFN0cmluZy4uLiBvdGhlckVuY29kaW5nTmFtZXMpIHsKCSAgICAvLyAgIHRoaXMudmFsdWVzID0gbmV3IEludDMyQXJyYXkge3ZhbHVlfQoJICAgIC8vICAgdGhpcy5vdGhlckVuY29kaW5nTmFtZXMgPSBvdGhlckVuY29kaW5nTmFtZXMKCSAgICAvLyB9CgkgICAgLy8gQ2hhcmFjdGVyU2V0RUNJKHZhbHVlczogSW50MzJBcnJheSwgU3RyaW5nLi4uIG90aGVyRW5jb2RpbmdOYW1lcykgewoJICAgIC8vICAgdGhpcy52YWx1ZXMgPSB2YWx1ZXMKCSAgICAvLyAgIHRoaXMub3RoZXJFbmNvZGluZ05hbWVzID0gb3RoZXJFbmNvZGluZ05hbWVzCgkgICAgLy8gfQoJICAgIENoYXJhY3RlclNldEVDSS5wcm90b3R5cGUuZ2V0VmFsdWVJZGVudGlmaWVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZUlkZW50aWZpZXI7CgkgICAgfTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kucHJvdG90eXBlLmdldE5hbWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm5hbWU7CgkgICAgfTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZXNbMF07CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gdmFsdWUgY2hhcmFjdGVyIHNldCBFQ0kgdmFsdWUKCSAgICAgKiBAcmV0dXJuIHtAY29kZSBDaGFyYWN0ZXJTZXRFQ0l9IHJlcHJlc2VudGluZyBFQ0kgb2YgZ2l2ZW4gdmFsdWUsIG9yIG51bGwgaWYgaXQgaXMgbGVnYWwgYnV0CgkgICAgICogICB1bnN1cHBvcnRlZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIEVDSSB2YWx1ZSBpcyBpbnZhbGlkCgkgICAgICovCgkgICAgQ2hhcmFjdGVyU2V0RUNJLmdldENoYXJhY3RlclNldEVDSUJ5VmFsdWUgPSBmdW5jdGlvbiAodmFsdWUgLyppbnQqLykgewoJICAgICAgICBpZiAodmFsdWUgPCAwIHx8IHZhbHVlID49IDkwMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoJ2luY29yZWN0IHZhbHVlJyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGNoYXJhY3RlclNldCA9IENoYXJhY3RlclNldEVDSS5WQUxVRVNfVE9fRUNJLmdldCh2YWx1ZSk7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGNoYXJhY3RlclNldCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoJ2luY29yZWN0IHZhbHVlJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGNoYXJhY3RlclNldDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBuYW1lIGNoYXJhY3RlciBzZXQgRUNJIGVuY29kaW5nIG5hbWUKCSAgICAgKiBAcmV0dXJuIENoYXJhY3RlclNldEVDSSByZXByZXNlbnRpbmcgRUNJIGZvciBjaGFyYWN0ZXIgZW5jb2RpbmcsIG9yIG51bGwgaWYgaXQgaXMgbGVnYWwKCSAgICAgKiAgIGJ1dCB1bnN1cHBvcnRlZAoJICAgICAqLwoJICAgIENoYXJhY3RlclNldEVDSS5nZXRDaGFyYWN0ZXJTZXRFQ0lCeU5hbWUgPSBmdW5jdGlvbiAobmFtZSkgewoJICAgICAgICB2YXIgY2hhcmFjdGVyU2V0ID0gQ2hhcmFjdGVyU2V0RUNJLk5BTUVfVE9fRUNJLmdldChuYW1lKTsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gY2hhcmFjdGVyU2V0KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgnaW5jb3JlY3QgdmFsdWUnKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gY2hhcmFjdGVyU2V0OwoJICAgIH07CgkgICAgQ2hhcmFjdGVyU2V0RUNJLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICBpZiAoIShvIGluc3RhbmNlb2YgQ2hhcmFjdGVyU2V0RUNJKSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLmdldE5hbWUoKSA9PT0gb3RoZXIuZ2V0TmFtZSgpOwoJICAgIH07CgkgICAgQ2hhcmFjdGVyU2V0RUNJLlZBTFVFX0lERU5USUZJRVJfVE9fRUNJID0gbmV3IE1hcCgpOwoJICAgIENoYXJhY3RlclNldEVDSS5WQUxVRVNfVE9fRUNJID0gbmV3IE1hcCgpOwoJICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSSA9IG5ldyBNYXAoKTsKCSAgICAvLyBFbnVtIG5hbWUgaXMgYSBKYXZhIGVuY29kaW5nIHZhbGlkIGZvciBqYXZhLmxhbmcgYW5kIGphdmEuaW8KCSAgICAvLyBUWVBFU0NSSVBUUE9SVDogY2hhbmdlZCB0aGUgbWFpbiBsYWJlbCBmb3IgSVNPIGFzIHRoZSBUZXh0RW5jb2RlciBkaWQgbm90IHJlY29nbml6ZWQgdGhlbSBpbiB0aGUgZm9ybSBmcm9tIGphdmEKCSAgICAvLyAoZWcgSVNPODg1OV8xIG11c3QgYmUgSVNPODg1OTEgb3IgSVNPODg1OS0xIG9yIElTTy04ODU5LTEpCgkgICAgLy8gbGF0ZXIgb246IHdlbGwsIGV4Y2VwdCAxNiB3aWNoIGRvZXMgbm90IHdvcmsgd2l0aCBJU084ODU5MTYgc28gdXNlZCBJU08tODg1OS0xIGZvcm0gZm9yIGRlZmF1bHQKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuQ3A0MzcgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQ3A0MzcsIEludDMyQXJyYXkuZnJvbShbMCwgMl0pLCAnQ3A0MzcnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMSwgSW50MzJBcnJheS5mcm9tKFsxLCAzXSksICdJU08tODg1OS0xJywgJ0lTTzg4NTkxJywgJ0lTTzg4NTlfMScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzIgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8yLCA0LCAnSVNPLTg4NTktMicsICdJU084ODU5MicsICdJU084ODU5XzInKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8zID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMywgNSwgJ0lTTy04ODU5LTMnLCAnSVNPODg1OTMnLCAnSVNPODg1OV8zJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfNCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzQsIDYsICdJU08tODg1OS00JywgJ0lTTzg4NTk0JywgJ0lTTzg4NTlfNCcpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV81LCA3LCAnSVNPLTg4NTktNScsICdJU084ODU5NScsICdJU084ODU5XzUnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV82ID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfNiwgOCwgJ0lTTy04ODU5LTYnLCAnSVNPODg1OTYnLCAnSVNPODg1OV82Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfNyA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzcsIDksICdJU08tODg1OS03JywgJ0lTTzg4NTk3JywgJ0lTTzg4NTlfNycpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzggPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV84LCAxMCwgJ0lTTy04ODU5LTgnLCAnSVNPODg1OTgnLCAnSVNPODg1OV84Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfOSA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzksIDExLCAnSVNPLTg4NTktOScsICdJU084ODU5OScsICdJU084ODU5XzknKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xMCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzEwLCAxMiwgJ0lTTy04ODU5LTEwJywgJ0lTTzg4NTkxMCcsICdJU084ODU5XzEwJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfMTEgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8xMSwgMTMsICdJU08tODg1OS0xMScsICdJU084ODU5MTEnLCAnSVNPODg1OV8xMScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzEzID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMTMsIDE1LCAnSVNPLTg4NTktMTMnLCAnSVNPODg1OTEzJywgJ0lTTzg4NTlfMTMnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xNCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzE0LCAxNiwgJ0lTTy04ODU5LTE0JywgJ0lTTzg4NTkxNCcsICdJU084ODU5XzE0Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfMTUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8xNSwgMTcsICdJU08tODg1OS0xNScsICdJU084ODU5MTUnLCAnSVNPODg1OV8xNScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzE2ID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMTYsIDE4LCAnSVNPLTg4NTktMTYnLCAnSVNPODg1OTE2JywgJ0lTTzg4NTlfMTYnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuU0pJUyA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5TSklTLCAyMCwgJ1NKSVMnLCAnU2hpZnRfSklTJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkNwMTI1MCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5DcDEyNTAsIDIxLCAnQ3AxMjUwJywgJ3dpbmRvd3MtMTI1MCcpOwoJICAgIENoYXJhY3RlclNldEVDSS5DcDEyNTEgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQ3AxMjUxLCAyMiwgJ0NwMTI1MScsICd3aW5kb3dzLTEyNTEnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuQ3AxMjUyID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLkNwMTI1MiwgMjMsICdDcDEyNTInLCAnd2luZG93cy0xMjUyJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkNwMTI1NiA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5DcDEyNTYsIDI0LCAnQ3AxMjU2JywgJ3dpbmRvd3MtMTI1NicpOwoJICAgIENoYXJhY3RlclNldEVDSS5Vbmljb2RlQmlnVW5tYXJrZWQgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuVW5pY29kZUJpZ1VubWFya2VkLCAyNSwgJ1VuaWNvZGVCaWdVbm1hcmtlZCcsICdVVEYtMTZCRScsICdVbmljb2RlQmlnJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLlVURjggPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuVVRGOCwgMjYsICdVVEY4JywgJ1VURi04Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkFTQ0lJID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLkFTQ0lJLCBJbnQzMkFycmF5LmZyb20oWzI3LCAxNzBdKSwgJ0FTQ0lJJywgJ1VTLUFTQ0lJJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkJpZzUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQmlnNSwgMjgsICdCaWc1Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkdCMTgwMzAgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuR0IxODAzMCwgMjksICdHQjE4MDMwJywgJ0dCMjMxMicsICdFVUNfQ04nLCAnR0JLJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkVVQ19LUiA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5FVUNfS1IsIDMwLCAnRVVDX0tSJywgJ0VVQy1LUicpOwoJICAgIHJldHVybiBDaGFyYWN0ZXJTZXRFQ0k7Cgl9KCkpOwoJZXhwb3J0cy5kZWZhdWx0ID0gQ2hhcmFjdGVyU2V0RUNJOwoKCX0oQ2hhcmFjdGVyU2V0RUNJKSk7CgoJdmFyIFN0cmluZ0VuY29kaW5nJDEgPSB7fTsKCgl2YXIgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNiA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZShVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbi5raW5kID0gJ1Vuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDYuZGVmYXVsdCkpOwoJVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24kMS5kZWZhdWx0ID0gVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb247CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZ0VuY29kaW5nJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbl8xJDEgPSBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiQxOwoJdmFyIENoYXJhY3RlclNldEVDSV8xJDIgPSBDaGFyYWN0ZXJTZXRFQ0k7CgkvKioKCSAqIFJlc3BvbnNpYmxlIGZvciBlbi9kZWNvZGluZyBzdHJpbmdzLgoJICovCgl2YXIgU3RyaW5nRW5jb2RpbmcgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nRW5jb2RpbmcoKSB7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIERlY29kZXMgc29tZSBVaW50OEFycmF5IHRvIGEgc3RyaW5nIGZvcm1hdC4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5kZWNvZGUgPSBmdW5jdGlvbiAoYnl0ZXMsIGVuY29kaW5nKSB7CgkgICAgICAgIHZhciBlbmNvZGluZ05hbWUgPSB0aGlzLmVuY29kaW5nTmFtZShlbmNvZGluZyk7CgkgICAgICAgIGlmICh0aGlzLmN1c3RvbURlY29kZXIpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmN1c3RvbURlY29kZXIoYnl0ZXMsIGVuY29kaW5nTmFtZSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gSW5jcmVhc2VzIGJyb3dzZXIgc3VwcG9ydC4KCSAgICAgICAgaWYgKHR5cGVvZiBUZXh0RGVjb2RlciA9PT0gJ3VuZGVmaW5lZCcgfHwgdGhpcy5zaG91bGREZWNvZGVPbkZhbGxiYWNrKGVuY29kaW5nTmFtZSkpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUZhbGxiYWNrKGJ5dGVzLCBlbmNvZGluZ05hbWUpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgVGV4dERlY29kZXIoZW5jb2RpbmdOYW1lKS5kZWNvZGUoYnl0ZXMpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ2hlY2tzIGlmIHRoZSBkZWNvZGluZyBtZXRob2Qgc2hvdWxkIHVzZSB0aGUgZmFsbGJhY2sgZm9yIGRlY29kaW5nCgkgICAgICogb25jZSBOb2RlIFRleHREZWNvZGVyIGRvZXNuJ3Qgc3VwcG9ydCBhbGwgZW5jb2RpbmcgZm9ybWF0cy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBlbmNvZGluZ05hbWUKCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5zaG91bGREZWNvZGVPbkZhbGxiYWNrID0gZnVuY3Rpb24gKGVuY29kaW5nTmFtZSkgewoJICAgICAgICByZXR1cm4gIVN0cmluZ0VuY29kaW5nLmlzQnJvd3NlcigpICYmIGVuY29kaW5nTmFtZSA9PT0gJ0lTTy04ODU5LTEnOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRW5jb2RlcyBzb21lIHN0cmluZyBpbnRvIGEgVWludDhBcnJheS4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5lbmNvZGUgPSBmdW5jdGlvbiAocywgZW5jb2RpbmcpIHsKCSAgICAgICAgdmFyIGVuY29kaW5nTmFtZSA9IHRoaXMuZW5jb2RpbmdOYW1lKGVuY29kaW5nKTsKCSAgICAgICAgaWYgKHRoaXMuY3VzdG9tRW5jb2RlcikgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VzdG9tRW5jb2RlcihzLCBlbmNvZGluZ05hbWUpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEluY3JlYXNlcyBicm93c2VyIHN1cHBvcnQuCgkgICAgICAgIGlmICh0eXBlb2YgVGV4dEVuY29kZXIgPT09ICd1bmRlZmluZWQnKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5lbmNvZGVGYWxsYmFjayhzKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBUZXh0RW5jb2RlciBvbmx5IGVuY29kZXMgdG8gVVRGOCBieSBkZWZhdWx0IGFzIHNwZWNpZmllZCBieSBlbmNvZGluZy5zcGVjLndoYXR3Zy5vcmcKCSAgICAgICAgcmV0dXJuIG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShzKTsKCSAgICB9OwoJICAgIFN0cmluZ0VuY29kaW5nLmlzQnJvd3NlciA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB7fS50b1N0cmluZy5jYWxsKHdpbmRvdykgPT09ICdbb2JqZWN0IFdpbmRvd10nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIHN0cmluZyB2YWx1ZSBmcm9tIHNvbWUgZW5jb2RpbmcgY2hhcmFjdGVyIHNldC4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5lbmNvZGluZ05hbWUgPSBmdW5jdGlvbiAoZW5jb2RpbmcpIHsKCSAgICAgICAgcmV0dXJuIHR5cGVvZiBlbmNvZGluZyA9PT0gJ3N0cmluZycKCSAgICAgICAgICAgID8gZW5jb2RpbmcKCSAgICAgICAgICAgIDogZW5jb2RpbmcuZ2V0TmFtZSgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV0dXJucyBjaGFyYWN0ZXIgc2V0IGZyb20gc29tZSBlbmNvZGluZyBjaGFyYWN0ZXIgc2V0LgoJICAgICAqLwoJICAgIFN0cmluZ0VuY29kaW5nLmVuY29kaW5nQ2hhcmFjdGVyU2V0ID0gZnVuY3Rpb24gKGVuY29kaW5nKSB7CgkgICAgICAgIGlmIChlbmNvZGluZyBpbnN0YW5jZW9mIENoYXJhY3RlclNldEVDSV8xJDIuZGVmYXVsdCkgewoJICAgICAgICAgICAgcmV0dXJuIGVuY29kaW5nOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuZ2V0Q2hhcmFjdGVyU2V0RUNJQnlOYW1lKGVuY29kaW5nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJ1bnMgYSBmYWxsYmFjayBmb3IgdGhlIG5hdGl2ZSBkZWNvZGluZyBmdW5jaW9uLgoJICAgICAqLwoJICAgIFN0cmluZ0VuY29kaW5nLmRlY29kZUZhbGxiYWNrID0gZnVuY3Rpb24gKGJ5dGVzLCBlbmNvZGluZykgewoJICAgICAgICB2YXIgY2hhcmFjdGVyU2V0ID0gdGhpcy5lbmNvZGluZ0NoYXJhY3RlclNldChlbmNvZGluZyk7CgkgICAgICAgIGlmIChTdHJpbmdFbmNvZGluZy5pc0RlY29kZUZhbGxiYWNrU3VwcG9ydGVkKGNoYXJhY3RlclNldCkpIHsKCSAgICAgICAgICAgIHZhciBzID0gJyc7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoXzEgPSBieXRlcy5sZW5ndGg7IGkgPCBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGggPSBieXRlc1tpXS50b1N0cmluZygxNik7CgkgICAgICAgICAgICAgICAgaWYgKGgubGVuZ3RoIDwgMikgewoJICAgICAgICAgICAgICAgICAgICBoID0gJzAnICsgaDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcyArPSAnJScgKyBoOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChzKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuVW5pY29kZUJpZ1VubWFya2VkKSkgewoJICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgbmV3IFVpbnQxNkFycmF5KGJ5dGVzLmJ1ZmZlcikpOwoJICAgICAgICB9CgkgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgiRW5jb2RpbmcgIiArIHRoaXMuZW5jb2RpbmdOYW1lKGVuY29kaW5nKSArICIgbm90IHN1cHBvcnRlZCBieSBmYWxsYmFjay4iKTsKCSAgICB9OwoJICAgIFN0cmluZ0VuY29kaW5nLmlzRGVjb2RlRmFsbGJhY2tTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoY2hhcmFjdGVyU2V0KSB7CgkgICAgICAgIHJldHVybiBjaGFyYWN0ZXJTZXQuZXF1YWxzKENoYXJhY3RlclNldEVDSV8xJDIuZGVmYXVsdC5VVEY4KSB8fAoJICAgICAgICAgICAgY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuSVNPODg1OV8xKSB8fAoJICAgICAgICAgICAgY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuQVNDSUkpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUnVucyBhIGZhbGxiYWNrIGZvciB0aGUgbmF0aXZlIGVuY29kaW5nIGZ1bmNpb24uCgkgICAgICoKCSAgICAgKiBAc2VlIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xNzE5Mjg0NS80MzY3NjgzCgkgICAgICovCgkgICAgU3RyaW5nRW5jb2RpbmcuZW5jb2RlRmFsbGJhY2sgPSBmdW5jdGlvbiAocykgewoJICAgICAgICB2YXIgZW5jb2RlZFVSSXN0cmluZyA9IGJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHMpKSk7CgkgICAgICAgIHZhciBjaGFyTGlzdCA9IGVuY29kZWRVUklzdHJpbmcuc3BsaXQoJycpOwoJICAgICAgICB2YXIgdWludEFycmF5ID0gW107CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhckxpc3QubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHVpbnRBcnJheS5wdXNoKGNoYXJMaXN0W2ldLmNoYXJDb2RlQXQoMCkpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSh1aW50QXJyYXkpOwoJICAgIH07CgkgICAgcmV0dXJuIFN0cmluZ0VuY29kaW5nOwoJfSgpKTsKCVN0cmluZ0VuY29kaW5nJDEuZGVmYXVsdCA9IFN0cmluZ0VuY29kaW5nOwoKCS8qCgkgKiBDb3B5cmlnaHQgKEMpIDIwMTAgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZ1V0aWxzJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS5uaW8uY2hhcnNldC5DaGFyc2V0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgl2YXIgRGVjb2RlSGludFR5cGVfMSQzID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBDaGFyYWN0ZXJTZXRFQ0lfMSQxID0gQ2hhcmFjdGVyU2V0RUNJOwoJdmFyIFN0cmluZ0VuY29kaW5nXzEkMSA9IFN0cmluZ0VuY29kaW5nJDE7CgkvKioKCSAqIENvbW1vbiBzdHJpbmctcmVsYXRlZCBmdW5jdGlvbnMuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBhdXRob3IgQWxleCBEdXByZQoJICovCgl2YXIgU3RyaW5nVXRpbHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nVXRpbHMoKSB7CgkgICAgfQoJICAgIC8vIFNISUZUX0pJUy5lcXVhbHNJZ25vcmVDYXNlKFBMQVRGT1JNX0RFRkFVTFRfRU5DT0RJTkcpIHx8CgkgICAgLy8gRVVDX0pQLmVxdWFsc0lnbm9yZUNhc2UoUExBVEZPUk1fREVGQVVMVF9FTkNPRElORyk7CgkgICAgU3RyaW5nVXRpbHMuY2FzdEFzTm9uVXRmOENoYXIgPSBmdW5jdGlvbiAoY29kZSwgZW5jb2RpbmcpIHsKCSAgICAgICAgaWYgKGVuY29kaW5nID09PSB2b2lkIDApIHsgZW5jb2RpbmcgPSBudWxsOyB9CgkgICAgICAgIC8vIElTTyA4ODU5LTEgaXMgdGhlIEphdmEgZGVmYXVsdCBhcyBVVEYtOCBpcyBKYXZhU2NyaXB0cwoJICAgICAgICAvLyB5b3UgY2FuIHNlZSB0aGlzIG1ldGhvZCBhcyBhIEphdmEgdmVyc2lvbiBvZiBTdHJpbmcuZnJvbUNoYXJDb2RlCgkgICAgICAgIHZhciBlID0gZW5jb2RpbmcgPyBlbmNvZGluZy5nZXROYW1lKCkgOiB0aGlzLklTTzg4NTkxOwoJICAgICAgICAvLyB1c2UgcGFzc2VkIGZvcm1hdCAoZnJvbUNoYXJDb2RlIHdpbGwgcmV0dXJuIFVURjggZW5jb2RpbmcpCgkgICAgICAgIHJldHVybiBTdHJpbmdFbmNvZGluZ18xJDEuZGVmYXVsdC5kZWNvZGUobmV3IFVpbnQ4QXJyYXkoW2NvZGVdKSwgZSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYnl0ZXMgYnl0ZXMgZW5jb2RpbmcgYSBzdHJpbmcsIHdob3NlIGVuY29kaW5nIHNob3VsZCBiZSBndWVzc2VkCgkgICAgICogQHBhcmFtIGhpbnRzIGRlY29kZSBoaW50cyBpZiBhcHBsaWNhYmxlCgkgICAgICogQHJldHVybiBuYW1lIG9mIGd1ZXNzZWQgZW5jb2Rpbmc7IGF0IHRoZSBtb21lbnQgd2lsbCBvbmx5IGd1ZXNzIG9uZSBvZjoKCSAgICAgKiAge0BsaW5rICNTSElGVF9KSVN9LCB7QGxpbmsgI1VURjh9LCB7QGxpbmsgI0lTTzg4NTkxfSwgb3IgdGhlIHBsYXRmb3JtCgkgICAgICogIGRlZmF1bHQgZW5jb2RpbmcgaWYgbm9uZSBvZiB0aGVzZSBjYW4gcG9zc2libHkgYmUgY29ycmVjdAoJICAgICAqLwoJICAgIFN0cmluZ1V0aWxzLmd1ZXNzRW5jb2RpbmcgPSBmdW5jdGlvbiAoYnl0ZXMsIGhpbnRzKSB7CgkgICAgICAgIGlmIChoaW50cyAhPT0gbnVsbCAmJiBoaW50cyAhPT0gdW5kZWZpbmVkICYmIHVuZGVmaW5lZCAhPT0gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEkMy5kZWZhdWx0LkNIQVJBQ1RFUl9TRVQpKSB7CgkgICAgICAgICAgICByZXR1cm4gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEkMy5kZWZhdWx0LkNIQVJBQ1RFUl9TRVQpLnRvU3RyaW5nKCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRm9yIG5vdywgbWVyZWx5IHRyaWVzIHRvIGRpc3Rpbmd1aXNoIElTTy04ODU5LTEsIFVURi04IGFuZCBTaGlmdF9KSVMsCgkgICAgICAgIC8vIHdoaWNoIHNob3VsZCBiZSBieSBmYXIgdGhlIG1vc3QgY29tbW9uIGVuY29kaW5ncy4KCSAgICAgICAgdmFyIGxlbmd0aCA9IGJ5dGVzLmxlbmd0aDsKCSAgICAgICAgdmFyIGNhbkJlSVNPODg1OTEgPSB0cnVlOwoJICAgICAgICB2YXIgY2FuQmVTaGlmdEpJUyA9IHRydWU7CgkgICAgICAgIHZhciBjYW5CZVVURjggPSB0cnVlOwoJICAgICAgICB2YXIgdXRmOEJ5dGVzTGVmdCA9IDA7CgkgICAgICAgIC8vIGludCB1dGY4TG93Q2hhcnMgPSAwCgkgICAgICAgIHZhciB1dGYyQnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciB1dGYzQnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciB1dGY0Qnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciBzamlzQnl0ZXNMZWZ0ID0gMDsKCSAgICAgICAgLy8gaW50IHNqaXNMb3dDaGFycyA9IDAKCSAgICAgICAgdmFyIHNqaXNLYXRha2FuYUNoYXJzID0gMDsKCSAgICAgICAgLy8gaW50IHNqaXNEb3VibGVCeXRlc0NoYXJzID0gMAoJICAgICAgICB2YXIgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgIHZhciBzamlzQ3VyRG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gMDsKCSAgICAgICAgdmFyIHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPSAwOwoJICAgICAgICB2YXIgc2ppc01heERvdWJsZUJ5dGVzV29yZExlbmd0aCA9IDA7CgkgICAgICAgIC8vIGludCBpc29Mb3dDaGFycyA9IDAKCSAgICAgICAgLy8gaW50IGlzb0hpZ2hDaGFycyA9IDAKCSAgICAgICAgdmFyIGlzb0hpZ2hPdGhlciA9IDA7CgkgICAgICAgIHZhciB1dGY4Ym9tID0gYnl0ZXMubGVuZ3RoID4gMyAmJgoJICAgICAgICAgICAgYnl0ZXNbMF0gPT09IC8qKGJ5dGUpICovIDB4RUYgJiYKCSAgICAgICAgICAgIGJ5dGVzWzFdID09PSAvKihieXRlKSAqLyAweEJCICYmCgkgICAgICAgICAgICBieXRlc1syXSA9PT0gLyooYnl0ZSkgKi8gMHhCRjsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGggJiYgKGNhbkJlSVNPODg1OTEgfHwgY2FuQmVTaGlmdEpJUyB8fCBjYW5CZVVURjgpOyBpKyspIHsKCSAgICAgICAgICAgIHZhciB2YWx1ZSA9IGJ5dGVzW2ldICYgMHhGRjsKCSAgICAgICAgICAgIC8vIFVURi04IHN0dWZmCgkgICAgICAgICAgICBpZiAoY2FuQmVVVEY4KSB7CgkgICAgICAgICAgICAgICAgaWYgKHV0ZjhCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDgwKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgY2FuQmVVVEY4ID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0LS07CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAoKHZhbHVlICYgMHg4MCkgIT09IDApIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKCh2YWx1ZSAmIDB4NDApID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBjYW5CZVVURjggPSBmYWxzZTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjhCeXRlc0xlZnQrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDIwKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjJCeXRlc0NoYXJzKys7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh2YWx1ZSAmIDB4MTApID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjNCeXRlc0NoYXJzKys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDA4KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRmNEJ5dGVzQ2hhcnMrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbkJlVVRGOCA9IGZhbHNlOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfSAvLyBlbHNlIHsKCSAgICAgICAgICAgICAgICAvLyB1dGY4TG93Q2hhcnMrKwoJICAgICAgICAgICAgICAgIC8vIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIElTTy04ODU5LTEgc3R1ZmYKCSAgICAgICAgICAgIGlmIChjYW5CZUlTTzg4NTkxKSB7CgkgICAgICAgICAgICAgICAgaWYgKHZhbHVlID4gMHg3RiAmJiB2YWx1ZSA8IDB4QTApIHsKCSAgICAgICAgICAgICAgICAgICAgY2FuQmVJU084ODU5MSA9IGZhbHNlOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSA+IDB4OUYpIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlIDwgMHhDMCB8fCB2YWx1ZSA9PT0gMHhENyB8fCB2YWx1ZSA9PT0gMHhGNykgewoJICAgICAgICAgICAgICAgICAgICAgICAgaXNvSGlnaE90aGVyKys7CgkgICAgICAgICAgICAgICAgICAgIH0gLy8gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIGlzb0hpZ2hDaGFycysrCgkgICAgICAgICAgICAgICAgICAgIC8vIH0KCSAgICAgICAgICAgICAgICB9IC8vIGVsc2UgewoJICAgICAgICAgICAgICAgIC8vIGlzb0xvd0NoYXJzKysKCSAgICAgICAgICAgICAgICAvLyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBTaGlmdF9KSVMgc3R1ZmYKCSAgICAgICAgICAgIGlmIChjYW5CZVNoaWZ0SklTKSB7CgkgICAgICAgICAgICAgICAgaWYgKHNqaXNCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA8IDB4NDAgfHwgdmFsdWUgPT09IDB4N0YgfHwgdmFsdWUgPiAweEZDKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBjYW5CZVNoaWZ0SklTID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBzamlzQnl0ZXNMZWZ0LS07CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPT09IDB4ODAgfHwgdmFsdWUgPT09IDB4QTAgfHwgdmFsdWUgPiAweEVGKSB7CgkgICAgICAgICAgICAgICAgICAgIGNhbkJlU2hpZnRKSVMgPSBmYWxzZTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPiAweEEwICYmIHZhbHVlIDwgMHhFMCkgewoJICAgICAgICAgICAgICAgICAgICBzamlzS2F0YWthbmFDaGFycysrOwoJICAgICAgICAgICAgICAgICAgICBzamlzQ3VyRG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gMDsKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCsrOwoJICAgICAgICAgICAgICAgICAgICBpZiAoc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA+IHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGgpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPSBzamlzQ3VyS2F0YWthbmFXb3JkTGVuZ3RoOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgaWYgKHZhbHVlID4gMHg3RikgewoJICAgICAgICAgICAgICAgICAgICBzamlzQnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgIC8vIHNqaXNEb3VibGVCeXRlc0NoYXJzKysKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgICAgICAgICAgICAgIHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGgrKzsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGggPiBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gc2ppc0N1ckRvdWJsZUJ5dGVzV29yZExlbmd0aDsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gc2ppc0xvd0NoYXJzKysKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgICAgICAgICAgICAgIHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGggPSAwOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBpZiAoY2FuQmVVVEY4ICYmIHV0ZjhCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICBjYW5CZVVURjggPSBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY2FuQmVTaGlmdEpJUyAmJiBzamlzQnl0ZXNMZWZ0ID4gMCkgewoJICAgICAgICAgICAgY2FuQmVTaGlmdEpJUyA9IGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIEVhc3kgLS0gaWYgdGhlcmUgaXMgQk9NIG9yIGF0IGxlYXN0IDEgdmFsaWQgbm90LXNpbmdsZSBieXRlIGNoYXJhY3RlciAoYW5kIG5vIGV2aWRlbmNlIGl0IGNhbid0IGJlIFVURi04KSwgZG9uZQoJICAgICAgICBpZiAoY2FuQmVVVEY4ICYmICh1dGY4Ym9tIHx8IHV0ZjJCeXRlc0NoYXJzICsgdXRmM0J5dGVzQ2hhcnMgKyB1dGY0Qnl0ZXNDaGFycyA+IDApKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuVVRGODsKCSAgICAgICAgfQoJICAgICAgICAvLyBFYXN5IC0tIGlmIGFzc3VtaW5nIFNoaWZ0X0pJUyBvciBhdCBsZWFzdCAzIHZhbGlkIGNvbnNlY3V0aXZlIG5vdC1hc2NpaSBjaGFyYWN0ZXJzIChhbmQgbm8gZXZpZGVuY2UgaXQgY2FuJ3QgYmUpLCBkb25lCgkgICAgICAgIGlmIChjYW5CZVNoaWZ0SklTICYmIChTdHJpbmdVdGlscy5BU1NVTUVfU0hJRlRfSklTIHx8IHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPj0gMyB8fCBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoID49IDMpKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuU0hJRlRfSklTOwoJICAgICAgICB9CgkgICAgICAgIC8vIERpc3Rpbmd1aXNoaW5nIFNoaWZ0X0pJUyBhbmQgSVNPLTg4NTktMSBjYW4gYmUgYSBsaXR0bGUgdG91Z2ggZm9yIHNob3J0IHdvcmRzLiBUaGUgY3J1ZGUgaGV1cmlzdGljIGlzOgoJICAgICAgICAvLyAtIElmIHdlIHNhdwoJICAgICAgICAvLyAgIC0gb25seSB0d28gY29uc2VjdXRpdmUga2F0YWthbmEgY2hhcnMgaW4gdGhlIHdob2xlIHRleHQsIG9yCgkgICAgICAgIC8vICAgLSBhdCBsZWFzdCAxMCUgb2YgYnl0ZXMgdGhhdCBjb3VsZCBiZSAidXBwZXIiIG5vdC1hbHBoYW51bWVyaWMgTGF0aW4xLAoJICAgICAgICAvLyAtIHRoZW4gd2UgY29uY2x1ZGUgU2hpZnRfSklTLCBlbHNlIElTTy04ODU5LTEKCSAgICAgICAgaWYgKGNhbkJlSVNPODg1OTEgJiYgY2FuQmVTaGlmdEpJUykgewoJICAgICAgICAgICAgcmV0dXJuIChzamlzTWF4S2F0YWthbmFXb3JkTGVuZ3RoID09PSAyICYmIHNqaXNLYXRha2FuYUNoYXJzID09PSAyKSB8fCBpc29IaWdoT3RoZXIgKiAxMCA+PSBsZW5ndGgKCSAgICAgICAgICAgICAgICA/IFN0cmluZ1V0aWxzLlNISUZUX0pJUyA6IFN0cmluZ1V0aWxzLklTTzg4NTkxOwoJICAgICAgICB9CgkgICAgICAgIC8vIE90aGVyd2lzZSwgdHJ5IGluIG9yZGVyIElTTy04ODU5LTEsIFNoaWZ0IEpJUywgVVRGLTggYW5kIGZhbGwgYmFjayB0byBkZWZhdWx0IHBsYXRmb3JtIGVuY29kaW5nCgkgICAgICAgIGlmIChjYW5CZUlTTzg4NTkxKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuSVNPODg1OTE7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNhbkJlU2hpZnRKSVMpIHsKCSAgICAgICAgICAgIHJldHVybiBTdHJpbmdVdGlscy5TSElGVF9KSVM7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNhbkJlVVRGOCkgewoJICAgICAgICAgICAgcmV0dXJuIFN0cmluZ1V0aWxzLlVURjg7CgkgICAgICAgIH0KCSAgICAgICAgLy8gT3RoZXJ3aXNlLCB3ZSB0YWtlIGEgd2lsZCBndWVzcyB3aXRoIHBsYXRmb3JtIGVuY29kaW5nCgkgICAgICAgIHJldHVybiBTdHJpbmdVdGlscy5QTEFURk9STV9ERUZBVUxUX0VOQ09ESU5HOwoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKiBAc2VlIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xMzQzOTcxMS80MzY3NjgzCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYXBwZW5kIFRoZSBuZXcgc3RyaW5nIHRvIGFwcGVuZC4KCSAgICAgKiBAcGFyYW0gYXJncyBBcmd1bWV0cyB2YWx1ZXMgdG8gYmUgZm9ybWF0ZWQuCgkgICAgICovCgkgICAgU3RyaW5nVXRpbHMuZm9ybWF0ID0gZnVuY3Rpb24gKGFwcGVuZCkgewoJICAgICAgICB2YXIgYXJncyA9IFtdOwoJICAgICAgICBmb3IgKHZhciBfaSA9IDE7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewoJICAgICAgICAgICAgYXJnc1tfaSAtIDFdID0gYXJndW1lbnRzW19pXTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgaSA9IC0xOwoJICAgICAgICBmdW5jdGlvbiBjYWxsYmFjayhleHAsIHAwLCBwMSwgcDIsIHAzLCBwNCkgewoJICAgICAgICAgICAgaWYgKGV4cCA9PT0gJyUlJykKCSAgICAgICAgICAgICAgICByZXR1cm4gJyUnOwoJICAgICAgICAgICAgaWYgKGFyZ3NbKytpXSA9PT0gdW5kZWZpbmVkKQoJICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CgkgICAgICAgICAgICBleHAgPSBwMiA/IHBhcnNlSW50KHAyLnN1YnN0cigxKSkgOiB1bmRlZmluZWQ7CgkgICAgICAgICAgICB2YXIgYmFzZSA9IHAzID8gcGFyc2VJbnQocDMuc3Vic3RyKDEpKSA6IHVuZGVmaW5lZDsKCSAgICAgICAgICAgIHZhciB2YWw7CgkgICAgICAgICAgICBzd2l0Y2ggKHA0KSB7CgkgICAgICAgICAgICAgICAgY2FzZSAncyc6CgkgICAgICAgICAgICAgICAgICAgIHZhbCA9IGFyZ3NbaV07CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ2MnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBhcmdzW2ldWzBdOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlICdmJzoKCSAgICAgICAgICAgICAgICAgICAgdmFsID0gcGFyc2VGbG9hdChhcmdzW2ldKS50b0ZpeGVkKGV4cCk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ3AnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBwYXJzZUZsb2F0KGFyZ3NbaV0pLnRvUHJlY2lzaW9uKGV4cCk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ2UnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBwYXJzZUZsb2F0KGFyZ3NbaV0pLnRvRXhwb25lbnRpYWwoZXhwKTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAneCc6CgkgICAgICAgICAgICAgICAgICAgIHZhbCA9IHBhcnNlSW50KGFyZ3NbaV0pLnRvU3RyaW5nKGJhc2UgPyBiYXNlIDogMTYpOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlICdkJzoKCSAgICAgICAgICAgICAgICAgICAgdmFsID0gcGFyc2VGbG9hdChwYXJzZUludChhcmdzW2ldLCBiYXNlID8gYmFzZSA6IDEwKS50b1ByZWNpc2lvbihleHApKS50b0ZpeGVkKDApOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhbCA9IHR5cGVvZiB2YWwgPT09ICdvYmplY3QnID8gSlNPTi5zdHJpbmdpZnkodmFsKSA6ICgrdmFsKS50b1N0cmluZyhiYXNlKTsKCSAgICAgICAgICAgIHZhciBzaXplID0gcGFyc2VJbnQocDEpOyAvKiBwYWRkaW5nIHNpemUgKi8KCSAgICAgICAgICAgIHZhciBjaCA9IHAxICYmIChwMVswXSArICcnKSA9PT0gJzAnID8gJzAnIDogJyAnOyAvKiBpc251bGw/ICovCgkgICAgICAgICAgICB3aGlsZSAodmFsLmxlbmd0aCA8IHNpemUpCgkgICAgICAgICAgICAgICAgdmFsID0gcDAgIT09IHVuZGVmaW5lZCA/IHZhbCArIGNoIDogY2ggKyB2YWw7IC8qIGlzbWludXM/ICovCgkgICAgICAgICAgICByZXR1cm4gdmFsOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZWdleCA9IC8lKC0pPygwP1swLTldKyk/KFsuXVswLTldKyk/KFsjXVswLTldKyk/KFtzY2ZwZXhkJV0pL2c7CgkgICAgICAgIHJldHVybiBhcHBlbmQucmVwbGFjZShyZWdleCwgY2FsbGJhY2spOwoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKi8KCSAgICBTdHJpbmdVdGlscy5nZXRCeXRlcyA9IGZ1bmN0aW9uIChzdHIsIGVuY29kaW5nKSB7CgkgICAgICAgIHJldHVybiBTdHJpbmdFbmNvZGluZ18xJDEuZGVmYXVsdC5lbmNvZGUoc3RyLCBlbmNvZGluZyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIHRoZSBjaGFyY29kZSBhdCB0aGUgc3BlY2lmaWVkIGluZGV4IG9yIGF0IGluZGV4IHplcm8uCgkgICAgICovCgkgICAgU3RyaW5nVXRpbHMuZ2V0Q2hhckNvZGUgPSBmdW5jdGlvbiAoc3RyLCBpbmRleCkgewoJICAgICAgICBpZiAoaW5kZXggPT09IHZvaWQgMCkgeyBpbmRleCA9IDA7IH0KCSAgICAgICAgcmV0dXJuIHN0ci5jaGFyQ29kZUF0KGluZGV4KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgY2hhciBmb3IgZ2l2ZW4gY2hhcmNvZGUKCSAgICAgKi8KCSAgICBTdHJpbmdVdGlscy5nZXRDaGFyQXQgPSBmdW5jdGlvbiAoY2hhckNvZGUpIHsKCSAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoY2hhckNvZGUpOwoJICAgIH07CgkgICAgU3RyaW5nVXRpbHMuU0hJRlRfSklTID0gQ2hhcmFjdGVyU2V0RUNJXzEkMS5kZWZhdWx0LlNKSVMuZ2V0TmFtZSgpOyAvLyAiU0pJUyIKCSAgICBTdHJpbmdVdGlscy5HQjIzMTIgPSAnR0IyMzEyJzsKCSAgICBTdHJpbmdVdGlscy5JU084ODU5MSA9IENoYXJhY3RlclNldEVDSV8xJDEuZGVmYXVsdC5JU084ODU5XzEuZ2V0TmFtZSgpOyAvLyAiSVNPODg1OV8xIgoJICAgIFN0cmluZ1V0aWxzLkVVQ19KUCA9ICdFVUNfSlAnOwoJICAgIFN0cmluZ1V0aWxzLlVURjggPSBDaGFyYWN0ZXJTZXRFQ0lfMSQxLmRlZmF1bHQuVVRGOC5nZXROYW1lKCk7IC8vICJVVEY4IgoJICAgIFN0cmluZ1V0aWxzLlBMQVRGT1JNX0RFRkFVTFRfRU5DT0RJTkcgPSBTdHJpbmdVdGlscy5VVEY4OyAvLyAiVVRGOCIvL0NoYXJzZXQuZGVmYXVsdENoYXJzZXQoKS5uYW1lKCkKCSAgICBTdHJpbmdVdGlscy5BU1NVTUVfU0hJRlRfSklTID0gZmFsc2U7CgkgICAgcmV0dXJuIFN0cmluZ1V0aWxzOwoJfSgpKTsKCVN0cmluZ1V0aWxzJDEuZGVmYXVsdCA9IFN0cmluZ1V0aWxzOwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHJpbmdCdWlsZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBTdHJpbmdVdGlsc18xJDEgPSBTdHJpbmdVdGlscyQxOwoJdmFyIFN0cmluZ0J1aWxkZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nQnVpbGRlcih2YWx1ZSkgewoJICAgICAgICBpZiAodmFsdWUgPT09IHZvaWQgMCkgeyB2YWx1ZSA9ICcnOyB9CgkgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKCSAgICB9CgkgICAgU3RyaW5nQnVpbGRlci5wcm90b3R5cGUuZW5hYmxlRGVjb2RpbmcgPSBmdW5jdGlvbiAoZW5jb2RpbmcpIHsKCSAgICAgICAgdGhpcy5lbmNvZGluZyA9IGVuY29kaW5nOwoJICAgICAgICByZXR1cm4gdGhpczsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmFwcGVuZCA9IGZ1bmN0aW9uIChzKSB7CgkgICAgICAgIGlmICh0eXBlb2YgcyA9PT0gJ3N0cmluZycpIHsKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gcy50b1N0cmluZygpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgaWYgKHRoaXMuZW5jb2RpbmcpIHsKCSAgICAgICAgICAgIC8vIHVzZSBwYXNzZWQgZm9ybWF0IChmcm9tQ2hhckNvZGUgd2lsbCByZXR1cm4gVVRGOCBlbmNvZGluZykKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gU3RyaW5nVXRpbHNfMSQxLmRlZmF1bHQuY2FzdEFzTm9uVXRmOENoYXIocywgdGhpcy5lbmNvZGluZyk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAvLyBjb3JyZWN0bHkgY29udmVydHMgZnJvbSBVVEYtOCwgYnV0IG5vdCBvdGhlciBlbmNvZGluZ3MKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShzKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpczsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmFwcGVuZENoYXJzID0gZnVuY3Rpb24gKHN0ciwgb2Zmc2V0LCBsZW4pIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IG9mZnNldDsgb2Zmc2V0IDwgb2Zmc2V0ICsgbGVuOyBpKyspIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kKHN0cltpXSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXM7CgkgICAgfTsKCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5sZW5ndGggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLmxlbmd0aDsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmNoYXJBdCA9IGZ1bmN0aW9uIChuKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLmNoYXJBdChuKTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmRlbGV0ZUNoYXJBdCA9IGZ1bmN0aW9uIChuKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIHRoaXMudmFsdWUuc3Vic3RyaW5nKG4gKyAxKTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLnNldENoYXJBdCA9IGZ1bmN0aW9uIChuLCBjKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIGMgKyB0aGlzLnZhbHVlLnN1YnN0cihuICsgMSk7CgkgICAgfTsKCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5zdWJzdHJpbmcgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZS5zdWJzdHJpbmcoc3RhcnQsIGVuZCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAbm90ZSBoZWxwZXIgbWV0aG9kIGZvciBSU1MgRXhwYW5kZWQKCSAgICAgKi8KCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5zZXRMZW5ndGhUb1plcm8gPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSAnJzsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmluc2VydCA9IGZ1bmN0aW9uIChuLCBjKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIGMgKyB0aGlzLnZhbHVlLnN1YnN0cihuICsgYy5sZW5ndGgpOwoJICAgIH07CgkgICAgcmV0dXJuIFN0cmluZ0J1aWxkZXI7Cgl9KCkpOwoJU3RyaW5nQnVpbGRlciQxLmRlZmF1bHQgPSBTdHJpbmdCdWlsZGVyOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQml0TWF0cml4JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5czsqLwoJdmFyIEJpdEFycmF5XzEkMSA9IEJpdEFycmF5JDE7Cgl2YXIgU3lzdGVtXzEkMyA9IFN5c3RlbSQxOwoJdmFyIEFycmF5c18xID0gQXJyYXlzJDE7Cgl2YXIgU3RyaW5nQnVpbGRlcl8xJDIgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNyA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5SZXByZXNlbnRzIGEgMkQgbWF0cml4IG9mIGJpdHMuIEluIGZ1bmN0aW9uIGFyZ3VtZW50cyBiZWxvdywgYW5kIHRocm91Z2hvdXQgdGhlIGNvbW1vbgoJICogbW9kdWxlLCB4IGlzIHRoZSBjb2x1bW4gcG9zaXRpb24sIGFuZCB5IGlzIHRoZSByb3cgcG9zaXRpb24uIFRoZSBvcmRlcmluZyBpcyBhbHdheXMgeCwgeS4KCSAqIFRoZSBvcmlnaW4gaXMgYXQgdGhlIHRvcC1sZWZ0LjwvcD4KCSAqCgkgKiA8cD5JbnRlcm5hbGx5IHRoZSBiaXRzIGFyZSByZXByZXNlbnRlZCBpbiBhIDEtRCBhcnJheSBvZiAzMi1iaXQgaW50cy4gSG93ZXZlciwgZWFjaCByb3cgYmVnaW5zCgkgKiB3aXRoIGEgbmV3IGludC4gVGhpcyBpcyBkb25lIGludGVudGlvbmFsbHkgc28gdGhhdCB3ZSBjYW4gY29weSBvdXQgYSByb3cgaW50byBhIEJpdEFycmF5IHZlcnkKCSAqIGVmZmljaWVudGx5LjwvcD4KCSAqCgkgKiA8cD5UaGUgb3JkZXJpbmcgb2YgYml0cyBpcyByb3ctbWFqb3IuIFdpdGhpbiBlYWNoIGludCwgdGhlIGxlYXN0IHNpZ25pZmljYW50IGJpdHMgYXJlIHVzZWQgZmlyc3QsCgkgKiBtZWFuaW5nIHRoZXkgcmVwcmVzZW50IGxvd2VyIHggdmFsdWVzLiBUaGlzIGlzIGNvbXBhdGlibGUgd2l0aCBCaXRBcnJheSdzIGltcGxlbWVudGF0aW9uLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqLwoJdmFyIEJpdE1hdHJpeCAvKmltcGxlbWVudHMgQ2xvbmVhYmxlKi8gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQ3JlYXRlcyBhbiBlbXB0eSBzcXVhcmUge0BsaW5rIEJpdE1hdHJpeH0uCgkgICAgICoKCSAgICAgKiBAcGFyYW0gZGltZW5zaW9uIGhlaWdodCBhbmQgd2lkdGgKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IoZGltZW5zaW9uOiBudW1iZXIgLyppbnQqLykgewoJICAgIC8vICAgdGhpcyhkaW1lbnNpb24sIGRpbWVuc2lvbikKCSAgICAvLyB9CgkgICAgLyoqCgkgICAgICogQ3JlYXRlcyBhbiBlbXB0eSB7QGxpbmsgQml0TWF0cml4fS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB3aWR0aCBiaXQgbWF0cml4IHdpZHRoCgkgICAgICogQHBhcmFtIGhlaWdodCBiaXQgbWF0cml4IGhlaWdodAoJICAgICAqLwoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3Rvcih3aWR0aDogbnVtYmVyIC8qaW50Ki8sIGhlaWdodDogbnVtYmVyIC8qaW50Ki8pIHsKCSAgICAvLyAgIGlmICh3aWR0aCA8IDEgfHwgaGVpZ2h0IDwgMSkgewoJICAgIC8vICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJCb3RoIGRpbWVuc2lvbnMgbXVzdCBiZSBncmVhdGVyIHRoYW4gMCIpCgkgICAgLy8gICB9CgkgICAgLy8gICB0aGlzLndpZHRoID0gd2lkdGgKCSAgICAvLyAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0CgkgICAgLy8gICB0aGlzLnJvd1NpemUgPSAod2lkdGggKyAzMSkgLyAzMgoJICAgIC8vICAgYml0cyA9IG5ldyBpbnRbcm93U2l6ZSAqIGhlaWdodF07CgkgICAgLy8gfQoJICAgIGZ1bmN0aW9uIEJpdE1hdHJpeCh3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLywgcm93U2l6ZSAvKmludCovLCBiaXRzKSB7CgkgICAgICAgIHRoaXMud2lkdGggPSB3aWR0aDsKCSAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CgkgICAgICAgIHRoaXMucm93U2l6ZSA9IHJvd1NpemU7CgkgICAgICAgIHRoaXMuYml0cyA9IGJpdHM7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGhlaWdodCB8fCBudWxsID09PSBoZWlnaHQpIHsKCSAgICAgICAgICAgIGhlaWdodCA9IHdpZHRoOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwoJICAgICAgICBpZiAod2lkdGggPCAxIHx8IGhlaWdodCA8IDEpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ0JvdGggZGltZW5zaW9ucyBtdXN0IGJlIGdyZWF0ZXIgdGhhbiAwJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gcm93U2l6ZSB8fCBudWxsID09PSByb3dTaXplKSB7CgkgICAgICAgICAgICByb3dTaXplID0gTWF0aC5mbG9vcigod2lkdGggKyAzMSkgLyAzMik7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yb3dTaXplID0gcm93U2l6ZTsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gYml0cyB8fCBudWxsID09PSBiaXRzKSB7CgkgICAgICAgICAgICB0aGlzLmJpdHMgPSBuZXcgSW50MzJBcnJheSh0aGlzLnJvd1NpemUgKiB0aGlzLmhlaWdodCk7CgkgICAgICAgIH0KCSAgICB9CgkgICAgLyoqCgkgICAgICogSW50ZXJwcmV0cyBhIDJEIGFycmF5IG9mIGJvb2xlYW5zIGFzIGEge0BsaW5rIEJpdE1hdHJpeH0sIHdoZXJlICJ0cnVlIiBtZWFucyBhbiAib24iIGJpdC4KCSAgICAgKgoJICAgICAqIEBmdW5jdGlvbiBwYXJzZQoJICAgICAqIEBwYXJhbSBpbWFnZSBiaXRzIG9mIHRoZSBpbWFnZSwgYXMgYSByb3ctbWFqb3IgMkQgYXJyYXkuIEVsZW1lbnRzIGFyZSBhcnJheXMgcmVwcmVzZW50aW5nIHJvd3MKCSAgICAgKiBAcmV0dXJuIHtAbGluayBCaXRNYXRyaXh9IHJlcHJlc2VudGF0aW9uIG9mIGltYWdlCgkgICAgICovCgkgICAgQml0TWF0cml4LnBhcnNlRnJvbUJvb2xlYW5BcnJheSA9IGZ1bmN0aW9uIChpbWFnZSkgewoJICAgICAgICB2YXIgaGVpZ2h0ID0gaW1hZ2UubGVuZ3RoOwoJICAgICAgICB2YXIgd2lkdGggPSBpbWFnZVswXS5sZW5ndGg7CgkgICAgICAgIHZhciBiaXRzID0gbmV3IEJpdE1hdHJpeCh3aWR0aCwgaGVpZ2h0KTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewoJICAgICAgICAgICAgdmFyIGltYWdlSSA9IGltYWdlW2ldOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB3aWR0aDsgaisrKSB7CgkgICAgICAgICAgICAgICAgaWYgKGltYWdlSVtqXSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLnNldChqLCBpKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKgoJICAgICAqIEBmdW5jdGlvbiBwYXJzZQoJICAgICAqIEBwYXJhbSBzdHJpbmdSZXByZXNlbnRhdGlvbgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcKCSAgICAgKiBAcGFyYW0gdW5zZXRTdHJpbmcKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucGFyc2VGcm9tU3RyaW5nID0gZnVuY3Rpb24gKHN0cmluZ1JlcHJlc2VudGF0aW9uLCBzZXRTdHJpbmcsIHVuc2V0U3RyaW5nKSB7CgkgICAgICAgIGlmIChzdHJpbmdSZXByZXNlbnRhdGlvbiA9PT0gbnVsbCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnc3RyaW5nUmVwcmVzZW50YXRpb24gY2Fubm90IGJlIG51bGwnKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IG5ldyBBcnJheShzdHJpbmdSZXByZXNlbnRhdGlvbi5sZW5ndGgpOwoJICAgICAgICB2YXIgYml0c1BvcyA9IDA7CgkgICAgICAgIHZhciByb3dTdGFydFBvcyA9IDA7CgkgICAgICAgIHZhciByb3dMZW5ndGggPSAtMTsKCSAgICAgICAgdmFyIG5Sb3dzID0gMDsKCSAgICAgICAgdmFyIHBvcyA9IDA7CgkgICAgICAgIHdoaWxlIChwb3MgPCBzdHJpbmdSZXByZXNlbnRhdGlvbi5sZW5ndGgpIHsKCSAgICAgICAgICAgIGlmIChzdHJpbmdSZXByZXNlbnRhdGlvbi5jaGFyQXQocG9zKSA9PT0gJ1xuJyB8fAoJICAgICAgICAgICAgICAgIHN0cmluZ1JlcHJlc2VudGF0aW9uLmNoYXJBdChwb3MpID09PSAnXHInKSB7CgkgICAgICAgICAgICAgICAgaWYgKGJpdHNQb3MgPiByb3dTdGFydFBvcykgewoJICAgICAgICAgICAgICAgICAgICBpZiAocm93TGVuZ3RoID09PSAtMSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcm93TGVuZ3RoID0gYml0c1BvcyAtIHJvd1N0YXJ0UG9zOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJpdHNQb3MgLSByb3dTdGFydFBvcyAhPT0gcm93TGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdyb3cgbGVuZ3RocyBkbyBub3QgbWF0Y2gnKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICByb3dTdGFydFBvcyA9IGJpdHNQb3M7CgkgICAgICAgICAgICAgICAgICAgIG5Sb3dzKys7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHBvcysrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSBpZiAoc3RyaW5nUmVwcmVzZW50YXRpb24uc3Vic3RyaW5nKHBvcywgcG9zICsgc2V0U3RyaW5nLmxlbmd0aCkgPT09IHNldFN0cmluZykgewoJICAgICAgICAgICAgICAgIHBvcyArPSBzZXRTdHJpbmcubGVuZ3RoOwoJICAgICAgICAgICAgICAgIGJpdHNbYml0c1Bvc10gPSB0cnVlOwoJICAgICAgICAgICAgICAgIGJpdHNQb3MrKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHN0cmluZ1JlcHJlc2VudGF0aW9uLnN1YnN0cmluZyhwb3MsIHBvcyArIHVuc2V0U3RyaW5nLmxlbmd0aCkgPT09IHVuc2V0U3RyaW5nKSB7CgkgICAgICAgICAgICAgICAgcG9zICs9IHVuc2V0U3RyaW5nLmxlbmd0aDsKCSAgICAgICAgICAgICAgICBiaXRzW2JpdHNQb3NdID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgYml0c1BvcysrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnaWxsZWdhbCBjaGFyYWN0ZXIgZW5jb3VudGVyZWQ6ICcgKyBzdHJpbmdSZXByZXNlbnRhdGlvbi5zdWJzdHJpbmcocG9zKSk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gbm8gRU9MIGF0IGVuZD8KCSAgICAgICAgaWYgKGJpdHNQb3MgPiByb3dTdGFydFBvcykgewoJICAgICAgICAgICAgaWYgKHJvd0xlbmd0aCA9PT0gLTEpIHsKCSAgICAgICAgICAgICAgICByb3dMZW5ndGggPSBiaXRzUG9zIC0gcm93U3RhcnRQb3M7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIGlmIChiaXRzUG9zIC0gcm93U3RhcnRQb3MgIT09IHJvd0xlbmd0aCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ3JvdyBsZW5ndGhzIGRvIG5vdCBtYXRjaCcpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgblJvd3MrKzsKCSAgICAgICAgfQoJICAgICAgICB2YXIgbWF0cml4ID0gbmV3IEJpdE1hdHJpeChyb3dMZW5ndGgsIG5Sb3dzKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiaXRzUG9zOyBpKyspIHsKCSAgICAgICAgICAgIGlmIChiaXRzW2ldKSB7CgkgICAgICAgICAgICAgICAgbWF0cml4LnNldChNYXRoLmZsb29yKGkgJSByb3dMZW5ndGgpLCBNYXRoLmZsb29yKGkgLyByb3dMZW5ndGgpKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbWF0cml4OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+R2V0cyB0aGUgcmVxdWVzdGVkIGJpdCwgd2hlcmUgdHJ1ZSBtZWFucyBibGFjay48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0geCBUaGUgaG9yaXpvbnRhbCBjb21wb25lbnQgKGkuZS4gd2hpY2ggY29sdW1uKQoJICAgICAqIEBwYXJhbSB5IFRoZSB2ZXJ0aWNhbCBjb21wb25lbnQgKGkuZS4gd2hpY2ggcm93KQoJICAgICAqIEByZXR1cm4gdmFsdWUgb2YgZ2l2ZW4gYml0IGluIG1hdHJpeAoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKHggLyppbnQqLywgeSAvKmludCovKSB7CgkgICAgICAgIHZhciBvZmZzZXQgPSB5ICogdGhpcy5yb3dTaXplICsgTWF0aC5mbG9vcih4IC8gMzIpOwoJICAgICAgICByZXR1cm4gKCh0aGlzLmJpdHNbb2Zmc2V0XSA+Pj4gKHggJiAweDFmKSkgJiAxKSAhPT0gMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlNldHMgdGhlIGdpdmVuIGJpdCB0byB0cnVlLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB4IFRoZSBob3Jpem9udGFsIGNvbXBvbmVudCAoaS5lLiB3aGljaCBjb2x1bW4pCgkgICAgICogQHBhcmFtIHkgVGhlIHZlcnRpY2FsIGNvbXBvbmVudCAoaS5lLiB3aGljaCByb3cpCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdIHw9ICgxIDw8ICh4ICYgMHgxZikpICYgMHhGRkZGRkZGRjsKCSAgICB9OwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUudW5zZXQgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdICY9IH4oKDEgPDwgKHggJiAweDFmKSkgJiAweEZGRkZGRkZGKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkZsaXBzIHRoZSBnaXZlbiBiaXQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIHggVGhlIGhvcml6b250YWwgY29tcG9uZW50IChpLmUuIHdoaWNoIGNvbHVtbikKCSAgICAgKiBAcGFyYW0geSBUaGUgdmVydGljYWwgY29tcG9uZW50IChpLmUuIHdoaWNoIHJvdykKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmZsaXAgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdIF49ICgoMSA8PCAoeCAmIDB4MWYpKSAmIDB4RkZGRkZGRkYpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRXhjbHVzaXZlLW9yIChYT1IpOiBGbGlwIHRoZSBiaXQgaW4gdGhpcyB7QGNvZGUgQml0TWF0cml4fSBpZiB0aGUgY29ycmVzcG9uZGluZwoJICAgICAqIG1hc2sgYml0IGlzIHNldC4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBtYXNrIFhPUiBtYXNrCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS54b3IgPSBmdW5jdGlvbiAobWFzaykgewoJICAgICAgICBpZiAodGhpcy53aWR0aCAhPT0gbWFzay5nZXRXaWR0aCgpIHx8IHRoaXMuaGVpZ2h0ICE9PSBtYXNrLmdldEhlaWdodCgpCgkgICAgICAgICAgICB8fCB0aGlzLnJvd1NpemUgIT09IG1hc2suZ2V0Um93U2l6ZSgpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdpbnB1dCBtYXRyaXggZGltZW5zaW9ucyBkbyBub3QgbWF0Y2gnKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcm93QXJyYXkgPSBuZXcgQml0QXJyYXlfMSQxLmRlZmF1bHQoTWF0aC5mbG9vcih0aGlzLndpZHRoIC8gMzIpICsgMSk7CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgeSA9IDAsIGhlaWdodCA9IHRoaXMuaGVpZ2h0OyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIHZhciBvZmZzZXQgPSB5ICogcm93U2l6ZTsKCSAgICAgICAgICAgIHZhciByb3cgPSBtYXNrLmdldFJvdyh5LCByb3dBcnJheSkuZ2V0Qml0QXJyYXkoKTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgcm93U2l6ZTsgeCsrKSB7CgkgICAgICAgICAgICAgICAgYml0c1tvZmZzZXQgKyB4XSBePSByb3dbeF07CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIENsZWFycyBhbGwgYml0cyAoc2V0cyB0byBmYWxzZSkuCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIHZhciBtYXggPSBiaXRzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXg7IGkrKykgewoJICAgICAgICAgICAgYml0c1tpXSA9IDA7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlNldHMgYSBzcXVhcmUgcmVnaW9uIG9mIHRoZSBiaXQgbWF0cml4IHRvIHRydWUuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGxlZnQgVGhlIGhvcml6b250YWwgcG9zaXRpb24gdG8gYmVnaW4gYXQgKGluY2x1c2l2ZSkKCSAgICAgKiBAcGFyYW0gdG9wIFRoZSB2ZXJ0aWNhbCBwb3NpdGlvbiB0byBiZWdpbiBhdCAoaW5jbHVzaXZlKQoJICAgICAqIEBwYXJhbSB3aWR0aCBUaGUgd2lkdGggb2YgdGhlIHJlZ2lvbgoJICAgICAqIEBwYXJhbSBoZWlnaHQgVGhlIGhlaWdodCBvZiB0aGUgcmVnaW9uCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5zZXRSZWdpb24gPSBmdW5jdGlvbiAobGVmdCAvKmludCovLCB0b3AgLyppbnQqLywgd2lkdGggLyppbnQqLywgaGVpZ2h0IC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKHRvcCA8IDAgfHwgbGVmdCA8IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ0xlZnQgYW5kIHRvcCBtdXN0IGJlIG5vbm5lZ2F0aXZlJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGhlaWdodCA8IDEgfHwgd2lkdGggPCAxKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdIZWlnaHQgYW5kIHdpZHRoIG11c3QgYmUgYXQgbGVhc3QgMScpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByaWdodCA9IGxlZnQgKyB3aWR0aDsKCSAgICAgICAgdmFyIGJvdHRvbSA9IHRvcCArIGhlaWdodDsKCSAgICAgICAgaWYgKGJvdHRvbSA+IHRoaXMuaGVpZ2h0IHx8IHJpZ2h0ID4gdGhpcy53aWR0aCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnVGhlIHJlZ2lvbiBtdXN0IGZpdCBpbnNpZGUgdGhlIG1hdHJpeCcpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgeSA9IHRvcDsgeSA8IGJvdHRvbTsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb2Zmc2V0ID0geSAqIHJvd1NpemU7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gbGVmdDsgeCA8IHJpZ2h0OyB4KyspIHsKCSAgICAgICAgICAgICAgICBiaXRzW29mZnNldCArIE1hdGguZmxvb3IoeCAvIDMyKV0gfD0gKCgxIDw8ICh4ICYgMHgxZikpICYgMHhGRkZGRkZGRik7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEEgZmFzdCBtZXRob2QgdG8gcmV0cmlldmUgb25lIHJvdyBvZiBkYXRhIGZyb20gdGhlIG1hdHJpeCBhcyBhIEJpdEFycmF5LgoJICAgICAqCgkgICAgICogQHBhcmFtIHkgVGhlIHJvdyB0byByZXRyaWV2ZQoJICAgICAqIEBwYXJhbSByb3cgQW4gb3B0aW9uYWwgY2FsbGVyLWFsbG9jYXRlZCBCaXRBcnJheSwgd2lsbCBiZSBhbGxvY2F0ZWQgaWYgbnVsbCBvciB0b28gc21hbGwKCSAgICAgKiBAcmV0dXJuIFRoZSByZXN1bHRpbmcgQml0QXJyYXkgLSB0aGlzIHJlZmVyZW5jZSBzaG91bGQgYWx3YXlzIGJlIHVzZWQgZXZlbiB3aGVuIHBhc3NpbmcKCSAgICAgKiAgICAgICAgIHlvdXIgb3duIHJvdwoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0Um93ID0gZnVuY3Rpb24gKHkgLyppbnQqLywgcm93KSB7CgkgICAgICAgIGlmIChyb3cgPT09IG51bGwgfHwgcm93ID09PSB1bmRlZmluZWQgfHwgcm93LmdldFNpemUoKSA8IHRoaXMud2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBCaXRBcnJheV8xJDEuZGVmYXVsdCh0aGlzLndpZHRoKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHJvdy5jbGVhcigpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiByb3dTaXplOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHJvd1NpemU7IHgrKykgewoJICAgICAgICAgICAgcm93LnNldEJ1bGsoeCAqIDMyLCBiaXRzW29mZnNldCArIHhdKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcm93OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIHkgcm93IHRvIHNldAoJICAgICAqIEBwYXJhbSByb3cge0BsaW5rIEJpdEFycmF5fSB0byBjb3B5IGZyb20KCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLnNldFJvdyA9IGZ1bmN0aW9uICh5IC8qaW50Ki8sIHJvdykgewoJICAgICAgICBTeXN0ZW1fMSQzLmRlZmF1bHQuYXJyYXljb3B5KHJvdy5nZXRCaXRBcnJheSgpLCAwLCB0aGlzLmJpdHMsIHkgKiB0aGlzLnJvd1NpemUsIHRoaXMucm93U2l6ZSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBNb2RpZmllcyB0aGlzIHtAY29kZSBCaXRNYXRyaXh9IHRvIHJlcHJlc2VudCB0aGUgc2FtZSBidXQgcm90YXRlZCAxODAgZGVncmVlcwoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUucm90YXRlMTgwID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgd2lkdGggPSB0aGlzLmdldFdpZHRoKCk7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgdG9wUm93ID0gbmV3IEJpdEFycmF5XzEkMS5kZWZhdWx0KHdpZHRoKTsKCSAgICAgICAgdmFyIGJvdHRvbVJvdyA9IG5ldyBCaXRBcnJheV8xJDEuZGVmYXVsdCh3aWR0aCk7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IE1hdGguZmxvb3IoKGhlaWdodCArIDEpIC8gMik7IGkgPCBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICB0b3BSb3cgPSB0aGlzLmdldFJvdyhpLCB0b3BSb3cpOwoJICAgICAgICAgICAgYm90dG9tUm93ID0gdGhpcy5nZXRSb3coaGVpZ2h0IC0gMSAtIGksIGJvdHRvbVJvdyk7CgkgICAgICAgICAgICB0b3BSb3cucmV2ZXJzZSgpOwoJICAgICAgICAgICAgYm90dG9tUm93LnJldmVyc2UoKTsKCSAgICAgICAgICAgIHRoaXMuc2V0Um93KGksIGJvdHRvbVJvdyk7CgkgICAgICAgICAgICB0aGlzLnNldFJvdyhoZWlnaHQgLSAxIC0gaSwgdG9wUm93KTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICogVGhpcyBpcyB1c2VmdWwgaW4gZGV0ZWN0aW5nIHRoZSBlbmNsb3NpbmcgcmVjdGFuZ2xlIG9mIGEgJ3B1cmUnIGJhcmNvZGUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIHtAY29kZSBsZWZ0LHRvcCx3aWR0aCxoZWlnaHR9IGVuY2xvc2luZyByZWN0YW5nbGUgb2YgYWxsIDEgYml0cywgb3IgbnVsbCBpZiBpdCBpcyBhbGwgd2hpdGUKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmdldEVuY2xvc2luZ1JlY3RhbmdsZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHdpZHRoID0gdGhpcy53aWR0aDsKCSAgICAgICAgdmFyIGhlaWdodCA9IHRoaXMuaGVpZ2h0OwoJICAgICAgICB2YXIgcm93U2l6ZSA9IHRoaXMucm93U2l6ZTsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIHZhciBsZWZ0ID0gd2lkdGg7CgkgICAgICAgIHZhciB0b3AgPSBoZWlnaHQ7CgkgICAgICAgIHZhciByaWdodCA9IC0xOwoJICAgICAgICB2YXIgYm90dG9tID0gLTE7CgkgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIHgzMiA9IDA7IHgzMiA8IHJvd1NpemU7IHgzMisrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHRoZUJpdHMgPSBiaXRzW3kgKiByb3dTaXplICsgeDMyXTsKCSAgICAgICAgICAgICAgICBpZiAodGhlQml0cyAhPT0gMCkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoeSA8IHRvcCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgdG9wID0geTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBpZiAoeSA+IGJvdHRvbSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgYm90dG9tID0geTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBpZiAoeDMyICogMzIgPCBsZWZ0KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYml0ID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgoKHRoZUJpdHMgPDwgKDMxIC0gYml0KSkgJiAweEZGRkZGRkZGKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpdCsrOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh4MzIgKiAzMiArIGJpdCkgPCBsZWZ0KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdCA9IHgzMiAqIDMyICsgYml0OwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGlmICh4MzIgKiAzMiArIDMxID4gcmlnaHQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiaXQgPSAzMTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgodGhlQml0cyA+Pj4gYml0KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpdC0tOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh4MzIgKiAzMiArIGJpdCkgPiByaWdodCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0ID0geDMyICogMzIgKyBiaXQ7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHJpZ2h0IDwgbGVmdCB8fCBib3R0b20gPCB0b3ApIHsKCSAgICAgICAgICAgIHJldHVybiBudWxsOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW2xlZnQsIHRvcCwgcmlnaHQgLSBsZWZ0ICsgMSwgYm90dG9tIC0gdG9wICsgMV0pOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogVGhpcyBpcyB1c2VmdWwgaW4gZGV0ZWN0aW5nIGEgY29ybmVyIG9mIGEgJ3B1cmUnIGJhcmNvZGUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIHtAY29kZSB4LHl9IGNvb3JkaW5hdGUgb2YgdG9wLWxlZnQtbW9zdCAxIGJpdCwgb3IgbnVsbCBpZiBpdCBpcyBhbGwgd2hpdGUKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmdldFRvcExlZnRPbkJpdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJvd1NpemUgPSB0aGlzLnJvd1NpemU7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IDA7CgkgICAgICAgIHdoaWxlIChiaXRzT2Zmc2V0IDwgYml0cy5sZW5ndGggJiYgYml0c1tiaXRzT2Zmc2V0XSA9PT0gMCkgewoJICAgICAgICAgICAgYml0c09mZnNldCsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChiaXRzT2Zmc2V0ID09PSBiaXRzLmxlbmd0aCkgewoJICAgICAgICAgICAgcmV0dXJuIG51bGw7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHkgPSBiaXRzT2Zmc2V0IC8gcm93U2l6ZTsKCSAgICAgICAgdmFyIHggPSAoYml0c09mZnNldCAlIHJvd1NpemUpICogMzI7CgkgICAgICAgIHZhciB0aGVCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgdmFyIGJpdCA9IDA7CgkgICAgICAgIHdoaWxlICgoKHRoZUJpdHMgPDwgKDMxIC0gYml0KSkgJiAweEZGRkZGRkZGKSA9PT0gMCkgewoJICAgICAgICAgICAgYml0Kys7CgkgICAgICAgIH0KCSAgICAgICAgeCArPSBiaXQ7CgkgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW3gsIHldKTsKCSAgICB9OwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0Qm90dG9tUmlnaHRPbkJpdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJvd1NpemUgPSB0aGlzLnJvd1NpemU7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IGJpdHMubGVuZ3RoIC0gMTsKCSAgICAgICAgd2hpbGUgKGJpdHNPZmZzZXQgPj0gMCAmJiBiaXRzW2JpdHNPZmZzZXRdID09PSAwKSB7CgkgICAgICAgICAgICBiaXRzT2Zmc2V0LS07CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGJpdHNPZmZzZXQgPCAwKSB7CgkgICAgICAgICAgICByZXR1cm4gbnVsbDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgeSA9IE1hdGguZmxvb3IoYml0c09mZnNldCAvIHJvd1NpemUpOwoJICAgICAgICB2YXIgeCA9IE1hdGguZmxvb3IoYml0c09mZnNldCAlIHJvd1NpemUpICogMzI7CgkgICAgICAgIHZhciB0aGVCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgdmFyIGJpdCA9IDMxOwoJICAgICAgICB3aGlsZSAoKHRoZUJpdHMgPj4+IGJpdCkgPT09IDApIHsKCSAgICAgICAgICAgIGJpdC0tOwoJICAgICAgICB9CgkgICAgICAgIHggKz0gYml0OwoJICAgICAgICByZXR1cm4gSW50MzJBcnJheS5mcm9tKFt4LCB5XSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSB3aWR0aCBvZiB0aGUgbWF0cml4CgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMud2lkdGg7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSBoZWlnaHQgb2YgdGhlIG1hdHJpeAoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0SGVpZ2h0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5oZWlnaHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSByb3cgc2l6ZSBvZiB0aGUgbWF0cml4CgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5nZXRSb3dTaXplID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yb3dTaXplOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKG8pIHsKCSAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mIEJpdE1hdHJpeCkpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgb3RoZXIgPSBvOwoJICAgICAgICByZXR1cm4gdGhpcy53aWR0aCA9PT0gb3RoZXIud2lkdGggJiYgdGhpcy5oZWlnaHQgPT09IG90aGVyLmhlaWdodCAmJiB0aGlzLnJvd1NpemUgPT09IG90aGVyLnJvd1NpemUgJiYKCSAgICAgICAgICAgIEFycmF5c18xLmRlZmF1bHQuZXF1YWxzKHRoaXMuYml0cywgb3RoZXIuYml0cyk7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGhhc2ggPSB0aGlzLndpZHRoOwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgdGhpcy53aWR0aDsKCSAgICAgICAgaGFzaCA9IDMxICogaGFzaCArIHRoaXMuaGVpZ2h0OwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgdGhpcy5yb3dTaXplOwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgQXJyYXlzXzEuZGVmYXVsdC5oYXNoQ29kZSh0aGlzLmJpdHMpOwoJICAgICAgICByZXR1cm4gaGFzaDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIHVzaW5nICJYIiBmb3Igc2V0IGFuZCAiICIgZm9yIHVuc2V0IGJpdHMKCSAgICAgKi8KCSAgICAvKkBPdmVycmlkZSovCgkgICAgLy8gcHVibGljIHRvU3RyaW5nKCk6IHN0cmluZyB7CgkgICAgLy8gICByZXR1cm4gdG9TdHJpbmcoIjogIlgsICIgICIpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYSBzZXQgYml0CgkgICAgICogQHBhcmFtIHVuc2V0U3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGFuIHVuc2V0IGJpdAoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGVudGlyZSBtYXRyaXggdXRpbGl6aW5nIGdpdmVuIHN0cmluZ3MKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgdG9TdHJpbmcoc2V0U3RyaW5nOiBzdHJpbmcgPSAiWCAiLCB1bnNldFN0cmluZzogc3RyaW5nID0gIiAgIik6IHN0cmluZyB7CgkgICAgLy8gICByZXR1cm4gdGhpcy5idWlsZFRvU3RyaW5nKHNldFN0cmluZywgdW5zZXRTdHJpbmcsICJcbiIpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYSBzZXQgYml0CgkgICAgICogQHBhcmFtIHVuc2V0U3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGFuIHVuc2V0IGJpdAoJICAgICAqIEBwYXJhbSBsaW5lU2VwYXJhdG9yIG5ld2xpbmUgY2hhcmFjdGVyIGluIHN0cmluZyByZXByZXNlbnRhdGlvbgoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGVudGlyZSBtYXRyaXggdXRpbGl6aW5nIGdpdmVuIHN0cmluZ3MgYW5kIGxpbmUgc2VwYXJhdG9yCgkgICAgICogQGRlcHJlY2F0ZWQgY2FsbCB7QGxpbmsgI3RvU3RyaW5nKFN0cmluZyxTdHJpbmcpfSBvbmx5LCB3aGljaCB1c2VzIFxuIGxpbmUgc2VwYXJhdG9yIGFsd2F5cwoJICAgICAqLwoJICAgIC8vIEBEZXByZWNhdGVkCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uIChzZXRTdHJpbmcsIHVuc2V0U3RyaW5nLCBsaW5lU2VwYXJhdG9yKSB7CgkgICAgICAgIGlmIChzZXRTdHJpbmcgPT09IHZvaWQgMCkgeyBzZXRTdHJpbmcgPSAnWCAnOyB9CgkgICAgICAgIGlmICh1bnNldFN0cmluZyA9PT0gdm9pZCAwKSB7IHVuc2V0U3RyaW5nID0gJyAgJzsgfQoJICAgICAgICBpZiAobGluZVNlcGFyYXRvciA9PT0gdm9pZCAwKSB7IGxpbmVTZXBhcmF0b3IgPSAnXG4nOyB9CgkgICAgICAgIHJldHVybiB0aGlzLmJ1aWxkVG9TdHJpbmcoc2V0U3RyaW5nLCB1bnNldFN0cmluZywgbGluZVNlcGFyYXRvcik7CgkgICAgfTsKCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmJ1aWxkVG9TdHJpbmcgPSBmdW5jdGlvbiAoc2V0U3RyaW5nLCB1bnNldFN0cmluZywgbGluZVNlcGFyYXRvcikgewoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFN0cmluZ0J1aWxkZXJfMSQyLmRlZmF1bHQoKTsKCSAgICAgICAgLy8gcmVzdWx0LmFwcGVuZChsaW5lU2VwYXJhdG9yKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDAsIGhlaWdodCA9IHRoaXMuaGVpZ2h0OyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwLCB3aWR0aCA9IHRoaXMud2lkdGg7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0LmFwcGVuZCh0aGlzLmdldCh4LCB5KSA/IHNldFN0cmluZyA6IHVuc2V0U3RyaW5nKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQobGluZVNlcGFyYXRvcik7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdC50b1N0cmluZygpOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgQml0TWF0cml4KHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0LCB0aGlzLnJvd1NpemUsIHRoaXMuYml0cy5zbGljZSgpKTsKCSAgICB9OwoJICAgIHJldHVybiBCaXRNYXRyaXg7Cgl9KCkpOwoJQml0TWF0cml4JDEuZGVmYXVsdCA9IEJpdE1hdHJpeDsKCgl2YXIgTm90Rm91bmRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShOb3RGb3VuZEV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNSA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBOb3RGb3VuZEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZChOb3RGb3VuZEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBOb3RGb3VuZEV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBOb3RGb3VuZEV4Y2VwdGlvbi5nZXROb3RGb3VuZEluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCk7CgkgICAgfTsKCSAgICBOb3RGb3VuZEV4Y2VwdGlvbi5raW5kID0gJ05vdEZvdW5kRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gTm90Rm91bmRFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDUuZGVmYXVsdCkpOwoJTm90Rm91bmRFeGNlcHRpb24kMS5kZWZhdWx0ID0gTm90Rm91bmRFeGNlcHRpb247CgoJLyoKCSAqIENvcHlyaWdodCAyMDA5IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMkYyA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5jb21tb24geyovCgl2YXIgQmluYXJpemVyXzEgPSBCaW5hcml6ZXIkMTsKCXZhciBCaXRBcnJheV8xID0gQml0QXJyYXkkMTsKCXZhciBCaXRNYXRyaXhfMSQ1ID0gQml0TWF0cml4JDE7Cgl2YXIgTm90Rm91bmRFeGNlcHRpb25fMSQ2ID0gTm90Rm91bmRFeGNlcHRpb24kMTsKCS8qKgoJICogVGhpcyBCaW5hcml6ZXIgaW1wbGVtZW50YXRpb24gdXNlcyB0aGUgb2xkIFpYaW5nIGdsb2JhbCBoaXN0b2dyYW0gYXBwcm9hY2guIEl0IGlzIHN1aXRhYmxlCgkgKiBmb3IgbG93LWVuZCBtb2JpbGUgZGV2aWNlcyB3aGljaCBkb24ndCBoYXZlIGVub3VnaCBDUFUgb3IgbWVtb3J5IHRvIHVzZSBhIGxvY2FsIHRocmVzaG9sZGluZwoJICogYWxnb3JpdGhtLiBIb3dldmVyLCBiZWNhdXNlIGl0IHBpY2tzIGEgZ2xvYmFsIGJsYWNrIHBvaW50LCBpdCBjYW5ub3QgaGFuZGxlIGRpZmZpY3VsdCBzaGFkb3dzCgkgKiBhbmQgZ3JhZGllbnRzLgoJICoKCSAqIEZhc3RlciBtb2JpbGUgZGV2aWNlcyBhbmQgYWxsIGRlc2t0b3AgYXBwbGljYXRpb25zIHNob3VsZCBwcm9iYWJseSB1c2UgSHlicmlkQmluYXJpemVyIGluc3RlYWQuCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGMoR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcihzb3VyY2UpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgc291cmNlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5sdW1pbmFuY2VzID0gR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkVNUFRZOwoJICAgICAgICBfdGhpcy5idWNrZXRzID0gbmV3IEludDMyQXJyYXkoR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkxVTUlOQU5DRV9CVUNLRVRTKTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICAvLyBBcHBsaWVzIHNpbXBsZSBzaGFycGVuaW5nIHRvIHRoZSByb3cgZGF0YSB0byBpbXByb3ZlIHBlcmZvcm1hbmNlIG9mIHRoZSAxRCBSZWFkZXJzLgoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIucHJvdG90eXBlLmdldEJsYWNrUm93ID0gZnVuY3Rpb24gKHkgLyppbnQqLywgcm93KSB7CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgaWYgKHJvdyA9PT0gdW5kZWZpbmVkIHx8IHJvdyA9PT0gbnVsbCB8fCByb3cuZ2V0U2l6ZSgpIDwgd2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBCaXRBcnJheV8xLmRlZmF1bHQod2lkdGgpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgcm93LmNsZWFyKCk7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5pbml0QXJyYXlzKHdpZHRoKTsKCSAgICAgICAgdmFyIGxvY2FsTHVtaW5hbmNlcyA9IHNvdXJjZS5nZXRSb3coeSwgdGhpcy5sdW1pbmFuY2VzKTsKCSAgICAgICAgdmFyIGxvY2FsQnVja2V0cyA9IHRoaXMuYnVja2V0czsKCSAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICBsb2NhbEJ1Y2tldHNbKGxvY2FsTHVtaW5hbmNlc1t4XSAmIDB4ZmYpID4+IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfU0hJRlRdKys7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGJsYWNrUG9pbnQgPSBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuZXN0aW1hdGVCbGFja1BvaW50KGxvY2FsQnVja2V0cyk7CgkgICAgICAgIGlmICh3aWR0aCA8IDMpIHsKCSAgICAgICAgICAgIC8vIFNwZWNpYWwgY2FzZSBmb3IgdmVyeSBzbWFsbCBpbWFnZXMKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgd2lkdGg7IHgrKykgewoJICAgICAgICAgICAgICAgIGlmICgobG9jYWxMdW1pbmFuY2VzW3hdICYgMHhmZikgPCBibGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgIHJvdy5zZXQoeCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdmFyIGxlZnQgPSBsb2NhbEx1bWluYW5jZXNbMF0gJiAweGZmOwoJICAgICAgICAgICAgdmFyIGNlbnRlciA9IGxvY2FsTHVtaW5hbmNlc1sxXSAmIDB4ZmY7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMTsgeCA8IHdpZHRoIC0gMTsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHJpZ2h0ID0gbG9jYWxMdW1pbmFuY2VzW3ggKyAxXSAmIDB4ZmY7CgkgICAgICAgICAgICAgICAgLy8gQSBzaW1wbGUgLTEgNCAtMSBib3ggZmlsdGVyIHdpdGggYSB3ZWlnaHQgb2YgMi4KCSAgICAgICAgICAgICAgICBpZiAoKChjZW50ZXIgKiA0KSAtIGxlZnQgLSByaWdodCkgLyAyIDwgYmxhY2tQb2ludCkgewoJICAgICAgICAgICAgICAgICAgICByb3cuc2V0KHgpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBsZWZ0ID0gY2VudGVyOwoJICAgICAgICAgICAgICAgIGNlbnRlciA9IHJpZ2h0OwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByb3c7CgkgICAgfTsKCSAgICAvLyBEb2VzIG5vdCBzaGFycGVuIHRoZSBkYXRhLCBhcyB0aGlzIGNhbGwgaXMgaW50ZW5kZWQgdG8gb25seSBiZSB1c2VkIGJ5IDJEIFJlYWRlcnMuCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5wcm90b3R5cGUuZ2V0QmxhY2tNYXRyaXggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IHNvdXJjZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIG1hdHJpeCA9IG5ldyBCaXRNYXRyaXhfMSQ1LmRlZmF1bHQod2lkdGgsIGhlaWdodCk7CgkgICAgICAgIC8vIFF1aWNrbHkgY2FsY3VsYXRlcyB0aGUgaGlzdG9ncmFtIGJ5IHNhbXBsaW5nIGZvdXIgcm93cyBmcm9tIHRoZSBpbWFnZS4gVGhpcyBwcm92ZWQgdG8gYmUKCSAgICAgICAgLy8gbW9yZSByb2J1c3Qgb24gdGhlIGJsYWNrYm94IHRlc3RzIHRoYW4gc2FtcGxpbmcgYSBkaWFnb25hbCBhcyB3ZSB1c2VkIHRvIGRvLgoJICAgICAgICB0aGlzLmluaXRBcnJheXMod2lkdGgpOwoJICAgICAgICB2YXIgbG9jYWxCdWNrZXRzID0gdGhpcy5idWNrZXRzOwoJICAgICAgICBmb3IgKHZhciB5ID0gMTsgeSA8IDU7IHkrKykgewoJICAgICAgICAgICAgdmFyIHJvdyA9IE1hdGguZmxvb3IoKGhlaWdodCAqIHkpIC8gNSk7CgkgICAgICAgICAgICB2YXIgbG9jYWxMdW1pbmFuY2VzXzEgPSBzb3VyY2UuZ2V0Um93KHJvdywgdGhpcy5sdW1pbmFuY2VzKTsKCSAgICAgICAgICAgIHZhciByaWdodCA9IE1hdGguZmxvb3IoKHdpZHRoICogNCkgLyA1KTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSBNYXRoLmZsb29yKHdpZHRoIC8gNSk7IHggPCByaWdodDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBpeGVsID0gbG9jYWxMdW1pbmFuY2VzXzFbeF0gJiAweGZmOwoJICAgICAgICAgICAgICAgIGxvY2FsQnVja2V0c1twaXhlbCA+PiBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUXSsrOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciBibGFja1BvaW50ID0gR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLmVzdGltYXRlQmxhY2tQb2ludChsb2NhbEJ1Y2tldHMpOwoJICAgICAgICAvLyBXZSBkZWxheSByZWFkaW5nIHRoZSBlbnRpcmUgaW1hZ2UgbHVtaW5hbmNlIHVudGlsIHRoZSBibGFjayBwb2ludCBlc3RpbWF0aW9uIHN1Y2NlZWRzLgoJICAgICAgICAvLyBBbHRob3VnaCB3ZSBlbmQgdXAgcmVhZGluZyBmb3VyIHJvd3MgdHdpY2UsIGl0IGlzIGNvbnNpc3RlbnQgd2l0aCBvdXIgbW90dG8gb2YKCSAgICAgICAgLy8gImZhaWwgcXVpY2tseSIgd2hpY2ggaXMgbmVjZXNzYXJ5IGZvciBjb250aW51b3VzIHNjYW5uaW5nLgoJICAgICAgICB2YXIgbG9jYWxMdW1pbmFuY2VzID0gc291cmNlLmdldE1hdHJpeCgpOwoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb2Zmc2V0ID0geSAqIHdpZHRoOwoJICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBpeGVsID0gbG9jYWxMdW1pbmFuY2VzW29mZnNldCArIHhdICYgMHhmZjsKCSAgICAgICAgICAgICAgICBpZiAocGl4ZWwgPCBibGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgIG1hdHJpeC5zZXQoeCwgeSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBtYXRyaXg7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLnByb3RvdHlwZS5jcmVhdGVCaW5hcml6ZXIgPSBmdW5jdGlvbiAoc291cmNlKSB7CgkgICAgICAgIHJldHVybiBuZXcgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyKHNvdXJjZSk7CgkgICAgfTsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIucHJvdG90eXBlLmluaXRBcnJheXMgPSBmdW5jdGlvbiAobHVtaW5hbmNlU2l6ZSAvKmludCovKSB7CgkgICAgICAgIGlmICh0aGlzLmx1bWluYW5jZXMubGVuZ3RoIDwgbHVtaW5hbmNlU2l6ZSkgewoJICAgICAgICAgICAgdGhpcy5sdW1pbmFuY2VzID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGx1bWluYW5jZVNpemUpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBidWNrZXRzID0gdGhpcy5idWNrZXRzOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQlVDS0VUUzsgeCsrKSB7CgkgICAgICAgICAgICBidWNrZXRzW3hdID0gMDsKCSAgICAgICAgfQoJICAgIH07CgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLmVzdGltYXRlQmxhY2tQb2ludCA9IGZ1bmN0aW9uIChidWNrZXRzKSB7CgkgICAgICAgIC8vIEZpbmQgdGhlIHRhbGxlc3QgcGVhayBpbiB0aGUgaGlzdG9ncmFtLgoJICAgICAgICB2YXIgbnVtQnVja2V0cyA9IGJ1Y2tldHMubGVuZ3RoOwoJICAgICAgICB2YXIgbWF4QnVja2V0Q291bnQgPSAwOwoJICAgICAgICB2YXIgZmlyc3RQZWFrID0gMDsKCSAgICAgICAgdmFyIGZpcnN0UGVha1NpemUgPSAwOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG51bUJ1Y2tldHM7IHgrKykgewoJICAgICAgICAgICAgaWYgKGJ1Y2tldHNbeF0gPiBmaXJzdFBlYWtTaXplKSB7CgkgICAgICAgICAgICAgICAgZmlyc3RQZWFrID0geDsKCSAgICAgICAgICAgICAgICBmaXJzdFBlYWtTaXplID0gYnVja2V0c1t4XTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmIChidWNrZXRzW3hdID4gbWF4QnVja2V0Q291bnQpIHsKCSAgICAgICAgICAgICAgICBtYXhCdWNrZXRDb3VudCA9IGJ1Y2tldHNbeF07CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gRmluZCB0aGUgc2Vjb25kLXRhbGxlc3QgcGVhayB3aGljaCBpcyBzb21ld2hhdCBmYXIgZnJvbSB0aGUgdGFsbGVzdCBwZWFrLgoJICAgICAgICB2YXIgc2Vjb25kUGVhayA9IDA7CgkgICAgICAgIHZhciBzZWNvbmRQZWFrU2NvcmUgPSAwOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG51bUJ1Y2tldHM7IHgrKykgewoJICAgICAgICAgICAgdmFyIGRpc3RhbmNlVG9CaWdnZXN0ID0geCAtIGZpcnN0UGVhazsKCSAgICAgICAgICAgIC8vIEVuY291cmFnZSBtb3JlIGRpc3RhbnQgc2Vjb25kIHBlYWtzIGJ5IG11bHRpcGx5aW5nIGJ5IHNxdWFyZSBvZiBkaXN0YW5jZS4KCSAgICAgICAgICAgIHZhciBzY29yZSA9IGJ1Y2tldHNbeF0gKiBkaXN0YW5jZVRvQmlnZ2VzdCAqIGRpc3RhbmNlVG9CaWdnZXN0OwoJICAgICAgICAgICAgaWYgKHNjb3JlID4gc2Vjb25kUGVha1Njb3JlKSB7CgkgICAgICAgICAgICAgICAgc2Vjb25kUGVhayA9IHg7CgkgICAgICAgICAgICAgICAgc2Vjb25kUGVha1Njb3JlID0gc2NvcmU7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTWFrZSBzdXJlIGZpcnN0UGVhayBjb3JyZXNwb25kcyB0byB0aGUgYmxhY2sgcGVhay4KCSAgICAgICAgaWYgKGZpcnN0UGVhayA+IHNlY29uZFBlYWspIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gZmlyc3RQZWFrOwoJICAgICAgICAgICAgZmlyc3RQZWFrID0gc2Vjb25kUGVhazsKCSAgICAgICAgICAgIHNlY29uZFBlYWsgPSB0ZW1wOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHRoZXJlIGlzIHRvbyBsaXR0bGUgY29udHJhc3QgaW4gdGhlIGltYWdlIHRvIHBpY2sgYSBtZWFuaW5nZnVsIGJsYWNrIHBvaW50LCB0aHJvdyByYXRoZXIKCSAgICAgICAgLy8gdGhhbiB3YXN0ZSB0aW1lIHRyeWluZyB0byBkZWNvZGUgdGhlIGltYWdlLCBhbmQgcmlzayBmYWxzZSBwb3NpdGl2ZXMuCgkgICAgICAgIGlmIChzZWNvbmRQZWFrIC0gZmlyc3RQZWFrIDw9IG51bUJ1Y2tldHMgLyAxNikgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRmluZCBhIHZhbGxleSBiZXR3ZWVuIHRoZW0gdGhhdCBpcyBsb3cgYW5kIGNsb3NlciB0byB0aGUgd2hpdGUgcGVhay4KCSAgICAgICAgdmFyIGJlc3RWYWxsZXkgPSBzZWNvbmRQZWFrIC0gMTsKCSAgICAgICAgdmFyIGJlc3RWYWxsZXlTY29yZSA9IC0xOwoJICAgICAgICBmb3IgKHZhciB4ID0gc2Vjb25kUGVhayAtIDE7IHggPiBmaXJzdFBlYWs7IHgtLSkgewoJICAgICAgICAgICAgdmFyIGZyb21GaXJzdCA9IHggLSBmaXJzdFBlYWs7CgkgICAgICAgICAgICB2YXIgc2NvcmUgPSBmcm9tRmlyc3QgKiBmcm9tRmlyc3QgKiAoc2Vjb25kUGVhayAtIHgpICogKG1heEJ1Y2tldENvdW50IC0gYnVja2V0c1t4XSk7CgkgICAgICAgICAgICBpZiAoc2NvcmUgPiBiZXN0VmFsbGV5U2NvcmUpIHsKCSAgICAgICAgICAgICAgICBiZXN0VmFsbGV5ID0geDsKCSAgICAgICAgICAgICAgICBiZXN0VmFsbGV5U2NvcmUgPSBzY29yZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gYmVzdFZhbGxleSA8PCBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUOwoJICAgIH07CgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkxVTUlOQU5DRV9CSVRTID0gNTsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUID0gOCAtIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQklUUzsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX0JVQ0tFVFMgPSAxIDw8IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQklUUzsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuRU1QVFkgPSBVaW50OENsYW1wZWRBcnJheS5mcm9tKFswXSk7CgkgICAgcmV0dXJuIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcjsKCX0oQmluYXJpemVyXzEuZGVmYXVsdCkpOwoJR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyJDEuZGVmYXVsdCA9IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcjsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fZXh0ZW5kcyRiID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEh5YnJpZEJpbmFyaXplciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyXzEgPSBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMTsKCXZhciBCaXRNYXRyaXhfMSQ0ID0gQml0TWF0cml4JDE7CgkvKioKCSAqIFRoaXMgY2xhc3MgaW1wbGVtZW50cyBhIGxvY2FsIHRocmVzaG9sZGluZyBhbGdvcml0aG0sIHdoaWNoIHdoaWxlIHNsb3dlciB0aGFuIHRoZQoJICogR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLCBpcyBmYWlybHkgZWZmaWNpZW50IGZvciB3aGF0IGl0IGRvZXMuIEl0IGlzIGRlc2lnbmVkIGZvcgoJICogaGlnaCBmcmVxdWVuY3kgaW1hZ2VzIG9mIGJhcmNvZGVzIHdpdGggYmxhY2sgZGF0YSBvbiB3aGl0ZSBiYWNrZ3JvdW5kcy4gRm9yIHRoaXMgYXBwbGljYXRpb24sCgkgKiBpdCBkb2VzIGEgbXVjaCBiZXR0ZXIgam9iIHRoYW4gYSBnbG9iYWwgYmxhY2twb2ludCB3aXRoIHNldmVyZSBzaGFkb3dzIGFuZCBncmFkaWVudHMuCgkgKiBIb3dldmVyIGl0IHRlbmRzIHRvIHByb2R1Y2UgYXJ0aWZhY3RzIG9uIGxvd2VyIGZyZXF1ZW5jeSBpbWFnZXMgYW5kIGlzIHRoZXJlZm9yZSBub3QKCSAqIGEgZ29vZCBnZW5lcmFsIHB1cnBvc2UgYmluYXJpemVyIGZvciB1c2VzIG91dHNpZGUgWlhpbmcuCgkgKgoJICogVGhpcyBjbGFzcyBleHRlbmRzIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplciwgdXNpbmcgdGhlIG9sZGVyIGhpc3RvZ3JhbSBhcHByb2FjaCBmb3IgMUQgcmVhZGVycywKCSAqIGFuZCB0aGUgbmV3ZXIgbG9jYWwgYXBwcm9hY2ggZm9yIDJEIHJlYWRlcnMuIDFEIGRlY29kaW5nIHVzaW5nIGEgcGVyLXJvdyBoaXN0b2dyYW0gaXMgYWxyZWFkeQoJICogaW5oZXJlbnRseSBsb2NhbCwgYW5kIG9ubHkgZmFpbHMgZm9yIGhvcml6b250YWwgZ3JhZGllbnRzLiBXZSBjYW4gcmV2aXNpdCB0aGF0IHByb2JsZW0gbGF0ZXIsCgkgKiBidXQgZm9yIG5vdyBpdCB3YXMgbm90IGEgd2luIHRvIHVzZSBsb2NhbCBibG9ja3MgZm9yIDFELgoJICoKCSAqIFRoaXMgQmluYXJpemVyIGlzIHRoZSBkZWZhdWx0IGZvciB0aGUgdW5pdCB0ZXN0cyBhbmQgdGhlIHJlY29tbWVuZGVkIGNsYXNzIGZvciBsaWJyYXJ5IHVzZXJzLgoJICoKCSAqIEBhdXRob3IgZHN3aXRraW5AZ29vZ2xlLmNvbSAoRGFuaWVsIFN3aXRraW4pCgkgKi8KCXZhciBIeWJyaWRCaW5hcml6ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGIoSHlicmlkQmluYXJpemVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEh5YnJpZEJpbmFyaXplcihzb3VyY2UpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgc291cmNlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5tYXRyaXggPSBudWxsOwoJICAgICAgICByZXR1cm4gX3RoaXM7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIENhbGN1bGF0ZXMgdGhlIGZpbmFsIEJpdE1hdHJpeCBvbmNlIGZvciBhbGwgcmVxdWVzdHMuIFRoaXMgY291bGQgYmUgY2FsbGVkIG9uY2UgZnJvbSB0aGUKCSAgICAgKiBjb25zdHJ1Y3RvciBpbnN0ZWFkLCBidXQgdGhlcmUgYXJlIHNvbWUgYWR2YW50YWdlcyB0byBkb2luZyBpdCBsYXppbHksIHN1Y2ggYXMgbWFraW5nCgkgICAgICogcHJvZmlsaW5nIGVhc2llciwgYW5kIG5vdCBkb2luZyBoZWF2eSBsaWZ0aW5nIHdoZW4gY2FsbGVycyBkb24ndCBleHBlY3QgaXQuCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEh5YnJpZEJpbmFyaXplci5wcm90b3R5cGUuZ2V0QmxhY2tNYXRyaXggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLm1hdHJpeCAhPT0gbnVsbCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0cml4OwoJICAgICAgICB9CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IHNvdXJjZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgaWYgKHdpZHRoID49IEh5YnJpZEJpbmFyaXplci5NSU5JTVVNX0RJTUVOU0lPTiAmJiBoZWlnaHQgPj0gSHlicmlkQmluYXJpemVyLk1JTklNVU1fRElNRU5TSU9OKSB7CgkgICAgICAgICAgICB2YXIgbHVtaW5hbmNlcyA9IHNvdXJjZS5nZXRNYXRyaXgoKTsKCSAgICAgICAgICAgIHZhciBzdWJXaWR0aCA9IHdpZHRoID4+IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKCh3aWR0aCAmIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0spICE9PSAwKSB7CgkgICAgICAgICAgICAgICAgc3ViV2lkdGgrKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhciBzdWJIZWlnaHQgPSBoZWlnaHQgPj4gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7CgkgICAgICAgICAgICBpZiAoKGhlaWdodCAmIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0spICE9PSAwKSB7CgkgICAgICAgICAgICAgICAgc3ViSGVpZ2h0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgYmxhY2tQb2ludHMgPSBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlQmxhY2tQb2ludHMobHVtaW5hbmNlcywgc3ViV2lkdGgsIHN1YkhlaWdodCwgd2lkdGgsIGhlaWdodCk7CgkgICAgICAgICAgICB2YXIgbmV3TWF0cml4ID0gbmV3IEJpdE1hdHJpeF8xJDQuZGVmYXVsdCh3aWR0aCwgaGVpZ2h0KTsKCSAgICAgICAgICAgIEh5YnJpZEJpbmFyaXplci5jYWxjdWxhdGVUaHJlc2hvbGRGb3JCbG9jayhsdW1pbmFuY2VzLCBzdWJXaWR0aCwgc3ViSGVpZ2h0LCB3aWR0aCwgaGVpZ2h0LCBibGFja1BvaW50cywgbmV3TWF0cml4KTsKCSAgICAgICAgICAgIHRoaXMubWF0cml4ID0gbmV3TWF0cml4OwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgLy8gSWYgdGhlIGltYWdlIGlzIHRvbyBzbWFsbCwgZmFsbCBiYWNrIHRvIHRoZSBnbG9iYWwgaGlzdG9ncmFtIGFwcHJvYWNoLgoJICAgICAgICAgICAgdGhpcy5tYXRyaXggPSBfc3VwZXIucHJvdG90eXBlLmdldEJsYWNrTWF0cml4LmNhbGwodGhpcyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMubWF0cml4OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEh5YnJpZEJpbmFyaXplci5wcm90b3R5cGUuY3JlYXRlQmluYXJpemVyID0gZnVuY3Rpb24gKHNvdXJjZSkgewoJICAgICAgICByZXR1cm4gbmV3IEh5YnJpZEJpbmFyaXplcihzb3VyY2UpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRm9yIGVhY2ggYmxvY2sgaW4gdGhlIGltYWdlLCBjYWxjdWxhdGUgdGhlIGF2ZXJhZ2UgYmxhY2sgcG9pbnQgdXNpbmcgYSA1eDUgZ3JpZAoJICAgICAqIG9mIHRoZSBibG9ja3MgYXJvdW5kIGl0LiBBbHNvIGhhbmRsZXMgdGhlIGNvcm5lciBjYXNlcyAoZnJhY3Rpb25hbCBibG9ja3MgYXJlIGNvbXB1dGVkIGJhc2VkCgkgICAgICogb24gdGhlIGxhc3QgcGl4ZWxzIGluIHRoZSByb3cvY29sdW1uIHdoaWNoIGFyZSBhbHNvIHVzZWQgaW4gdGhlIHByZXZpb3VzIGJsb2NrKS4KCSAgICAgKi8KCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlVGhyZXNob2xkRm9yQmxvY2sgPSBmdW5jdGlvbiAobHVtaW5hbmNlcywgc3ViV2lkdGggLyppbnQqLywgc3ViSGVpZ2h0IC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovLCBibGFja1BvaW50cywgbWF0cml4KSB7CgkgICAgICAgIHZhciBtYXhZT2Zmc2V0ID0gaGVpZ2h0IC0gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7CgkgICAgICAgIHZhciBtYXhYT2Zmc2V0ID0gd2lkdGggLSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBzdWJIZWlnaHQ7IHkrKykgewoJICAgICAgICAgICAgdmFyIHlvZmZzZXQgPSB5IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKHlvZmZzZXQgPiBtYXhZT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgeW9mZnNldCA9IG1heFlPZmZzZXQ7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgdG9wXzEgPSBIeWJyaWRCaW5hcml6ZXIuY2FwKHksIDIsIHN1YkhlaWdodCAtIDMpOwoJICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBzdWJXaWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHhvZmZzZXQgPSB4IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgICAgIGlmICh4b2Zmc2V0ID4gbWF4WE9mZnNldCkgewoJICAgICAgICAgICAgICAgICAgICB4b2Zmc2V0ID0gbWF4WE9mZnNldDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgdmFyIGxlZnQgPSBIeWJyaWRCaW5hcml6ZXIuY2FwKHgsIDIsIHN1YldpZHRoIC0gMyk7CgkgICAgICAgICAgICAgICAgdmFyIHN1bSA9IDA7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgeiA9IC0yOyB6IDw9IDI7IHorKykgewoJICAgICAgICAgICAgICAgICAgICB2YXIgYmxhY2tSb3cgPSBibGFja1BvaW50c1t0b3BfMSArIHpdOwoJICAgICAgICAgICAgICAgICAgICBzdW0gKz0gYmxhY2tSb3dbbGVmdCAtIDJdICsgYmxhY2tSb3dbbGVmdCAtIDFdICsgYmxhY2tSb3dbbGVmdF0gKyBibGFja1Jvd1tsZWZ0ICsgMV0gKyBibGFja1Jvd1tsZWZ0ICsgMl07CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHZhciBhdmVyYWdlID0gc3VtIC8gMjU7CgkgICAgICAgICAgICAgICAgSHlicmlkQmluYXJpemVyLnRocmVzaG9sZEJsb2NrKGx1bWluYW5jZXMsIHhvZmZzZXQsIHlvZmZzZXQsIGF2ZXJhZ2UsIHdpZHRoLCBtYXRyaXgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FwID0gZnVuY3Rpb24gKHZhbHVlIC8qaW50Ki8sIG1pbiAvKmludCovLCBtYXggLyppbnQqLykgewoJICAgICAgICByZXR1cm4gdmFsdWUgPCBtaW4gPyBtaW4gOiB2YWx1ZSA+IG1heCA/IG1heCA6IHZhbHVlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQXBwbGllcyBhIHNpbmdsZSB0aHJlc2hvbGQgdG8gYSBibG9jayBvZiBwaXhlbHMuCgkgICAgICovCgkgICAgSHlicmlkQmluYXJpemVyLnRocmVzaG9sZEJsb2NrID0gZnVuY3Rpb24gKGx1bWluYW5jZXMsIHhvZmZzZXQgLyppbnQqLywgeW9mZnNldCAvKmludCovLCB0aHJlc2hvbGQgLyppbnQqLywgc3RyaWRlIC8qaW50Ki8sIG1hdHJpeCkgewoJICAgICAgICBmb3IgKHZhciB5ID0gMCwgb2Zmc2V0ID0geW9mZnNldCAqIHN0cmlkZSArIHhvZmZzZXQ7IHkgPCBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsgeSsrLCBvZmZzZXQgKz0gc3RyaWRlKSB7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFOyB4KyspIHsKCSAgICAgICAgICAgICAgICAvLyBDb21wYXJpc29uIG5lZWRzIHRvIGJlIDw9IHNvIHRoYXQgYmxhY2sgPT0gMCBwaXhlbHMgYXJlIGJsYWNrIGV2ZW4gaWYgdGhlIHRocmVzaG9sZCBpcyAwLgoJICAgICAgICAgICAgICAgIGlmICgobHVtaW5hbmNlc1tvZmZzZXQgKyB4XSAmIDB4RkYpIDw9IHRocmVzaG9sZCkgewoJICAgICAgICAgICAgICAgICAgICBtYXRyaXguc2V0KHhvZmZzZXQgKyB4LCB5b2Zmc2V0ICsgeSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDYWxjdWxhdGVzIGEgc2luZ2xlIGJsYWNrIHBvaW50IGZvciBlYWNoIGJsb2NrIG9mIHBpeGVscyBhbmQgc2F2ZXMgaXQgYXdheS4KCSAgICAgKiBTZWUgdGhlIGZvbGxvd2luZyB0aHJlYWQgZm9yIGEgZGlzY3Vzc2lvbiBvZiB0aGlzIGFsZ29yaXRobToKCSAgICAgKiAgaHR0cDovL2dyb3Vwcy5nb29nbGUuY29tL2dyb3VwL3p4aW5nL2Jyb3dzZV90aHJlYWQvdGhyZWFkL2QwNmVmYTJjMzVhN2RkYzAKCSAgICAgKi8KCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlQmxhY2tQb2ludHMgPSBmdW5jdGlvbiAobHVtaW5hbmNlcywgc3ViV2lkdGggLyppbnQqLywgc3ViSGVpZ2h0IC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHZhciBtYXhZT2Zmc2V0ID0gaGVpZ2h0IC0gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7CgkgICAgICAgIHZhciBtYXhYT2Zmc2V0ID0gd2lkdGggLSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsKCSAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOndoaXRlc3BhY2UKCSAgICAgICAgdmFyIGJsYWNrUG9pbnRzID0gbmV3IEFycmF5KHN1YkhlaWdodCk7IC8vIHN1YldpZHRoCgkgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgc3ViSGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGJsYWNrUG9pbnRzW3ldID0gbmV3IEludDMyQXJyYXkoc3ViV2lkdGgpOwoJICAgICAgICAgICAgdmFyIHlvZmZzZXQgPSB5IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKHlvZmZzZXQgPiBtYXhZT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgeW9mZnNldCA9IG1heFlPZmZzZXQ7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHN1YldpZHRoOyB4KyspIHsKCSAgICAgICAgICAgICAgICB2YXIgeG9mZnNldCA9IHggPDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7CgkgICAgICAgICAgICAgICAgaWYgKHhvZmZzZXQgPiBtYXhYT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgICAgIHhvZmZzZXQgPSBtYXhYT2Zmc2V0OwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB2YXIgc3VtID0gMDsKCSAgICAgICAgICAgICAgICB2YXIgbWluID0gMHhGRjsKCSAgICAgICAgICAgICAgICB2YXIgbWF4ID0gMDsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciB5eSA9IDAsIG9mZnNldCA9IHlvZmZzZXQgKiB3aWR0aCArIHhvZmZzZXQ7IHl5IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHl5KyssIG9mZnNldCArPSB3aWR0aCkgewoJICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB4eCA9IDA7IHh4IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHh4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwaXhlbCA9IGx1bWluYW5jZXNbb2Zmc2V0ICsgeHhdICYgMHhGRjsKCSAgICAgICAgICAgICAgICAgICAgICAgIHN1bSArPSBwaXhlbDsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0aWxsIGxvb2tpbmcgZm9yIGdvb2QgY29udHJhc3QKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwaXhlbCA8IG1pbikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbiA9IHBpeGVsOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBpeGVsID4gbWF4KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4ID0gcGl4ZWw7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgLy8gc2hvcnQtY2lyY3VpdCBtaW4vbWF4IHRlc3RzIG9uY2UgZHluYW1pYyByYW5nZSBpcyBtZXQKCSAgICAgICAgICAgICAgICAgICAgaWYgKG1heCAtIG1pbiA+IEh5YnJpZEJpbmFyaXplci5NSU5fRFlOQU1JQ19SQU5HRSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmluaXNoIHRoZSByZXN0IG9mIHRoZSByb3dzIHF1aWNrbHkKCSAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoeXkrKywgb2Zmc2V0ICs9IHdpZHRoOyB5eSA8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFOyB5eSsrLCBvZmZzZXQgKz0gd2lkdGgpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB4eCA9IDA7IHh4IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHh4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VtICs9IGx1bWluYW5jZXNbb2Zmc2V0ICsgeHhdICYgMHhGRjsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgLy8gVGhlIGRlZmF1bHQgZXN0aW1hdGUgaXMgdGhlIGF2ZXJhZ2Ugb2YgdGhlIHZhbHVlcyBpbiB0aGUgYmxvY2suCgkgICAgICAgICAgICAgICAgdmFyIGF2ZXJhZ2UgPSBzdW0gPj4gKEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSICogMik7CgkgICAgICAgICAgICAgICAgaWYgKG1heCAtIG1pbiA8PSBIeWJyaWRCaW5hcml6ZXIuTUlOX0RZTkFNSUNfUkFOR0UpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gSWYgdmFyaWF0aW9uIHdpdGhpbiB0aGUgYmxvY2sgaXMgbG93LCBhc3N1bWUgdGhpcyBpcyBhIGJsb2NrIHdpdGggb25seSBsaWdodCBvciBvbmx5CgkgICAgICAgICAgICAgICAgICAgIC8vIGRhcmsgcGl4ZWxzLiBJbiB0aGF0IGNhc2Ugd2UgZG8gbm90IHdhbnQgdG8gdXNlIHRoZSBhdmVyYWdlLCBhcyBpdCB3b3VsZCBkaXZpZGUgdGhpcwoJICAgICAgICAgICAgICAgICAgICAvLyBsb3cgY29udHJhc3QgYXJlYSBpbnRvIGJsYWNrIGFuZCB3aGl0ZSBwaXhlbHMsIGVzc2VudGlhbGx5IGNyZWF0aW5nIGRhdGEgb3V0IG9mIG5vaXNlLgoJICAgICAgICAgICAgICAgICAgICAvLwoJICAgICAgICAgICAgICAgICAgICAvLyBUaGUgZGVmYXVsdCBhc3N1bXB0aW9uIGlzIHRoYXQgdGhlIGJsb2NrIGlzIGxpZ2h0L2JhY2tncm91bmQuIFNpbmNlIG5vIGVzdGltYXRlIGZvcgoJICAgICAgICAgICAgICAgICAgICAvLyB0aGUgbGV2ZWwgb2YgZGFyayBwaXhlbHMgZXhpc3RzIGxvY2FsbHksIHVzZSBoYWxmIHRoZSBtaW4gZm9yIHRoZSBibG9jay4KCSAgICAgICAgICAgICAgICAgICAgYXZlcmFnZSA9IG1pbiAvIDI7CgkgICAgICAgICAgICAgICAgICAgIGlmICh5ID4gMCAmJiB4ID4gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29ycmVjdCB0aGUgIndoaXRlIGJhY2tncm91bmQiIGFzc3VtcHRpb24gZm9yIGJsb2NrcyB0aGF0IGhhdmUgbmVpZ2hib3JzIGJ5IGNvbXBhcmluZwoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHBpeGVscyBpbiB0aGlzIGJsb2NrIHRvIHRoZSBwcmV2aW91c2x5IGNhbGN1bGF0ZWQgYmxhY2sgcG9pbnRzLiBUaGlzIGlzIGJhc2VkIG9uCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgZmFjdCB0aGF0IGRhcmsgYmFyY29kZSBzeW1ib2xvZ3kgaXMgYWx3YXlzIHN1cnJvdW5kZWQgYnkgc29tZSBhbW91bnQgb2YgbGlnaHQKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJhY2tncm91bmQgZm9yIHdoaWNoIHJlYXNvbmFibGUgYmxhY2sgcG9pbnQgZXN0aW1hdGVzIHdlcmUgbWFkZS4gVGhlIGJwIGVzdGltYXRlZCBhdAoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGJvdW5kYXJpZXMgaXMgdXNlZCBmb3IgdGhlIGludGVyaW9yLgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIChtaW4gPCBicCkgaXMgYXJiaXRyYXJ5IGJ1dCB3b3JrcyBiZXR0ZXIgdGhhbiBvdGhlciBoZXVyaXN0aWNzIHRoYXQgd2VyZSB0cmllZC4KCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdmVyYWdlTmVpZ2hib3JCbGFja1BvaW50ID0gKGJsYWNrUG9pbnRzW3kgLSAxXVt4XSArICgyICogYmxhY2tQb2ludHNbeV1beCAtIDFdKSArIGJsYWNrUG9pbnRzW3kgLSAxXVt4IC0gMV0pIC8gNDsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtaW4gPCBhdmVyYWdlTmVpZ2hib3JCbGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZlcmFnZSA9IGF2ZXJhZ2VOZWlnaGJvckJsYWNrUG9pbnQ7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgYmxhY2tQb2ludHNbeV1beF0gPSBhdmVyYWdlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBibGFja1BvaW50czsKCSAgICB9OwoJICAgIC8vIFRoaXMgY2xhc3MgdXNlcyA1eDUgYmxvY2tzIHRvIGNvbXB1dGUgbG9jYWwgbHVtaW5hbmNlLCB3aGVyZSBlYWNoIGJsb2NrIGlzIDh4OCBwaXhlbHMuCgkgICAgLy8gU28gdGhpcyBpcyB0aGUgc21hbGxlc3QgZGltZW5zaW9uIGluIGVhY2ggYXhpcyB3ZSBjYW4gYWNjZXB0LgoJICAgIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSID0gMzsKCSAgICBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRSA9IDEgPDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7IC8vIC4uLjAxMDAuLi4wMAoJICAgIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0sgPSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRSAtIDE7IC8vIC4uLjAwMTEuLi4xMQoJICAgIEh5YnJpZEJpbmFyaXplci5NSU5JTVVNX0RJTUVOU0lPTiA9IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFICogNTsKCSAgICBIeWJyaWRCaW5hcml6ZXIuTUlOX0RZTkFNSUNfUkFOR0UgPSAyNDsKCSAgICByZXR1cm4gSHlicmlkQmluYXJpemVyOwoJfShHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXJfMS5kZWZhdWx0KSk7Cgl2YXIgX2RlZmF1bHQkMiA9IEh5YnJpZEJpbmFyaXplciQxLmRlZmF1bHQgPSBIeWJyaWRCaW5hcml6ZXI7CgoJdmFyIFJHQkx1bWluYW5jZVNvdXJjZSQxID0ge307CgoJdmFyIEludmVydGVkTHVtaW5hbmNlU291cmNlJDEgPSB7fTsKCgl2YXIgTHVtaW5hbmNlU291cmNlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEx1bWluYW5jZVNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3RyaW5nQnVpbGRlcl8xJDEgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMSA9IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uJDE7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nIHsqLwoJLyoqCgkgKiBUaGUgcHVycG9zZSBvZiB0aGlzIGNsYXNzIGhpZXJhcmNoeSBpcyB0byBhYnN0cmFjdCBkaWZmZXJlbnQgYml0bWFwIGltcGxlbWVudGF0aW9ucyBhY3Jvc3MKCSAqIHBsYXRmb3JtcyBpbnRvIGEgc3RhbmRhcmQgaW50ZXJmYWNlIGZvciByZXF1ZXN0aW5nIGdyZXlzY2FsZSBsdW1pbmFuY2UgdmFsdWVzLiBUaGUgaW50ZXJmYWNlCgkgKiBvbmx5IHByb3ZpZGVzIGltbXV0YWJsZSBtZXRob2RzOyB0aGVyZWZvcmUgY3JvcCBhbmQgcm90YXRpb24gY3JlYXRlIGNvcGllcy4gVGhpcyBpcyB0byBlbnN1cmUKCSAqIHRoYXQgb25lIFJlYWRlciBkb2VzIG5vdCBtb2RpZnkgdGhlIG9yaWdpbmFsIGx1bWluYW5jZSBzb3VyY2UgYW5kIGxlYXZlIGl0IGluIGFuIHVua25vd24gc3RhdGUKCSAqIGZvciBvdGhlciBSZWFkZXJzIGluIHRoZSBjaGFpbi4KCSAqCgkgKiBAYXV0aG9yIGRzd2l0a2luQGdvb2dsZS5jb20gKERhbmllbCBTd2l0a2luKQoJICovCgl2YXIgTHVtaW5hbmNlU291cmNlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEx1bWluYW5jZVNvdXJjZSh3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7CgkgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwoJICAgIH0KCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSB3aWR0aCBvZiB0aGUgYml0bWFwLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuZ2V0V2lkdGggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLndpZHRoOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBUaGUgaGVpZ2h0IG9mIHRoZSBiaXRtYXAuCgkgICAgICovCgkgICAgTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRIZWlnaHQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmhlaWdodDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIHN1YmNsYXNzIHN1cHBvcnRzIGNyb3BwaW5nLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNDcm9wU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIGEgbmV3IG9iamVjdCB3aXRoIGNyb3BwZWQgaW1hZ2UgZGF0YS4gSW1wbGVtZW50YXRpb25zIG1heSBrZWVwIGEgcmVmZXJlbmNlIHRvIHRoZQoJICAgICAqIG9yaWdpbmFsIGRhdGEgcmF0aGVyIHRoYW4gYSBjb3B5LiBPbmx5IGNhbGxhYmxlIGlmIGlzQ3JvcFN1cHBvcnRlZCgpIGlzIHRydWUuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gbGVmdCBUaGUgbGVmdCBjb29yZGluYXRlLCB3aGljaCBtdXN0IGJlIGluIFswLGdldFdpZHRoKCkpCgkgICAgICogQHBhcmFtIHRvcCBUaGUgdG9wIGNvb3JkaW5hdGUsIHdoaWNoIG11c3QgYmUgaW4gWzAsZ2V0SGVpZ2h0KCkpCgkgICAgICogQHBhcmFtIHdpZHRoIFRoZSB3aWR0aCBvZiB0aGUgcmVjdGFuZ2xlIHRvIGNyb3AuCgkgICAgICogQHBhcmFtIGhlaWdodCBUaGUgaGVpZ2h0IG9mIHRoZSByZWN0YW5nbGUgdG8gY3JvcC4KCSAgICAgKiBAcmV0dXJuIEEgY3JvcHBlZCB2ZXJzaW9uIG9mIHRoaXMgb2JqZWN0LgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuY3JvcCA9IGZ1bmN0aW9uIChsZWZ0IC8qaW50Ki8sIHRvcCAvKmludCovLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMS5kZWZhdWx0KCdUaGlzIGx1bWluYW5jZSBzb3VyY2UgZG9lcyBub3Qgc3VwcG9ydCBjcm9wcGluZy4nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIHN1YmNsYXNzIHN1cHBvcnRzIGNvdW50ZXItY2xvY2t3aXNlIHJvdGF0aW9uLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNSb3RhdGVTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggcm90YXRlZCBpbWFnZSBkYXRhIGJ5IDkwIGRlZ3JlZXMgY291bnRlcmNsb2Nrd2lzZS4KCSAgICAgKiBPbmx5IGNhbGxhYmxlIGlmIHtAbGluayAjaXNSb3RhdGVTdXBwb3J0ZWQoKX0gaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gQSByb3RhdGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMS5kZWZhdWx0KCdUaGlzIGx1bWluYW5jZSBzb3VyY2UgZG9lcyBub3Qgc3VwcG9ydCByb3RhdGlvbiBieSA5MCBkZWdyZWVzLicpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV0dXJucyBhIG5ldyBvYmplY3Qgd2l0aCByb3RhdGVkIGltYWdlIGRhdGEgYnkgNDUgZGVncmVlcyBjb3VudGVyY2xvY2t3aXNlLgoJICAgICAqIE9ubHkgY2FsbGFibGUgaWYge0BsaW5rICNpc1JvdGF0ZVN1cHBvcnRlZCgpfSBpcyB0cnVlLgoJICAgICAqCgkgICAgICogQHJldHVybiBBIHJvdGF0ZWQgdmVyc2lvbiBvZiB0aGlzIG9iamVjdC4KCSAgICAgKi8KCSAgICBMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLnJvdGF0ZUNvdW50ZXJDbG9ja3dpc2U0NSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uXzEuZGVmYXVsdCgnVGhpcyBsdW1pbmFuY2Ugc291cmNlIGRvZXMgbm90IHN1cHBvcnQgcm90YXRpb24gYnkgNDUgZGVncmVlcy4nKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgcm93ID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHRoaXMud2lkdGgpOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFN0cmluZ0J1aWxkZXJfMSQxLmRlZmF1bHQoKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCB0aGlzLmhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgc291cmNlUm93ID0gdGhpcy5nZXRSb3coeSwgcm93KTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgdGhpcy53aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGx1bWluYW5jZSA9IHNvdXJjZVJvd1t4XSAmIDB4RkY7CgkgICAgICAgICAgICAgICAgdmFyIGMgPSB2b2lkIDA7CgkgICAgICAgICAgICAgICAgaWYgKGx1bWluYW5jZSA8IDB4NDApIHsKCSAgICAgICAgICAgICAgICAgICAgYyA9ICcjJzsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAobHVtaW5hbmNlIDwgMHg4MCkgewoJICAgICAgICAgICAgICAgICAgICBjID0gJysnOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIGlmIChsdW1pbmFuY2UgPCAweEMwKSB7CgkgICAgICAgICAgICAgICAgICAgIGMgPSAnLic7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICBjID0gJyAnOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICByZXN1bHQuYXBwZW5kKGMpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZCgnXG4nKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0LnRvU3RyaW5nKCk7CgkgICAgfTsKCSAgICByZXR1cm4gTHVtaW5hbmNlU291cmNlOwoJfSgpKTsKCUx1bWluYW5jZVNvdXJjZSQxLmRlZmF1bHQgPSBMdW1pbmFuY2VTb3VyY2U7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA5IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMkYSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbnZlcnRlZEx1bWluYW5jZVNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgTHVtaW5hbmNlU291cmNlXzEkMSA9IEx1bWluYW5jZVNvdXJjZSQxOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogQSB3cmFwcGVyIGltcGxlbWVudGF0aW9uIG9mIHtAbGluayBMdW1pbmFuY2VTb3VyY2V9IHdoaWNoIGludmVydHMgdGhlIGx1bWluYW5jZXMgaXQgcmV0dXJucyAtLSBibGFjayBiZWNvbWVzCgkgKiB3aGl0ZSBhbmQgdmljZSB2ZXJzYSwgYW5kIGVhY2ggdmFsdWUgYmVjb21lcyAoMjU1LXZhbHVlKS4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGEoSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UsIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UoZGVsZWdhdGUpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgZGVsZWdhdGUuZ2V0V2lkdGgoKSwgZGVsZWdhdGUuZ2V0SGVpZ2h0KCkpIHx8IHRoaXM7CgkgICAgICAgIF90aGlzLmRlbGVnYXRlID0gZGVsZWdhdGU7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgdmFyIHNvdXJjZVJvdyA9IHRoaXMuZGVsZWdhdGUuZ2V0Um93KHksIHJvdyk7CgkgICAgICAgIHZhciB3aWR0aCA9IHRoaXMuZ2V0V2lkdGgoKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3aWR0aDsgaSsrKSB7CgkgICAgICAgICAgICBzb3VyY2VSb3dbaV0gPSAvKihieXRlKSovICgyNTUgLSAoc291cmNlUm93W2ldICYgMHhGRikpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBzb3VyY2VSb3c7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLmdldE1hdHJpeCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIG1hdHJpeCA9IHRoaXMuZGVsZWdhdGUuZ2V0TWF0cml4KCk7CgkgICAgICAgIHZhciBsZW5ndGggPSB0aGlzLmdldFdpZHRoKCkgKiB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgaW52ZXJ0ZWRNYXRyaXggPSBuZXcgVWludDhDbGFtcGVkQXJyYXkobGVuZ3RoKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewoJICAgICAgICAgICAgaW52ZXJ0ZWRNYXRyaXhbaV0gPSAvKihieXRlKSovICgyNTUgLSAobWF0cml4W2ldICYgMHhGRikpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBpbnZlcnRlZE1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNDcm9wU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5kZWxlZ2F0ZS5pc0Nyb3BTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuY3JvcCA9IGZ1bmN0aW9uIChsZWZ0IC8qaW50Ki8sIHRvcCAvKmludCovLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUuY3JvcChsZWZ0LCB0b3AsIHdpZHRoLCBoZWlnaHQpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNSb3RhdGVTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlbGVnYXRlLmlzUm90YXRlU3VwcG9ydGVkKCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIG9yaWdpbmFsIGRlbGVnYXRlIHtAbGluayBMdW1pbmFuY2VTb3VyY2V9IHNpbmNlIGludmVydCB1bmRvZXMgaXRzZWxmCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5pbnZlcnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlbGVnYXRlOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUucm90YXRlQ291bnRlckNsb2Nrd2lzZSgpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1KCkpOwoJICAgIH07CgkgICAgcmV0dXJuIEludmVydGVkTHVtaW5hbmNlU291cmNlOwoJfShMdW1pbmFuY2VTb3VyY2VfMSQxLmRlZmF1bHQpKTsKCUludmVydGVkTHVtaW5hbmNlU291cmNlJDEuZGVmYXVsdCA9IEludmVydGVkTHVtaW5hbmNlU291cmNlOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDkgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoUkdCTHVtaW5hbmNlU291cmNlJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcgeyovCgkgLy8gcmVxdWlyZWQgYmVjYXVzZSBvZiBjaXJjdWxhciBkZXBlbmRlbmNpZXMgYmV0d2VlbiBMdW1pbmFuY2VTb3VyY2UgYW5kIEludmVydGVkTHVtaW5hbmNlU291cmNlCgl2YXIgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2VfMSA9IEludmVydGVkTHVtaW5hbmNlU291cmNlJDE7Cgl2YXIgTHVtaW5hbmNlU291cmNlXzEgPSBMdW1pbmFuY2VTb3VyY2UkMTsKCXZhciBTeXN0ZW1fMSQyID0gU3lzdGVtJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNiA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBUaGlzIGNsYXNzIGlzIHVzZWQgdG8gaGVscCBkZWNvZGUgaW1hZ2VzIGZyb20gZmlsZXMgd2hpY2ggYXJyaXZlIGFzIFJHQiBkYXRhIGZyb20KCSAqIGFuIEFSR0IgcGl4ZWwgYXJyYXkuIEl0IGRvZXMgbm90IHN1cHBvcnQgcm90YXRpb24uCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBhdXRob3IgQmV0YW1pbm9zCgkgKi8KCXZhciBSR0JMdW1pbmFuY2VTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDkoUkdCTHVtaW5hbmNlU291cmNlLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIFJHQkx1bWluYW5jZVNvdXJjZShsdW1pbmFuY2VzLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLywgZGF0YVdpZHRoIC8qaW50Ki8sIGRhdGFIZWlnaHQgLyppbnQqLywgbGVmdCAvKmludCovLCB0b3AgLyppbnQqLykgewoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCB3aWR0aCwgaGVpZ2h0KSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5kYXRhV2lkdGggPSBkYXRhV2lkdGg7CgkgICAgICAgIF90aGlzLmRhdGFIZWlnaHQgPSBkYXRhSGVpZ2h0OwoJICAgICAgICBfdGhpcy5sZWZ0ID0gbGVmdDsKCSAgICAgICAgX3RoaXMudG9wID0gdG9wOwoJICAgICAgICBpZiAobHVtaW5hbmNlcy5CWVRFU19QRVJfRUxFTUVOVCA9PT0gNCkgeyAvLyBJbnQzMkFycmF5CgkgICAgICAgICAgICB2YXIgc2l6ZSA9IHdpZHRoICogaGVpZ2h0OwoJICAgICAgICAgICAgdmFyIGx1bWluYW5jZXNVaW50OEFycmF5ID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHNpemUpOwoJICAgICAgICAgICAgZm9yICh2YXIgb2Zmc2V0ID0gMDsgb2Zmc2V0IDwgc2l6ZTsgb2Zmc2V0KyspIHsKCSAgICAgICAgICAgICAgICB2YXIgcGl4ZWwgPSBsdW1pbmFuY2VzW29mZnNldF07CgkgICAgICAgICAgICAgICAgdmFyIHIgPSAocGl4ZWwgPj4gMTYpICYgMHhmZjsgLy8gcmVkCgkgICAgICAgICAgICAgICAgdmFyIGcyID0gKHBpeGVsID4+IDcpICYgMHgxZmU7IC8vIDIgKiBncmVlbgoJICAgICAgICAgICAgICAgIHZhciBiID0gcGl4ZWwgJiAweGZmOyAvLyBibHVlCgkgICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGdyZWVuLWZhdm91cmluZyBhdmVyYWdlIGNoZWFwbHkKCSAgICAgICAgICAgICAgICBsdW1pbmFuY2VzVWludDhBcnJheVtvZmZzZXRdID0gLyooYnl0ZSkgKi8gKChyICsgZzIgKyBiKSAvIDQpICYgMHhGRjsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIF90aGlzLmx1bWluYW5jZXMgPSBsdW1pbmFuY2VzVWludDhBcnJheTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIF90aGlzLmx1bWluYW5jZXMgPSBsdW1pbmFuY2VzOwoJICAgICAgICB9CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGRhdGFXaWR0aCkgewoJICAgICAgICAgICAgX3RoaXMuZGF0YVdpZHRoID0gd2lkdGg7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gZGF0YUhlaWdodCkgewoJICAgICAgICAgICAgX3RoaXMuZGF0YUhlaWdodCA9IGhlaWdodDsKCSAgICAgICAgfQoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSBsZWZ0KSB7CgkgICAgICAgICAgICBfdGhpcy5sZWZ0ID0gMDsKCSAgICAgICAgfQoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSB0b3ApIHsKCSAgICAgICAgICAgIF90aGlzLnRvcCA9IDA7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKF90aGlzLmxlZnQgKyB3aWR0aCA+IF90aGlzLmRhdGFXaWR0aCB8fCBfdGhpcy50b3AgKyBoZWlnaHQgPiBfdGhpcy5kYXRhSGVpZ2h0KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNi5kZWZhdWx0KCdDcm9wIHJlY3RhbmdsZSBkb2VzIG5vdCBmaXQgd2l0aGluIGltYWdlIGRhdGEuJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICAvKkBPdmVycmlkZSovCgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgaWYgKHkgPCAwIHx8IHkgPj0gdGhpcy5nZXRIZWlnaHQoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDYuZGVmYXVsdCgnUmVxdWVzdGVkIHJvdyBpcyBvdXRzaWRlIHRoZSBpbWFnZTogJyArIHkpOwoJICAgICAgICB9CgkgICAgICAgIHZhciB3aWR0aCA9IHRoaXMuZ2V0V2lkdGgoKTsKCSAgICAgICAgaWYgKHJvdyA9PT0gbnVsbCB8fCByb3cgPT09IHVuZGVmaW5lZCB8fCByb3cubGVuZ3RoIDwgd2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBVaW50OENsYW1wZWRBcnJheSh3aWR0aCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG9mZnNldCA9ICh5ICsgdGhpcy50b3ApICogdGhpcy5kYXRhV2lkdGggKyB0aGlzLmxlZnQ7CgkgICAgICAgIFN5c3RlbV8xJDIuZGVmYXVsdC5hcnJheWNvcHkodGhpcy5sdW1pbmFuY2VzLCBvZmZzZXQsIHJvdywgMCwgd2lkdGgpOwoJICAgICAgICByZXR1cm4gcm93OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJHQkx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuZ2V0TWF0cml4ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgd2lkdGggPSB0aGlzLmdldFdpZHRoKCk7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICAvLyBJZiB0aGUgY2FsbGVyIGFza3MgZm9yIHRoZSBlbnRpcmUgdW5kZXJseWluZyBpbWFnZSwgc2F2ZSB0aGUgY29weSBhbmQgZ2l2ZSB0aGVtIHRoZQoJICAgICAgICAvLyBvcmlnaW5hbCBkYXRhLiBUaGUgZG9jcyBzcGVjaWZpY2FsbHkgd2FybiB0aGF0IHJlc3VsdC5sZW5ndGggbXVzdCBiZSBpZ25vcmVkLgoJICAgICAgICBpZiAod2lkdGggPT09IHRoaXMuZGF0YVdpZHRoICYmIGhlaWdodCA9PT0gdGhpcy5kYXRhSGVpZ2h0KSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5sdW1pbmFuY2VzOwoJICAgICAgICB9CgkgICAgICAgIHZhciBhcmVhID0gd2lkdGggKiBoZWlnaHQ7CgkgICAgICAgIHZhciBtYXRyaXggPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoYXJlYSk7CgkgICAgICAgIHZhciBpbnB1dE9mZnNldCA9IHRoaXMudG9wICogdGhpcy5kYXRhV2lkdGggKyB0aGlzLmxlZnQ7CgkgICAgICAgIC8vIElmIHRoZSB3aWR0aCBtYXRjaGVzIHRoZSBmdWxsIHdpZHRoIG9mIHRoZSB1bmRlcmx5aW5nIGRhdGEsIHBlcmZvcm0gYSBzaW5nbGUgY29weS4KCSAgICAgICAgaWYgKHdpZHRoID09PSB0aGlzLmRhdGFXaWR0aCkgewoJICAgICAgICAgICAgU3lzdGVtXzEkMi5kZWZhdWx0LmFycmF5Y29weSh0aGlzLmx1bWluYW5jZXMsIGlucHV0T2Zmc2V0LCBtYXRyaXgsIDAsIGFyZWEpOwoJICAgICAgICAgICAgcmV0dXJuIG1hdHJpeDsKCSAgICAgICAgfQoJICAgICAgICAvLyBPdGhlcndpc2UgY29weSBvbmUgY3JvcHBlZCByb3cgYXQgYSB0aW1lLgoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb3V0cHV0T2Zmc2V0ID0geSAqIHdpZHRoOwoJICAgICAgICAgICAgU3lzdGVtXzEkMi5kZWZhdWx0LmFycmF5Y29weSh0aGlzLmx1bWluYW5jZXMsIGlucHV0T2Zmc2V0LCBtYXRyaXgsIG91dHB1dE9mZnNldCwgd2lkdGgpOwoJICAgICAgICAgICAgaW5wdXRPZmZzZXQgKz0gdGhpcy5kYXRhV2lkdGg7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBSR0JMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLmlzQ3JvcFN1cHBvcnRlZCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5jcm9wID0gZnVuY3Rpb24gKGxlZnQgLyppbnQqLywgdG9wIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHJldHVybiBuZXcgUkdCTHVtaW5hbmNlU291cmNlKHRoaXMubHVtaW5hbmNlcywgd2lkdGgsIGhlaWdodCwgdGhpcy5kYXRhV2lkdGgsIHRoaXMuZGF0YUhlaWdodCwgdGhpcy5sZWZ0ICsgbGVmdCwgdGhpcy50b3AgKyB0b3ApOwoJICAgIH07CgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5pbnZlcnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2VfMS5kZWZhdWx0KHRoaXMpOwoJICAgIH07CgkgICAgcmV0dXJuIFJHQkx1bWluYW5jZVNvdXJjZTsKCX0oTHVtaW5hbmNlU291cmNlXzEuZGVmYXVsdCkpOwoJdmFyIF9kZWZhdWx0JDEgPSBSR0JMdW1pbmFuY2VTb3VyY2UkMS5kZWZhdWx0ID0gUkdCTHVtaW5hbmNlU291cmNlOwoKCXZhciBRUkNvZGVSZWFkZXIkMSA9IHt9OwoKCXZhciBCYXJjb2RlRm9ybWF0JDEgPSB7fTsKCgkvKgoJICogRGlyZWN0IHBvcnQgdG8gVHlwZVNjcmlwdCBvZiBaWGluZyBieSBBZHJpYW4gVG/ImWPEgwoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmFyY29kZUZvcm1hdCQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogRW51bWVyYXRlcyBiYXJjb2RlIGZvcm1hdHMga25vd24gdG8gdGhpcyBwYWNrYWdlLiBQbGVhc2Uga2VlcCBhbHBoYWJldGl6ZWQuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEJhcmNvZGVGb3JtYXQ7CgkoZnVuY3Rpb24gKEJhcmNvZGVGb3JtYXQpIHsKCSAgICAvKiogQXp0ZWMgMkQgYmFyY29kZSBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJBWlRFQyJdID0gMF0gPSAiQVpURUMiOwoJICAgIC8qKiBDT0RBQkFSIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREFCQVIiXSA9IDFdID0gIkNPREFCQVIiOwoJICAgIC8qKiBDb2RlIDM5IDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREVfMzkiXSA9IDJdID0gIkNPREVfMzkiOwoJICAgIC8qKiBDb2RlIDkzIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREVfOTMiXSA9IDNdID0gIkNPREVfOTMiOwoJICAgIC8qKiBDb2RlIDEyOCAxRCBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJDT0RFXzEyOCJdID0gNF0gPSAiQ09ERV8xMjgiOwoJICAgIC8qKiBEYXRhIE1hdHJpeCAyRCBiYXJjb2RlIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkRBVEFfTUFUUklYIl0gPSA1XSA9ICJEQVRBX01BVFJJWCI7CgkgICAgLyoqIEVBTi04IDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkVBTl84Il0gPSA2XSA9ICJFQU5fOCI7CgkgICAgLyoqIEVBTi0xMyAxRCBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJFQU5fMTMiXSA9IDddID0gIkVBTl8xMyI7CgkgICAgLyoqIElURiAoSW50ZXJsZWF2ZWQgVHdvIG9mIEZpdmUpIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIklURiJdID0gOF0gPSAiSVRGIjsKCSAgICAvKiogTWF4aUNvZGUgMkQgYmFyY29kZSBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJNQVhJQ09ERSJdID0gOV0gPSAiTUFYSUNPREUiOwoJICAgIC8qKiBQREY0MTcgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUERGXzQxNyJdID0gMTBdID0gIlBERl80MTciOwoJICAgIC8qKiBRUiBDb2RlIDJEIGJhcmNvZGUgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUVJfQ09ERSJdID0gMTFdID0gIlFSX0NPREUiOwoJICAgIC8qKiBSU1MgMTQgKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlJTU18xNCJdID0gMTJdID0gIlJTU18xNCI7CgkgICAgLyoqIFJTUyBFWFBBTkRFRCAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUlNTX0VYUEFOREVEIl0gPSAxM10gPSAiUlNTX0VYUEFOREVEIjsKCSAgICAvKiogVVBDLUEgMUQgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiVVBDX0EiXSA9IDE0XSA9ICJVUENfQSI7CgkgICAgLyoqIFVQQy1FIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlVQQ19FIl0gPSAxNV0gPSAiVVBDX0UiOwoJICAgIC8qKiBVUEMvRUFOIGV4dGVuc2lvbiBmb3JtYXQuIE5vdCBhIHN0YW5kLWFsb25lIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlVQQ19FQU5fRVhURU5TSU9OIl0gPSAxNl0gPSAiVVBDX0VBTl9FWFRFTlNJT04iOwoJfSkoQmFyY29kZUZvcm1hdCB8fCAoQmFyY29kZUZvcm1hdCA9IHt9KSk7CglCYXJjb2RlRm9ybWF0JDEuZGVmYXVsdCA9IEJhcmNvZGVGb3JtYXQ7CgoJdmFyIFJlc3VsdCQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZXN1bHQkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIFN5c3RlbV8xJDEgPSBTeXN0ZW0kMTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGVjb2RpbmcgYSBiYXJjb2RlIHdpdGhpbiBhbiBpbWFnZS48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFJlc3VsdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IocHJpdmF0ZSB0ZXh0OiBzdHJpbmcsCgkgICAgLy8gICAgICAgICAgICAgICBVaW50OEFycmF5IHJhd0J5dGVzLAoJICAgIC8vICAgICAgICAgICAgICAgUmVzdWx0UG9jb25zdCByZXN1bHRQb2ludHM6IEludDMyQXJyYXksCgkgICAgLy8gICAgICAgICAgICAgICBCYXJjb2RlRm9ybWF0IGZvcm1hdCkgewoJICAgIC8vICAgdGhpcyh0ZXh0LCByYXdCeXRlcywgcmVzdWx0UG9pbnRzLCBmb3JtYXQsIFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpKQoJICAgIC8vIH0KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IodGV4dDogc3RyaW5nLAoJICAgIC8vICAgICAgICAgICAgICAgVWludDhBcnJheSByYXdCeXRlcywKCSAgICAvLyAgICAgICAgICAgICAgIFJlc3VsdFBvY29uc3QgcmVzdWx0UG9pbnRzOiBJbnQzMkFycmF5LAoJICAgIC8vICAgICAgICAgICAgICAgQmFyY29kZUZvcm1hdCBmb3JtYXQsCgkgICAgLy8gICAgICAgICAgICAgICBsb25nIHRpbWVzdGFtcCkgewoJICAgIC8vICAgdGhpcyh0ZXh0LCByYXdCeXRlcywgcmF3Qnl0ZXMgPT0gbnVsbCA/IDAgOiA4ICogcmF3Qnl0ZXMubGVuZ3RoLAoJICAgIC8vICAgICAgICByZXN1bHRQb2ludHMsIGZvcm1hdCwgdGltZXN0YW1wKQoJICAgIC8vIH0KCSAgICBmdW5jdGlvbiBSZXN1bHQodGV4dCwgcmF3Qnl0ZXMsIG51bUJpdHMsIHJlc3VsdFBvaW50cywgZm9ybWF0LCB0aW1lc3RhbXApIHsKCSAgICAgICAgaWYgKG51bUJpdHMgPT09IHZvaWQgMCkgeyBudW1CaXRzID0gcmF3Qnl0ZXMgPT0gbnVsbCA/IDAgOiA4ICogcmF3Qnl0ZXMubGVuZ3RoOyB9CgkgICAgICAgIGlmICh0aW1lc3RhbXAgPT09IHZvaWQgMCkgeyB0aW1lc3RhbXAgPSBTeXN0ZW1fMSQxLmRlZmF1bHQuY3VycmVudFRpbWVNaWxsaXMoKTsgfQoJICAgICAgICB0aGlzLnRleHQgPSB0ZXh0OwoJICAgICAgICB0aGlzLnJhd0J5dGVzID0gcmF3Qnl0ZXM7CgkgICAgICAgIHRoaXMubnVtQml0cyA9IG51bUJpdHM7CgkgICAgICAgIHRoaXMucmVzdWx0UG9pbnRzID0gcmVzdWx0UG9pbnRzOwoJICAgICAgICB0aGlzLmZvcm1hdCA9IGZvcm1hdDsKCSAgICAgICAgdGhpcy50aW1lc3RhbXAgPSB0aW1lc3RhbXA7CgkgICAgICAgIHRoaXMudGV4dCA9IHRleHQ7CgkgICAgICAgIHRoaXMucmF3Qnl0ZXMgPSByYXdCeXRlczsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gbnVtQml0cyB8fCBudWxsID09PSBudW1CaXRzKSB7CgkgICAgICAgICAgICB0aGlzLm51bUJpdHMgPSAocmF3Qnl0ZXMgPT09IG51bGwgfHwgcmF3Qnl0ZXMgPT09IHVuZGVmaW5lZCkgPyAwIDogOCAqIHJhd0J5dGVzLmxlbmd0aDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHRoaXMubnVtQml0cyA9IG51bUJpdHM7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludHMgPSByZXN1bHRQb2ludHM7CgkgICAgICAgIHRoaXMuZm9ybWF0ID0gZm9ybWF0OwoJICAgICAgICB0aGlzLnJlc3VsdE1ldGFkYXRhID0gbnVsbDsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gdGltZXN0YW1wIHx8IG51bGwgPT09IHRpbWVzdGFtcCkgewoJICAgICAgICAgICAgdGhpcy50aW1lc3RhbXAgPSBTeXN0ZW1fMSQxLmRlZmF1bHQuY3VycmVudFRpbWVNaWxsaXMoKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHRoaXMudGltZXN0YW1wID0gdGltZXN0YW1wOwoJICAgICAgICB9CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcmF3IHRleHQgZW5jb2RlZCBieSB0aGUgYmFyY29kZQoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0VGV4dCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMudGV4dDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcmF3IGJ5dGVzIGVuY29kZWQgYnkgdGhlIGJhcmNvZGUsIGlmIGFwcGxpY2FibGUsIG90aGVyd2lzZSB7QGNvZGUgbnVsbH0KCSAgICAgKi8KCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFJhd0J5dGVzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yYXdCeXRlczsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaG93IG1hbnkgYml0cyBvZiB7QGxpbmsgI2dldFJhd0J5dGVzKCl9IGFyZSB2YWxpZDsgdHlwaWNhbGx5IDggdGltZXMgaXRzIGxlbmd0aAoJICAgICAqIEBzaW5jZSAzLjMuMAoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0TnVtQml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMubnVtQml0czsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcG9pbnRzIHJlbGF0ZWQgdG8gdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLiBUaGVzZSBhcmUgdHlwaWNhbGx5IHBvaW50cwoJICAgICAqICAgICAgICAgaWRlbnRpZnlpbmcgZmluZGVyIHBhdHRlcm5zIG9yIHRoZSBjb3JuZXJzIG9mIHRoZSBiYXJjb2RlLiBUaGUgZXhhY3QgbWVhbmluZyBpcwoJICAgICAqICAgICAgICAgc3BlY2lmaWMgdG8gdGhlIHR5cGUgb2YgYmFyY29kZSB0aGF0IHdhcyBkZWNvZGVkLgoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0UmVzdWx0UG9pbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRQb2ludHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHtAbGluayBCYXJjb2RlRm9ybWF0fSByZXByZXNlbnRpbmcgdGhlIGZvcm1hdCBvZiB0aGUgYmFyY29kZSB0aGF0IHdhcyBkZWNvZGVkCgkgICAgICovCgkgICAgUmVzdWx0LnByb3RvdHlwZS5nZXRCYXJjb2RlRm9ybWF0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHtAbGluayBNYXB9IG1hcHBpbmcge0BsaW5rIFJlc3VsdE1ldGFkYXRhVHlwZX0ga2V5cyB0byB2YWx1ZXMuIE1heSBiZQoJICAgICAqICAge0Bjb2RlIG51bGx9LiBUaGlzIGNvbnRhaW5zIG9wdGlvbmFsIG1ldGFkYXRhIGFib3V0IHdoYXQgd2FzIGRldGVjdGVkIGFib3V0IHRoZSBiYXJjb2RlLAoJICAgICAqICAgbGlrZSBvcmllbnRhdGlvbi4KCSAgICAgKi8KCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFJlc3VsdE1ldGFkYXRhID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRNZXRhZGF0YTsKCSAgICB9OwoJICAgIFJlc3VsdC5wcm90b3R5cGUucHV0TWV0YWRhdGEgPSBmdW5jdGlvbiAodHlwZSwgdmFsdWUpIHsKCSAgICAgICAgaWYgKHRoaXMucmVzdWx0TWV0YWRhdGEgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHRoaXMucmVzdWx0TWV0YWRhdGEgPSBuZXcgTWFwKCk7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YS5zZXQodHlwZSwgdmFsdWUpOwoJICAgIH07CgkgICAgUmVzdWx0LnByb3RvdHlwZS5wdXRBbGxNZXRhZGF0YSA9IGZ1bmN0aW9uIChtZXRhZGF0YSkgewoJICAgICAgICBpZiAobWV0YWRhdGEgIT09IG51bGwpIHsKCSAgICAgICAgICAgIGlmICh0aGlzLnJlc3VsdE1ldGFkYXRhID09PSBudWxsKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YSA9IG1ldGFkYXRhOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YSA9IG5ldyBNYXAobWV0YWRhdGEpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZXN1bHQucHJvdG90eXBlLmFkZFJlc3VsdFBvaW50cyA9IGZ1bmN0aW9uIChuZXdQb2ludHMpIHsKCSAgICAgICAgdmFyIG9sZFBvaW50cyA9IHRoaXMucmVzdWx0UG9pbnRzOwoJICAgICAgICBpZiAob2xkUG9pbnRzID09PSBudWxsKSB7CgkgICAgICAgICAgICB0aGlzLnJlc3VsdFBvaW50cyA9IG5ld1BvaW50czsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChuZXdQb2ludHMgIT09IG51bGwgJiYgbmV3UG9pbnRzLmxlbmd0aCA+IDApIHsKCSAgICAgICAgICAgIHZhciBhbGxQb2ludHMgPSBuZXcgQXJyYXkob2xkUG9pbnRzLmxlbmd0aCArIG5ld1BvaW50cy5sZW5ndGgpOwoJICAgICAgICAgICAgU3lzdGVtXzEkMS5kZWZhdWx0LmFycmF5Y29weShvbGRQb2ludHMsIDAsIGFsbFBvaW50cywgMCwgb2xkUG9pbnRzLmxlbmd0aCk7CgkgICAgICAgICAgICBTeXN0ZW1fMSQxLmRlZmF1bHQuYXJyYXljb3B5KG5ld1BvaW50cywgMCwgYWxsUG9pbnRzLCBvbGRQb2ludHMubGVuZ3RoLCBuZXdQb2ludHMubGVuZ3RoKTsKCSAgICAgICAgICAgIHRoaXMucmVzdWx0UG9pbnRzID0gYWxsUG9pbnRzOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFRpbWVzdGFtcCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMudGltZXN0YW1wOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnRleHQ7CgkgICAgfTsKCSAgICByZXR1cm4gUmVzdWx0OwoJfSgpKTsKCVJlc3VsdCQxLmRlZmF1bHQgPSBSZXN1bHQ7CgoJdmFyIFJlc3VsdE1ldGFkYXRhVHlwZSQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA4IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZXN1bHRNZXRhZGF0YVR5cGUkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogUmVwcmVzZW50cyBzb21lIHR5cGUgb2YgbWV0YWRhdGEgYWJvdXQgdGhlIHJlc3VsdCBvZiB0aGUgZGVjb2RpbmcgdGhhdCB0aGUgZGVjb2RlcgoJICogd2lzaGVzIHRvIGNvbW11bmljYXRlIGJhY2sgdG8gdGhlIGNhbGxlci4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUmVzdWx0TWV0YWRhdGFUeXBlOwoJKGZ1bmN0aW9uIChSZXN1bHRNZXRhZGF0YVR5cGUpIHsKCSAgICAvKioKCSAgICAgKiBVbnNwZWNpZmllZCwgYXBwbGljYXRpb24tc3BlY2lmaWMgbWV0YWRhdGEuIE1hcHMgdG8gYW4gdW5zcGVjaWZpZWQge0BsaW5rIE9iamVjdH0uCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiT1RIRVIiXSA9IDBdID0gIk9USEVSIjsKCSAgICAvKioKCSAgICAgKiBEZW5vdGVzIHRoZSBsaWtlbHkgYXBwcm94aW1hdGUgb3JpZW50YXRpb24gb2YgdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLiBUaGlzIHZhbHVlCgkgICAgICogaXMgZ2l2ZW4gYXMgZGVncmVlcyByb3RhdGVkIGNsb2Nrd2lzZSBmcm9tIHRoZSBub3JtYWwsIHVwcmlnaHQgb3JpZW50YXRpb24uCgkgICAgICogRm9yIGV4YW1wbGUgYSAxRCBiYXJjb2RlIHdoaWNoIHdhcyBmb3VuZCBieSByZWFkaW5nIHRvcC10by1ib3R0b20gd291bGQgYmUKCSAgICAgKiBzYWlkIHRvIGhhdmUgb3JpZW50YXRpb24gIjkwIi4gVGhpcyBrZXkgbWFwcyB0byBhbiB7QGxpbmsgSW50ZWdlcn0gd2hvc2UKCSAgICAgKiB2YWx1ZSBpcyBpbiB0aGUgcmFuZ2UgWzAsMzYwKS4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJPUklFTlRBVElPTiJdID0gMV0gPSAiT1JJRU5UQVRJT04iOwoJICAgIC8qKgoJICAgICAqIDxwPjJEIGJhcmNvZGUgZm9ybWF0cyB0eXBpY2FsbHkgZW5jb2RlIHRleHQsIGJ1dCBhbGxvdyBmb3IgYSBzb3J0IG9mICdieXRlIG1vZGUnCgkgICAgICogd2hpY2ggaXMgc29tZXRpbWVzIHVzZWQgdG8gZW5jb2RlIGJpbmFyeSBkYXRhLiBXaGlsZSB7QGxpbmsgUmVzdWx0fSBtYWtlcyBhdmFpbGFibGUKCSAgICAgKiB0aGUgY29tcGxldGUgcmF3IGJ5dGVzIGluIHRoZSBiYXJjb2RlIGZvciB0aGVzZSBmb3JtYXRzLCBpdCBkb2VzIG5vdCBvZmZlciB0aGUgYnl0ZXMKCSAgICAgKiBmcm9tIHRoZSBieXRlIHNlZ21lbnRzIGFsb25lLjwvcD4KCSAgICAgKgoJICAgICAqIDxwPlRoaXMgbWFwcyB0byBhIHtAbGluayBqYXZhLnV0aWwuTGlzdH0gb2YgYnl0ZSBhcnJheXMgY29ycmVzcG9uZGluZyB0byB0aGUKCSAgICAgKiByYXcgYnl0ZXMgaW4gdGhlIGJ5dGUgc2VnbWVudHMgaW4gdGhlIGJhcmNvZGUsIGluIG9yZGVyLjwvcD4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJCWVRFX1NFR01FTlRTIl0gPSAyXSA9ICJCWVRFX1NFR01FTlRTIjsKCSAgICAvKioKCSAgICAgKiBFcnJvciBjb3JyZWN0aW9uIGxldmVsIHVzZWQsIGlmIGFwcGxpY2FibGUuIFRoZSB2YWx1ZSB0eXBlIGRlcGVuZHMgb24gdGhlCgkgICAgICogZm9ybWF0LCBidXQgaXMgdHlwaWNhbGx5IGEgU3RyaW5nLgoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwiXSA9IDNdID0gIkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwiOwoJICAgIC8qKgoJICAgICAqIEZvciBzb21lIHBlcmlvZGljYWxzLCBpbmRpY2F0ZXMgdGhlIGlzc3VlIG51bWJlciBhcyBhbiB7QGxpbmsgSW50ZWdlcn0uCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiSVNTVUVfTlVNQkVSIl0gPSA0XSA9ICJJU1NVRV9OVU1CRVIiOwoJICAgIC8qKgoJICAgICAqIEZvciBzb21lIHByb2R1Y3RzLCBpbmRpY2F0ZXMgdGhlIHN1Z2dlc3RlZCByZXRhaWwgcHJpY2UgaW4gdGhlIGJhcmNvZGUgYXMgYQoJICAgICAqIGZvcm1hdHRlZCB7QGxpbmsgU3RyaW5nfS4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJTVUdHRVNURURfUFJJQ0UiXSA9IDVdID0gIlNVR0dFU1RFRF9QUklDRSI7CgkgICAgLyoqCgkgICAgICogRm9yIHNvbWUgcHJvZHVjdHMsIHRoZSBwb3NzaWJsZSBjb3VudHJ5IG9mIG1hbnVmYWN0dXJlIGFzIGEge0BsaW5rIFN0cmluZ30gZGVub3RpbmcgdGhlCgkgICAgICogSVNPIGNvdW50cnkgY29kZS4gU29tZSBtYXAgdG8gbXVsdGlwbGUgcG9zc2libGUgY291bnRyaWVzLCBsaWtlICJVUy9DQSIuCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiUE9TU0lCTEVfQ09VTlRSWSJdID0gNl0gPSAiUE9TU0lCTEVfQ09VTlRSWSI7CgkgICAgLyoqCgkgICAgICogRm9yIHNvbWUgcHJvZHVjdHMsIHRoZSBleHRlbnNpb24gdGV4dAoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIlVQQ19FQU5fRVhURU5TSU9OIl0gPSA3XSA9ICJVUENfRUFOX0VYVEVOU0lPTiI7CgkgICAgLyoqCgkgICAgICogUERGNDE3LXNwZWNpZmljIG1ldGFkYXRhCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiUERGNDE3X0VYVFJBX01FVEFEQVRBIl0gPSA4XSA9ICJQREY0MTdfRVhUUkFfTUVUQURBVEEiOwoJICAgIC8qKgoJICAgICAqIElmIHRoZSBjb2RlIGZvcm1hdCBzdXBwb3J0cyBzdHJ1Y3R1cmVkIGFwcGVuZCBhbmQgdGhlIGN1cnJlbnQgc2Nhbm5lZCBjb2RlIGlzIHBhcnQgb2Ygb25lIHRoZW4gdGhlCgkgICAgICogc2VxdWVuY2UgbnVtYmVyIGlzIGdpdmVuIHdpdGggaXQuCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiU1RSVUNUVVJFRF9BUFBFTkRfU0VRVUVOQ0UiXSA9IDldID0gIlNUUlVDVFVSRURfQVBQRU5EX1NFUVVFTkNFIjsKCSAgICAvKioKCSAgICAgKiBJZiB0aGUgY29kZSBmb3JtYXQgc3VwcG9ydHMgc3RydWN0dXJlZCBhcHBlbmQgYW5kIHRoZSBjdXJyZW50IHNjYW5uZWQgY29kZSBpcyBwYXJ0IG9mIG9uZSB0aGVuIHRoZQoJICAgICAqIHBhcml0eSBpcyBnaXZlbiB3aXRoIGl0LgoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIlNUUlVDVFVSRURfQVBQRU5EX1BBUklUWSJdID0gMTBdID0gIlNUUlVDVFVSRURfQVBQRU5EX1BBUklUWSI7Cgl9KShSZXN1bHRNZXRhZGF0YVR5cGUgfHwgKFJlc3VsdE1ldGFkYXRhVHlwZSA9IHt9KSk7CglSZXN1bHRNZXRhZGF0YVR5cGUkMS5kZWZhdWx0ID0gUmVzdWx0TWV0YWRhdGFUeXBlOwoKCXZhciBEZWNvZGVyJDEgPSB7fTsKCgl2YXIgQ2hlY2tzdW1FeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkOCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShDaGVja3N1bUV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNCA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBDaGVja3N1bUV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkOChDaGVja3N1bUV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBDaGVja3N1bUV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBDaGVja3N1bUV4Y2VwdGlvbi5nZXRDaGVja3N1bUluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IENoZWNrc3VtRXhjZXB0aW9uKCk7CgkgICAgfTsKCSAgICBDaGVja3N1bUV4Y2VwdGlvbi5raW5kID0gJ0NoZWNrc3VtRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gQ2hlY2tzdW1FeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDQuZGVmYXVsdCkpOwoJQ2hlY2tzdW1FeGNlcHRpb24kMS5kZWZhdWx0ID0gQ2hlY2tzdW1FeGNlcHRpb247CgoJdmFyIEdlbmVyaWNHRiQxID0ge307CgoJdmFyIEdlbmVyaWNHRlBvbHkkMSA9IHt9OwoKCXZhciBBYnN0cmFjdEdlbmVyaWNHRiQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShBYnN0cmFjdEdlbmVyaWNHRiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5UaGlzIGNsYXNzIGNvbnRhaW5zIHV0aWxpdHkgbWV0aG9kcyBmb3IgcGVyZm9ybWluZyBtYXRoZW1hdGljYWwgb3BlcmF0aW9ucyBvdmVyCgkgKiB0aGUgR2Fsb2lzIEZpZWxkcy4gT3BlcmF0aW9ucyB1c2UgYSBnaXZlbiBwcmltaXRpdmUgcG9seW5vbWlhbCBpbiBjYWxjdWxhdGlvbnMuPC9wPgoJICoKCSAqIDxwPlRocm91Z2hvdXQgdGhpcyBwYWNrYWdlLCBlbGVtZW50cyBvZiB0aGUgR0YgYXJlIHJlcHJlc2VudGVkIGFzIGFuIHtAY29kZSBpbnR9CgkgKiBmb3IgY29udmVuaWVuY2UgYW5kIHNwZWVkIChidXQgYXQgdGhlIGNvc3Qgb2YgbWVtb3J5KS4KCSAqIDwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBEYXZpZCBPbGl2aWVyCgkgKi8KCXZhciBBYnN0cmFjdEdlbmVyaWNHRiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBBYnN0cmFjdEdlbmVyaWNHRigpIHsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiAyIHRvIHRoZSBwb3dlciBvZiBhIGluIEdGKHNpemUpCgkgICAgICovCgkgICAgQWJzdHJhY3RHZW5lcmljR0YucHJvdG90eXBlLmV4cCA9IGZ1bmN0aW9uIChhKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmV4cFRhYmxlW2FdOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBiYXNlIDIgbG9nIG9mIGEgaW4gR0Yoc2l6ZSkKCSAgICAgKi8KCSAgICBBYnN0cmFjdEdlbmVyaWNHRi5wcm90b3R5cGUubG9nID0gZnVuY3Rpb24gKGEgLyppbnQqLykgewoJICAgICAgICBpZiAoYSA9PT0gMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDUuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB0aGlzLmxvZ1RhYmxlW2FdOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogSW1wbGVtZW50cyBib3RoIGFkZGl0aW9uIGFuZCBzdWJ0cmFjdGlvbiAtLSB0aGV5IGFyZSB0aGUgc2FtZSBpbiBHRihzaXplKS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gc3VtL2RpZmZlcmVuY2Ugb2YgYSBhbmQgYgoJICAgICAqLwoJICAgIEFic3RyYWN0R2VuZXJpY0dGLmFkZE9yU3VidHJhY3QgPSBmdW5jdGlvbiAoYSAvKmludCovLCBiIC8qaW50Ki8pIHsKCSAgICAgICAgcmV0dXJuIGEgXiBiOwoJICAgIH07CgkgICAgcmV0dXJuIEFic3RyYWN0R2VuZXJpY0dGOwoJfSgpKTsKCUFic3RyYWN0R2VuZXJpY0dGJDEuZGVmYXVsdCA9IEFic3RyYWN0R2VuZXJpY0dGOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoR2VuZXJpY0dGUG9seSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbi5yZWVkc29sb21vbiB7Ki8KCXZhciBBYnN0cmFjdEdlbmVyaWNHRl8xJDEgPSBBYnN0cmFjdEdlbmVyaWNHRiQxOwoJdmFyIFN5c3RlbV8xID0gU3lzdGVtJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNCA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5SZXByZXNlbnRzIGEgcG9seW5vbWlhbCB3aG9zZSBjb2VmZmljaWVudHMgYXJlIGVsZW1lbnRzIG9mIGEgR0YuCgkgKiBJbnN0YW5jZXMgb2YgdGhpcyBjbGFzcyBhcmUgaW1tdXRhYmxlLjwvcD4KCSAqCgkgKiA8cD5NdWNoIGNyZWRpdCBpcyBkdWUgdG8gV2lsbGlhbSBSdWNrbGlkZ2Ugc2luY2UgcG9ydGlvbnMgb2YgdGhpcyBjb2RlIGFyZSBhbiBpbmRpcmVjdAoJICogcG9ydCBvZiBoaXMgQysrIFJlZWQtU29sb21vbiBpbXBsZW1lbnRhdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEdlbmVyaWNHRlBvbHkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGZpZWxkIHRoZSB7QGxpbmsgR2VuZXJpY0dGfSBpbnN0YW5jZSByZXByZXNlbnRpbmcgdGhlIGZpZWxkIHRvIHVzZQoJICAgICAqIHRvIHBlcmZvcm0gY29tcHV0YXRpb25zCgkgICAgICogQHBhcmFtIGNvZWZmaWNpZW50cyBjb2VmZmljaWVudHMgYXMgaW50cyByZXByZXNlbnRpbmcgZWxlbWVudHMgb2YgR0Yoc2l6ZSksIGFycmFuZ2VkCgkgICAgICogZnJvbSBtb3N0IHNpZ25pZmljYW50IChoaWdoZXN0LXBvd2VyIHRlcm0pIGNvZWZmaWNpZW50IHRvIGxlYXN0IHNpZ25pZmljYW50CgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgYXJndW1lbnQgaXMgbnVsbCBvciBlbXB0eSwKCSAgICAgKiBvciBpZiBsZWFkaW5nIGNvZWZmaWNpZW50IGlzIDAgYW5kIHRoaXMgaXMgbm90IGEKCSAgICAgKiBjb25zdGFudCBwb2x5bm9taWFsICh0aGF0IGlzLCBpdCBpcyBub3QgdGhlIG1vbm9taWFsICIwIikKCSAgICAgKi8KCSAgICBmdW5jdGlvbiBHZW5lcmljR0ZQb2x5KGZpZWxkLCBjb2VmZmljaWVudHMpIHsKCSAgICAgICAgaWYgKGNvZWZmaWNpZW50cy5sZW5ndGggPT09IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLmZpZWxkID0gZmllbGQ7CgkgICAgICAgIHZhciBjb2VmZmljaWVudHNMZW5ndGggPSBjb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICBpZiAoY29lZmZpY2llbnRzTGVuZ3RoID4gMSAmJiBjb2VmZmljaWVudHNbMF0gPT09IDApIHsKCSAgICAgICAgICAgIC8vIExlYWRpbmcgdGVybSBtdXN0IGJlIG5vbi16ZXJvIGZvciBhbnl0aGluZyBleGNlcHQgdGhlIGNvbnN0YW50IHBvbHlub21pYWwgIjAiCgkgICAgICAgICAgICB2YXIgZmlyc3ROb25aZXJvID0gMTsKCSAgICAgICAgICAgIHdoaWxlIChmaXJzdE5vblplcm8gPCBjb2VmZmljaWVudHNMZW5ndGggJiYgY29lZmZpY2llbnRzW2ZpcnN0Tm9uWmVyb10gPT09IDApIHsKCSAgICAgICAgICAgICAgICBmaXJzdE5vblplcm8rKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmIChmaXJzdE5vblplcm8gPT09IGNvZWZmaWNpZW50c0xlbmd0aCkgewoJICAgICAgICAgICAgICAgIHRoaXMuY29lZmZpY2llbnRzID0gSW50MzJBcnJheS5mcm9tKFswXSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICB0aGlzLmNvZWZmaWNpZW50cyA9IG5ldyBJbnQzMkFycmF5KGNvZWZmaWNpZW50c0xlbmd0aCAtIGZpcnN0Tm9uWmVybyk7CgkgICAgICAgICAgICAgICAgU3lzdGVtXzEuZGVmYXVsdC5hcnJheWNvcHkoY29lZmZpY2llbnRzLCBmaXJzdE5vblplcm8sIHRoaXMuY29lZmZpY2llbnRzLCAwLCB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdGhpcy5jb2VmZmljaWVudHMgPSBjb2VmZmljaWVudHM7CgkgICAgICAgIH0KCSAgICB9CgkgICAgR2VuZXJpY0dGUG9seS5wcm90b3R5cGUuZ2V0Q29lZmZpY2llbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGRlZ3JlZSBvZiB0aGlzIHBvbHlub21pYWwKCSAgICAgKi8KCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5nZXREZWdyZWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGggLSAxOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGlzIHBvbHlub21pYWwgaXMgdGhlIG1vbm9taWFsICIwIgoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmlzWmVybyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY29lZmZpY2llbnRzWzBdID09PSAwOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBjb2VmZmljaWVudCBvZiB4XmRlZ3JlZSB0ZXJtIGluIHRoaXMgcG9seW5vbWlhbAoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmdldENvZWZmaWNpZW50ID0gZnVuY3Rpb24gKGRlZ3JlZSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvZWZmaWNpZW50c1t0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGggLSAxIC0gZGVncmVlXTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gZXZhbHVhdGlvbiBvZiB0aGlzIHBvbHlub21pYWwgYXQgYSBnaXZlbiBwb2ludAoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmV2YWx1YXRlQXQgPSBmdW5jdGlvbiAoYSAvKmludCovKSB7CgkgICAgICAgIGlmIChhID09PSAwKSB7CgkgICAgICAgICAgICAvLyBKdXN0IHJldHVybiB0aGUgeF4wIGNvZWZmaWNpZW50CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRDb2VmZmljaWVudCgwKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgY29lZmZpY2llbnRzID0gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciByZXN1bHQ7CgkgICAgICAgIGlmIChhID09PSAxKSB7CgkgICAgICAgICAgICAvLyBKdXN0IHRoZSBzdW0gb2YgdGhlIGNvZWZmaWNpZW50cwoJICAgICAgICAgICAgcmVzdWx0ID0gMDsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IGNvZWZmaWNpZW50cy5sZW5ndGg7IGkgIT09IGxlbmd0aF8xOyBpKyspIHsKCSAgICAgICAgICAgICAgICB2YXIgY29lZmZpY2llbnQgPSBjb2VmZmljaWVudHNbaV07CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gQWJzdHJhY3RHZW5lcmljR0ZfMSQxLmRlZmF1bHQuYWRkT3JTdWJ0cmFjdChyZXN1bHQsIGNvZWZmaWNpZW50KTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0KCSAgICAgICAgcmVzdWx0ID0gY29lZmZpY2llbnRzWzBdOwoJICAgICAgICB2YXIgc2l6ZSA9IGNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgc2l6ZTsgaSsrKSB7CgkgICAgICAgICAgICByZXN1bHQgPSBBYnN0cmFjdEdlbmVyaWNHRl8xJDEuZGVmYXVsdC5hZGRPclN1YnRyYWN0KGZpZWxkLm11bHRpcGx5KGEsIHJlc3VsdCksIGNvZWZmaWNpZW50c1tpXSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmFkZE9yU3VidHJhY3QgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKCF0aGlzLmZpZWxkLmVxdWFscyhvdGhlci5maWVsZCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoJ0dlbmVyaWNHRlBvbHlzIGRvIG5vdCBoYXZlIHNhbWUgR2VuZXJpY0dGIGZpZWxkJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRoaXMuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHJldHVybiBvdGhlcjsKCSAgICAgICAgfQoJICAgICAgICBpZiAob3RoZXIuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzbWFsbGVyQ29lZmZpY2llbnRzID0gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciBsYXJnZXJDb2VmZmljaWVudHMgPSBvdGhlci5jb2VmZmljaWVudHM7CgkgICAgICAgIGlmIChzbWFsbGVyQ29lZmZpY2llbnRzLmxlbmd0aCA+IGxhcmdlckNvZWZmaWNpZW50cy5sZW5ndGgpIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gc21hbGxlckNvZWZmaWNpZW50czsKCSAgICAgICAgICAgIHNtYWxsZXJDb2VmZmljaWVudHMgPSBsYXJnZXJDb2VmZmljaWVudHM7CgkgICAgICAgICAgICBsYXJnZXJDb2VmZmljaWVudHMgPSB0ZW1wOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzdW1EaWZmID0gbmV3IEludDMyQXJyYXkobGFyZ2VyQ29lZmZpY2llbnRzLmxlbmd0aCk7CgkgICAgICAgIHZhciBsZW5ndGhEaWZmID0gbGFyZ2VyQ29lZmZpY2llbnRzLmxlbmd0aCAtIHNtYWxsZXJDb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICAvLyBDb3B5IGhpZ2gtb3JkZXIgdGVybXMgb25seSBmb3VuZCBpbiBoaWdoZXItZGVncmVlIHBvbHlub21pYWwncyBjb2VmZmljaWVudHMKCSAgICAgICAgU3lzdGVtXzEuZGVmYXVsdC5hcnJheWNvcHkobGFyZ2VyQ29lZmZpY2llbnRzLCAwLCBzdW1EaWZmLCAwLCBsZW5ndGhEaWZmKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IGxlbmd0aERpZmY7IGkgPCBsYXJnZXJDb2VmZmljaWVudHMubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHN1bURpZmZbaV0gPSBBYnN0cmFjdEdlbmVyaWNHRl8xJDEuZGVmYXVsdC5hZGRPclN1YnRyYWN0KHNtYWxsZXJDb2VmZmljaWVudHNbaSAtIGxlbmd0aERpZmZdLCBsYXJnZXJDb2VmZmljaWVudHNbaV0pOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seSh0aGlzLmZpZWxkLCBzdW1EaWZmKTsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLm11bHRpcGx5ID0gZnVuY3Rpb24gKG90aGVyKSB7CgkgICAgICAgIGlmICghdGhpcy5maWVsZC5lcXVhbHMob3RoZXIuZmllbGQpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNC5kZWZhdWx0KCdHZW5lcmljR0ZQb2x5cyBkbyBub3QgaGF2ZSBzYW1lIEdlbmVyaWNHRiBmaWVsZCcpOwoJICAgICAgICB9CgkgICAgICAgIGlmICh0aGlzLmlzWmVybygpIHx8IG90aGVyLmlzWmVybygpKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5maWVsZC5nZXRaZXJvKCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGFDb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgdmFyIGFMZW5ndGggPSBhQ29lZmZpY2llbnRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGJDb2VmZmljaWVudHMgPSBvdGhlci5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciBiTGVuZ3RoID0gYkNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBwcm9kdWN0ID0gbmV3IEludDMyQXJyYXkoYUxlbmd0aCArIGJMZW5ndGggLSAxKTsKCSAgICAgICAgdmFyIGZpZWxkID0gdGhpcy5maWVsZDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhTGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHZhciBhQ29lZmYgPSBhQ29lZmZpY2llbnRzW2ldOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBiTGVuZ3RoOyBqKyspIHsKCSAgICAgICAgICAgICAgICBwcm9kdWN0W2kgKyBqXSA9IEFic3RyYWN0R2VuZXJpY0dGXzEkMS5kZWZhdWx0LmFkZE9yU3VidHJhY3QocHJvZHVjdFtpICsgal0sIGZpZWxkLm11bHRpcGx5KGFDb2VmZiwgYkNvZWZmaWNpZW50c1tqXSkpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seShmaWVsZCwgcHJvZHVjdCk7CgkgICAgfTsKCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5tdWx0aXBseVNjYWxhciA9IGZ1bmN0aW9uIChzY2FsYXIgLyppbnQqLykgewoJICAgICAgICBpZiAoc2NhbGFyID09PSAwKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5maWVsZC5nZXRaZXJvKCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHNjYWxhciA9PT0gMSkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXM7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHNpemUgPSB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIHZhciBwcm9kdWN0ID0gbmV3IEludDMyQXJyYXkoc2l6ZSk7CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKCSAgICAgICAgICAgIHByb2R1Y3RbaV0gPSBmaWVsZC5tdWx0aXBseShjb2VmZmljaWVudHNbaV0sIHNjYWxhcik7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG5ldyBHZW5lcmljR0ZQb2x5KGZpZWxkLCBwcm9kdWN0KTsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLm11bHRpcGx5QnlNb25vbWlhbCA9IGZ1bmN0aW9uIChkZWdyZWUgLyppbnQqLywgY29lZmZpY2llbnQgLyppbnQqLykgewoJICAgICAgICBpZiAoZGVncmVlIDwgMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDQuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIGlmIChjb2VmZmljaWVudCA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmllbGQuZ2V0WmVybygpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgdmFyIHNpemUgPSBjb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICB2YXIgcHJvZHVjdCA9IG5ldyBJbnQzMkFycmF5KHNpemUgKyBkZWdyZWUpOwoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpemU7IGkrKykgewoJICAgICAgICAgICAgcHJvZHVjdFtpXSA9IGZpZWxkLm11bHRpcGx5KGNvZWZmaWNpZW50c1tpXSwgY29lZmZpY2llbnQpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seShmaWVsZCwgcHJvZHVjdCk7CgkgICAgfTsKCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5kaXZpZGUgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKCF0aGlzLmZpZWxkLmVxdWFscyhvdGhlci5maWVsZCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoJ0dlbmVyaWNHRlBvbHlzIGRvIG5vdCBoYXZlIHNhbWUgR2VuZXJpY0dGIGZpZWxkJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKG90aGVyLmlzWmVybygpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNC5kZWZhdWx0KCdEaXZpZGUgYnkgMCcpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIHZhciBxdW90aWVudCA9IGZpZWxkLmdldFplcm8oKTsKCSAgICAgICAgdmFyIHJlbWFpbmRlciA9IHRoaXM7CgkgICAgICAgIHZhciBkZW5vbWluYXRvckxlYWRpbmdUZXJtID0gb3RoZXIuZ2V0Q29lZmZpY2llbnQob3RoZXIuZ2V0RGVncmVlKCkpOwoJICAgICAgICB2YXIgaW52ZXJzZURlbm9taW5hdG9yTGVhZGluZ1Rlcm0gPSBmaWVsZC5pbnZlcnNlKGRlbm9taW5hdG9yTGVhZGluZ1Rlcm0pOwoJICAgICAgICB3aGlsZSAocmVtYWluZGVyLmdldERlZ3JlZSgpID49IG90aGVyLmdldERlZ3JlZSgpICYmICFyZW1haW5kZXIuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHZhciBkZWdyZWVEaWZmZXJlbmNlID0gcmVtYWluZGVyLmdldERlZ3JlZSgpIC0gb3RoZXIuZ2V0RGVncmVlKCk7CgkgICAgICAgICAgICB2YXIgc2NhbGUgPSBmaWVsZC5tdWx0aXBseShyZW1haW5kZXIuZ2V0Q29lZmZpY2llbnQocmVtYWluZGVyLmdldERlZ3JlZSgpKSwgaW52ZXJzZURlbm9taW5hdG9yTGVhZGluZ1Rlcm0pOwoJICAgICAgICAgICAgdmFyIHRlcm0gPSBvdGhlci5tdWx0aXBseUJ5TW9ub21pYWwoZGVncmVlRGlmZmVyZW5jZSwgc2NhbGUpOwoJICAgICAgICAgICAgdmFyIGl0ZXJhdGlvblF1b3RpZW50ID0gZmllbGQuYnVpbGRNb25vbWlhbChkZWdyZWVEaWZmZXJlbmNlLCBzY2FsZSk7CgkgICAgICAgICAgICBxdW90aWVudCA9IHF1b3RpZW50LmFkZE9yU3VidHJhY3QoaXRlcmF0aW9uUXVvdGllbnQpOwoJICAgICAgICAgICAgcmVtYWluZGVyID0gcmVtYWluZGVyLmFkZE9yU3VidHJhY3QodGVybSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIFtxdW90aWVudCwgcmVtYWluZGVyXTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJlc3VsdCA9ICcnOwoJICAgICAgICBmb3IgKHZhciBkZWdyZWUgPSB0aGlzLmdldERlZ3JlZSgpOyBkZWdyZWUgPj0gMDsgZGVncmVlLS0pIHsKCSAgICAgICAgICAgIHZhciBjb2VmZmljaWVudCA9IHRoaXMuZ2V0Q29lZmZpY2llbnQoZGVncmVlKTsKCSAgICAgICAgICAgIGlmIChjb2VmZmljaWVudCAhPT0gMCkgewoJICAgICAgICAgICAgICAgIGlmIChjb2VmZmljaWVudCA8IDApIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICcgLSAnOwoJICAgICAgICAgICAgICAgICAgICBjb2VmZmljaWVudCA9IC1jb2VmZmljaWVudDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICcgKyAnOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmIChkZWdyZWUgPT09IDAgfHwgY29lZmZpY2llbnQgIT09IDEpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGFscGhhUG93ZXIgPSB0aGlzLmZpZWxkLmxvZyhjb2VmZmljaWVudCk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChhbHBoYVBvd2VyID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gJzEnOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFscGhhUG93ZXIgPT09IDEpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnYSc7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gJ2FeJzsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBhbHBoYVBvd2VyOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmIChkZWdyZWUgIT09IDApIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKGRlZ3JlZSA9PT0gMSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICd4JzsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAneF4nOwoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGRlZ3JlZTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgcmV0dXJuIEdlbmVyaWNHRlBvbHk7Cgl9KCkpOwoJR2VuZXJpY0dGUG9seSQxLmRlZmF1bHQgPSBHZW5lcmljR0ZQb2x5OwoKCXZhciBBcml0aG1ldGljRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgX19leHRlbmRzJDcgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJpdGhtZXRpY0V4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkMyA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBBcml0aG1ldGljRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyQ3KEFyaXRobWV0aWNFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gQXJpdGhtZXRpY0V4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBBcml0aG1ldGljRXhjZXB0aW9uLmtpbmQgPSAnQXJpdGhtZXRpY0V4Y2VwdGlvbic7CgkgICAgcmV0dXJuIEFyaXRobWV0aWNFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDMuZGVmYXVsdCkpOwoJQXJpdGhtZXRpY0V4Y2VwdGlvbiQxLmRlZmF1bHQgPSBBcml0aG1ldGljRXhjZXB0aW9uOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDYgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoR2VuZXJpY0dGJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uLnJlZWRzb2xvbW9uIHsqLwoJdmFyIEdlbmVyaWNHRlBvbHlfMSQxID0gR2VuZXJpY0dGUG9seSQxOwoJdmFyIEFic3RyYWN0R2VuZXJpY0dGXzEgPSBBYnN0cmFjdEdlbmVyaWNHRiQxOwoJdmFyIEludGVnZXJfMSQxID0gSW50ZWdlciQxOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDMgPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcml0aG1ldGljRXhjZXB0aW9uXzEgPSBBcml0aG1ldGljRXhjZXB0aW9uJDE7CgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgY29udGFpbnMgdXRpbGl0eSBtZXRob2RzIGZvciBwZXJmb3JtaW5nIG1hdGhlbWF0aWNhbCBvcGVyYXRpb25zIG92ZXIKCSAqIHRoZSBHYWxvaXMgRmllbGRzLiBPcGVyYXRpb25zIHVzZSBhIGdpdmVuIHByaW1pdGl2ZSBwb2x5bm9taWFsIGluIGNhbGN1bGF0aW9ucy48L3A+CgkgKgoJICogPHA+VGhyb3VnaG91dCB0aGlzIHBhY2thZ2UsIGVsZW1lbnRzIG9mIHRoZSBHRiBhcmUgcmVwcmVzZW50ZWQgYXMgYW4ge0Bjb2RlIGludH0KCSAqIGZvciBjb252ZW5pZW5jZSBhbmQgc3BlZWQgKGJ1dCBhdCB0aGUgY29zdCBvZiBtZW1vcnkpLgoJICogPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKiBAYXV0aG9yIERhdmlkIE9saXZpZXIKCSAqLwoJdmFyIEdlbmVyaWNHRiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkNihHZW5lcmljR0YsIF9zdXBlcik7CgkgICAgLyoqCgkgICAgICogQ3JlYXRlIGEgcmVwcmVzZW50YXRpb24gb2YgR0Yoc2l6ZSkgdXNpbmcgdGhlIGdpdmVuIHByaW1pdGl2ZSBwb2x5bm9taWFsLgoJICAgICAqCgkgICAgICogQHBhcmFtIHByaW1pdGl2ZSBpcnJlZHVjaWJsZSBwb2x5bm9taWFsIHdob3NlIGNvZWZmaWNpZW50cyBhcmUgcmVwcmVzZW50ZWQgYnkKCSAgICAgKiAgdGhlIGJpdHMgb2YgYW4gaW50LCB3aGVyZSB0aGUgbGVhc3Qtc2lnbmlmaWNhbnQgYml0IHJlcHJlc2VudHMgdGhlIGNvbnN0YW50CgkgICAgICogIGNvZWZmaWNpZW50CgkgICAgICogQHBhcmFtIHNpemUgdGhlIHNpemUgb2YgdGhlIGZpZWxkCgkgICAgICogQHBhcmFtIGIgdGhlIGZhY3RvciBiIGluIHRoZSBnZW5lcmF0b3IgcG9seW5vbWlhbCBjYW4gYmUgMC0gb3IgMS1iYXNlZAoJICAgICAqICAoZyh4KSA9ICh4K2FeYikoeCthXihiKzEpKS4uLih4K2FeKGIrMnQtMSkpKS4KCSAgICAgKiAgSW4gbW9zdCBjYXNlcyBpdCBzaG91bGQgYmUgMSwgYnV0IGZvciBRUiBjb2RlIGl0IGlzIDAuCgkgICAgICovCgkgICAgZnVuY3Rpb24gR2VuZXJpY0dGKHByaW1pdGl2ZSAvKmludCovLCBzaXplIC8qaW50Ki8sIGdlbmVyYXRvckJhc2UgLyppbnQqLykgewoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5wcmltaXRpdmUgPSBwcmltaXRpdmU7CgkgICAgICAgIF90aGlzLnNpemUgPSBzaXplOwoJICAgICAgICBfdGhpcy5nZW5lcmF0b3JCYXNlID0gZ2VuZXJhdG9yQmFzZTsKCSAgICAgICAgdmFyIGV4cFRhYmxlID0gbmV3IEludDMyQXJyYXkoc2l6ZSk7CgkgICAgICAgIHZhciB4ID0gMTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKCSAgICAgICAgICAgIGV4cFRhYmxlW2ldID0geDsKCSAgICAgICAgICAgIHggKj0gMjsgLy8gd2UncmUgYXNzdW1pbmcgdGhlIGdlbmVyYXRvciBhbHBoYSBpcyAyCgkgICAgICAgICAgICBpZiAoeCA+PSBzaXplKSB7CgkgICAgICAgICAgICAgICAgeCBePSBwcmltaXRpdmU7CgkgICAgICAgICAgICAgICAgeCAmPSBzaXplIC0gMTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBfdGhpcy5leHBUYWJsZSA9IGV4cFRhYmxlOwoJICAgICAgICB2YXIgbG9nVGFibGUgPSBuZXcgSW50MzJBcnJheShzaXplKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplIC0gMTsgaSsrKSB7CgkgICAgICAgICAgICBsb2dUYWJsZVtleHBUYWJsZVtpXV0gPSBpOwoJICAgICAgICB9CgkgICAgICAgIF90aGlzLmxvZ1RhYmxlID0gbG9nVGFibGU7CgkgICAgICAgIC8vIGxvZ1RhYmxlWzBdID09IDAgYnV0IHRoaXMgc2hvdWxkIG5ldmVyIGJlIHVzZWQKCSAgICAgICAgX3RoaXMuemVybyA9IG5ldyBHZW5lcmljR0ZQb2x5XzEkMS5kZWZhdWx0KF90aGlzLCBJbnQzMkFycmF5LmZyb20oWzBdKSk7CgkgICAgICAgIF90aGlzLm9uZSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEkMS5kZWZhdWx0KF90aGlzLCBJbnQzMkFycmF5LmZyb20oWzFdKSk7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5nZXRaZXJvID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy56ZXJvOwoJICAgIH07CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5nZXRPbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm9uZTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gdGhlIG1vbm9taWFsIHJlcHJlc2VudGluZyBjb2VmZmljaWVudCAqIHheZGVncmVlCgkgICAgICovCgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5idWlsZE1vbm9taWFsID0gZnVuY3Rpb24gKGRlZ3JlZSAvKmludCovLCBjb2VmZmljaWVudCAvKmludCovKSB7CgkgICAgICAgIGlmIChkZWdyZWUgPCAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkMy5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvZWZmaWNpZW50ID09PSAwKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy56ZXJvOwoJICAgICAgICB9CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSBuZXcgSW50MzJBcnJheShkZWdyZWUgKyAxKTsKCSAgICAgICAgY29lZmZpY2llbnRzWzBdID0gY29lZmZpY2llbnQ7CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seV8xJDEuZGVmYXVsdCh0aGlzLCBjb2VmZmljaWVudHMpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBtdWx0aXBsaWNhdGl2ZSBpbnZlcnNlIG9mIGEKCSAgICAgKi8KCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmludmVyc2UgPSBmdW5jdGlvbiAoYSAvKmludCovKSB7CgkgICAgICAgIGlmIChhID09PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgQXJpdGhtZXRpY0V4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5leHBUYWJsZVt0aGlzLnNpemUgLSB0aGlzLmxvZ1RhYmxlW2FdIC0gMV07CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHByb2R1Y3Qgb2YgYSBhbmQgYiBpbiBHRihzaXplKQoJICAgICAqLwoJICAgIEdlbmVyaWNHRi5wcm90b3R5cGUubXVsdGlwbHkgPSBmdW5jdGlvbiAoYSAvKmludCovLCBiIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGEgPT09IDAgfHwgYiA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIDA7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMuZXhwVGFibGVbKHRoaXMubG9nVGFibGVbYV0gKyB0aGlzLmxvZ1RhYmxlW2JdKSAlICh0aGlzLnNpemUgLSAxKV07CgkgICAgfTsKCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmdldFNpemUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnNpemU7CgkgICAgfTsKCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmdldEdlbmVyYXRvckJhc2UgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRvckJhc2U7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICgnR0YoMHgnICsgSW50ZWdlcl8xJDEuZGVmYXVsdC50b0hleFN0cmluZyh0aGlzLnByaW1pdGl2ZSkgKyAnLCcgKyB0aGlzLnNpemUgKyAnKScpOwoJICAgIH07CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICByZXR1cm4gbyA9PT0gdGhpczsKCSAgICB9OwoJICAgIEdlbmVyaWNHRi5BWlRFQ19EQVRBXzEyID0gbmV3IEdlbmVyaWNHRigweDEwNjksIDQwOTYsIDEpOyAvLyB4XjEyICsgeF42ICsgeF41ICsgeF4zICsgMQoJICAgIEdlbmVyaWNHRi5BWlRFQ19EQVRBXzEwID0gbmV3IEdlbmVyaWNHRigweDQwOSwgMTAyNCwgMSk7IC8vIHheMTAgKyB4XjMgKyAxCgkgICAgR2VuZXJpY0dGLkFaVEVDX0RBVEFfNiA9IG5ldyBHZW5lcmljR0YoMHg0MywgNjQsIDEpOyAvLyB4XjYgKyB4ICsgMQoJICAgIEdlbmVyaWNHRi5BWlRFQ19QQVJBTSA9IG5ldyBHZW5lcmljR0YoMHgxMywgMTYsIDEpOyAvLyB4XjQgKyB4ICsgMQoJICAgIEdlbmVyaWNHRi5RUl9DT0RFX0ZJRUxEXzI1NiA9IG5ldyBHZW5lcmljR0YoMHgwMTFkLCAyNTYsIDApOyAvLyB4XjggKyB4XjQgKyB4XjMgKyB4XjIgKyAxCgkgICAgR2VuZXJpY0dGLkRBVEFfTUFUUklYX0ZJRUxEXzI1NiA9IG5ldyBHZW5lcmljR0YoMHgwMTJkLCAyNTYsIDEpOyAvLyB4XjggKyB4XjUgKyB4XjMgKyB4XjIgKyAxCgkgICAgR2VuZXJpY0dGLkFaVEVDX0RBVEFfOCA9IEdlbmVyaWNHRi5EQVRBX01BVFJJWF9GSUVMRF8yNTY7CgkgICAgR2VuZXJpY0dGLk1BWElDT0RFX0ZJRUxEXzY0ID0gR2VuZXJpY0dGLkFaVEVDX0RBVEFfNjsKCSAgICByZXR1cm4gR2VuZXJpY0dGOwoJfShBYnN0cmFjdEdlbmVyaWNHRl8xLmRlZmF1bHQpKTsKCUdlbmVyaWNHRiQxLmRlZmF1bHQgPSBHZW5lcmljR0Y7CgoJdmFyIFJlZWRTb2xvbW9uRGVjb2RlciQxID0ge307CgoJdmFyIFJlZWRTb2xvbW9uRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgX19leHRlbmRzJDUgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVlZFNvbG9tb25FeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDIgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgUmVlZFNvbG9tb25FeGNlcHRpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDUoUmVlZFNvbG9tb25FeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gUmVlZFNvbG9tb25FeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgUmVlZFNvbG9tb25FeGNlcHRpb24ua2luZCA9ICdSZWVkU29sb21vbkV4Y2VwdGlvbic7CgkgICAgcmV0dXJuIFJlZWRTb2xvbW9uRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQyLmRlZmF1bHQpKTsKCVJlZWRTb2xvbW9uRXhjZXB0aW9uJDEuZGVmYXVsdCA9IFJlZWRTb2xvbW9uRXhjZXB0aW9uOwoKCXZhciBJbGxlZ2FsU3RhdGVFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkNCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbGxlZ2FsU3RhdGVFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDEgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgSWxsZWdhbFN0YXRlRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyQ0KElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgSWxsZWdhbFN0YXRlRXhjZXB0aW9uLmtpbmQgPSAnSWxsZWdhbFN0YXRlRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gSWxsZWdhbFN0YXRlRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQxLmRlZmF1bHQpKTsKCUlsbGVnYWxTdGF0ZUV4Y2VwdGlvbiQxLmRlZmF1bHQgPSBJbGxlZ2FsU3RhdGVFeGNlcHRpb247CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZWVkU29sb21vbkRlY29kZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5jb21tb24ucmVlZHNvbG9tb24geyovCgl2YXIgR2VuZXJpY0dGXzEkMSA9IEdlbmVyaWNHRiQxOwoJdmFyIEdlbmVyaWNHRlBvbHlfMSA9IEdlbmVyaWNHRlBvbHkkMTsKCXZhciBSZWVkU29sb21vbkV4Y2VwdGlvbl8xID0gUmVlZFNvbG9tb25FeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsU3RhdGVFeGNlcHRpb25fMSA9IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5JbXBsZW1lbnRzIFJlZWQtU29sb21vbiBkZWNvZGluZywgYXMgdGhlIG5hbWUgaW1wbGllcy48L3A+CgkgKgoJICogPHA+VGhlIGFsZ29yaXRobSB3aWxsIG5vdCBiZSBleHBsYWluZWQgaGVyZSwgYnV0IHRoZSBmb2xsb3dpbmcgcmVmZXJlbmNlcyB3ZXJlIGhlbHBmdWwKCSAqIGluIGNyZWF0aW5nIHRoaXMgaW1wbGVtZW50YXRpb246PC9wPgoJICoKCSAqIDx1bD4KCSAqIDxsaT5CcnVjZSBNYWdncy4KCSAqIDxhIGhyZWY9Imh0dHA6Ly93d3cuY3MuY211LmVkdS9hZnMvY3MuY211LmVkdS9wcm9qZWN0L3BzY2ljby1ndXliL3JlYWx3b3JsZC93d3cvcnNfZGVjb2RlLnBzIj4KCSAqICJEZWNvZGluZyBSZWVkLVNvbG9tb24gQ29kZXMiPC9hPiAoc2VlIGRpc2N1c3Npb24gb2YgRm9ybmV5J3MgRm9ybXVsYSk8L2xpPgoJICogPGxpPkouSS4gSGFsbC4gPGEgaHJlZj0id3d3Lm10aC5tc3UuZWR1L35qaGFsbC9jbGFzc2VzL2NvZGVub3Rlcy9HUlMucGRmIj4KCSAqICJDaGFwdGVyIDUuIEdlbmVyYWxpemVkIFJlZWQtU29sb21vbiBDb2RlcyI8L2E+CgkgKiAoc2VlIGRpc2N1c3Npb24gb2YgRXVjbGlkZWFuIGFsZ29yaXRobSk8L2xpPgoJICogPC91bD4KCSAqCgkgKiA8cD5NdWNoIGNyZWRpdCBpcyBkdWUgdG8gV2lsbGlhbSBSdWNrbGlkZ2Ugc2luY2UgcG9ydGlvbnMgb2YgdGhpcyBjb2RlIGFyZSBhbiBpbmRpcmVjdAoJICogcG9ydCBvZiBoaXMgQysrIFJlZWQtU29sb21vbiBpbXBsZW1lbnRhdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBhdXRob3IgV2lsbGlhbSBSdWNrbGlkZ2UKCSAqIEBhdXRob3Igc2FuZm9yZHNxdWlyZXMKCSAqLwoJdmFyIFJlZWRTb2xvbW9uRGVjb2RlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBSZWVkU29sb21vbkRlY29kZXIoZmllbGQpIHsKCSAgICAgICAgdGhpcy5maWVsZCA9IGZpZWxkOwoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5EZWNvZGVzIGdpdmVuIHNldCBvZiByZWNlaXZlZCBjb2Rld29yZHMsIHdoaWNoIGluY2x1ZGUgYm90aCBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uCgkgICAgICogY29kZXdvcmRzLiBSZWFsbHksIHRoaXMgbWVhbnMgaXQgdXNlcyBSZWVkLVNvbG9tb24gdG8gZGV0ZWN0IGFuZCBjb3JyZWN0IGVycm9ycywgaW4tcGxhY2UsCgkgICAgICogaW4gdGhlIGlucHV0LjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSByZWNlaXZlZCBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcwoJICAgICAqIEBwYXJhbSB0d29TIG51bWJlciBvZiBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyBhdmFpbGFibGUKCSAgICAgKiBAdGhyb3dzIFJlZWRTb2xvbW9uRXhjZXB0aW9uIGlmIGRlY29kaW5nIGZhaWxzIGZvciBhbnkgcmVhc29uCgkgICAgICovCgkgICAgUmVlZFNvbG9tb25EZWNvZGVyLnByb3RvdHlwZS5kZWNvZGUgPSBmdW5jdGlvbiAocmVjZWl2ZWQsIHR3b1MgLyppbnQqLykgewoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICB2YXIgcG9seSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEuZGVmYXVsdChmaWVsZCwgcmVjZWl2ZWQpOwoJICAgICAgICB2YXIgc3luZHJvbWVDb2VmZmljaWVudHMgPSBuZXcgSW50MzJBcnJheSh0d29TKTsKCSAgICAgICAgdmFyIG5vRXJyb3IgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHR3b1M7IGkrKykgewoJICAgICAgICAgICAgdmFyIGV2YWxSZXN1bHQgPSBwb2x5LmV2YWx1YXRlQXQoZmllbGQuZXhwKGkgKyBmaWVsZC5nZXRHZW5lcmF0b3JCYXNlKCkpKTsKCSAgICAgICAgICAgIHN5bmRyb21lQ29lZmZpY2llbnRzW3N5bmRyb21lQ29lZmZpY2llbnRzLmxlbmd0aCAtIDEgLSBpXSA9IGV2YWxSZXN1bHQ7CgkgICAgICAgICAgICBpZiAoZXZhbFJlc3VsdCAhPT0gMCkgewoJICAgICAgICAgICAgICAgIG5vRXJyb3IgPSBmYWxzZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBpZiAobm9FcnJvcikgewoJICAgICAgICAgICAgcmV0dXJuOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzeW5kcm9tZSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEuZGVmYXVsdChmaWVsZCwgc3luZHJvbWVDb2VmZmljaWVudHMpOwoJICAgICAgICB2YXIgc2lnbWFPbWVnYSA9IHRoaXMucnVuRXVjbGlkZWFuQWxnb3JpdGhtKGZpZWxkLmJ1aWxkTW9ub21pYWwodHdvUywgMSksIHN5bmRyb21lLCB0d29TKTsKCSAgICAgICAgdmFyIHNpZ21hID0gc2lnbWFPbWVnYVswXTsKCSAgICAgICAgdmFyIG9tZWdhID0gc2lnbWFPbWVnYVsxXTsKCSAgICAgICAgdmFyIGVycm9yTG9jYXRpb25zID0gdGhpcy5maW5kRXJyb3JMb2NhdGlvbnMoc2lnbWEpOwoJICAgICAgICB2YXIgZXJyb3JNYWduaXR1ZGVzID0gdGhpcy5maW5kRXJyb3JNYWduaXR1ZGVzKG9tZWdhLCBlcnJvckxvY2F0aW9ucyk7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXJyb3JMb2NhdGlvbnMubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IHJlY2VpdmVkLmxlbmd0aCAtIDEgLSBmaWVsZC5sb2coZXJyb3JMb2NhdGlvbnNbaV0pOwoJICAgICAgICAgICAgaWYgKHBvc2l0aW9uIDwgMCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBSZWVkU29sb21vbkV4Y2VwdGlvbl8xLmRlZmF1bHQoJ0JhZCBlcnJvciBsb2NhdGlvbicpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVjZWl2ZWRbcG9zaXRpb25dID0gR2VuZXJpY0dGXzEkMS5kZWZhdWx0LmFkZE9yU3VidHJhY3QocmVjZWl2ZWRbcG9zaXRpb25dLCBlcnJvck1hZ25pdHVkZXNbaV0pOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZWVkU29sb21vbkRlY29kZXIucHJvdG90eXBlLnJ1bkV1Y2xpZGVhbkFsZ29yaXRobSA9IGZ1bmN0aW9uIChhLCBiLCBSIC8qaW50Ki8pIHsKCSAgICAgICAgLy8gQXNzdW1lIGEncyBkZWdyZWUgaXMgPj0gYidzCgkgICAgICAgIGlmIChhLmdldERlZ3JlZSgpIDwgYi5nZXREZWdyZWUoKSkgewoJICAgICAgICAgICAgdmFyIHRlbXAgPSBhOwoJICAgICAgICAgICAgYSA9IGI7CgkgICAgICAgICAgICBiID0gdGVtcDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICB2YXIgckxhc3QgPSBhOwoJICAgICAgICB2YXIgciA9IGI7CgkgICAgICAgIHZhciB0TGFzdCA9IGZpZWxkLmdldFplcm8oKTsKCSAgICAgICAgdmFyIHQgPSBmaWVsZC5nZXRPbmUoKTsKCSAgICAgICAgLy8gUnVuIEV1Y2xpZGVhbiBhbGdvcml0aG0gdW50aWwgcidzIGRlZ3JlZSBpcyBsZXNzIHRoYW4gUi8yCgkgICAgICAgIHdoaWxlIChyLmdldERlZ3JlZSgpID49IChSIC8gMiB8IDApKSB7CgkgICAgICAgICAgICB2YXIgckxhc3RMYXN0ID0gckxhc3Q7CgkgICAgICAgICAgICB2YXIgdExhc3RMYXN0ID0gdExhc3Q7CgkgICAgICAgICAgICByTGFzdCA9IHI7CgkgICAgICAgICAgICB0TGFzdCA9IHQ7CgkgICAgICAgICAgICAvLyBEaXZpZGUgckxhc3RMYXN0IGJ5IHJMYXN0LCB3aXRoIHF1b3RpZW50IGluIHEgYW5kIHJlbWFpbmRlciBpbiByCgkgICAgICAgICAgICBpZiAockxhc3QuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgICAgICAvLyBPb3BzLCBFdWNsaWRlYW4gYWxnb3JpdGhtIGFscmVhZHkgdGVybWluYXRlZD8KCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUmVlZFNvbG9tb25FeGNlcHRpb25fMS5kZWZhdWx0KCdyX3tpLTF9IHdhcyB6ZXJvJyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByID0gckxhc3RMYXN0OwoJICAgICAgICAgICAgdmFyIHEgPSBmaWVsZC5nZXRaZXJvKCk7CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3JMZWFkaW5nVGVybSA9IHJMYXN0LmdldENvZWZmaWNpZW50KHJMYXN0LmdldERlZ3JlZSgpKTsKCSAgICAgICAgICAgIHZhciBkbHRJbnZlcnNlID0gZmllbGQuaW52ZXJzZShkZW5vbWluYXRvckxlYWRpbmdUZXJtKTsKCSAgICAgICAgICAgIHdoaWxlIChyLmdldERlZ3JlZSgpID49IHJMYXN0LmdldERlZ3JlZSgpICYmICFyLmlzWmVybygpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRlZ3JlZURpZmYgPSByLmdldERlZ3JlZSgpIC0gckxhc3QuZ2V0RGVncmVlKCk7CgkgICAgICAgICAgICAgICAgdmFyIHNjYWxlID0gZmllbGQubXVsdGlwbHkoci5nZXRDb2VmZmljaWVudChyLmdldERlZ3JlZSgpKSwgZGx0SW52ZXJzZSk7CgkgICAgICAgICAgICAgICAgcSA9IHEuYWRkT3JTdWJ0cmFjdChmaWVsZC5idWlsZE1vbm9taWFsKGRlZ3JlZURpZmYsIHNjYWxlKSk7CgkgICAgICAgICAgICAgICAgciA9IHIuYWRkT3JTdWJ0cmFjdChyTGFzdC5tdWx0aXBseUJ5TW9ub21pYWwoZGVncmVlRGlmZiwgc2NhbGUpKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHQgPSBxLm11bHRpcGx5KHRMYXN0KS5hZGRPclN1YnRyYWN0KHRMYXN0TGFzdCk7CgkgICAgICAgICAgICBpZiAoci5nZXREZWdyZWUoKSA+PSByTGFzdC5nZXREZWdyZWUoKSkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb25fMS5kZWZhdWx0KCdEaXZpc2lvbiBhbGdvcml0aG0gZmFpbGVkIHRvIHJlZHVjZSBwb2x5bm9taWFsPycpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciBzaWdtYVRpbGRlQXRaZXJvID0gdC5nZXRDb2VmZmljaWVudCgwKTsKCSAgICAgICAgaWYgKHNpZ21hVGlsZGVBdFplcm8gPT09IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBSZWVkU29sb21vbkV4Y2VwdGlvbl8xLmRlZmF1bHQoJ3NpZ21hVGlsZGUoMCkgd2FzIHplcm8nKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgaW52ZXJzZSA9IGZpZWxkLmludmVyc2Uoc2lnbWFUaWxkZUF0WmVybyk7CgkgICAgICAgIHZhciBzaWdtYSA9IHQubXVsdGlwbHlTY2FsYXIoaW52ZXJzZSk7CgkgICAgICAgIHZhciBvbWVnYSA9IHIubXVsdGlwbHlTY2FsYXIoaW52ZXJzZSk7CgkgICAgICAgIHJldHVybiBbc2lnbWEsIG9tZWdhXTsKCSAgICB9OwoJICAgIFJlZWRTb2xvbW9uRGVjb2Rlci5wcm90b3R5cGUuZmluZEVycm9yTG9jYXRpb25zID0gZnVuY3Rpb24gKGVycm9yTG9jYXRvcikgewoJICAgICAgICAvLyBUaGlzIGlzIGEgZGlyZWN0IGFwcGxpY2F0aW9uIG9mIENoaWVuJ3Mgc2VhcmNoCgkgICAgICAgIHZhciBudW1FcnJvcnMgPSBlcnJvckxvY2F0b3IuZ2V0RGVncmVlKCk7CgkgICAgICAgIGlmIChudW1FcnJvcnMgPT09IDEpIHsgLy8gc2hvcnRjdXQKCSAgICAgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW2Vycm9yTG9jYXRvci5nZXRDb2VmZmljaWVudCgxKV0pOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSBuZXcgSW50MzJBcnJheShudW1FcnJvcnMpOwoJICAgICAgICB2YXIgZSA9IDA7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgZmllbGQuZ2V0U2l6ZSgpICYmIGUgPCBudW1FcnJvcnM7IGkrKykgewoJICAgICAgICAgICAgaWYgKGVycm9yTG9jYXRvci5ldmFsdWF0ZUF0KGkpID09PSAwKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0W2VdID0gZmllbGQuaW52ZXJzZShpKTsKCSAgICAgICAgICAgICAgICBlKys7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGUgIT09IG51bUVycm9ycykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IFJlZWRTb2xvbW9uRXhjZXB0aW9uXzEuZGVmYXVsdCgnRXJyb3IgbG9jYXRvciBkZWdyZWUgZG9lcyBub3QgbWF0Y2ggbnVtYmVyIG9mIHJvb3RzJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIFJlZWRTb2xvbW9uRGVjb2Rlci5wcm90b3R5cGUuZmluZEVycm9yTWFnbml0dWRlcyA9IGZ1bmN0aW9uIChlcnJvckV2YWx1YXRvciwgZXJyb3JMb2NhdGlvbnMpIHsKCSAgICAgICAgLy8gVGhpcyBpcyBkaXJlY3RseSBhcHBseWluZyBGb3JuZXkncyBGb3JtdWxhCgkgICAgICAgIHZhciBzID0gZXJyb3JMb2NhdGlvbnMubGVuZ3RoOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IEludDMyQXJyYXkocyk7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgczsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgeGlJbnZlcnNlID0gZmllbGQuaW52ZXJzZShlcnJvckxvY2F0aW9uc1tpXSk7CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3IgPSAxOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzOyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAoaSAhPT0gaikgewoJICAgICAgICAgICAgICAgICAgICAvLyBkZW5vbWluYXRvciA9IGZpZWxkLm11bHRpcGx5KGRlbm9taW5hdG9yLAoJICAgICAgICAgICAgICAgICAgICAvLyAgICBHZW5lcmljR0YuYWRkT3JTdWJ0cmFjdCgxLCBmaWVsZC5tdWx0aXBseShlcnJvckxvY2F0aW9uc1tqXSwgeGlJbnZlcnNlKSkpCgkgICAgICAgICAgICAgICAgICAgIC8vIEFib3ZlIHNob3VsZCB3b3JrIGJ1dCBmYWlscyBvbiBzb21lIEFwcGxlIGFuZCBMaW51eCBKREtzIGR1ZSB0byBhIEhvdHNwb3QgYnVnLgoJICAgICAgICAgICAgICAgICAgICAvLyBCZWxvdyBpcyBhIGZ1bm55LWxvb2tpbmcgd29ya2Fyb3VuZCBmcm9tIFN0ZXZlbiBQYXJrZXMKCSAgICAgICAgICAgICAgICAgICAgdmFyIHRlcm0gPSBmaWVsZC5tdWx0aXBseShlcnJvckxvY2F0aW9uc1tqXSwgeGlJbnZlcnNlKTsKCSAgICAgICAgICAgICAgICAgICAgdmFyIHRlcm1QbHVzMSA9ICh0ZXJtICYgMHgxKSA9PT0gMCA/IHRlcm0gfCAxIDogdGVybSAmIH4xOwoJICAgICAgICAgICAgICAgICAgICBkZW5vbWluYXRvciA9IGZpZWxkLm11bHRpcGx5KGRlbm9taW5hdG9yLCB0ZXJtUGx1czEpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdFtpXSA9IGZpZWxkLm11bHRpcGx5KGVycm9yRXZhbHVhdG9yLmV2YWx1YXRlQXQoeGlJbnZlcnNlKSwgZmllbGQuaW52ZXJzZShkZW5vbWluYXRvcikpOwoJICAgICAgICAgICAgaWYgKGZpZWxkLmdldEdlbmVyYXRvckJhc2UoKSAhPT0gMCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdFtpXSA9IGZpZWxkLm11bHRpcGx5KHJlc3VsdFtpXSwgeGlJbnZlcnNlKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgcmV0dXJuIFJlZWRTb2xvbW9uRGVjb2RlcjsKCX0oKSk7CglSZWVkU29sb21vbkRlY29kZXIkMS5kZWZhdWx0ID0gUmVlZFNvbG9tb25EZWNvZGVyOwoKCXZhciBCaXRNYXRyaXhQYXJzZXIkMSA9IHt9OwoKCXZhciBWZXJzaW9uJDEgPSB7fTsKCgl2YXIgRm9ybWF0SW5mb3JtYXRpb24kMSA9IHt9OwoKCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbCA9IHt9OwoKCXZhciBBcmd1bWVudEV4Y2VwdGlvbiQxID0ge307CgoJdmFyIF9fZXh0ZW5kcyQzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFyZ3VtZW50RXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBFeGNlcHRpb25fMSA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBBcmd1bWVudEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkMyhBcmd1bWVudEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBBcmd1bWVudEV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBBcmd1bWVudEV4Y2VwdGlvbi5raW5kID0gJ0FyZ3VtZW50RXhjZXB0aW9uJzsKCSAgICByZXR1cm4gQXJndW1lbnRFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xLmRlZmF1bHQpKTsKCUFyZ3VtZW50RXhjZXB0aW9uJDEuZGVmYXVsdCA9IEFyZ3VtZW50RXhjZXB0aW9uOwoKCShmdW5jdGlvbiAoZXhwb3J0cykgewoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CglleHBvcnRzLkVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzID0gdm9pZCAwOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBBcmd1bWVudEV4Y2VwdGlvbl8xID0gQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJdmFyIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzOwoJKGZ1bmN0aW9uIChFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcykgewoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzW0Vycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzWyJMIl0gPSAwXSA9ICJMIjsKCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlc1tFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlc1siTSJdID0gMV0gPSAiTSI7CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXNbRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXNbIlEiXSA9IDJdID0gIlEiOwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzW0Vycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzWyJIIl0gPSAzXSA9ICJIIjsKCX0pKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzID0gZXhwb3J0cy5FcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcyB8fCAoZXhwb3J0cy5FcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcyA9IHt9KSk7CgkvKioKCSAqIDxwPlNlZSBJU08gMTgwMDQ6MjAwNiwgNi41LjEuIFRoaXMgZW51bSBlbmNhcHN1bGF0ZXMgdGhlIGZvdXIgZXJyb3IgY29ycmVjdGlvbiBsZXZlbHMKCSAqIGRlZmluZWQgYnkgdGhlIFFSIGNvZGUgc3RhbmRhcmQuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBFcnJvckNvcnJlY3Rpb25MZXZlbCh2YWx1ZSwgc3RyaW5nVmFsdWUsIGJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuc3RyaW5nVmFsdWUgPSBzdHJpbmdWYWx1ZTsKCSAgICAgICAgdGhpcy5iaXRzID0gYml0czsKCSAgICAgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuc2V0KGJpdHMsIHRoaXMpOwoJICAgICAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5GT1JfVkFMVUUuc2V0KHZhbHVlLCB0aGlzKTsKCSAgICB9CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTsKCSAgICB9OwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsLnByb3RvdHlwZS5nZXRCaXRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRzOwoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuZnJvbVN0cmluZyA9IGZ1bmN0aW9uIChzKSB7CgkgICAgICAgIHN3aXRjaCAocykgewoJICAgICAgICAgICAgY2FzZSAnTCc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5MOwoJICAgICAgICAgICAgY2FzZSAnTSc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5NOwoJICAgICAgICAgICAgY2FzZSAnUSc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5ROwoJICAgICAgICAgICAgY2FzZSAnSCc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5IOwoJICAgICAgICAgICAgZGVmYXVsdDogdGhyb3cgbmV3IEFyZ3VtZW50RXhjZXB0aW9uXzEuZGVmYXVsdChzICsgJ25vdCBhdmFpbGFibGUnKTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdWYWx1ZTsKCSAgICB9OwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICBpZiAoIShvIGluc3RhbmNlb2YgRXJyb3JDb3JyZWN0aW9uTGV2ZWwpKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG90aGVyID0gbzsKCSAgICAgICAgcmV0dXJuIHRoaXMudmFsdWUgPT09IG90aGVyLnZhbHVlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJpdHMgaW50IGNvbnRhaW5pbmcgdGhlIHR3byBiaXRzIGVuY29kaW5nIGEgUVIgQ29kZSdzIGVycm9yIGNvcnJlY3Rpb24gbGV2ZWwKCSAgICAgKiBAcmV0dXJuIEVycm9yQ29ycmVjdGlvbkxldmVsIHJlcHJlc2VudGluZyB0aGUgZW5jb2RlZCBlcnJvciBjb3JyZWN0aW9uIGxldmVsCgkgICAgICovCgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuZm9yQml0cyA9IGZ1bmN0aW9uIChiaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGJpdHMgPCAwIHx8IGJpdHMgPj0gRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuc2l6ZSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuZ2V0KGJpdHMpOwoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMgPSBuZXcgTWFwKCk7CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX1ZBTFVFID0gbmV3IE1hcCgpOwoJICAgIC8qKiBMID0gfjclIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5MID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLkwsICdMJywgMHgwMSk7CgkgICAgLyoqIE0gPSB+MTUlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5NID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLk0sICdNJywgMHgwMCk7CgkgICAgLyoqIFEgPSB+MjUlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5RID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLlEsICdRJywgMHgwMyk7CgkgICAgLyoqIEggPSB+MzAlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5IID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLkgsICdIJywgMHgwMik7CgkgICAgcmV0dXJuIEVycm9yQ29ycmVjdGlvbkxldmVsOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IEVycm9yQ29ycmVjdGlvbkxldmVsOwoKCX0oRXJyb3JDb3JyZWN0aW9uTGV2ZWwpKTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDYgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRm9ybWF0SW5mb3JtYXRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbF8xID0gRXJyb3JDb3JyZWN0aW9uTGV2ZWw7Cgl2YXIgSW50ZWdlcl8xID0gSW50ZWdlciQxOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgYSBRUiBDb2RlJ3MgZm9ybWF0IGluZm9ybWF0aW9uLCBpbmNsdWRpbmcgdGhlIGRhdGEgbWFzayB1c2VkIGFuZAoJICogZXJyb3IgY29ycmVjdGlvbiBsZXZlbC48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBzZWUgRGF0YU1hc2sKCSAqIEBzZWUgRXJyb3JDb3JyZWN0aW9uTGV2ZWwKCSAqLwoJdmFyIEZvcm1hdEluZm9ybWF0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEZvcm1hdEluZm9ybWF0aW9uKGZvcm1hdEluZm8gLyppbnQqLykgewoJICAgICAgICAvLyBCaXRzIDMsNAoJICAgICAgICB0aGlzLmVycm9yQ29ycmVjdGlvbkxldmVsID0gRXJyb3JDb3JyZWN0aW9uTGV2ZWxfMS5kZWZhdWx0LmZvckJpdHMoKGZvcm1hdEluZm8gPj4gMykgJiAweDAzKTsKCSAgICAgICAgLy8gQm90dG9tIDMgYml0cwoJICAgICAgICB0aGlzLmRhdGFNYXNrID0gLyooYnl0ZSkgKi8gKGZvcm1hdEluZm8gJiAweDA3KTsKCSAgICB9CgkgICAgRm9ybWF0SW5mb3JtYXRpb24ubnVtQml0c0RpZmZlcmluZyA9IGZ1bmN0aW9uIChhIC8qaW50Ki8sIGIgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gSW50ZWdlcl8xLmRlZmF1bHQuYml0Q291bnQoYSBeIGIpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIG1hc2tlZEZvcm1hdEluZm8xIGZvcm1hdCBpbmZvIGluZGljYXRvciwgd2l0aCBtYXNrIHN0aWxsIGFwcGxpZWQKCSAgICAgKiBAcGFyYW0gbWFza2VkRm9ybWF0SW5mbzIgc2Vjb25kIGNvcHkgb2Ygc2FtZSBpbmZvOyBib3RoIGFyZSBjaGVja2VkIGF0IHRoZSBzYW1lIHRpbWUKCSAgICAgKiAgdG8gZXN0YWJsaXNoIGJlc3QgbWF0Y2gKCSAgICAgKiBAcmV0dXJuIGluZm9ybWF0aW9uIGFib3V0IHRoZSBmb3JtYXQgaXQgc3BlY2lmaWVzLCBvciB7QGNvZGUgbnVsbH0KCSAgICAgKiAgaWYgZG9lc24ndCBzZWVtIHRvIG1hdGNoIGFueSBrbm93biBwYXR0ZXJuCgkgICAgICovCgkgICAgRm9ybWF0SW5mb3JtYXRpb24uZGVjb2RlRm9ybWF0SW5mb3JtYXRpb24gPSBmdW5jdGlvbiAobWFza2VkRm9ybWF0SW5mbzEgLyppbnQqLywgbWFza2VkRm9ybWF0SW5mbzIgLyppbnQqLykgewoJICAgICAgICB2YXIgZm9ybWF0SW5mbyA9IEZvcm1hdEluZm9ybWF0aW9uLmRvRGVjb2RlRm9ybWF0SW5mb3JtYXRpb24obWFza2VkRm9ybWF0SW5mbzEsIG1hc2tlZEZvcm1hdEluZm8yKTsKCSAgICAgICAgaWYgKGZvcm1hdEluZm8gIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiBmb3JtYXRJbmZvOwoJICAgICAgICB9CgkgICAgICAgIC8vIFNob3VsZCByZXR1cm4gbnVsbCwgYnV0LCBzb21lIFFSIGNvZGVzIGFwcGFyZW50bHkKCSAgICAgICAgLy8gZG8gbm90IG1hc2sgdGhpcyBpbmZvLiBUcnkgYWdhaW4gYnkgYWN0dWFsbHkgbWFza2luZyB0aGUgcGF0dGVybgoJICAgICAgICAvLyBmaXJzdAoJICAgICAgICByZXR1cm4gRm9ybWF0SW5mb3JtYXRpb24uZG9EZWNvZGVGb3JtYXRJbmZvcm1hdGlvbihtYXNrZWRGb3JtYXRJbmZvMSBeIEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX01BU0tfUVIsIG1hc2tlZEZvcm1hdEluZm8yIF4gRm9ybWF0SW5mb3JtYXRpb24uRk9STUFUX0lORk9fTUFTS19RUik7CgkgICAgfTsKCSAgICBGb3JtYXRJbmZvcm1hdGlvbi5kb0RlY29kZUZvcm1hdEluZm9ybWF0aW9uID0gZnVuY3Rpb24gKG1hc2tlZEZvcm1hdEluZm8xIC8qaW50Ki8sIG1hc2tlZEZvcm1hdEluZm8yIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGVfMSwgX2E7CgkgICAgICAgIC8vIEZpbmQgdGhlIGludCBpbiBGT1JNQVRfSU5GT19ERUNPREVfTE9PS1VQIHdpdGggZmV3ZXN0IGJpdHMgZGlmZmVyaW5nCgkgICAgICAgIHZhciBiZXN0RGlmZmVyZW5jZSA9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSOwoJICAgICAgICB2YXIgYmVzdEZvcm1hdEluZm8gPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgX2IgPSBfX3ZhbHVlcyQ2KEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX0RFQ09ERV9MT09LVVApLCBfYyA9IF9iLm5leHQoKTsgIV9jLmRvbmU7IF9jID0gX2IubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRlY29kZUluZm8gPSBfYy52YWx1ZTsKCSAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0SW5mbyA9IGRlY29kZUluZm9bMF07CgkgICAgICAgICAgICAgICAgaWYgKHRhcmdldEluZm8gPT09IG1hc2tlZEZvcm1hdEluZm8xIHx8IHRhcmdldEluZm8gPT09IG1hc2tlZEZvcm1hdEluZm8yKSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIEZvdW5kIGFuIGV4YWN0IG1hdGNoCgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRm9ybWF0SW5mb3JtYXRpb24oZGVjb2RlSW5mb1sxXSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHZhciBiaXRzRGlmZmVyZW5jZSA9IEZvcm1hdEluZm9ybWF0aW9uLm51bUJpdHNEaWZmZXJpbmcobWFza2VkRm9ybWF0SW5mbzEsIHRhcmdldEluZm8pOwoJICAgICAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgICAgIGJlc3RGb3JtYXRJbmZvID0gZGVjb2RlSW5mb1sxXTsKCSAgICAgICAgICAgICAgICAgICAgYmVzdERpZmZlcmVuY2UgPSBiaXRzRGlmZmVyZW5jZTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgaWYgKG1hc2tlZEZvcm1hdEluZm8xICE9PSBtYXNrZWRGb3JtYXRJbmZvMikgewoJICAgICAgICAgICAgICAgICAgICAvLyBhbHNvIHRyeSB0aGUgb3RoZXIgb3B0aW9uCgkgICAgICAgICAgICAgICAgICAgIGJpdHNEaWZmZXJlbmNlID0gRm9ybWF0SW5mb3JtYXRpb24ubnVtQml0c0RpZmZlcmluZyhtYXNrZWRGb3JtYXRJbmZvMiwgdGFyZ2V0SW5mbyk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBiZXN0Rm9ybWF0SW5mbyA9IGRlY29kZUluZm9bMV07CgkgICAgICAgICAgICAgICAgICAgICAgICBiZXN0RGlmZmVyZW5jZSA9IGJpdHNEaWZmZXJlbmNlOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzFfMSkgeyBlXzEgPSB7IGVycm9yOiBlXzFfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2MgJiYgIV9jLmRvbmUgJiYgKF9hID0gX2IucmV0dXJuKSkgX2EuY2FsbChfYik7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gSGFtbWluZyBkaXN0YW5jZSBvZiB0aGUgMzIgbWFza2VkIGNvZGVzIGlzIDcsIGJ5IGNvbnN0cnVjdGlvbiwgc28gPD0gMyBiaXRzCgkgICAgICAgIC8vIGRpZmZlcmluZyBtZWFucyB3ZSBmb3VuZCBhIG1hdGNoCgkgICAgICAgIGlmIChiZXN0RGlmZmVyZW5jZSA8PSAzKSB7CgkgICAgICAgICAgICByZXR1cm4gbmV3IEZvcm1hdEluZm9ybWF0aW9uKGJlc3RGb3JtYXRJbmZvKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbnVsbDsKCSAgICB9OwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLnByb3RvdHlwZS5nZXRFcnJvckNvcnJlY3Rpb25MZXZlbCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZXJyb3JDb3JyZWN0aW9uTGV2ZWw7CgkgICAgfTsKCSAgICBGb3JtYXRJbmZvcm1hdGlvbi5wcm90b3R5cGUuZ2V0RGF0YU1hc2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRhdGFNYXNrOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICh0aGlzLmVycm9yQ29ycmVjdGlvbkxldmVsLmdldEJpdHMoKSA8PCAzKSB8IHRoaXMuZGF0YU1hc2s7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgRm9ybWF0SW5mb3JtYXRpb24ucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIChvKSB7CgkgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBGb3JtYXRJbmZvcm1hdGlvbikpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgb3RoZXIgPSBvOwoJICAgICAgICByZXR1cm4gdGhpcy5lcnJvckNvcnJlY3Rpb25MZXZlbCA9PT0gb3RoZXIuZXJyb3JDb3JyZWN0aW9uTGV2ZWwgJiYKCSAgICAgICAgICAgIHRoaXMuZGF0YU1hc2sgPT09IG90aGVyLmRhdGFNYXNrOwoJICAgIH07CgkgICAgRm9ybWF0SW5mb3JtYXRpb24uRk9STUFUX0lORk9fTUFTS19RUiA9IDB4NTQxMjsKCSAgICAvKioKCSAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYsIEFubmV4IEMsIFRhYmxlIEMuMQoJICAgICAqLwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX0RFQ09ERV9MT09LVVAgPSBbCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1NDEyLCAweDAwXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1MTI1LCAweDAxXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1RTdDLCAweDAyXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1QjRCLCAweDAzXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0NUY5LCAweDA0XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0MENFLCAweDA1XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0Rjk3LCAweDA2XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0QUEwLCAweDA3XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3N0M0LCAweDA4XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3MkYzLCAweDA5XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3REFBLCAweDBBXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3ODlELCAweDBCXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2NjJGLCAweDBDXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2MzE4LCAweDBEXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2QzQxLCAweDBFXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2OTc2LCAweDBGXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxNjg5LCAweDEwXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxM0JFLCAweDExXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxQ0U3LCAweDEyXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxOUQwLCAweDEzXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwNzYyLCAweDE0XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwMjU1LCAweDE1XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwRDBDLCAweDE2XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwODNCLCAweDE3XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzNTVGLCAweDE4XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzMDY4LCAweDE5XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzRjMxLCAweDFBXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzQTA2LCAweDFCXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyNEI0LCAweDFDXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyMTgzLCAweDFEXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyRURBLCAweDFFXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyQkVELCAweDFGXSksCgkgICAgXTsKCSAgICByZXR1cm4gRm9ybWF0SW5mb3JtYXRpb247Cgl9KCkpOwoJRm9ybWF0SW5mb3JtYXRpb24kMS5kZWZhdWx0ID0gRm9ybWF0SW5mb3JtYXRpb247CgoJdmFyIEVDQmxvY2tzJDEgPSB7fTsKCgl2YXIgX192YWx1ZXMkNSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX3ZhbHVlcykgfHwgZnVuY3Rpb24obykgewoJICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwOwoJICAgIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pOwoJICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHJldHVybiB7CgkgICAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7CgkgICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHRocm93IG5ldyBUeXBlRXJyb3IocyA/ICJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLiIgOiAiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpOwoJfTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFQ0Jsb2NrcyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIHNldCBvZiBlcnJvci1jb3JyZWN0aW9uIGJsb2NrcyBpbiBvbmUgc3ltYm9sIHZlcnNpb24uIE1vc3QgdmVyc2lvbnMgd2lsbAoJICogdXNlIGJsb2NrcyBvZiBkaWZmZXJpbmcgc2l6ZXMgd2l0aGluIG9uZSB2ZXJzaW9uLCBzbywgdGhpcyBlbmNhcHN1bGF0ZXMgdGhlIHBhcmFtZXRlcnMgZm9yCgkgKiBlYWNoIHNldCBvZiBibG9ja3MuIEl0IGFsc28gaG9sZHMgdGhlIG51bWJlciBvZiBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyBwZXIgYmxvY2sgc2luY2UgaXQKCSAqIHdpbGwgYmUgdGhlIHNhbWUgYWNyb3NzIGFsbCBibG9ja3Mgd2l0aGluIG9uZSB2ZXJzaW9uLjwvcD4KCSAqLwoJdmFyIEVDQmxvY2tzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEVDQmxvY2tzKGVjQ29kZXdvcmRzUGVyQmxvY2sgLyppbnQqLykgewoJICAgICAgICB2YXIgZWNCbG9ja3MgPSBbXTsKCSAgICAgICAgZm9yICh2YXIgX2kgPSAxOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgICAgICAgIGVjQmxvY2tzW19pIC0gMV0gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuZWNDb2Rld29yZHNQZXJCbG9jayA9IGVjQ29kZXdvcmRzUGVyQmxvY2s7CgkgICAgICAgIHRoaXMuZWNCbG9ja3MgPSBlY0Jsb2NrczsKCSAgICB9CgkgICAgRUNCbG9ja3MucHJvdG90eXBlLmdldEVDQ29kZXdvcmRzUGVyQmxvY2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmVjQ29kZXdvcmRzUGVyQmxvY2s7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0TnVtQmxvY2tzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIHRvdGFsID0gMDsKCSAgICAgICAgdmFyIGVjQmxvY2tzID0gdGhpcy5lY0Jsb2NrczsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIGVjQmxvY2tzXzEgPSBfX3ZhbHVlcyQ1KGVjQmxvY2tzKSwgZWNCbG9ja3NfMV8xID0gZWNCbG9ja3NfMS5uZXh0KCk7ICFlY0Jsb2Nrc18xXzEuZG9uZTsgZWNCbG9ja3NfMV8xID0gZWNCbG9ja3NfMS5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZWNCbG9jayA9IGVjQmxvY2tzXzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbCArPSBlY0Jsb2NrLmdldENvdW50KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChlY0Jsb2Nrc18xXzEgJiYgIWVjQmxvY2tzXzFfMS5kb25lICYmIChfYSA9IGVjQmxvY2tzXzEucmV0dXJuKSkgX2EuY2FsbChlY0Jsb2Nrc18xKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdG90YWw7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0VG90YWxFQ0NvZGV3b3JkcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZWNDb2Rld29yZHNQZXJCbG9jayAqIHRoaXMuZ2V0TnVtQmxvY2tzKCk7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0RUNCbG9ja3MgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmVjQmxvY2tzOwoJICAgIH07CgkgICAgcmV0dXJuIEVDQmxvY2tzOwoJfSgpKTsKCUVDQmxvY2tzJDEuZGVmYXVsdCA9IEVDQmxvY2tzOwoKCXZhciBFQ0IkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFQ0IkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgdGhlIHBhcmFtZXRlcnMgZm9yIG9uZSBlcnJvci1jb3JyZWN0aW9uIGJsb2NrIGluIG9uZSBzeW1ib2wgdmVyc2lvbi4KCSAqIFRoaXMgaW5jbHVkZXMgdGhlIG51bWJlciBvZiBkYXRhIGNvZGV3b3JkcywgYW5kIHRoZSBudW1iZXIgb2YgdGltZXMgYSBibG9jayB3aXRoIHRoZXNlCgkgKiBwYXJhbWV0ZXJzIGlzIHVzZWQgY29uc2VjdXRpdmVseSBpbiB0aGUgUVIgY29kZSB2ZXJzaW9uJ3MgZm9ybWF0LjwvcD4KCSAqLwoJdmFyIEVDQiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBFQ0IoY291bnQgLyppbnQqLywgZGF0YUNvZGV3b3JkcyAvKmludCovKSB7CgkgICAgICAgIHRoaXMuY291bnQgPSBjb3VudDsKCSAgICAgICAgdGhpcy5kYXRhQ29kZXdvcmRzID0gZGF0YUNvZGV3b3JkczsKCSAgICB9CgkgICAgRUNCLnByb3RvdHlwZS5nZXRDb3VudCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY291bnQ7CgkgICAgfTsKCSAgICBFQ0IucHJvdG90eXBlLmdldERhdGFDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRhdGFDb2Rld29yZHM7CgkgICAgfTsKCSAgICByZXR1cm4gRUNCOwoJfSgpKTsKCUVDQiQxLmRlZmF1bHQgPSBFQ0I7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX3ZhbHVlcyQ0ID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFZlcnNpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBCaXRNYXRyaXhfMSQzID0gQml0TWF0cml4JDE7Cgl2YXIgRm9ybWF0SW5mb3JtYXRpb25fMSQxID0gRm9ybWF0SW5mb3JtYXRpb24kMTsKCXZhciBFQ0Jsb2Nrc18xID0gRUNCbG9ja3MkMTsKCXZhciBFQ0JfMSA9IEVDQiQxOwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xJDIgPSBGb3JtYXRFeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQyID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7CgkvKioKCSAqIFNlZSBJU08gMTgwMDQ6MjAwNiBBbm5leCBECgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFZlcnNpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gVmVyc2lvbih2ZXJzaW9uTnVtYmVyIC8qaW50Ki8sIGFsaWdubWVudFBhdHRlcm5DZW50ZXJzKSB7CgkgICAgICAgIHZhciBlXzEsIF9hOwoJICAgICAgICB2YXIgZWNCbG9ja3MgPSBbXTsKCSAgICAgICAgZm9yICh2YXIgX2kgPSAyOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgICAgICAgIGVjQmxvY2tzW19pIC0gMl0gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMudmVyc2lvbk51bWJlciA9IHZlcnNpb25OdW1iZXI7CgkgICAgICAgIHRoaXMuYWxpZ25tZW50UGF0dGVybkNlbnRlcnMgPSBhbGlnbm1lbnRQYXR0ZXJuQ2VudGVyczsKCSAgICAgICAgdGhpcy5lY0Jsb2NrcyA9IGVjQmxvY2tzOwoJICAgICAgICB2YXIgdG90YWwgPSAwOwoJICAgICAgICB2YXIgZWNDb2Rld29yZHMgPSBlY0Jsb2Nrc1swXS5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCk7CgkgICAgICAgIHZhciBlY2JBcnJheSA9IGVjQmxvY2tzWzBdLmdldEVDQmxvY2tzKCk7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICBmb3IgKHZhciBlY2JBcnJheV8xID0gX192YWx1ZXMkNChlY2JBcnJheSksIGVjYkFycmF5XzFfMSA9IGVjYkFycmF5XzEubmV4dCgpOyAhZWNiQXJyYXlfMV8xLmRvbmU7IGVjYkFycmF5XzFfMSA9IGVjYkFycmF5XzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGVjQmxvY2sgPSBlY2JBcnJheV8xXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgdG90YWwgKz0gZWNCbG9jay5nZXRDb3VudCgpICogKGVjQmxvY2suZ2V0RGF0YUNvZGV3b3JkcygpICsgZWNDb2Rld29yZHMpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzFfMSkgeyBlXzEgPSB7IGVycm9yOiBlXzFfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoZWNiQXJyYXlfMV8xICYmICFlY2JBcnJheV8xXzEuZG9uZSAmJiAoX2EgPSBlY2JBcnJheV8xLnJldHVybikpIF9hLmNhbGwoZWNiQXJyYXlfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy50b3RhbENvZGV3b3JkcyA9IHRvdGFsOwoJICAgIH0KCSAgICBWZXJzaW9uLnByb3RvdHlwZS5nZXRWZXJzaW9uTnVtYmVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52ZXJzaW9uTnVtYmVyOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0QWxpZ25tZW50UGF0dGVybkNlbnRlcnMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0VG90YWxDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnRvdGFsQ29kZXdvcmRzOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0RGltZW5zaW9uRm9yVmVyc2lvbiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDE3ICsgNCAqIHRoaXMudmVyc2lvbk51bWJlcjsKCSAgICB9OwoJICAgIFZlcnNpb24ucHJvdG90eXBlLmdldEVDQmxvY2tzRm9yTGV2ZWwgPSBmdW5jdGlvbiAoZWNMZXZlbCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lY0Jsb2Nrc1tlY0xldmVsLmdldFZhbHVlKCldOwoJICAgICAgICAvLyBUWVBFU0NSSVBUUE9SVDogb3JpZ2luYWwgd2FzIHVzaW5nIG9yZGluYWwsIGFuZCB1c2luZyB0aGUgb3JkZXIgb2YgbGV2ZWxzIGFzIGRlZmluZWQgaW4gRXJyb3JDb3JyZWN0aW9uTGV2ZWwgZW51bSAoTE1RSCkKCSAgICAgICAgLy8gSSB3aWxsIHVzZSB0aGUgZGlyZWN0IHZhbHVlIGZyb20gRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXMgZW51bSB3aGljaCBpbiB0eXBlc2NyaXB0IGdvZXMgdG8gYSBudW1iZXIKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkRlZHVjZXMgdmVyc2lvbiBpbmZvcm1hdGlvbiBwdXJlbHkgZnJvbSBRUiBDb2RlIGRpbWVuc2lvbnMuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGRpbWVuc2lvbiBkaW1lbnNpb24gaW4gbW9kdWxlcwoJICAgICAqIEByZXR1cm4gVmVyc2lvbiBmb3IgYSBRUiBDb2RlIG9mIHRoYXQgZGltZW5zaW9uCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgZGltZW5zaW9uIGlzIG5vdCAxIG1vZCA0CgkgICAgICovCgkgICAgVmVyc2lvbi5nZXRQcm92aXNpb25hbFZlcnNpb25Gb3JEaW1lbnNpb24gPSBmdW5jdGlvbiAoZGltZW5zaW9uIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGRpbWVuc2lvbiAlIDQgIT09IDEpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMSQyLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmVyc2lvbkZvck51bWJlcigoZGltZW5zaW9uIC0gMTcpIC8gNCk7CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlnbm9yZWQgLyo6IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEkMi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFZlcnNpb24uZ2V0VmVyc2lvbkZvck51bWJlciA9IGZ1bmN0aW9uICh2ZXJzaW9uTnVtYmVyIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKHZlcnNpb25OdW1iZXIgPCAxIHx8IHZlcnNpb25OdW1iZXIgPiA0MCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDIuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBWZXJzaW9uLlZFUlNJT05TW3ZlcnNpb25OdW1iZXIgLSAxXTsKCSAgICB9OwoJICAgIFZlcnNpb24uZGVjb2RlVmVyc2lvbkluZm9ybWF0aW9uID0gZnVuY3Rpb24gKHZlcnNpb25CaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGJlc3REaWZmZXJlbmNlID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgICAgIHZhciBiZXN0VmVyc2lvbiA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgVmVyc2lvbi5WRVJTSU9OX0RFQ09ERV9JTkZPLmxlbmd0aDsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgdGFyZ2V0VmVyc2lvbiA9IFZlcnNpb24uVkVSU0lPTl9ERUNPREVfSU5GT1tpXTsKCSAgICAgICAgICAgIC8vIERvIHRoZSB2ZXJzaW9uIGluZm8gYml0cyBtYXRjaCBleGFjdGx5PyBkb25lLgoJICAgICAgICAgICAgaWYgKHRhcmdldFZlcnNpb24gPT09IHZlcnNpb25CaXRzKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIFZlcnNpb24uZ2V0VmVyc2lvbkZvck51bWJlcihpICsgNyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBPdGhlcndpc2Ugc2VlIGlmIHRoaXMgaXMgdGhlIGNsb3Nlc3QgdG8gYSByZWFsIHZlcnNpb24gaW5mbyBiaXQgc3RyaW5nCgkgICAgICAgICAgICAvLyB3ZSBoYXZlIHNlZW4gc28gZmFyCgkgICAgICAgICAgICB2YXIgYml0c0RpZmZlcmVuY2UgPSBGb3JtYXRJbmZvcm1hdGlvbl8xJDEuZGVmYXVsdC5udW1CaXRzRGlmZmVyaW5nKHZlcnNpb25CaXRzLCB0YXJnZXRWZXJzaW9uKTsKCSAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgYmVzdFZlcnNpb24gPSBpICsgNzsKCSAgICAgICAgICAgICAgICBiZXN0RGlmZmVyZW5jZSA9IGJpdHNEaWZmZXJlbmNlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIFdlIGNhbiB0b2xlcmF0ZSB1cCB0byAzIGJpdHMgb2YgZXJyb3Igc2luY2Ugbm8gdHdvIHZlcnNpb24gaW5mbyBjb2Rld29yZHMgd2lsbAoJICAgICAgICAvLyBkaWZmZXIgaW4gbGVzcyB0aGFuIDggYml0cy4KCSAgICAgICAgaWYgKGJlc3REaWZmZXJlbmNlIDw9IDMpIHsKCSAgICAgICAgICAgIHJldHVybiBWZXJzaW9uLmdldFZlcnNpb25Gb3JOdW1iZXIoYmVzdFZlcnNpb24pOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHdlIGRpZG4ndCBmaW5kIGEgY2xvc2UgZW5vdWdoIG1hdGNoLCBmYWlsCgkgICAgICAgIHJldHVybiBudWxsOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogU2VlIElTTyAxODAwNDoyMDA2IEFubmV4IEUKCSAgICAgKi8KCSAgICBWZXJzaW9uLnByb3RvdHlwZS5idWlsZEZ1bmN0aW9uUGF0dGVybiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuZ2V0RGltZW5zaW9uRm9yVmVyc2lvbigpOwoJICAgICAgICB2YXIgYml0TWF0cml4ID0gbmV3IEJpdE1hdHJpeF8xJDMuZGVmYXVsdChkaW1lbnNpb24pOwoJICAgICAgICAvLyBUb3AgbGVmdCBmaW5kZXIgcGF0dGVybiArIHNlcGFyYXRvciArIGZvcm1hdAoJICAgICAgICBiaXRNYXRyaXguc2V0UmVnaW9uKDAsIDAsIDksIDkpOwoJICAgICAgICAvLyBUb3AgcmlnaHQgZmluZGVyIHBhdHRlcm4gKyBzZXBhcmF0b3IgKyBmb3JtYXQKCSAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbihkaW1lbnNpb24gLSA4LCAwLCA4LCA5KTsKCSAgICAgICAgLy8gQm90dG9tIGxlZnQgZmluZGVyIHBhdHRlcm4gKyBzZXBhcmF0b3IgKyBmb3JtYXQKCSAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbigwLCBkaW1lbnNpb24gLSA4LCA5LCA4KTsKCSAgICAgICAgLy8gQWxpZ25tZW50IHBhdHRlcm5zCgkgICAgICAgIHZhciBtYXggPSB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBtYXg7IHgrKykgewoJICAgICAgICAgICAgdmFyIGkgPSB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzW3hdIC0gMjsKCSAgICAgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgbWF4OyB5KyspIHsKCSAgICAgICAgICAgICAgICBpZiAoKHggPT09IDAgJiYgKHkgPT09IDAgfHwgeSA9PT0gbWF4IC0gMSkpIHx8ICh4ID09PSBtYXggLSAxICYmIHkgPT09IDApKSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIE5vIGFsaWdubWVudCBwYXR0ZXJucyBuZWFyIHRoZSB0aHJlZSBmaW5kZXIgcGF0dGVybnMKCSAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24odGhpcy5hbGlnbm1lbnRQYXR0ZXJuQ2VudGVyc1t5XSAtIDIsIGksIDUsIDUpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIFZlcnRpY2FsIHRpbWluZyBwYXR0ZXJuCgkgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oNiwgOSwgMSwgZGltZW5zaW9uIC0gMTcpOwoJICAgICAgICAvLyBIb3Jpem9udGFsIHRpbWluZyBwYXR0ZXJuCgkgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oOSwgNiwgZGltZW5zaW9uIC0gMTcsIDEpOwoJICAgICAgICBpZiAodGhpcy52ZXJzaW9uTnVtYmVyID4gNikgewoJICAgICAgICAgICAgLy8gVmVyc2lvbiBpbmZvLCB0b3AgcmlnaHQKCSAgICAgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oZGltZW5zaW9uIC0gMTEsIDAsIDMsIDYpOwoJICAgICAgICAgICAgLy8gVmVyc2lvbiBpbmZvLCBib3R0b20gbGVmdAoJICAgICAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbigwLCBkaW1lbnNpb24gLSAxMSwgNiwgMyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdE1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBWZXJzaW9uLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICcnICsgdGhpcy52ZXJzaW9uTnVtYmVyOwoJICAgIH07CgkgICAgLyoqCgkgICAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYgQW5uZXggRC4KCSAgICAgICAqIEVsZW1lbnQgaSByZXByZXNlbnRzIHRoZSByYXcgdmVyc2lvbiBiaXRzIHRoYXQgc3BlY2lmeSB2ZXJzaW9uIGkgKyA3CgkgICAgICAgKi8KCSAgICBWZXJzaW9uLlZFUlNJT05fREVDT0RFX0lORk8gPSBJbnQzMkFycmF5LmZyb20oWwoJICAgICAgICAweDA3Qzk0LCAweDA4NUJDLCAweDA5QTk5LCAweDBBNEQzLCAweDBCQkY2LAoJICAgICAgICAweDBDNzYyLCAweDBEODQ3LCAweDBFNjBELCAweDBGOTI4LCAweDEwQjc4LAoJICAgICAgICAweDExNDVELCAweDEyQTE3LCAweDEzNTMyLCAweDE0OUE2LCAweDE1NjgzLAoJICAgICAgICAweDE2OEM5LCAweDE3N0VDLCAweDE4RUM0LCAweDE5MUUxLCAweDFBRkFCLAoJICAgICAgICAweDFCMDhFLCAweDFDQzFBLCAweDFEMzNGLCAweDFFRDc1LCAweDFGMjUwLAoJICAgICAgICAweDIwOUQ1LCAweDIxNkYwLCAweDIyOEJBLCAweDIzNzlGLCAweDI0QjBCLAoJICAgICAgICAweDI1NDJFLCAweDI2QTY0LCAweDI3NTQxLCAweDI4QzY5CgkgICAgXSk7CgkgICAgLyoqCgkgICAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYgNi41LjEgVGFibGUgOQoJICAgICAgICovCgkgICAgVmVyc2lvbi5WRVJTSU9OUyA9IFsKCSAgICAgICAgbmV3IFZlcnNpb24oMSwgbmV3IEludDMyQXJyYXkoMCksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoNywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxMCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxMywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxNywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgOSkpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMiwgSW50MzJBcnJheS5mcm9tKFs2LCAxOF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDEwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAzNCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE2LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAyOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAyMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMywgSW50MzJBcnJheS5mcm9tKFs2LCAyMl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE1LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA1NSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA0NCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oNCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA4MCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAyNCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA5KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbig1LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDEwOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCA0MykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExKSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTIpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDYsIEludDMyQXJyYXkuZnJvbShbNiwgMzRdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgNjgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDcsIEludDMyQXJyYXkuZnJvbShbNiwgMjIsIDM4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDc4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDMxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTMpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxNCkpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oOCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNCwgNDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgOTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMzgpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzOSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxOCksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE5KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDksIEludDMyQXJyYXkuZnJvbShbNiwgMjYsIDQ2XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCAzNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDM3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTAsIEludDMyQXJyYXkuZnJvbShbNiwgMjgsIDUwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDY4KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgNjkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDMpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA0NCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxOSksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDIwKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDExLCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIwLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA4MSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA1MCksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDUxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTIpLCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTIsIEludDMyQXJyYXkuZnJvbShbNiwgMzIsIDU4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDkyKSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgOTMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMzYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAyMCksIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDEzLCBJbnQzMkFycmF5LmZyb20oWzYsIDM0LCA2Ml0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMzcpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAzOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAyMCksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDEyLCAxMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDEyKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNDYsIDY2XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA0MCksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDQxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDE3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNSwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNDgsIDcwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDg3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgODgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgNDEpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCA0MikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNiwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTAsIDc0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDk4KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgOTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNywgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCA0NikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMTkpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAyMCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTcsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU0LCA3OF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxMDcpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAxMDgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjIpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDE4LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NiwgODJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgMTIwKSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDksIDQzKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxOSwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDE5LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1OCwgODZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTEzKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTE0KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDQ0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDQ1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDE3LCAyMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDksIDEzKSwgbmV3IEVDQl8xLmRlZmF1bHQoMTYsIDE0KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyMCwgSW50MzJBcnJheS5mcm9tKFs2LCAzNCwgNjIsIDkwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDEwNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDEwOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgzLCA0MSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCA0MikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDIxLCBJbnQzMkFycmF5LmZyb20oWzYsIDI4LCA1MCwgNzIsIDk0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgNDIpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDIyLCBJbnQzMkFycmF5LmZyb20oWzYsIDI2LCA1MCwgNzQsIDk4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDExMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNywgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNiwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMzQsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyMywgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTQsIDc4LCAxMDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIxKSwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgMTIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTQsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNiwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDI0LCBJbnQzMkFycmF5LmZyb20oWzYsIDI4LCA1NCwgODAsIDEwNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMTcpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMTgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTYsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMwLCAxNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE3KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyNSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMiwgNTgsIDg0LCAxMTBdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMTA2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTA3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDgsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjIsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMjYsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU4LCA4NiwgMTE0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAxMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxMTUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjgsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMzMsIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDI3LCBJbnQzMkFycmF5LmZyb20oWzYsIDM0LCA2MiwgOTAsIDExOF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAxMjIpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjIsIDQ1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMjMpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNiwgMjQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTIsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjgsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyOCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTAsIDc0LCA5OCwgMTIyXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDExNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAxMTgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgzMSwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzEsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyOSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTQsIDc4LCAxMDIsIDEyNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCAxMTYpLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCAxMTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjEsIDQ1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjMpLCBuZXcgRUNCXzEuZGVmYXVsdCgzNywgMjQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjYsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzMCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTIsIDc4LCAxMDQsIDEzMF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAxMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMTE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCA0NyksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCA0OCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNSwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjMsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjUsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzMSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTYsIDgyLCAxMDgsIDEzNF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxMywgMTE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjksIDQ3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQyLCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIzLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDI4LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzIsIEludDMyQXJyYXkuZnJvbShbNiwgMzQsIDYwLCA4NiwgMTEyLCAxMzhdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDExNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzUsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDM1LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzMsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU4LCA4NiwgMTE0LCAxNDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMSwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjksIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQ2LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzQsIEludDMyQXJyYXkuZnJvbShbNiwgMzQsIDYyLCA5MCwgMTE4LCAxNDZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNDQsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNywgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNTksIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDM1LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NCwgNzgsIDEwMiwgMTI2LCAxNTBdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTIsIDEyMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDEyMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxMiwgNDcpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNiwgNDgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMzksIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTQsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQxLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzYsIEludDMyQXJyYXkuZnJvbShbNiwgMjQsIDUwLCA3NiwgMTAyLCAxMjgsIDE1NF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMjEpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgMTIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzQsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQ2LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDY0LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzcsIEludDMyQXJyYXkuZnJvbShbNiwgMjgsIDU0LCA4MCwgMTA2LCAxMzIsIDE1OF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgMTIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIzKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDI5LCA0NiksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCA0NykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0OSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjQsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNDYsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzOCwgSW50MzJBcnJheS5mcm9tKFs2LCAzMiwgNTgsIDg0LCAxMTAsIDEzNiwgMTYyXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDEyMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDE4LCAxMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzIsIDQ3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQ4LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0MiwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgzMiwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDM5LCBJbnQzMkFycmF5LmZyb20oWzYsIDI2LCA1NCwgODIsIDExMCwgMTM4LCAxNjZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjAsIDExNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCg0MCwgNDcpLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCA0OCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0MywgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMiwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNjcsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbig0MCwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTgsIDg2LCAxMTQsIDE0MiwgMTcwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCAxMTgpLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTgsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzEsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDM0LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDM0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgyMCwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCg2MSwgMTYpKSkKCSAgICBdOwoJICAgIHJldHVybiBWZXJzaW9uOwoJfSgpKTsKCVZlcnNpb24kMS5kZWZhdWx0ID0gVmVyc2lvbjsKCgl2YXIgRGF0YU1hc2sgPSB7fTsKCgkoZnVuY3Rpb24gKGV4cG9ydHMpIHsKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJZXhwb3J0cy5EYXRhTWFza1ZhbHVlcyA9IHZvaWQgMDsKCXZhciBEYXRhTWFza1ZhbHVlczsKCShmdW5jdGlvbiAoRGF0YU1hc2tWYWx1ZXMpIHsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzAwMCJdID0gMF0gPSAiREFUQV9NQVNLXzAwMCI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18wMDEiXSA9IDFdID0gIkRBVEFfTUFTS18wMDEiOwoJICAgIERhdGFNYXNrVmFsdWVzW0RhdGFNYXNrVmFsdWVzWyJEQVRBX01BU0tfMDEwIl0gPSAyXSA9ICJEQVRBX01BU0tfMDEwIjsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzAxMSJdID0gM10gPSAiREFUQV9NQVNLXzAxMSI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18xMDAiXSA9IDRdID0gIkRBVEFfTUFTS18xMDAiOwoJICAgIERhdGFNYXNrVmFsdWVzW0RhdGFNYXNrVmFsdWVzWyJEQVRBX01BU0tfMTAxIl0gPSA1XSA9ICJEQVRBX01BU0tfMTAxIjsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzExMCJdID0gNl0gPSAiREFUQV9NQVNLXzExMCI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18xMTEiXSA9IDddID0gIkRBVEFfTUFTS18xMTEiOwoJfSkoRGF0YU1hc2tWYWx1ZXMgPSBleHBvcnRzLkRhdGFNYXNrVmFsdWVzIHx8IChleHBvcnRzLkRhdGFNYXNrVmFsdWVzID0ge30pKTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGRhdGEgbWFza3MgZm9yIHRoZSBkYXRhIGJpdHMgaW4gYSBRUiBjb2RlLCBwZXIgSVNPIDE4MDA0OjIwMDYgNi44LiBJbXBsZW1lbnRhdGlvbnMKCSAqIG9mIHRoaXMgY2xhc3MgY2FuIHVuLW1hc2sgYSByYXcgQml0TWF0cml4LiBGb3Igc2ltcGxpY2l0eSwgdGhleSB3aWxsIHVubWFzayB0aGUgZW50aXJlIEJpdE1hdHJpeCwKCSAqIGluY2x1ZGluZyBhcmVhcyB1c2VkIGZvciBmaW5kZXIgcGF0dGVybnMsIHRpbWluZyBwYXR0ZXJucywgZXRjLiBUaGVzZSBhcmVhcyBzaG91bGQgYmUgdW51c2VkCgkgKiBhZnRlciB0aGUgcG9pbnQgdGhleSBhcmUgdW5tYXNrZWQgYW55d2F5LjwvcD4KCSAqCgkgKiA8cD5Ob3RlIHRoYXQgdGhlIGRpYWdyYW0gaW4gc2VjdGlvbiA2LjguMSBpcyBtaXNsZWFkaW5nIHNpbmNlIGl0IGluZGljYXRlcyB0aGF0IGkgaXMgY29sdW1uIHBvc2l0aW9uCgkgKiBhbmQgaiBpcyByb3cgcG9zaXRpb24uIEluIGZhY3QsIGFzIHRoZSB0ZXh0IHNheXMsIGkgaXMgcm93IHBvc2l0aW9uIGFuZCBqIGlzIGNvbHVtbiBwb3NpdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERhdGFNYXNrID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8vIFNlZSBJU08gMTgwMDQ6MjAwNiA2LjguMQoJICAgIGZ1bmN0aW9uIERhdGFNYXNrKHZhbHVlLCBpc01hc2tlZCkgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuaXNNYXNrZWQgPSBpc01hc2tlZDsKCSAgICB9CgkgICAgLy8gRW5kIG9mIGVudW0gY29uc3RhbnRzLgoJICAgIC8qKgoJICAgICAqIDxwPkltcGxlbWVudGF0aW9ucyBvZiB0aGlzIG1ldGhvZCByZXZlcnNlIHRoZSBkYXRhIG1hc2tpbmcgcHJvY2VzcyBhcHBsaWVkIHRvIGEgUVIgQ29kZSBhbmQKCSAgICAgKiBtYWtlIGl0cyBiaXRzIHJlYWR5IHRvIHJlYWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGJpdHMgcmVwcmVzZW50YXRpb24gb2YgUVIgQ29kZSBiaXRzCgkgICAgICogQHBhcmFtIGRpbWVuc2lvbiBkaW1lbnNpb24gb2YgUVIgQ29kZSwgcmVwcmVzZW50ZWQgYnkgYml0cywgYmVpbmcgdW5tYXNrZWQKCSAgICAgKi8KCSAgICBEYXRhTWFzay5wcm90b3R5cGUudW5tYXNrQml0TWF0cml4ID0gZnVuY3Rpb24gKGJpdHMsIGRpbWVuc2lvbiAvKmludCovKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGltZW5zaW9uOyBpKyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgZGltZW5zaW9uOyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5pc01hc2tlZChpLCBqKSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLmZsaXAoaiwgaSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBEYXRhTWFzay52YWx1ZXMgPSBuZXcgTWFwKFsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIDAwMDogbWFzayBiaXRzIGZvciB3aGljaCAoeCArIHkpIG1vZCAyID09IDAKCSAgICAgICAgICovCgkgICAgICAgIFtEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMDAwLCBuZXcgRGF0YU1hc2soRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAwMCwgZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovKSB7IHJldHVybiAoKGkgKyBqKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAwMDE6IG1hc2sgYml0cyBmb3Igd2hpY2ggeCBtb2QgMiA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAwMSwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMDEsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKGkgJiAweDAxKSA9PT0gMDsgfSldLAoJICAgICAgICAvKioKCSAgICAgICAgICogMDEwOiBtYXNrIGJpdHMgZm9yIHdoaWNoIHkgbW9kIDMgPT0gMAoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMTAsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMDEwLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuIGogJSAzID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAwMTE6IG1hc2sgYml0cyBmb3Igd2hpY2ggKHggKyB5KSBtb2QgMyA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAxMSwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMTEsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKGkgKyBqKSAlIDMgPT09IDA7IH0pXSwKCSAgICAgICAgLyoqCgkgICAgICAgICAqIDEwMDogbWFzayBiaXRzIGZvciB3aGljaCAoeC8yICsgeS8zKSBtb2QgMiA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzEwMCwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMDAsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKChNYXRoLmZsb29yKGkgLyAyKSArIE1hdGguZmxvb3IoaiAvIDMpKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAxMDE6IG1hc2sgYml0cyBmb3Igd2hpY2ggeHkgbW9kIDIgKyB4eSBtb2QgMyA9PSAwCgkgICAgICAgICAqIGVxdWl2YWxlbnRseSwgc3VjaCB0aGF0IHh5IG1vZCA2ID09IDAKCSAgICAgICAgICovCgkgICAgICAgIFtEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTAxLCBuZXcgRGF0YU1hc2soRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzEwMSwgZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovKSB7IHJldHVybiAoaSAqIGopICUgNiA9PT0gMDsgfSldLAoJICAgICAgICAvKioKCSAgICAgICAgICogMTEwOiBtYXNrIGJpdHMgZm9yIHdoaWNoICh4eSBtb2QgMiArIHh5IG1vZCAzKSBtb2QgMiA9PSAwCgkgICAgICAgICAqIGVxdWl2YWxlbnRseSwgc3VjaCB0aGF0IHh5IG1vZCA2IDwgMwoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMTAsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTEwLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuICgoaSAqIGopICUgNikgPCAzOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAxMTE6IG1hc2sgYml0cyBmb3Igd2hpY2ggKCh4K3kpbW9kIDIgKyB4eSBtb2QgMykgbW9kIDIgPT0gMAoJICAgICAgICAgKiBlcXVpdmFsZW50bHksIHN1Y2ggdGhhdCAoeCArIHkgKyB4eSBtb2QgMykgbW9kIDIgPT0gMAoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMTEsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTExLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuICgoaSArIGogKyAoKGkgKiBqKSAlIDMpKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgXSk7CgkgICAgcmV0dXJuIERhdGFNYXNrOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IERhdGFNYXNrOwoKCX0oRGF0YU1hc2spKTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdE1hdHJpeFBhcnNlciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgVmVyc2lvbl8xJDEgPSBWZXJzaW9uJDE7Cgl2YXIgRm9ybWF0SW5mb3JtYXRpb25fMSA9IEZvcm1hdEluZm9ybWF0aW9uJDE7Cgl2YXIgRGF0YU1hc2tfMSA9IERhdGFNYXNrOwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xJDEgPSBGb3JtYXRFeGNlcHRpb24kMTsKCS8qKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEJpdE1hdHJpeFBhcnNlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYml0TWF0cml4IHtAbGluayBCaXRNYXRyaXh9IHRvIHBhcnNlCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgZGltZW5zaW9uIGlzIG5vdCA+PSAyMSBhbmQgMSBtb2QgNAoJICAgICAqLwoJICAgIGZ1bmN0aW9uIEJpdE1hdHJpeFBhcnNlcihiaXRNYXRyaXgpIHsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IGJpdE1hdHJpeC5nZXRIZWlnaHQoKTsKCSAgICAgICAgaWYgKGRpbWVuc2lvbiA8IDIxIHx8IChkaW1lbnNpb24gJiAweDAzKSAhPT0gMSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0TWF0cml4ID0gYml0TWF0cml4OwoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5SZWFkcyBmb3JtYXQgaW5mb3JtYXRpb24gZnJvbSBvbmUgb2YgaXRzIHR3byBsb2NhdGlvbnMgd2l0aGluIHRoZSBRUiBDb2RlLjwvcD4KCSAgICAgKgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEZvcm1hdEluZm9ybWF0aW9ufSBlbmNhcHN1bGF0aW5nIHRoZSBRUiBDb2RlJ3MgZm9ybWF0IGluZm8KCSAgICAgKiBAdGhyb3dzIEZvcm1hdEV4Y2VwdGlvbiBpZiBib3RoIGZvcm1hdCBpbmZvcm1hdGlvbiBsb2NhdGlvbnMgY2Fubm90IGJlIHBhcnNlZCBhcwoJICAgICAqIHRoZSB2YWxpZCBlbmNvZGluZyBvZiBmb3JtYXQgaW5mb3JtYXRpb24KCSAgICAgKi8KCSAgICBCaXRNYXRyaXhQYXJzZXIucHJvdG90eXBlLnJlYWRGb3JtYXRJbmZvcm1hdGlvbiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgaWYgKHRoaXMucGFyc2VkRm9ybWF0SW5mbyAhPT0gbnVsbCAmJiB0aGlzLnBhcnNlZEZvcm1hdEluZm8gIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VkRm9ybWF0SW5mbzsKCSAgICAgICAgfQoJICAgICAgICAvLyBSZWFkIHRvcC1sZWZ0IGZvcm1hdCBpbmZvIGJpdHMKCSAgICAgICAgdmFyIGZvcm1hdEluZm9CaXRzMSA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNjsgaSsrKSB7CgkgICAgICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoaSwgOCwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgfQoJICAgICAgICAvLyAuLiBhbmQgc2tpcCBhIGJpdCBpbiB0aGUgdGltaW5nIHBhdHRlcm4gLi4uCgkgICAgICAgIGZvcm1hdEluZm9CaXRzMSA9IHRoaXMuY29weUJpdCg3LCA4LCBmb3JtYXRJbmZvQml0czEpOwoJICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoOCwgOCwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgZm9ybWF0SW5mb0JpdHMxID0gdGhpcy5jb3B5Qml0KDgsIDcsIGZvcm1hdEluZm9CaXRzMSk7CgkgICAgICAgIC8vIC4uIGFuZCBza2lwIGEgYml0IGluIHRoZSB0aW1pbmcgcGF0dGVybiAuLi4KCSAgICAgICAgZm9yICh2YXIgaiA9IDU7IGogPj0gMDsgai0tKSB7CgkgICAgICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoOCwgaiwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBSZWFkIHRoZSB0b3AtcmlnaHQvYm90dG9tLWxlZnQgcGF0dGVybiB0b28KCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgZm9ybWF0SW5mb0JpdHMyID0gMDsKCSAgICAgICAgdmFyIGpNaW4gPSBkaW1lbnNpb24gLSA3OwoJICAgICAgICBmb3IgKHZhciBqID0gZGltZW5zaW9uIC0gMTsgaiA+PSBqTWluOyBqLS0pIHsKCSAgICAgICAgICAgIGZvcm1hdEluZm9CaXRzMiA9IHRoaXMuY29weUJpdCg4LCBqLCBmb3JtYXRJbmZvQml0czIpOwoJICAgICAgICB9CgkgICAgICAgIGZvciAodmFyIGkgPSBkaW1lbnNpb24gLSA4OyBpIDwgZGltZW5zaW9uOyBpKyspIHsKCSAgICAgICAgICAgIGZvcm1hdEluZm9CaXRzMiA9IHRoaXMuY29weUJpdChpLCA4LCBmb3JtYXRJbmZvQml0czIpOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMucGFyc2VkRm9ybWF0SW5mbyA9IEZvcm1hdEluZm9ybWF0aW9uXzEuZGVmYXVsdC5kZWNvZGVGb3JtYXRJbmZvcm1hdGlvbihmb3JtYXRJbmZvQml0czEsIGZvcm1hdEluZm9CaXRzMik7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZEZvcm1hdEluZm8gIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlZEZvcm1hdEluZm87CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+UmVhZHMgdmVyc2lvbiBpbmZvcm1hdGlvbiBmcm9tIG9uZSBvZiBpdHMgdHdvIGxvY2F0aW9ucyB3aXRoaW4gdGhlIFFSIENvZGUuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiB7QGxpbmsgVmVyc2lvbn0gZW5jYXBzdWxhdGluZyB0aGUgUVIgQ29kZSdzIHZlcnNpb24KCSAgICAgKiBAdGhyb3dzIEZvcm1hdEV4Y2VwdGlvbiBpZiBib3RoIHZlcnNpb24gaW5mb3JtYXRpb24gbG9jYXRpb25zIGNhbm5vdCBiZSBwYXJzZWQgYXMKCSAgICAgKiB0aGUgdmFsaWQgZW5jb2Rpbmcgb2YgdmVyc2lvbiBpbmZvcm1hdGlvbgoJICAgICAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUucmVhZFZlcnNpb24gPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZFZlcnNpb24gIT09IG51bGwgJiYgdGhpcy5wYXJzZWRWZXJzaW9uICE9PSB1bmRlZmluZWQpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgcHJvdmlzaW9uYWxWZXJzaW9uID0gTWF0aC5mbG9vcigoZGltZW5zaW9uIC0gMTcpIC8gNCk7CgkgICAgICAgIGlmIChwcm92aXNpb25hbFZlcnNpb24gPD0gNikgewoJICAgICAgICAgICAgcmV0dXJuIFZlcnNpb25fMSQxLmRlZmF1bHQuZ2V0VmVyc2lvbkZvck51bWJlcihwcm92aXNpb25hbFZlcnNpb24pOwoJICAgICAgICB9CgkgICAgICAgIC8vIFJlYWQgdG9wLXJpZ2h0IHZlcnNpb24gaW5mbzogMyB3aWRlIGJ5IDYgdGFsbAoJICAgICAgICB2YXIgdmVyc2lvbkJpdHMgPSAwOwoJICAgICAgICB2YXIgaWpNaW4gPSBkaW1lbnNpb24gLSAxMTsKCSAgICAgICAgZm9yICh2YXIgaiA9IDU7IGogPj0gMDsgai0tKSB7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gZGltZW5zaW9uIC0gOTsgaSA+PSBpak1pbjsgaS0tKSB7CgkgICAgICAgICAgICAgICAgdmVyc2lvbkJpdHMgPSB0aGlzLmNvcHlCaXQoaSwgaiwgdmVyc2lvbkJpdHMpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciB0aGVQYXJzZWRWZXJzaW9uID0gVmVyc2lvbl8xJDEuZGVmYXVsdC5kZWNvZGVWZXJzaW9uSW5mb3JtYXRpb24odmVyc2lvbkJpdHMpOwoJICAgICAgICBpZiAodGhlUGFyc2VkVmVyc2lvbiAhPT0gbnVsbCAmJiB0aGVQYXJzZWRWZXJzaW9uLmdldERpbWVuc2lvbkZvclZlcnNpb24oKSA9PT0gZGltZW5zaW9uKSB7CgkgICAgICAgICAgICB0aGlzLnBhcnNlZFZlcnNpb24gPSB0aGVQYXJzZWRWZXJzaW9uOwoJICAgICAgICAgICAgcmV0dXJuIHRoZVBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgLy8gSG1tLCBmYWlsZWQuIFRyeSBib3R0b20gbGVmdDogNiB3aWRlIGJ5IDMgdGFsbAoJICAgICAgICB2ZXJzaW9uQml0cyA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSA1OyBpID49IDA7IGktLSkgewoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IGRpbWVuc2lvbiAtIDk7IGogPj0gaWpNaW47IGotLSkgewoJICAgICAgICAgICAgICAgIHZlcnNpb25CaXRzID0gdGhpcy5jb3B5Qml0KGksIGosIHZlcnNpb25CaXRzKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICB0aGVQYXJzZWRWZXJzaW9uID0gVmVyc2lvbl8xJDEuZGVmYXVsdC5kZWNvZGVWZXJzaW9uSW5mb3JtYXRpb24odmVyc2lvbkJpdHMpOwoJICAgICAgICBpZiAodGhlUGFyc2VkVmVyc2lvbiAhPT0gbnVsbCAmJiB0aGVQYXJzZWRWZXJzaW9uLmdldERpbWVuc2lvbkZvclZlcnNpb24oKSA9PT0gZGltZW5zaW9uKSB7CgkgICAgICAgICAgICB0aGlzLnBhcnNlZFZlcnNpb24gPSB0aGVQYXJzZWRWZXJzaW9uOwoJICAgICAgICAgICAgcmV0dXJuIHRoZVBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgQml0TWF0cml4UGFyc2VyLnByb3RvdHlwZS5jb3B5Qml0ID0gZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovLCB2ZXJzaW9uQml0cyAvKmludCovKSB7CgkgICAgICAgIHZhciBiaXQgPSB0aGlzLmlzTWlycm9yID8gdGhpcy5iaXRNYXRyaXguZ2V0KGosIGkpIDogdGhpcy5iaXRNYXRyaXguZ2V0KGksIGopOwoJICAgICAgICByZXR1cm4gYml0ID8gKHZlcnNpb25CaXRzIDw8IDEpIHwgMHgxIDogdmVyc2lvbkJpdHMgPDwgMTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlJlYWRzIHRoZSBiaXRzIGluIHRoZSB7QGxpbmsgQml0TWF0cml4fSByZXByZXNlbnRpbmcgdGhlIGZpbmRlciBwYXR0ZXJuIGluIHRoZQoJICAgICAqIGNvcnJlY3Qgb3JkZXIgaW4gb3JkZXIgdG8gcmVjb25zdHJ1Y3QgdGhlIGNvZGV3b3JkcyBieXRlcyBjb250YWluZWQgd2l0aGluIHRoZQoJICAgICAqIFFSIENvZGUuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiBieXRlcyBlbmNvZGVkIHdpdGhpbiB0aGUgUVIgQ29kZQoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIHRoZSBleGFjdCBudW1iZXIgb2YgYnl0ZXMgZXhwZWN0ZWQgaXMgbm90IHJlYWQKCSAgICAgKi8KCSAgICBCaXRNYXRyaXhQYXJzZXIucHJvdG90eXBlLnJlYWRDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBmb3JtYXRJbmZvID0gdGhpcy5yZWFkRm9ybWF0SW5mb3JtYXRpb24oKTsKCSAgICAgICAgdmFyIHZlcnNpb24gPSB0aGlzLnJlYWRWZXJzaW9uKCk7CgkgICAgICAgIC8vIEdldCB0aGUgZGF0YSBtYXNrIGZvciB0aGUgZm9ybWF0IHVzZWQgaW4gdGhpcyBRUiBDb2RlLiBUaGlzIHdpbGwgZXhjbHVkZQoJICAgICAgICAvLyBzb21lIGJpdHMgZnJvbSByZWFkaW5nIGFzIHdlIHdpbmQgdGhyb3VnaCB0aGUgYml0IG1hdHJpeC4KCSAgICAgICAgdmFyIGRhdGFNYXNrID0gRGF0YU1hc2tfMS5kZWZhdWx0LnZhbHVlcy5nZXQoZm9ybWF0SW5mby5nZXREYXRhTWFzaygpKTsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICBkYXRhTWFzay51bm1hc2tCaXRNYXRyaXgodGhpcy5iaXRNYXRyaXgsIGRpbWVuc2lvbik7CgkgICAgICAgIHZhciBmdW5jdGlvblBhdHRlcm4gPSB2ZXJzaW9uLmJ1aWxkRnVuY3Rpb25QYXR0ZXJuKCk7CgkgICAgICAgIHZhciByZWFkaW5nVXAgPSB0cnVlOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkodmVyc2lvbi5nZXRUb3RhbENvZGV3b3JkcygpKTsKCSAgICAgICAgdmFyIHJlc3VsdE9mZnNldCA9IDA7CgkgICAgICAgIHZhciBjdXJyZW50Qnl0ZSA9IDA7CgkgICAgICAgIHZhciBiaXRzUmVhZCA9IDA7CgkgICAgICAgIC8vIFJlYWQgY29sdW1ucyBpbiBwYWlycywgZnJvbSByaWdodCB0byBsZWZ0CgkgICAgICAgIGZvciAodmFyIGogPSBkaW1lbnNpb24gLSAxOyBqID4gMDsgaiAtPSAyKSB7CgkgICAgICAgICAgICBpZiAoaiA9PT0gNikgewoJICAgICAgICAgICAgICAgIC8vIFNraXAgd2hvbGUgY29sdW1uIHdpdGggdmVydGljYWwgYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgICAgICAgICAgICAvLyBzYXZlcyB0aW1lIGFuZCBtYWtlcyB0aGUgb3RoZXIgY29kZSBwcm9jZWVkIG1vcmUgY2xlYW5seQoJICAgICAgICAgICAgICAgIGotLTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIFJlYWQgYWx0ZXJuYXRpbmdseSBmcm9tIGJvdHRvbSB0byB0b3AgdGhlbiB0b3AgdG8gYm90dG9tCgkgICAgICAgICAgICBmb3IgKHZhciBjb3VudCA9IDA7IGNvdW50IDwgZGltZW5zaW9uOyBjb3VudCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGkgPSByZWFkaW5nVXAgPyBkaW1lbnNpb24gLSAxIC0gY291bnQgOiBjb3VudDsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCAyOyBjb2wrKykgewoJICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgYml0cyBjb3ZlcmVkIGJ5IHRoZSBmdW5jdGlvbiBwYXR0ZXJuCgkgICAgICAgICAgICAgICAgICAgIGlmICghZnVuY3Rpb25QYXR0ZXJuLmdldChqIC0gY29sLCBpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVhZCBhIGJpdAoJICAgICAgICAgICAgICAgICAgICAgICAgYml0c1JlYWQrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRCeXRlIDw8PSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYml0TWF0cml4LmdldChqIC0gY29sLCBpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRCeXRlIHw9IDE7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB3ZSd2ZSBtYWRlIGEgd2hvbGUgYnl0ZSwgc2F2ZSBpdCBvZmYKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiaXRzUmVhZCA9PT0gOCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRPZmZzZXQrK10gPSAvKihieXRlKSAqLyBjdXJyZW50Qnl0ZTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaXRzUmVhZCA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEJ5dGUgPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVhZGluZ1VwID0gIXJlYWRpbmdVcDsgLy8gcmVhZGluZ1VwIF49IHRydWU7IC8vIHJlYWRpbmdVcCA9ICFyZWFkaW5nVXA7IC8vIHN3aXRjaCBkaXJlY3Rpb25zCgkgICAgICAgIH0KCSAgICAgICAgaWYgKHJlc3VsdE9mZnNldCAhPT0gdmVyc2lvbi5nZXRUb3RhbENvZGV3b3JkcygpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEkMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldmVydCB0aGUgbWFzayByZW1vdmFsIGRvbmUgd2hpbGUgcmVhZGluZyB0aGUgY29kZSB3b3Jkcy4gVGhlIGJpdCBtYXRyaXggc2hvdWxkIHJldmVydCB0byBpdHMgb3JpZ2luYWwgc3RhdGUuCgkgICAgICovCgkgICAgQml0TWF0cml4UGFyc2VyLnByb3RvdHlwZS5yZW1hc2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZEZvcm1hdEluZm8gPT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybjsgLy8gV2UgaGF2ZSBubyBmb3JtYXQgaW5mb3JtYXRpb24sIGFuZCBoYXZlIG5vIGRhdGEgbWFzawoJICAgICAgICB9CgkgICAgICAgIHZhciBkYXRhTWFzayA9IERhdGFNYXNrXzEuZGVmYXVsdC52YWx1ZXNbdGhpcy5wYXJzZWRGb3JtYXRJbmZvLmdldERhdGFNYXNrKCldOwoJICAgICAgICB2YXIgZGltZW5zaW9uID0gdGhpcy5iaXRNYXRyaXguZ2V0SGVpZ2h0KCk7CgkgICAgICAgIGRhdGFNYXNrLnVubWFza0JpdE1hdHJpeCh0aGlzLmJpdE1hdHJpeCwgZGltZW5zaW9uKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFByZXBhcmUgdGhlIHBhcnNlciBmb3IgYSBtaXJyb3JlZCBvcGVyYXRpb24uCgkgICAgICogVGhpcyBmbGFnIGhhcyBlZmZlY3Qgb25seSBvbiB0aGUge0BsaW5rICNyZWFkRm9ybWF0SW5mb3JtYXRpb24oKX0gYW5kIHRoZQoJICAgICAqIHtAbGluayAjcmVhZFZlcnNpb24oKX0uIEJlZm9yZSBwcm9jZWVkaW5nIHdpdGgge0BsaW5rICNyZWFkQ29kZXdvcmRzKCl9IHRoZQoJICAgICAqIHtAbGluayAjbWlycm9yKCl9IG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkLgoJICAgICAqCgkgICAgICogQHBhcmFtIG1pcnJvciBXaGV0aGVyIHRvIHJlYWQgdmVyc2lvbiBhbmQgZm9ybWF0IGluZm9ybWF0aW9uIG1pcnJvcmVkLgoJICAgICAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUuc2V0TWlycm9yID0gZnVuY3Rpb24gKGlzTWlycm9yKSB7CgkgICAgICAgIHRoaXMucGFyc2VkVmVyc2lvbiA9IG51bGw7CgkgICAgICAgIHRoaXMucGFyc2VkRm9ybWF0SW5mbyA9IG51bGw7CgkgICAgICAgIHRoaXMuaXNNaXJyb3IgPSBpc01pcnJvcjsKCSAgICB9OwoJICAgIC8qKiBNaXJyb3IgdGhlIGJpdCBtYXRyaXggaW4gb3JkZXIgdG8gYXR0ZW1wdCBhIHNlY29uZCByZWFkaW5nLiAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUubWlycm9yID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgYml0TWF0cml4ID0gdGhpcy5iaXRNYXRyaXg7CgkgICAgICAgIGZvciAodmFyIHggPSAwLCB3aWR0aCA9IGJpdE1hdHJpeC5nZXRXaWR0aCgpOyB4IDwgd2lkdGg7IHgrKykgewoJICAgICAgICAgICAgZm9yICh2YXIgeSA9IHggKyAxLCBoZWlnaHQgPSBiaXRNYXRyaXguZ2V0SGVpZ2h0KCk7IHkgPCBoZWlnaHQ7IHkrKykgewoJICAgICAgICAgICAgICAgIGlmIChiaXRNYXRyaXguZ2V0KHgsIHkpICE9PSBiaXRNYXRyaXguZ2V0KHksIHgpKSB7CgkgICAgICAgICAgICAgICAgICAgIGJpdE1hdHJpeC5mbGlwKHksIHgpOwoJICAgICAgICAgICAgICAgICAgICBiaXRNYXRyaXguZmxpcCh4LCB5KTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHJldHVybiBCaXRNYXRyaXhQYXJzZXI7Cgl9KCkpOwoJQml0TWF0cml4UGFyc2VyJDEuZGVmYXVsdCA9IEJpdE1hdHJpeFBhcnNlcjsKCgl2YXIgRGF0YUJsb2NrJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDMgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGF0YUJsb2NrJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQxID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIGJsb2NrIG9mIGRhdGEgd2l0aGluIGEgUVIgQ29kZS4gUVIgQ29kZXMgbWF5IHNwbGl0IHRoZWlyIGRhdGEgaW50bwoJICogbXVsdGlwbGUgYmxvY2tzLCBlYWNoIG9mIHdoaWNoIGlzIGEgdW5pdCBvZiBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3Jkcy4gRWFjaAoJICogaXMgcmVwcmVzZW50ZWQgYnkgYW4gaW5zdGFuY2Ugb2YgdGhpcyBjbGFzcy48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERhdGFCbG9jayA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBEYXRhQmxvY2sobnVtRGF0YUNvZGV3b3JkcyAvKmludCovLCBjb2Rld29yZHMpIHsKCSAgICAgICAgdGhpcy5udW1EYXRhQ29kZXdvcmRzID0gbnVtRGF0YUNvZGV3b3JkczsKCSAgICAgICAgdGhpcy5jb2Rld29yZHMgPSBjb2Rld29yZHM7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIDxwPldoZW4gUVIgQ29kZXMgdXNlIG11bHRpcGxlIGRhdGEgYmxvY2tzLCB0aGV5IGFyZSBhY3R1YWxseSBpbnRlcmxlYXZlZC4KCSAgICAgKiBUaGF0IGlzLCB0aGUgZmlyc3QgYnl0ZSBvZiBkYXRhIGJsb2NrIDEgdG8gbiBpcyB3cml0dGVuLCB0aGVuIHRoZSBzZWNvbmQgYnl0ZXMsIGFuZCBzbyBvbi4gVGhpcwoJICAgICAqIG1ldGhvZCB3aWxsIHNlcGFyYXRlIHRoZSBkYXRhIGludG8gb3JpZ2luYWwgYmxvY2tzLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSByYXdDb2Rld29yZHMgYnl0ZXMgYXMgcmVhZCBkaXJlY3RseSBmcm9tIHRoZSBRUiBDb2RlCgkgICAgICogQHBhcmFtIHZlcnNpb24gdmVyc2lvbiBvZiB0aGUgUVIgQ29kZQoJICAgICAqIEBwYXJhbSBlY0xldmVsIGVycm9yLWNvcnJlY3Rpb24gbGV2ZWwgb2YgdGhlIFFSIENvZGUKCSAgICAgKiBAcmV0dXJuIERhdGFCbG9ja3MgY29udGFpbmluZyBvcmlnaW5hbCBieXRlcywgImRlLWludGVybGVhdmVkIiBmcm9tIHJlcHJlc2VudGF0aW9uIGluIHRoZQoJICAgICAqICAgICAgICAgUVIgQ29kZQoJICAgICAqLwoJICAgIERhdGFCbG9jay5nZXREYXRhQmxvY2tzID0gZnVuY3Rpb24gKHJhd0NvZGV3b3JkcywgdmVyc2lvbiwgZWNMZXZlbCkgewoJICAgICAgICB2YXIgZV8xLCBfYSwgZV8yLCBfYjsKCSAgICAgICAgaWYgKHJhd0NvZGV3b3Jkcy5sZW5ndGggIT09IHZlcnNpb24uZ2V0VG90YWxDb2Rld29yZHMoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEZpZ3VyZSBvdXQgdGhlIG51bWJlciBhbmQgc2l6ZSBvZiBkYXRhIGJsb2NrcyB1c2VkIGJ5IHRoaXMgdmVyc2lvbiBhbmQKCSAgICAgICAgLy8gZXJyb3IgY29ycmVjdGlvbiBsZXZlbAoJICAgICAgICB2YXIgZWNCbG9ja3MgPSB2ZXJzaW9uLmdldEVDQmxvY2tzRm9yTGV2ZWwoZWNMZXZlbCk7CgkgICAgICAgIC8vIEZpcnN0IGNvdW50IHRoZSB0b3RhbCBudW1iZXIgb2YgZGF0YSBibG9ja3MKCSAgICAgICAgdmFyIHRvdGFsQmxvY2tzID0gMDsKCSAgICAgICAgdmFyIGVjQmxvY2tBcnJheSA9IGVjQmxvY2tzLmdldEVDQmxvY2tzKCk7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICBmb3IgKHZhciBlY0Jsb2NrQXJyYXlfMSA9IF9fdmFsdWVzJDMoZWNCbG9ja0FycmF5KSwgZWNCbG9ja0FycmF5XzFfMSA9IGVjQmxvY2tBcnJheV8xLm5leHQoKTsgIWVjQmxvY2tBcnJheV8xXzEuZG9uZTsgZWNCbG9ja0FycmF5XzFfMSA9IGVjQmxvY2tBcnJheV8xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgIHZhciBlY0Jsb2NrID0gZWNCbG9ja0FycmF5XzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbEJsb2NrcyArPSBlY0Jsb2NrLmdldENvdW50KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChlY0Jsb2NrQXJyYXlfMV8xICYmICFlY0Jsb2NrQXJyYXlfMV8xLmRvbmUgJiYgKF9hID0gZWNCbG9ja0FycmF5XzEucmV0dXJuKSkgX2EuY2FsbChlY0Jsb2NrQXJyYXlfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTm93IGVzdGFibGlzaCBEYXRhQmxvY2tzIG9mIHRoZSBhcHByb3ByaWF0ZSBzaXplIGFuZCBudW1iZXIgb2YgZGF0YSBjb2Rld29yZHMKCSAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBBcnJheSh0b3RhbEJsb2Nrcyk7CgkgICAgICAgIHZhciBudW1SZXN1bHRCbG9ja3MgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgZWNCbG9ja0FycmF5XzIgPSBfX3ZhbHVlcyQzKGVjQmxvY2tBcnJheSksIGVjQmxvY2tBcnJheV8yXzEgPSBlY0Jsb2NrQXJyYXlfMi5uZXh0KCk7ICFlY0Jsb2NrQXJyYXlfMl8xLmRvbmU7IGVjQmxvY2tBcnJheV8yXzEgPSBlY0Jsb2NrQXJyYXlfMi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZWNCbG9jayA9IGVjQmxvY2tBcnJheV8yXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlY0Jsb2NrLmdldENvdW50KCk7IGkrKykgewoJICAgICAgICAgICAgICAgICAgICB2YXIgbnVtRGF0YUNvZGV3b3JkcyA9IGVjQmxvY2suZ2V0RGF0YUNvZGV3b3JkcygpOwoJICAgICAgICAgICAgICAgICAgICB2YXIgbnVtQmxvY2tDb2Rld29yZHMgPSBlY0Jsb2Nrcy5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCkgKyBudW1EYXRhQ29kZXdvcmRzOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHRbbnVtUmVzdWx0QmxvY2tzKytdID0gbmV3IERhdGFCbG9jayhudW1EYXRhQ29kZXdvcmRzLCBuZXcgVWludDhBcnJheShudW1CbG9ja0NvZGV3b3JkcykpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8yXzEpIHsgZV8yID0geyBlcnJvcjogZV8yXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGVjQmxvY2tBcnJheV8yXzEgJiYgIWVjQmxvY2tBcnJheV8yXzEuZG9uZSAmJiAoX2IgPSBlY0Jsb2NrQXJyYXlfMi5yZXR1cm4pKSBfYi5jYWxsKGVjQmxvY2tBcnJheV8yKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8yKSB0aHJvdyBlXzIuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICAvLyBBbGwgYmxvY2tzIGhhdmUgdGhlIHNhbWUgYW1vdW50IG9mIGRhdGEsIGV4Y2VwdCB0aGF0IHRoZSBsYXN0IG4KCSAgICAgICAgLy8gKHdoZXJlIG4gbWF5IGJlIDApIGhhdmUgMSBtb3JlIGJ5dGUuIEZpZ3VyZSBvdXQgd2hlcmUgdGhlc2Ugc3RhcnQuCgkgICAgICAgIHZhciBzaG9ydGVyQmxvY2tzVG90YWxDb2Rld29yZHMgPSByZXN1bHRbMF0uY29kZXdvcmRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGxvbmdlckJsb2Nrc1N0YXJ0QXQgPSByZXN1bHQubGVuZ3RoIC0gMTsKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IGNoZWNrIGxlbmd0aCBpcyBjb3JyZWN0IGhlcmUKCSAgICAgICAgd2hpbGUgKGxvbmdlckJsb2Nrc1N0YXJ0QXQgPj0gMCkgewoJICAgICAgICAgICAgdmFyIG51bUNvZGV3b3JkcyA9IHJlc3VsdFtsb25nZXJCbG9ja3NTdGFydEF0XS5jb2Rld29yZHMubGVuZ3RoOwoJICAgICAgICAgICAgaWYgKG51bUNvZGV3b3JkcyA9PT0gc2hvcnRlckJsb2Nrc1RvdGFsQ29kZXdvcmRzKSB7CgkgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBsb25nZXJCbG9ja3NTdGFydEF0LS07CgkgICAgICAgIH0KCSAgICAgICAgbG9uZ2VyQmxvY2tzU3RhcnRBdCsrOwoJICAgICAgICB2YXIgc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHMgPSBzaG9ydGVyQmxvY2tzVG90YWxDb2Rld29yZHMgLSBlY0Jsb2Nrcy5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCk7CgkgICAgICAgIC8vIFRoZSBsYXN0IGVsZW1lbnRzIG9mIHJlc3VsdCBtYXkgYmUgMSBlbGVtZW50IGxvbmdlcgoJICAgICAgICAvLyBmaXJzdCBmaWxsIG91dCBhcyBtYW55IGVsZW1lbnRzIGFzIGFsbCBvZiB0aGVtIGhhdmUKCSAgICAgICAgdmFyIHJhd0NvZGV3b3Jkc09mZnNldCA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHM7IGkrKykgewoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBudW1SZXN1bHRCbG9ja3M7IGorKykgewoJICAgICAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbaV0gPSByYXdDb2Rld29yZHNbcmF3Q29kZXdvcmRzT2Zmc2V0KytdOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIEZpbGwgb3V0IHRoZSBsYXN0IGRhdGEgYmxvY2sgaW4gdGhlIGxvbmdlciBvbmVzCgkgICAgICAgIGZvciAodmFyIGogPSBsb25nZXJCbG9ja3NTdGFydEF0OyBqIDwgbnVtUmVzdWx0QmxvY2tzOyBqKyspIHsKCSAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHNdID0gcmF3Q29kZXdvcmRzW3Jhd0NvZGV3b3Jkc09mZnNldCsrXTsKCSAgICAgICAgfQoJICAgICAgICAvLyBOb3cgYWRkIGluIGVycm9yIGNvcnJlY3Rpb24gYmxvY2tzCgkgICAgICAgIHZhciBtYXggPSByZXN1bHRbMF0uY29kZXdvcmRzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IHNob3J0ZXJCbG9ja3NOdW1EYXRhQ29kZXdvcmRzOyBpIDwgbWF4OyBpKyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbnVtUmVzdWx0QmxvY2tzOyBqKyspIHsKCSAgICAgICAgICAgICAgICB2YXIgaU9mZnNldCA9IGogPCBsb25nZXJCbG9ja3NTdGFydEF0ID8gaSA6IGkgKyAxOwoJICAgICAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbaU9mZnNldF0gPSByYXdDb2Rld29yZHNbcmF3Q29kZXdvcmRzT2Zmc2V0KytdOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfTsKCSAgICBEYXRhQmxvY2sucHJvdG90eXBlLmdldE51bURhdGFDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm51bURhdGFDb2Rld29yZHM7CgkgICAgfTsKCSAgICBEYXRhQmxvY2sucHJvdG90eXBlLmdldENvZGV3b3JkcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY29kZXdvcmRzOwoJICAgIH07CgkgICAgcmV0dXJuIERhdGFCbG9jazsKCX0oKSk7CglEYXRhQmxvY2skMS5kZWZhdWx0ID0gRGF0YUJsb2NrOwoKCXZhciBEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEgPSB7fTsKCgl2YXIgQml0U291cmNlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdFNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbiB7Ki8KCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5UaGlzIHByb3ZpZGVzIGFuIGVhc3kgYWJzdHJhY3Rpb24gdG8gcmVhZCBiaXRzIGF0IGEgdGltZSBmcm9tIGEgc2VxdWVuY2Ugb2YgYnl0ZXMsIHdoZXJlIHRoZQoJICogbnVtYmVyIG9mIGJpdHMgcmVhZCBpcyBub3Qgb2Z0ZW4gYSBtdWx0aXBsZSBvZiA4LjwvcD4KCSAqCgkgKiA8cD5UaGlzIGNsYXNzIGlzIHRocmVhZC1zYWZlIGJ1dCBub3QgcmVlbnRyYW50IC0tIHVubGVzcyB0aGUgY2FsbGVyIG1vZGlmaWVzIHRoZSBieXRlcyBhcnJheQoJICogaXQgcGFzc2VkIGluLCBpbiB3aGljaCBjYXNlIGFsbCBiZXRzIGFyZSBvZmYuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBCaXRTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJ5dGVzIGJ5dGVzIGZyb20gd2hpY2ggdGhpcyB3aWxsIHJlYWQgYml0cy4gQml0cyB3aWxsIGJlIHJlYWQgZnJvbSB0aGUgZmlyc3QgYnl0ZSBmaXJzdC4KCSAgICAgKiBCaXRzIGFyZSByZWFkIHdpdGhpbiBhIGJ5dGUgZnJvbSBtb3N0LXNpZ25pZmljYW50IHRvIGxlYXN0LXNpZ25pZmljYW50IGJpdC4KCSAgICAgKi8KCSAgICBmdW5jdGlvbiBCaXRTb3VyY2UoYnl0ZXMpIHsKCSAgICAgICAgdGhpcy5ieXRlcyA9IGJ5dGVzOwoJICAgICAgICB0aGlzLmJ5dGVPZmZzZXQgPSAwOwoJICAgICAgICB0aGlzLmJpdE9mZnNldCA9IDA7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaW5kZXggb2YgbmV4dCBiaXQgaW4gY3VycmVudCBieXRlIHdoaWNoIHdvdWxkIGJlIHJlYWQgYnkgdGhlIG5leHQgY2FsbCB0byB7QGxpbmsgI3JlYWRCaXRzKGludCl9LgoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuZ2V0Qml0T2Zmc2V0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRPZmZzZXQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIG5leHQgYnl0ZSBpbiBpbnB1dCBieXRlIGFycmF5IHdoaWNoIHdvdWxkIGJlIHJlYWQgYnkgdGhlIG5leHQgY2FsbCB0byB7QGxpbmsgI3JlYWRCaXRzKGludCl9LgoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuZ2V0Qnl0ZU9mZnNldCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYnl0ZU9mZnNldDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBudW1CaXRzIG51bWJlciBvZiBiaXRzIHRvIHJlYWQKCSAgICAgKiBAcmV0dXJuIGludCByZXByZXNlbnRpbmcgdGhlIGJpdHMgcmVhZC4gVGhlIGJpdHMgd2lsbCBhcHBlYXIgYXMgdGhlIGxlYXN0LXNpZ25pZmljYW50CgkgICAgICogICAgICAgICBiaXRzIG9mIHRoZSBpbnQKCSAgICAgKiBAdGhyb3dzIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiBpZiBudW1CaXRzIGlzbid0IGluIFsxLDMyXSBvciBtb3JlIHRoYW4gaXMgYXZhaWxhYmxlCgkgICAgICovCgkgICAgQml0U291cmNlLnByb3RvdHlwZS5yZWFkQml0cyA9IGZ1bmN0aW9uIChudW1CaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKG51bUJpdHMgPCAxIHx8IG51bUJpdHMgPiAzMiB8fCBudW1CaXRzID4gdGhpcy5hdmFpbGFibGUoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xLmRlZmF1bHQoJycgKyBudW1CaXRzKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcmVzdWx0ID0gMDsKCSAgICAgICAgdmFyIGJpdE9mZnNldCA9IHRoaXMuYml0T2Zmc2V0OwoJICAgICAgICB2YXIgYnl0ZU9mZnNldCA9IHRoaXMuYnl0ZU9mZnNldDsKCSAgICAgICAgdmFyIGJ5dGVzID0gdGhpcy5ieXRlczsKCSAgICAgICAgLy8gRmlyc3QsIHJlYWQgcmVtYWluZGVyIGZyb20gY3VycmVudCBieXRlCgkgICAgICAgIGlmIChiaXRPZmZzZXQgPiAwKSB7CgkgICAgICAgICAgICB2YXIgYml0c0xlZnQgPSA4IC0gYml0T2Zmc2V0OwoJICAgICAgICAgICAgdmFyIHRvUmVhZCA9IG51bUJpdHMgPCBiaXRzTGVmdCA/IG51bUJpdHMgOiBiaXRzTGVmdDsKCSAgICAgICAgICAgIHZhciBiaXRzVG9Ob3RSZWFkID0gYml0c0xlZnQgLSB0b1JlYWQ7CgkgICAgICAgICAgICB2YXIgbWFzayA9ICgweEZGID4+ICg4IC0gdG9SZWFkKSkgPDwgYml0c1RvTm90UmVhZDsKCSAgICAgICAgICAgIHJlc3VsdCA9IChieXRlc1tieXRlT2Zmc2V0XSAmIG1hc2spID4+IGJpdHNUb05vdFJlYWQ7CgkgICAgICAgICAgICBudW1CaXRzIC09IHRvUmVhZDsKCSAgICAgICAgICAgIGJpdE9mZnNldCArPSB0b1JlYWQ7CgkgICAgICAgICAgICBpZiAoYml0T2Zmc2V0ID09PSA4KSB7CgkgICAgICAgICAgICAgICAgYml0T2Zmc2V0ID0gMDsKCSAgICAgICAgICAgICAgICBieXRlT2Zmc2V0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTmV4dCByZWFkIHdob2xlIGJ5dGVzCgkgICAgICAgIGlmIChudW1CaXRzID4gMCkgewoJICAgICAgICAgICAgd2hpbGUgKG51bUJpdHMgPj0gOCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IChyZXN1bHQgPDwgOCkgfCAoYnl0ZXNbYnl0ZU9mZnNldF0gJiAweEZGKTsKCSAgICAgICAgICAgICAgICBieXRlT2Zmc2V0Kys7CgkgICAgICAgICAgICAgICAgbnVtQml0cyAtPSA4OwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gRmluYWxseSByZWFkIGEgcGFydGlhbCBieXRlCgkgICAgICAgICAgICBpZiAobnVtQml0cyA+IDApIHsKCSAgICAgICAgICAgICAgICB2YXIgYml0c1RvTm90UmVhZCA9IDggLSBudW1CaXRzOwoJICAgICAgICAgICAgICAgIHZhciBtYXNrID0gKDB4RkYgPj4gYml0c1RvTm90UmVhZCkgPDwgYml0c1RvTm90UmVhZDsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSAocmVzdWx0IDw8IG51bUJpdHMpIHwgKChieXRlc1tieXRlT2Zmc2V0XSAmIG1hc2spID4+IGJpdHNUb05vdFJlYWQpOwoJICAgICAgICAgICAgICAgIGJpdE9mZnNldCArPSBudW1CaXRzOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0T2Zmc2V0ID0gYml0T2Zmc2V0OwoJICAgICAgICB0aGlzLmJ5dGVPZmZzZXQgPSBieXRlT2Zmc2V0OwoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgYml0cyB0aGF0IGNhbiBiZSByZWFkIHN1Y2Nlc3NmdWxseQoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuYXZhaWxhYmxlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gOCAqICh0aGlzLmJ5dGVzLmxlbmd0aCAtIHRoaXMuYnl0ZU9mZnNldCkgLSB0aGlzLmJpdE9mZnNldDsKCSAgICB9OwoJICAgIHJldHVybiBCaXRTb3VyY2U7Cgl9KCkpOwoJQml0U291cmNlJDEuZGVmYXVsdCA9IEJpdFNvdXJjZTsKCgl2YXIgRGVjb2RlclJlc3VsdCQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShEZWNvZGVyUmVzdWx0JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkxpc3Q7Ki8KCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGVjb2RpbmcgYSBtYXRyaXggb2YgYml0cy4gVGhpcyB0eXBpY2FsbHkKCSAqIGFwcGxpZXMgdG8gMkQgYmFyY29kZSBmb3JtYXRzLiBGb3Igbm93IGl0IGNvbnRhaW5zIHRoZSByYXcgYnl0ZXMgb2J0YWluZWQsCgkgKiBhcyB3ZWxsIGFzIGEgU3RyaW5nIGludGVycHJldGF0aW9uIG9mIHRob3NlIGJ5dGVzLCBpZiBhcHBsaWNhYmxlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGVjb2RlclJlc3VsdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IocmF3Qnl0ZXM6IFVpbnQ4QXJyYXksCgkgICAgLy8gICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyaW5nLAoJICAgIC8vICAgICAgICAgICAgICAgICAgICAgIExpc3Q8VWludDhBcnJheT4gYnl0ZVNlZ21lbnRzLAoJICAgIC8vICAgICAgICAgICAgICAgICAgICAgIFN0cmluZyBlY0xldmVsKSB7CgkgICAgLy8gICB0aGlzKHJhd0J5dGVzLCB0ZXh0LCBieXRlU2VnbWVudHMsIGVjTGV2ZWwsIC0xLCAtMSkKCSAgICAvLyB9CgkgICAgZnVuY3Rpb24gRGVjb2RlclJlc3VsdChyYXdCeXRlcywgdGV4dCwgYnl0ZVNlZ21lbnRzLCBlY0xldmVsLCBzdHJ1Y3R1cmVkQXBwZW5kU2VxdWVuY2VOdW1iZXIsIHN0cnVjdHVyZWRBcHBlbmRQYXJpdHkpIHsKCSAgICAgICAgaWYgKHN0cnVjdHVyZWRBcHBlbmRTZXF1ZW5jZU51bWJlciA9PT0gdm9pZCAwKSB7IHN0cnVjdHVyZWRBcHBlbmRTZXF1ZW5jZU51bWJlciA9IC0xOyB9CgkgICAgICAgIGlmIChzdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5ID09PSB2b2lkIDApIHsgc3RydWN0dXJlZEFwcGVuZFBhcml0eSA9IC0xOyB9CgkgICAgICAgIHRoaXMucmF3Qnl0ZXMgPSByYXdCeXRlczsKCSAgICAgICAgdGhpcy50ZXh0ID0gdGV4dDsKCSAgICAgICAgdGhpcy5ieXRlU2VnbWVudHMgPSBieXRlU2VnbWVudHM7CgkgICAgICAgIHRoaXMuZWNMZXZlbCA9IGVjTGV2ZWw7CgkgICAgICAgIHRoaXMuc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID0gc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyOwoJICAgICAgICB0aGlzLnN0cnVjdHVyZWRBcHBlbmRQYXJpdHkgPSBzdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5OwoJICAgICAgICB0aGlzLm51bUJpdHMgPSAocmF3Qnl0ZXMgPT09IHVuZGVmaW5lZCB8fCByYXdCeXRlcyA9PT0gbnVsbCkgPyAwIDogOCAqIHJhd0J5dGVzLmxlbmd0aDsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiByYXcgYnl0ZXMgcmVwcmVzZW50aW5nIHRoZSByZXN1bHQsIG9yIHtAY29kZSBudWxsfSBpZiBub3QgYXBwbGljYWJsZQoJICAgICAqLwoJICAgIERlY29kZXJSZXN1bHQucHJvdG90eXBlLmdldFJhd0J5dGVzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yYXdCeXRlczsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaG93IG1hbnkgYml0cyBvZiB7QGxpbmsgI2dldFJhd0J5dGVzKCl9IGFyZSB2YWxpZDsgdHlwaWNhbGx5IDggdGltZXMgaXRzIGxlbmd0aAoJICAgICAqIEBzaW5jZSAzLjMuMAoJICAgICAqLwoJICAgIERlY29kZXJSZXN1bHQucHJvdG90eXBlLmdldE51bUJpdHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm51bUJpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gbnVtQml0cyBvdmVycmlkZXMgdGhlIG51bWJlciBvZiBiaXRzIHRoYXQgYXJlIHZhbGlkIGluIHtAbGluayAjZ2V0UmF3Qnl0ZXMoKX0KCSAgICAgKiBAc2luY2UgMy4zLjAKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXROdW1CaXRzID0gZnVuY3Rpb24gKG51bUJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLm51bUJpdHMgPSBudW1CaXRzOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSByZXN1bHQKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRUZXh0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50ZXh0OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBsaXN0IG9mIGJ5dGUgc2VnbWVudHMgaW4gdGhlIHJlc3VsdCwgb3Ige0Bjb2RlIG51bGx9IGlmIG5vdCBhcHBsaWNhYmxlCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0Qnl0ZVNlZ21lbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5ieXRlU2VnbWVudHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIG5hbWUgb2YgZXJyb3IgY29ycmVjdGlvbiBsZXZlbCB1c2VkLCBvciB7QGNvZGUgbnVsbH0gaWYgbm90IGFwcGxpY2FibGUKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRFQ0xldmVsID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lY0xldmVsOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgZXJyb3JzIGNvcnJlY3RlZCwgb3Ige0Bjb2RlIG51bGx9IGlmIG5vdCBhcHBsaWNhYmxlCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0RXJyb3JzQ29ycmVjdGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lcnJvcnNDb3JyZWN0ZWQ7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXRFcnJvcnNDb3JyZWN0ZWQgPSBmdW5jdGlvbiAoZXJyb3JzQ29ycmVjdGVkIC8qSW50ZWdlciovKSB7CgkgICAgICAgIHRoaXMuZXJyb3JzQ29ycmVjdGVkID0gZXJyb3JzQ29ycmVjdGVkOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgZXJhc3VyZXMgY29ycmVjdGVkLCBvciB7QGNvZGUgbnVsbH0gaWYgbm90IGFwcGxpY2FibGUKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRFcmFzdXJlcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZXJhc3VyZXM7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXRFcmFzdXJlcyA9IGZ1bmN0aW9uIChlcmFzdXJlcyAvKkludGVnZXIqLykgewoJICAgICAgICB0aGlzLmVyYXN1cmVzID0gZXJhc3VyZXM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGFyYml0cmFyeSBhZGRpdGlvbmFsIG1ldGFkYXRhCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0T3RoZXIgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm90aGVyOwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuc2V0T3RoZXIgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgdGhpcy5vdGhlciA9IG90aGVyOwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuaGFzU3RydWN0dXJlZEFwcGVuZCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc3RydWN0dXJlZEFwcGVuZFBhcml0eSA+PSAwICYmIHRoaXMuc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID49IDA7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRTdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5OwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0U3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJ1Y3R1cmVkQXBwZW5kU2VxdWVuY2VOdW1iZXI7CgkgICAgfTsKCSAgICByZXR1cm4gRGVjb2RlclJlc3VsdDsKCX0oKSk7CglEZWNvZGVyUmVzdWx0JDEuZGVmYXVsdCA9IERlY29kZXJSZXN1bHQ7CgoJdmFyIE1vZGUgPSB7fTsKCgkoZnVuY3Rpb24gKGV4cG9ydHMpIHsKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJZXhwb3J0cy5Nb2RlVmFsdWVzID0gdm9pZCAwOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7Cgl2YXIgTW9kZVZhbHVlczsKCShmdW5jdGlvbiAoTW9kZVZhbHVlcykgewoJICAgIE1vZGVWYWx1ZXNbTW9kZVZhbHVlc1siVEVSTUlOQVRPUiJdID0gMF0gPSAiVEVSTUlOQVRPUiI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJOVU1FUklDIl0gPSAxXSA9ICJOVU1FUklDIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkFMUEhBTlVNRVJJQyJdID0gMl0gPSAiQUxQSEFOVU1FUklDIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIlNUUlVDVFVSRURfQVBQRU5EIl0gPSAzXSA9ICJTVFJVQ1RVUkVEX0FQUEVORCI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJCWVRFIl0gPSA0XSA9ICJCWVRFIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkVDSSJdID0gNV0gPSAiRUNJIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIktBTkpJIl0gPSA2XSA9ICJLQU5KSSI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJGTkMxX0ZJUlNUX1BPU0lUSU9OIl0gPSA3XSA9ICJGTkMxX0ZJUlNUX1BPU0lUSU9OIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkZOQzFfU0VDT05EX1BPU0lUSU9OIl0gPSA4XSA9ICJGTkMxX1NFQ09ORF9QT1NJVElPTiI7CgkgICAgLyoqIFNlZSBHQlQgMTgyODQtMjAwMDsgIkhhbnppIiBpcyBhIHRyYW5zbGl0ZXJhdGlvbiBvZiB0aGlzIG1vZGUgbmFtZS4gKi8KCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkhBTlpJIl0gPSA5XSA9ICJIQU5aSSI7Cgl9KShNb2RlVmFsdWVzID0gZXhwb3J0cy5Nb2RlVmFsdWVzIHx8IChleHBvcnRzLk1vZGVWYWx1ZXMgPSB7fSkpOwoJLyoqCgkgKiA8cD5TZWUgSVNPIDE4MDA0OjIwMDYsIDYuNC4xLCBUYWJsZXMgMiBhbmQgMy4gVGhpcyBlbnVtIGVuY2Fwc3VsYXRlcyB0aGUgdmFyaW91cyBtb2RlcyBpbiB3aGljaAoJICogZGF0YSBjYW4gYmUgZW5jb2RlZCB0byBiaXRzIGluIHRoZSBRUiBjb2RlIHN0YW5kYXJkLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgTW9kZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBNb2RlKHZhbHVlLCBzdHJpbmdWYWx1ZSwgY2hhcmFjdGVyQ291bnRCaXRzRm9yVmVyc2lvbnMsIGJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuc3RyaW5nVmFsdWUgPSBzdHJpbmdWYWx1ZTsKCSAgICAgICAgdGhpcy5jaGFyYWN0ZXJDb3VudEJpdHNGb3JWZXJzaW9ucyA9IGNoYXJhY3RlckNvdW50Qml0c0ZvclZlcnNpb25zOwoJICAgICAgICB0aGlzLmJpdHMgPSBiaXRzOwoJICAgICAgICBNb2RlLkZPUl9CSVRTLnNldChiaXRzLCB0aGlzKTsKCSAgICAgICAgTW9kZS5GT1JfVkFMVUUuc2V0KHZhbHVlLCB0aGlzKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJpdHMgZm91ciBiaXRzIGVuY29kaW5nIGEgUVIgQ29kZSBkYXRhIG1vZGUKCSAgICAgKiBAcmV0dXJuIE1vZGUgZW5jb2RlZCBieSB0aGVzZSBiaXRzCgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgYml0cyBkbyBub3QgY29ycmVzcG9uZCB0byBhIGtub3duIG1vZGUKCSAgICAgKi8KCSAgICBNb2RlLmZvckJpdHMgPSBmdW5jdGlvbiAoYml0cyAvKmludCovKSB7CgkgICAgICAgIHZhciBtb2RlID0gTW9kZS5GT1JfQklUUy5nZXQoYml0cyk7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IG1vZGUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG1vZGU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gdmVyc2lvbiB2ZXJzaW9uIGluIHF1ZXN0aW9uCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgYml0cyB1c2VkLCBpbiB0aGlzIFFSIENvZGUgc3ltYm9sIHtAbGluayBWZXJzaW9ufSwgdG8gZW5jb2RlIHRoZQoJICAgICAqICAgICAgICAgY291bnQgb2YgY2hhcmFjdGVycyB0aGF0IHdpbGwgZm9sbG93IGVuY29kZWQgaW4gdGhpcyBNb2RlCgkgICAgICovCgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0Q2hhcmFjdGVyQ291bnRCaXRzID0gZnVuY3Rpb24gKHZlcnNpb24pIHsKCSAgICAgICAgdmFyIHZlcnNpb25OdW1iZXIgPSB2ZXJzaW9uLmdldFZlcnNpb25OdW1iZXIoKTsKCSAgICAgICAgdmFyIG9mZnNldDsKCSAgICAgICAgaWYgKHZlcnNpb25OdW1iZXIgPD0gOSkgewoJICAgICAgICAgICAgb2Zmc2V0ID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmICh2ZXJzaW9uTnVtYmVyIDw9IDI2KSB7CgkgICAgICAgICAgICBvZmZzZXQgPSAxOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgb2Zmc2V0ID0gMjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5jaGFyYWN0ZXJDb3VudEJpdHNGb3JWZXJzaW9uc1tvZmZzZXRdOwoJICAgIH07CgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlOwoJICAgIH07CgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0Qml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYml0czsKCSAgICB9OwoJICAgIE1vZGUucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIChvKSB7CgkgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBNb2RlKSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlID09PSBvdGhlci52YWx1ZTsKCSAgICB9OwoJICAgIE1vZGUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdWYWx1ZTsKCSAgICB9OwoJICAgIE1vZGUuRk9SX0JJVFMgPSBuZXcgTWFwKCk7CgkgICAgTW9kZS5GT1JfVkFMVUUgPSBuZXcgTWFwKCk7CgkgICAgTW9kZS5URVJNSU5BVE9SID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5URVJNSU5BVE9SLCAnVEVSTUlOQVRPUicsIEludDMyQXJyYXkuZnJvbShbMCwgMCwgMF0pLCAweDAwKTsgLy8gTm90IHJlYWxseSBhIG1vZGUuLi4KCSAgICBNb2RlLk5VTUVSSUMgPSBuZXcgTW9kZShNb2RlVmFsdWVzLk5VTUVSSUMsICdOVU1FUklDJywgSW50MzJBcnJheS5mcm9tKFsxMCwgMTIsIDE0XSksIDB4MDEpOwoJICAgIE1vZGUuQUxQSEFOVU1FUklDID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5BTFBIQU5VTUVSSUMsICdBTFBIQU5VTUVSSUMnLCBJbnQzMkFycmF5LmZyb20oWzksIDExLCAxM10pLCAweDAyKTsKCSAgICBNb2RlLlNUUlVDVFVSRURfQVBQRU5EID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5TVFJVQ1RVUkVEX0FQUEVORCwgJ1NUUlVDVFVSRURfQVBQRU5EJywgSW50MzJBcnJheS5mcm9tKFswLCAwLCAwXSksIDB4MDMpOyAvLyBOb3Qgc3VwcG9ydGVkCgkgICAgTW9kZS5CWVRFID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5CWVRFLCAnQllURScsIEludDMyQXJyYXkuZnJvbShbOCwgMTYsIDE2XSksIDB4MDQpOwoJICAgIE1vZGUuRUNJID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5FQ0ksICdFQ0knLCBJbnQzMkFycmF5LmZyb20oWzAsIDAsIDBdKSwgMHgwNyk7IC8vIGNoYXJhY3RlciBjb3VudHMgZG9uJ3QgYXBwbHkKCSAgICBNb2RlLktBTkpJID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5LQU5KSSwgJ0tBTkpJJywgSW50MzJBcnJheS5mcm9tKFs4LCAxMCwgMTJdKSwgMHgwOCk7CgkgICAgTW9kZS5GTkMxX0ZJUlNUX1BPU0lUSU9OID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5GTkMxX0ZJUlNUX1BPU0lUSU9OLCAnRk5DMV9GSVJTVF9QT1NJVElPTicsIEludDMyQXJyYXkuZnJvbShbMCwgMCwgMF0pLCAweDA1KTsKCSAgICBNb2RlLkZOQzFfU0VDT05EX1BPU0lUSU9OID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5GTkMxX1NFQ09ORF9QT1NJVElPTiwgJ0ZOQzFfU0VDT05EX1BPU0lUSU9OJywgSW50MzJBcnJheS5mcm9tKFswLCAwLCAwXSksIDB4MDkpOwoJICAgIC8qKiBTZWUgR0JUIDE4Mjg0LTIwMDA7ICJIYW56aSIgaXMgYSB0cmFuc2xpdGVyYXRpb24gb2YgdGhpcyBtb2RlIG5hbWUuICovCgkgICAgTW9kZS5IQU5aSSA9IG5ldyBNb2RlKE1vZGVWYWx1ZXMuSEFOWkksICdIQU5aSScsIEludDMyQXJyYXkuZnJvbShbOCwgMTAsIDEyXSksIDB4MEQpOwoJICAgIHJldHVybiBNb2RlOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IE1vZGU7CgoJfShNb2RlKSk7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcucXJjb2RlLmRlY29kZXIgeyovCgl2YXIgQml0U291cmNlXzEgPSBCaXRTb3VyY2UkMTsKCXZhciBDaGFyYWN0ZXJTZXRFQ0lfMSA9IENoYXJhY3RlclNldEVDSTsKCXZhciBEZWNvZGVyUmVzdWx0XzEgPSBEZWNvZGVyUmVzdWx0JDE7Cgl2YXIgU3RyaW5nVXRpbHNfMSA9IFN0cmluZ1V0aWxzJDE7Cgl2YXIgRm9ybWF0RXhjZXB0aW9uXzEgPSBGb3JtYXRFeGNlcHRpb24kMTsKCXZhciBTdHJpbmdCdWlsZGVyXzEgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgU3RyaW5nRW5jb2RpbmdfMSA9IFN0cmluZ0VuY29kaW5nJDE7Cgl2YXIgTW9kZV8xID0gTW9kZTsKCS8qaW1wb3J0IGphdmEuaW8uVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbjsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsqLwoJLyppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlFSIENvZGVzIGNhbiBlbmNvZGUgdGV4dCBhcyBiaXRzIGluIG9uZSBvZiBzZXZlcmFsIG1vZGVzLCBhbmQgY2FuIHVzZSBtdWx0aXBsZSBtb2RlcwoJICogaW4gb25lIFFSIENvZGUuIFRoaXMgY2xhc3MgZGVjb2RlcyB0aGUgYml0cyBiYWNrIGludG8gdGV4dC48L3A+CgkgKgoJICogPHA+U2VlIElTTyAxODAwNDoyMDA2LCA2LjQuMyAtIDYuNC43PC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBEZWNvZGVkQml0U3RyZWFtUGFyc2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIERlY29kZWRCaXRTdHJlYW1QYXJzZXIoKSB7CgkgICAgfQoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlID0gZnVuY3Rpb24gKGJ5dGVzLCB2ZXJzaW9uLCBlY0xldmVsLCBoaW50cykgewoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRTb3VyY2VfMS5kZWZhdWx0KGJ5dGVzKTsKCSAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBTdHJpbmdCdWlsZGVyXzEuZGVmYXVsdCgpOwoJICAgICAgICB2YXIgYnl0ZVNlZ21lbnRzID0gbmV3IEFycmF5KCk7IC8vIDEKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IEkgZG8gbm90IHVzZSBjb25zdHJ1Y3RvciB3aXRoIHNpemUgMSBhcyBpbiBvcmlnaW5hbCBKYXZhIG1lYW5zIGNhcGFjaXR5IGFuZCB0aGUgYXJyYXkgbGVuZ3RoIGlzIGNoZWNrZWQgYmVsb3cKCSAgICAgICAgdmFyIHN5bWJvbFNlcXVlbmNlID0gLTE7CgkgICAgICAgIHZhciBwYXJpdHlEYXRhID0gLTE7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICB2YXIgY3VycmVudENoYXJhY3RlclNldEVDSSA9IG51bGw7CgkgICAgICAgICAgICB2YXIgZmMxSW5FZmZlY3QgPSBmYWxzZTsKCSAgICAgICAgICAgIHZhciBtb2RlID0gdm9pZCAwOwoJICAgICAgICAgICAgZG8gewoJICAgICAgICAgICAgICAgIC8vIFdoaWxlIHN0aWxsIGFub3RoZXIgc2VnbWVudCB0byByZWFkLi4uCgkgICAgICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCA0KSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIE9LLCBhc3N1bWUgd2UncmUgZG9uZS4gUmVhbGx5LCBhIFRFUk1JTkFUT1IgbW9kZSBzaG91bGQgaGF2ZSBiZWVuIHJlY29yZGVkIGhlcmUKCSAgICAgICAgICAgICAgICAgICAgbW9kZSA9IE1vZGVfMS5kZWZhdWx0LlRFUk1JTkFUT1I7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICB2YXIgbW9kZUJpdHMgPSBiaXRzLnJlYWRCaXRzKDQpOwoJICAgICAgICAgICAgICAgICAgICBtb2RlID0gTW9kZV8xLmRlZmF1bHQuZm9yQml0cyhtb2RlQml0cyk7IC8vIG1vZGUgaXMgZW5jb2RlZCBieSA0IGJpdHMKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgc3dpdGNoIChtb2RlKSB7CgkgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuVEVSTUlOQVRPUjoKCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LkZOQzFfRklSU1RfUE9TSVRJT046CgkgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuRk5DMV9TRUNPTkRfUE9TSVRJT046CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBkbyBsaXR0bGUgd2l0aCBGTkMxIGV4Y2VwdCBhbHRlciB0aGUgcGFyc2VkIHJlc3VsdCBhIGJpdCBhY2NvcmRpbmcgdG8gdGhlIHNwZWMKCSAgICAgICAgICAgICAgICAgICAgICAgIGZjMUluRWZmZWN0ID0gdHJ1ZTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LlNUUlVDVFVSRURfQVBQRU5EOgoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCAxNikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXF1ZW5jZSBudW1iZXIgYW5kIHBhcml0eSBpcyBhZGRlZCBsYXRlciB0byB0aGUgcmVzdWx0IG1ldGFkYXRhCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWFkIG5leHQgOCBiaXRzIChzeW1ib2wgc2VxdWVuY2UgIykgYW5kIDggYml0cyAoZGF0YTogcGFyaXR5KSwgdGhlbiBjb250aW51ZQoJICAgICAgICAgICAgICAgICAgICAgICAgc3ltYm9sU2VxdWVuY2UgPSBiaXRzLnJlYWRCaXRzKDgpOwoJICAgICAgICAgICAgICAgICAgICAgICAgcGFyaXR5RGF0YSA9IGJpdHMucmVhZEJpdHMoOCk7CgkgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgY2FzZSBNb2RlXzEuZGVmYXVsdC5FQ0k6CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBDb3VudCBkb2Vzbid0IGFwcGx5IHRvIEVDSQoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5wYXJzZUVDSVZhbHVlKGJpdHMpOwoJICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudENoYXJhY3RlclNldEVDSSA9IENoYXJhY3RlclNldEVDSV8xLmRlZmF1bHQuZ2V0Q2hhcmFjdGVyU2V0RUNJQnlWYWx1ZSh2YWx1ZSk7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudENoYXJhY3RlclNldEVDSSA9PT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgY2FzZSBNb2RlXzEuZGVmYXVsdC5IQU5aSToKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZpcnN0IGhhbmRsZSBIYW56aSBtb2RlIHdoaWNoIGRvZXMgbm90IHN0YXJ0IHdpdGggY2hhcmFjdGVyIGNvdW50CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGluZXNlIG1vZGUgY29udGFpbnMgYSBzdWIgc2V0IGluZGljYXRvciByaWdodCBhZnRlciBtb2RlIGluZGljYXRvcgoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1YnNldCA9IGJpdHMucmVhZEJpdHMoNCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY291bnRIYW56aSA9IGJpdHMucmVhZEJpdHMobW9kZS5nZXRDaGFyYWN0ZXJDb3VudEJpdHModmVyc2lvbikpOwoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1YnNldCA9PT0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5HQjIzMTJfU1VCU0VUKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVIYW56aVNlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudEhhbnppKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gIk5vcm1hbCIgUVIgY29kZSBtb2RlczoKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhvdyBtYW55IGNoYXJhY3RlcnMgd2lsbCBmb2xsb3csIGVuY29kZWQgaW4gdGhpcyBtb2RlPwoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvdW50ID0gYml0cy5yZWFkQml0cyhtb2RlLmdldENoYXJhY3RlckNvdW50Qml0cyh2ZXJzaW9uKSk7CgkgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG1vZGUpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0Lk5VTUVSSUM6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlTnVtZXJpY1NlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuQUxQSEFOVU1FUklDOgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLmRlY29kZUFscGhhbnVtZXJpY1NlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCwgZmMxSW5FZmZlY3QpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LkJZVEU6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlQnl0ZVNlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCwgY3VycmVudENoYXJhY3RlclNldEVDSSwgYnl0ZVNlZ21lbnRzLCBoaW50cyk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuS0FOSkk6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlS2FuamlTZWdtZW50KGJpdHMsIHJlc3VsdCwgY291bnQpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSB3aGlsZSAobW9kZSAhPT0gTW9kZV8xLmRlZmF1bHQuVEVSTUlOQVRPUik7CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlhZSAvKjogSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgIC8vIGZyb20gcmVhZEJpdHMoKSBjYWxscwoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbmV3IERlY29kZXJSZXN1bHRfMS5kZWZhdWx0KGJ5dGVzLCByZXN1bHQudG9TdHJpbmcoKSwgYnl0ZVNlZ21lbnRzLmxlbmd0aCA9PT0gMCA/IG51bGwgOiBieXRlU2VnbWVudHMsIGVjTGV2ZWwgPT09IG51bGwgPyBudWxsIDogZWNMZXZlbC50b1N0cmluZygpLCBzeW1ib2xTZXF1ZW5jZSwgcGFyaXR5RGF0YSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZWUgc3BlY2lmaWNhdGlvbiBHQlQgMTgyODQtMjAwMAoJICAgICAqLwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlSGFuemlTZWdtZW50ID0gZnVuY3Rpb24gKGJpdHMsIHJlc3VsdCwgY291bnQgLyppbnQqLykgewoJICAgICAgICAvLyBEb24ndCBjcmFzaCB0cnlpbmcgdG8gcmVhZCBtb3JlIGJpdHMgdGhhbiB3ZSBoYXZlIGF2YWlsYWJsZS4KCSAgICAgICAgaWYgKGNvdW50ICogMTMgPiBiaXRzLmF2YWlsYWJsZSgpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEVhY2ggY2hhcmFjdGVyIHdpbGwgcmVxdWlyZSAyIGJ5dGVzLiBSZWFkIHRoZSBjaGFyYWN0ZXJzIGFzIDItYnl0ZSBwYWlycwoJICAgICAgICAvLyBhbmQgZGVjb2RlIGFzIEdCMjMxMiBhZnRlcndhcmRzCgkgICAgICAgIHZhciBidWZmZXIgPSBuZXcgVWludDhBcnJheSgyICogY291bnQpOwoJICAgICAgICB2YXIgb2Zmc2V0ID0gMDsKCSAgICAgICAgd2hpbGUgKGNvdW50ID4gMCkgewoJICAgICAgICAgICAgLy8gRWFjaCAxMyBiaXRzIGVuY29kZXMgYSAyLWJ5dGUgY2hhcmFjdGVyCgkgICAgICAgICAgICB2YXIgdHdvQnl0ZXMgPSBiaXRzLnJlYWRCaXRzKDEzKTsKCSAgICAgICAgICAgIHZhciBhc3NlbWJsZWRUd29CeXRlcyA9ICgoKHR3b0J5dGVzIC8gMHgwNjApIDw8IDgpICYgMHhGRkZGRkZGRikgfCAodHdvQnl0ZXMgJSAweDA2MCk7CgkgICAgICAgICAgICBpZiAoYXNzZW1ibGVkVHdvQnl0ZXMgPCAweDAwM0JGKSB7CgkgICAgICAgICAgICAgICAgLy8gSW4gdGhlIDB4QTFBMSB0byAweEFBRkUgcmFuZ2UKCSAgICAgICAgICAgICAgICBhc3NlbWJsZWRUd29CeXRlcyArPSAweDBBMUExOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgLy8gSW4gdGhlIDB4QjBBMSB0byAweEZBRkUgcmFuZ2UKCSAgICAgICAgICAgICAgICBhc3NlbWJsZWRUd29CeXRlcyArPSAweDBBNkExOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgYnVmZmVyW29mZnNldF0gPSAvKihieXRlKSAqLyAoKGFzc2VtYmxlZFR3b0J5dGVzID4+IDgpICYgMHhGRik7CgkgICAgICAgICAgICBidWZmZXJbb2Zmc2V0ICsgMV0gPSAvKihieXRlKSAqLyAoYXNzZW1ibGVkVHdvQnl0ZXMgJiAweEZGKTsKCSAgICAgICAgICAgIG9mZnNldCArPSAyOwoJICAgICAgICAgICAgY291bnQtLTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChTdHJpbmdFbmNvZGluZ18xLmRlZmF1bHQuZGVjb2RlKGJ1ZmZlciwgU3RyaW5nVXRpbHNfMS5kZWZhdWx0LkdCMjMxMikpOwoJICAgICAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IFRPRE86IGltcGxlbWVudCBHQjIzMTIgZGVjb2RlLiBTdHJpbmdWaWV3IGZyb20gTUROIGNvdWxkIGJlIGEgc3RhcnRpbmcgcG9pbnQKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoaWdub3JlZCAvKjogVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdChpZ25vcmVkKTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVLYW5qaVNlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovKSB7CgkgICAgICAgIC8vIERvbid0IGNyYXNoIHRyeWluZyB0byByZWFkIG1vcmUgYml0cyB0aGFuIHdlIGhhdmUgYXZhaWxhYmxlLgoJICAgICAgICBpZiAoY291bnQgKiAxMyA+IGJpdHMuYXZhaWxhYmxlKCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRWFjaCBjaGFyYWN0ZXIgd2lsbCByZXF1aXJlIDIgYnl0ZXMuIFJlYWQgdGhlIGNoYXJhY3RlcnMgYXMgMi1ieXRlIHBhaXJzCgkgICAgICAgIC8vIGFuZCBkZWNvZGUgYXMgU2hpZnRfSklTIGFmdGVyd2FyZHMKCSAgICAgICAgdmFyIGJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KDIgKiBjb3VudCk7CgkgICAgICAgIHZhciBvZmZzZXQgPSAwOwoJICAgICAgICB3aGlsZSAoY291bnQgPiAwKSB7CgkgICAgICAgICAgICAvLyBFYWNoIDEzIGJpdHMgZW5jb2RlcyBhIDItYnl0ZSBjaGFyYWN0ZXIKCSAgICAgICAgICAgIHZhciB0d29CeXRlcyA9IGJpdHMucmVhZEJpdHMoMTMpOwoJICAgICAgICAgICAgdmFyIGFzc2VtYmxlZFR3b0J5dGVzID0gKCgodHdvQnl0ZXMgLyAweDBDMCkgPDwgOCkgJiAweEZGRkZGRkZGKSB8ICh0d29CeXRlcyAlIDB4MEMwKTsKCSAgICAgICAgICAgIGlmIChhc3NlbWJsZWRUd29CeXRlcyA8IDB4MDFGMDApIHsKCSAgICAgICAgICAgICAgICAvLyBJbiB0aGUgMHg4MTQwIHRvIDB4OUZGQyByYW5nZQoJICAgICAgICAgICAgICAgIGFzc2VtYmxlZFR3b0J5dGVzICs9IDB4MDgxNDA7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAvLyBJbiB0aGUgMHhFMDQwIHRvIDB4RUJCRiByYW5nZQoJICAgICAgICAgICAgICAgIGFzc2VtYmxlZFR3b0J5dGVzICs9IDB4MEMxNDA7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBidWZmZXJbb2Zmc2V0XSA9IC8qKGJ5dGUpICovIChhc3NlbWJsZWRUd29CeXRlcyA+PiA4KTsKCSAgICAgICAgICAgIGJ1ZmZlcltvZmZzZXQgKyAxXSA9IC8qKGJ5dGUpICovIGFzc2VtYmxlZFR3b0J5dGVzOwoJICAgICAgICAgICAgb2Zmc2V0ICs9IDI7CgkgICAgICAgICAgICBjb3VudC0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIFNoaWZ0X0pJUyBtYXkgbm90IGJlIHN1cHBvcnRlZCBpbiBzb21lIGVudmlyb25tZW50czoKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoU3RyaW5nRW5jb2RpbmdfMS5kZWZhdWx0LmRlY29kZShidWZmZXIsIFN0cmluZ1V0aWxzXzEuZGVmYXVsdC5TSElGVF9KSVMpKTsKCSAgICAgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiBUT0RPOiBpbXBsZW1lbnQgU0hJRlRfSklTIGRlY29kZS4gU3RyaW5nVmlldyBmcm9tIE1ETiBjb3VsZCBiZSBhIHN0YXJ0aW5nIHBvaW50CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlnbm9yZWQgLyo6IFVuc3VwcG9ydGVkRW5jb2RpbmdFeGNlcHRpb24qLykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoaWdub3JlZCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlQnl0ZVNlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovLCBjdXJyZW50Q2hhcmFjdGVyU2V0RUNJLCBieXRlU2VnbWVudHMsIGhpbnRzKSB7CgkgICAgICAgIC8vIERvbid0IGNyYXNoIHRyeWluZyB0byByZWFkIG1vcmUgYml0cyB0aGFuIHdlIGhhdmUgYXZhaWxhYmxlLgoJICAgICAgICBpZiAoOCAqIGNvdW50ID4gYml0cy5hdmFpbGFibGUoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcmVhZEJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoY291bnQpOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKCSAgICAgICAgICAgIHJlYWRCeXRlc1tpXSA9IC8qKGJ5dGUpICovIGJpdHMucmVhZEJpdHMoOCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGVuY29kaW5nOwoJICAgICAgICBpZiAoY3VycmVudENoYXJhY3RlclNldEVDSSA9PT0gbnVsbCkgewoJICAgICAgICAgICAgLy8gVGhlIHNwZWMgaXNuJ3QgY2xlYXIgb24gdGhpcyBtb2RlOyBzZWUKCSAgICAgICAgICAgIC8vIHNlY3Rpb24gNi40LjU6IHQgZG9lcyBub3Qgc2F5IHdoaWNoIGVuY29kaW5nIHRvIGFzc3VtaW5nCgkgICAgICAgICAgICAvLyB1cG9uIGRlY29kaW5nLiBJIGhhdmUgc2VlbiBJU08tODg1OS0xIHVzZWQgYXMgd2VsbCBhcwoJICAgICAgICAgICAgLy8gU2hpZnRfSklTIC0tIHdpdGhvdXQgYW55dGhpbmcgbGlrZSBhbiBFQ0kgZGVzaWduYXRvciB0bwoJICAgICAgICAgICAgLy8gZ2l2ZSBhIGhpbnQuCgkgICAgICAgICAgICBlbmNvZGluZyA9IFN0cmluZ1V0aWxzXzEuZGVmYXVsdC5ndWVzc0VuY29kaW5nKHJlYWRCeXRlcywgaGludHMpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgZW5jb2RpbmcgPSBjdXJyZW50Q2hhcmFjdGVyU2V0RUNJLmdldE5hbWUoKTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChTdHJpbmdFbmNvZGluZ18xLmRlZmF1bHQuZGVjb2RlKHJlYWRCeXRlcywgZW5jb2RpbmcpKTsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoaWdub3JlZCAvKjogVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdChpZ25vcmVkKTsKCSAgICAgICAgfQoJICAgICAgICBieXRlU2VnbWVudHMucHVzaChyZWFkQnl0ZXMpOwoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIgPSBmdW5jdGlvbiAodmFsdWUgLyppbnQqLykgewoJICAgICAgICBpZiAodmFsdWUgPj0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5BTFBIQU5VTUVSSUNfQ0hBUlMubGVuZ3RoKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLkFMUEhBTlVNRVJJQ19DSEFSU1t2YWx1ZV07CgkgICAgfTsKCSAgICBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLmRlY29kZUFscGhhbnVtZXJpY1NlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovLCBmYzFJbkVmZmVjdCkgewoJICAgICAgICAvLyBSZWFkIHR3byBjaGFyYWN0ZXJzIGF0IGEgdGltZQoJICAgICAgICB2YXIgc3RhcnQgPSByZXN1bHQubGVuZ3RoKCk7CgkgICAgICAgIHdoaWxlIChjb3VudCA+IDEpIHsKCSAgICAgICAgICAgIGlmIChiaXRzLmF2YWlsYWJsZSgpIDwgMTEpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIG5leHRUd29DaGFyc0JpdHMgPSBiaXRzLnJlYWRCaXRzKDExKTsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoTWF0aC5mbG9vcihuZXh0VHdvQ2hhcnNCaXRzIC8gNDUpKSk7CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKG5leHRUd29DaGFyc0JpdHMgJSA0NSkpOwoJICAgICAgICAgICAgY291bnQgLT0gMjsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY291bnQgPT09IDEpIHsKCSAgICAgICAgICAgIC8vIHNwZWNpYWwgY2FzZTogb25lIGNoYXJhY3RlciBsZWZ0CgkgICAgICAgICAgICBpZiAoYml0cy5hdmFpbGFibGUoKSA8IDYpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChEZWNvZGVkQml0U3RyZWFtUGFyc2VyLnRvQWxwaGFOdW1lcmljQ2hhcihiaXRzLnJlYWRCaXRzKDYpKSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gU2VlIHNlY3Rpb24gNi40LjguMSwgNi40LjguMgoJICAgICAgICBpZiAoZmMxSW5FZmZlY3QpIHsKCSAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gbWFzc2FnZSB0aGUgcmVzdWx0IGEgYml0IGlmIGluIGFuIEZOQzEgbW9kZToKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IHJlc3VsdC5sZW5ndGgoKTsgaSsrKSB7CgkgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5jaGFyQXQoaSkgPT09ICclJykgewoJICAgICAgICAgICAgICAgICAgICBpZiAoaSA8IHJlc3VsdC5sZW5ndGgoKSAtIDEgJiYgcmVzdWx0LmNoYXJBdChpICsgMSkgPT09ICclJykgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gJSUgaXMgcmVuZGVyZWQgYXMgJQoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmRlbGV0ZUNoYXJBdChpICsgMSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBJbiBhbHBoYSBtb2RlLCAlIHNob3VsZCBiZSBjb252ZXJ0ZWQgdG8gRk5DMSBzZXBhcmF0b3IgMHgxRAoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnNldENoYXJBdChpLCBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4MUQpKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVOdW1lcmljU2VnbWVudCA9IGZ1bmN0aW9uIChiaXRzLCByZXN1bHQsIGNvdW50IC8qaW50Ki8pIHsKCSAgICAgICAgLy8gUmVhZCB0aHJlZSBkaWdpdHMgYXQgYSB0aW1lCgkgICAgICAgIHdoaWxlIChjb3VudCA+PSAzKSB7CgkgICAgICAgICAgICAvLyBFYWNoIDEwIGJpdHMgZW5jb2RlcyB0aHJlZSBkaWdpdHMKCSAgICAgICAgICAgIGlmIChiaXRzLmF2YWlsYWJsZSgpIDwgMTApIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIHRocmVlRGlnaXRzQml0cyA9IGJpdHMucmVhZEJpdHMoMTApOwoJICAgICAgICAgICAgaWYgKHRocmVlRGlnaXRzQml0cyA+PSAxMDAwKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoTWF0aC5mbG9vcih0aHJlZURpZ2l0c0JpdHMgLyAxMDApKSk7CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKE1hdGguZmxvb3IodGhyZWVEaWdpdHNCaXRzIC8gMTApICUgMTApKTsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIodGhyZWVEaWdpdHNCaXRzICUgMTApKTsKCSAgICAgICAgICAgIGNvdW50IC09IDM7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvdW50ID09PSAyKSB7CgkgICAgICAgICAgICAvLyBUd28gZGlnaXRzIGxlZnQgb3ZlciB0byByZWFkLCBlbmNvZGVkIGluIDcgYml0cwoJICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCA3KSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhciB0d29EaWdpdHNCaXRzID0gYml0cy5yZWFkQml0cyg3KTsKCSAgICAgICAgICAgIGlmICh0d29EaWdpdHNCaXRzID49IDEwMCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKE1hdGguZmxvb3IodHdvRGlnaXRzQml0cyAvIDEwKSkpOwoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChEZWNvZGVkQml0U3RyZWFtUGFyc2VyLnRvQWxwaGFOdW1lcmljQ2hhcih0d29EaWdpdHNCaXRzICUgMTApKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChjb3VudCA9PT0gMSkgewoJICAgICAgICAgICAgLy8gT25lIGRpZ2l0IGxlZnQgb3ZlciB0byByZWFkCgkgICAgICAgICAgICBpZiAoYml0cy5hdmFpbGFibGUoKSA8IDQpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIGRpZ2l0Qml0cyA9IGJpdHMucmVhZEJpdHMoNCk7CgkgICAgICAgICAgICBpZiAoZGlnaXRCaXRzID49IDEwKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoZGlnaXRCaXRzKSk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIucGFyc2VFQ0lWYWx1ZSA9IGZ1bmN0aW9uIChiaXRzKSB7CgkgICAgICAgIHZhciBmaXJzdEJ5dGUgPSBiaXRzLnJlYWRCaXRzKDgpOwoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4ODApID09PSAwKSB7CgkgICAgICAgICAgICAvLyBqdXN0IG9uZSBieXRlCgkgICAgICAgICAgICByZXR1cm4gZmlyc3RCeXRlICYgMHg3RjsKCSAgICAgICAgfQoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4QzApID09PSAweDgwKSB7CgkgICAgICAgICAgICAvLyB0d28gYnl0ZXMKCSAgICAgICAgICAgIHZhciBzZWNvbmRCeXRlID0gYml0cy5yZWFkQml0cyg4KTsKCSAgICAgICAgICAgIHJldHVybiAoKChmaXJzdEJ5dGUgJiAweDNGKSA8PCA4KSAmIDB4RkZGRkZGRkYpIHwgc2Vjb25kQnl0ZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4RTApID09PSAweEMwKSB7CgkgICAgICAgICAgICAvLyB0aHJlZSBieXRlcwoJICAgICAgICAgICAgdmFyIHNlY29uZFRoaXJkQnl0ZXMgPSBiaXRzLnJlYWRCaXRzKDE2KTsKCSAgICAgICAgICAgIHJldHVybiAoKChmaXJzdEJ5dGUgJiAweDFGKSA8PCAxNikgJiAweEZGRkZGRkZGKSB8IHNlY29uZFRoaXJkQnl0ZXM7CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFNlZSBJU08gMTgwMDQ6MjAwNiwgNi40LjQgVGFibGUgNQoJICAgICAqLwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuQUxQSEFOVU1FUklDX0NIQVJTID0gJzAxMjM0NTY3ODlBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWiAkJSorLS4vOic7CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5HQjIzMTJfU1VCU0VUID0gMTsKCSAgICByZXR1cm4gRGVjb2RlZEJpdFN0cmVhbVBhcnNlcjsKCX0oKSk7CglEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEuZGVmYXVsdCA9IERlY29kZWRCaXRTdHJlYW1QYXJzZXI7CgoJdmFyIFFSQ29kZURlY29kZXJNZXRhRGF0YSQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDEzIFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShRUkNvZGVEZWNvZGVyTWV0YURhdGEkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLyoqCgkgKiBNZXRhLWRhdGEgY29udGFpbmVyIGZvciBRUiBDb2RlIGRlY29kaW5nLiBJbnN0YW5jZXMgb2YgdGhpcyBjbGFzcyBtYXkgYmUgdXNlZCB0byBjb252ZXkgaW5mb3JtYXRpb24gYmFjayB0byB0aGUKCSAqIGRlY29kaW5nIGNhbGxlci4gQ2FsbGVycyBhcmUgZXhwZWN0ZWQgdG8gcHJvY2VzcyB0aGlzLgoJICoKCSAqIEBzZWUgY29tLmdvb2dsZS56eGluZy5jb21tb24uRGVjb2RlclJlc3VsdCNnZXRPdGhlcigpCgkgKi8KCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGEgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUVJDb2RlRGVjb2Rlck1ldGFEYXRhKG1pcnJvcmVkKSB7CgkgICAgICAgIHRoaXMubWlycm9yZWQgPSBtaXJyb3JlZDsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBRUiBDb2RlIHdhcyBtaXJyb3JlZC4KCSAgICAgKi8KCSAgICBRUkNvZGVEZWNvZGVyTWV0YURhdGEucHJvdG90eXBlLmlzTWlycm9yZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm1pcnJvcmVkOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQXBwbHkgdGhlIHJlc3VsdCBwb2ludHMnIG9yZGVyIGNvcnJlY3Rpb24gZHVlIHRvIG1pcnJvcmluZy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBwb2ludHMgQXJyYXkgb2YgcG9pbnRzIHRvIGFwcGx5IG1pcnJvciBjb3JyZWN0aW9uIHRvLgoJICAgICAqLwoJICAgIFFSQ29kZURlY29kZXJNZXRhRGF0YS5wcm90b3R5cGUuYXBwbHlNaXJyb3JlZENvcnJlY3Rpb24gPSBmdW5jdGlvbiAocG9pbnRzKSB7CgkgICAgICAgIGlmICghdGhpcy5taXJyb3JlZCB8fCBwb2ludHMgPT09IG51bGwgfHwgcG9pbnRzLmxlbmd0aCA8IDMpIHsKCSAgICAgICAgICAgIHJldHVybjsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYm90dG9tTGVmdCA9IHBvaW50c1swXTsKCSAgICAgICAgcG9pbnRzWzBdID0gcG9pbnRzWzJdOwoJICAgICAgICBwb2ludHNbMl0gPSBib3R0b21MZWZ0OwoJICAgICAgICAvLyBObyBuZWVkIHRvICdmaXgnIHRvcC1sZWZ0IGFuZCBhbGlnbm1lbnQgcGF0dGVybi4KCSAgICB9OwoJICAgIHJldHVybiBRUkNvZGVEZWNvZGVyTWV0YURhdGE7Cgl9KCkpOwoJUVJDb2RlRGVjb2Rlck1ldGFEYXRhJDEuZGVmYXVsdCA9IFFSQ29kZURlY29kZXJNZXRhRGF0YTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDIgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGVjb2RlciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLnFyY29kZS5kZWNvZGVyIHsqLwoJdmFyIENoZWNrc3VtRXhjZXB0aW9uXzEgPSBDaGVja3N1bUV4Y2VwdGlvbiQxOwoJdmFyIEJpdE1hdHJpeF8xJDIgPSBCaXRNYXRyaXgkMTsKCXZhciBHZW5lcmljR0ZfMSA9IEdlbmVyaWNHRiQxOwoJdmFyIFJlZWRTb2xvbW9uRGVjb2Rlcl8xID0gUmVlZFNvbG9tb25EZWNvZGVyJDE7Cgl2YXIgQml0TWF0cml4UGFyc2VyXzEgPSBCaXRNYXRyaXhQYXJzZXIkMTsKCXZhciBEYXRhQmxvY2tfMSA9IERhdGFCbG9jayQxOwoJdmFyIERlY29kZWRCaXRTdHJlYW1QYXJzZXJfMSA9IERlY29kZWRCaXRTdHJlYW1QYXJzZXIkMTsKCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSQxID0gUVJDb2RlRGVjb2Rlck1ldGFEYXRhJDE7CgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlRoZSBtYWluIGNsYXNzIHdoaWNoIGltcGxlbWVudHMgUVIgQ29kZSBkZWNvZGluZyAtLSBhcyBvcHBvc2VkIHRvIGxvY2F0aW5nIGFuZCBleHRyYWN0aW5nCgkgKiB0aGUgUVIgQ29kZSBmcm9tIGFuIGltYWdlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGVjb2RlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBEZWNvZGVyKCkgewoJICAgICAgICB0aGlzLnJzRGVjb2RlciA9IG5ldyBSZWVkU29sb21vbkRlY29kZXJfMS5kZWZhdWx0KEdlbmVyaWNHRl8xLmRlZmF1bHQuUVJfQ09ERV9GSUVMRF8yNTYpOwoJICAgIH0KCSAgICAvLyBwdWJsaWMgZGVjb2RlKGltYWdlOiBib29sZWFuW11bXSk6IERlY29kZXJSZXN1bHQgLyp0aHJvd3MgQ2hlY2tzdW1FeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiovIHsKCSAgICAvLyAgIHJldHVybiBkZWNvZGUoaW1hZ2UsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIDxwPkNvbnZlbmllbmNlIG1ldGhvZCB0aGF0IGNhbiBkZWNvZGUgYSBRUiBDb2RlIHJlcHJlc2VudGVkIGFzIGEgMkQgYXJyYXkgb2YgYm9vbGVhbnMuCgkgICAgICogInRydWUiIGlzIHRha2VuIHRvIG1lYW4gYSBibGFjayBtb2R1bGUuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGltYWdlIGJvb2xlYW5zIHJlcHJlc2VudGluZyB3aGl0ZS9ibGFjayBRUiBDb2RlIG1vZHVsZXMKCSAgICAgKiBAcGFyYW0gaGludHMgZGVjb2RpbmcgaGludHMgdGhhdCBzaG91bGQgYmUgdXNlZCB0byBpbmZsdWVuY2UgZGVjb2RpbmcKCSAgICAgKiBAcmV0dXJuIHRleHQgYW5kIGJ5dGVzIGVuY29kZWQgd2l0aGluIHRoZSBRUiBDb2RlCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgdGhlIFFSIENvZGUgY2Fubm90IGJlIGRlY29kZWQKCSAgICAgKiBAdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uIGlmIGVycm9yIGNvcnJlY3Rpb24gZmFpbHMKCSAgICAgKi8KCSAgICBEZWNvZGVyLnByb3RvdHlwZS5kZWNvZGVCb29sZWFuQXJyYXkgPSBmdW5jdGlvbiAoaW1hZ2UsIGhpbnRzKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUJpdE1hdHJpeChCaXRNYXRyaXhfMSQyLmRlZmF1bHQucGFyc2VGcm9tQm9vbGVhbkFycmF5KGltYWdlKSwgaGludHMpOwoJICAgIH07CgkgICAgLy8gcHVibGljIGRlY29kZUJpdE1hdHJpeChiaXRzOiBCaXRNYXRyaXgpOiBEZWNvZGVyUmVzdWx0IC8qdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uLCBGb3JtYXRFeGNlcHRpb24qLyB7CgkgICAgLy8gICByZXR1cm4gZGVjb2RlKGJpdHMsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIDxwPkRlY29kZXMgYSBRUiBDb2RlIHJlcHJlc2VudGVkIGFzIGEge0BsaW5rIEJpdE1hdHJpeH0uIEEgMSBvciAidHJ1ZSIgaXMgdGFrZW4gdG8gbWVhbiBhIGJsYWNrIG1vZHVsZS48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0gYml0cyBib29sZWFucyByZXByZXNlbnRpbmcgd2hpdGUvYmxhY2sgUVIgQ29kZSBtb2R1bGVzCgkgICAgICogQHBhcmFtIGhpbnRzIGRlY29kaW5nIGhpbnRzIHRoYXQgc2hvdWxkIGJlIHVzZWQgdG8gaW5mbHVlbmNlIGRlY29kaW5nCgkgICAgICogQHJldHVybiB0ZXh0IGFuZCBieXRlcyBlbmNvZGVkIHdpdGhpbiB0aGUgUVIgQ29kZQoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIHRoZSBRUiBDb2RlIGNhbm5vdCBiZSBkZWNvZGVkCgkgICAgICogQHRocm93cyBDaGVja3N1bUV4Y2VwdGlvbiBpZiBlcnJvciBjb3JyZWN0aW9uIGZhaWxzCgkgICAgICovCgkgICAgRGVjb2Rlci5wcm90b3R5cGUuZGVjb2RlQml0TWF0cml4ID0gZnVuY3Rpb24gKGJpdHMsIGhpbnRzKSB7CgkgICAgICAgIC8vIENvbnN0cnVjdCBhIHBhcnNlciBhbmQgcmVhZCB2ZXJzaW9uLCBlcnJvci1jb3JyZWN0aW9uIGxldmVsCgkgICAgICAgIHZhciBwYXJzZXIgPSBuZXcgQml0TWF0cml4UGFyc2VyXzEuZGVmYXVsdChiaXRzKTsKCSAgICAgICAgdmFyIGV4ID0gbnVsbDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUJpdE1hdHJpeFBhcnNlcihwYXJzZXIsIGhpbnRzKTsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZSAvKjogRm9ybWF0RXhjZXB0aW9uLCBDaGVja3N1bUV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICBleCA9IGU7CgkgICAgICAgIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIC8vIFJldmVydCB0aGUgYml0IG1hdHJpeAoJICAgICAgICAgICAgcGFyc2VyLnJlbWFzaygpOwoJICAgICAgICAgICAgLy8gV2lsbCBiZSBhdHRlbXB0aW5nIGEgbWlycm9yZWQgcmVhZGluZyBvZiB0aGUgdmVyc2lvbiBhbmQgZm9ybWF0IGluZm8uCgkgICAgICAgICAgICBwYXJzZXIuc2V0TWlycm9yKHRydWUpOwoJICAgICAgICAgICAgLy8gUHJlZW1wdGl2ZWx5IHJlYWQgdGhlIHZlcnNpb24uCgkgICAgICAgICAgICBwYXJzZXIucmVhZFZlcnNpb24oKTsKCSAgICAgICAgICAgIC8vIFByZWVtcHRpdmVseSByZWFkIHRoZSBmb3JtYXQgaW5mb3JtYXRpb24uCgkgICAgICAgICAgICBwYXJzZXIucmVhZEZvcm1hdEluZm9ybWF0aW9uKCk7CgkgICAgICAgICAgICAvKgoJICAgICAgICAgICAgICogU2luY2Ugd2UncmUgaGVyZSwgdGhpcyBtZWFucyB3ZSBoYXZlIHN1Y2Nlc3NmdWxseSBkZXRlY3RlZCBzb21lIGtpbmQKCSAgICAgICAgICAgICAqIG9mIHZlcnNpb24gYW5kIGZvcm1hdCBpbmZvcm1hdGlvbiB3aGVuIG1pcnJvcmVkLiBUaGlzIGlzIGEgZ29vZCBzaWduLAoJICAgICAgICAgICAgICogdGhhdCB0aGUgUVIgY29kZSBtYXkgYmUgbWlycm9yZWQsIGFuZCB3ZSBzaG91bGQgdHJ5IG9uY2UgbW9yZSB3aXRoIGEKCSAgICAgICAgICAgICAqIG1pcnJvcmVkIGNvbnRlbnQuCgkgICAgICAgICAgICAgKi8KCSAgICAgICAgICAgIC8vIFByZXBhcmUgZm9yIGEgbWlycm9yZWQgcmVhZGluZy4KCSAgICAgICAgICAgIHBhcnNlci5taXJyb3IoKTsKCSAgICAgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLmRlY29kZUJpdE1hdHJpeFBhcnNlcihwYXJzZXIsIGhpbnRzKTsKCSAgICAgICAgICAgIC8vIFN1Y2Nlc3MhIE5vdGlmeSB0aGUgY2FsbGVyIHRoYXQgdGhlIGNvZGUgd2FzIG1pcnJvcmVkLgoJICAgICAgICAgICAgcmVzdWx0LnNldE90aGVyKG5ldyBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSQxLmRlZmF1bHQodHJ1ZSkpOwoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZSAvKkZvcm1hdEV4Y2VwdGlvbiB8IENoZWNrc3VtRXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgIC8vIFRocm93IHRoZSBleGNlcHRpb24gZnJvbSB0aGUgb3JpZ2luYWwgcmVhZGluZwoJICAgICAgICAgICAgaWYgKGV4ICE9PSBudWxsKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgZXg7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0aHJvdyBlOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBEZWNvZGVyLnByb3RvdHlwZS5kZWNvZGVCaXRNYXRyaXhQYXJzZXIgPSBmdW5jdGlvbiAocGFyc2VyLCBoaW50cykgewoJICAgICAgICB2YXIgZV8xLCBfYSwgZV8yLCBfYjsKCSAgICAgICAgdmFyIHZlcnNpb24gPSBwYXJzZXIucmVhZFZlcnNpb24oKTsKCSAgICAgICAgdmFyIGVjTGV2ZWwgPSBwYXJzZXIucmVhZEZvcm1hdEluZm9ybWF0aW9uKCkuZ2V0RXJyb3JDb3JyZWN0aW9uTGV2ZWwoKTsKCSAgICAgICAgLy8gUmVhZCBjb2Rld29yZHMKCSAgICAgICAgdmFyIGNvZGV3b3JkcyA9IHBhcnNlci5yZWFkQ29kZXdvcmRzKCk7CgkgICAgICAgIC8vIFNlcGFyYXRlIGludG8gZGF0YSBibG9ja3MKCSAgICAgICAgdmFyIGRhdGFCbG9ja3MgPSBEYXRhQmxvY2tfMS5kZWZhdWx0LmdldERhdGFCbG9ja3MoY29kZXdvcmRzLCB2ZXJzaW9uLCBlY0xldmVsKTsKCSAgICAgICAgLy8gQ291bnQgdG90YWwgbnVtYmVyIG9mIGRhdGEgYnl0ZXMKCSAgICAgICAgdmFyIHRvdGFsQnl0ZXMgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgZGF0YUJsb2Nrc18xID0gX192YWx1ZXMkMihkYXRhQmxvY2tzKSwgZGF0YUJsb2Nrc18xXzEgPSBkYXRhQmxvY2tzXzEubmV4dCgpOyAhZGF0YUJsb2Nrc18xXzEuZG9uZTsgZGF0YUJsb2Nrc18xXzEgPSBkYXRhQmxvY2tzXzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRhdGFCbG9jayA9IGRhdGFCbG9ja3NfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgIHRvdGFsQnl0ZXMgKz0gZGF0YUJsb2NrLmdldE51bURhdGFDb2Rld29yZHMoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGRhdGFCbG9ja3NfMV8xICYmICFkYXRhQmxvY2tzXzFfMS5kb25lICYmIChfYSA9IGRhdGFCbG9ja3NfMS5yZXR1cm4pKSBfYS5jYWxsKGRhdGFCbG9ja3NfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdEJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkodG90YWxCeXRlcyk7CgkgICAgICAgIHZhciByZXN1bHRPZmZzZXQgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgLy8gRXJyb3ItY29ycmVjdCBhbmQgY29weSBkYXRhIGJsb2NrcyB0b2dldGhlciBpbnRvIGEgc3RyZWFtIG9mIGJ5dGVzCgkgICAgICAgICAgICBmb3IgKHZhciBkYXRhQmxvY2tzXzIgPSBfX3ZhbHVlcyQyKGRhdGFCbG9ja3MpLCBkYXRhQmxvY2tzXzJfMSA9IGRhdGFCbG9ja3NfMi5uZXh0KCk7ICFkYXRhQmxvY2tzXzJfMS5kb25lOyBkYXRhQmxvY2tzXzJfMSA9IGRhdGFCbG9ja3NfMi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZGF0YUJsb2NrID0gZGF0YUJsb2Nrc18yXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgdmFyIGNvZGV3b3JkQnl0ZXMgPSBkYXRhQmxvY2suZ2V0Q29kZXdvcmRzKCk7CgkgICAgICAgICAgICAgICAgdmFyIG51bURhdGFDb2Rld29yZHMgPSBkYXRhQmxvY2suZ2V0TnVtRGF0YUNvZGV3b3JkcygpOwoJICAgICAgICAgICAgICAgIHRoaXMuY29ycmVjdEVycm9ycyhjb2Rld29yZEJ5dGVzLCBudW1EYXRhQ29kZXdvcmRzKTsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bURhdGFDb2Rld29yZHM7IGkrKykgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHRCeXRlc1tyZXN1bHRPZmZzZXQrK10gPSBjb2Rld29yZEJ5dGVzW2ldOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8yXzEpIHsgZV8yID0geyBlcnJvcjogZV8yXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGRhdGFCbG9ja3NfMl8xICYmICFkYXRhQmxvY2tzXzJfMS5kb25lICYmIChfYiA9IGRhdGFCbG9ja3NfMi5yZXR1cm4pKSBfYi5jYWxsKGRhdGFCbG9ja3NfMik7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMikgdGhyb3cgZV8yLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gRGVjb2RlIHRoZSBjb250ZW50cyBvZiB0aGF0IHN0cmVhbSBvZiBieXRlcwoJICAgICAgICByZXR1cm4gRGVjb2RlZEJpdFN0cmVhbVBhcnNlcl8xLmRlZmF1bHQuZGVjb2RlKHJlc3VsdEJ5dGVzLCB2ZXJzaW9uLCBlY0xldmVsLCBoaW50cyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5HaXZlbiBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyByZWNlaXZlZCwgcG9zc2libHkgY29ycnVwdGVkIGJ5IGVycm9ycywgYXR0ZW1wdHMgdG8KCSAgICAgKiBjb3JyZWN0IHRoZSBlcnJvcnMgaW4tcGxhY2UgdXNpbmcgUmVlZC1Tb2xvbW9uIGVycm9yIGNvcnJlY3Rpb24uPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGNvZGV3b3JkQnl0ZXMgZGF0YSBhbmQgZXJyb3IgY29ycmVjdGlvbiBjb2Rld29yZHMKCSAgICAgKiBAcGFyYW0gbnVtRGF0YUNvZGV3b3JkcyBudW1iZXIgb2YgY29kZXdvcmRzIHRoYXQgYXJlIGRhdGEgYnl0ZXMKCSAgICAgKiBAdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uIGlmIGVycm9yIGNvcnJlY3Rpb24gZmFpbHMKCSAgICAgKi8KCSAgICBEZWNvZGVyLnByb3RvdHlwZS5jb3JyZWN0RXJyb3JzID0gZnVuY3Rpb24gKGNvZGV3b3JkQnl0ZXMsIG51bURhdGFDb2Rld29yZHMgLyppbnQqLykgewoJICAgICAgICAvLyBjb25zdCBudW1Db2Rld29yZHMgPSBjb2Rld29yZEJ5dGVzLmxlbmd0aDsKCSAgICAgICAgLy8gRmlyc3QgcmVhZCBpbnRvIGFuIGFycmF5IG9mIGludHMKCSAgICAgICAgdmFyIGNvZGV3b3Jkc0ludHMgPSBuZXcgSW50MzJBcnJheShjb2Rld29yZEJ5dGVzKTsKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IG5vdCByZWFseSBuZWNlc3NhcnkgdG8gdHJhbnNmb3JtIHRvIGludHM/IGNvdWxkIHJlZGVzaWduIGV2ZXJ5dGhpbmcgdG8gd29yayB3aXRoIHVuc2lnbmVkIGJ5dGVzPwoJICAgICAgICAvLyBjb25zdCBjb2Rld29yZHNJbnRzID0gbmV3IEludDMyQXJyYXkobnVtQ29kZXdvcmRzKQoJICAgICAgICAvLyBmb3IgKGxldCBpID0gMDsgaSA8IG51bUNvZGV3b3JkczsgaSsrKSB7CgkgICAgICAgIC8vICAgY29kZXdvcmRzSW50c1tpXSA9IGNvZGV3b3JkQnl0ZXNbaV0gJiAweEZGCgkgICAgICAgIC8vIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHRoaXMucnNEZWNvZGVyLmRlY29kZShjb2Rld29yZHNJbnRzLCBjb2Rld29yZEJ5dGVzLmxlbmd0aCAtIG51bURhdGFDb2Rld29yZHMpOwoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChpZ25vcmVkIC8qOiBSZWVkU29sb21vbkV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgQ2hlY2tzdW1FeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29weSBiYWNrIGludG8gYXJyYXkgb2YgYnl0ZXMgLS0gb25seSBuZWVkIHRvIHdvcnJ5IGFib3V0IHRoZSBieXRlcyB0aGF0IHdlcmUgZGF0YQoJICAgICAgICAvLyBXZSBkb24ndCBjYXJlIGFib3V0IGVycm9ycyBpbiB0aGUgZXJyb3ItY29ycmVjdGlvbiBjb2Rld29yZHMKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1EYXRhQ29kZXdvcmRzOyBpKyspIHsKCSAgICAgICAgICAgIGNvZGV3b3JkQnl0ZXNbaV0gPSAvKihieXRlKSAqLyBjb2Rld29yZHNJbnRzW2ldOwoJICAgICAgICB9CgkgICAgfTsKCSAgICByZXR1cm4gRGVjb2RlcjsKCX0oKSk7CglEZWNvZGVyJDEuZGVmYXVsdCA9IERlY29kZXI7CgoJdmFyIERldGVjdG9yJDEgPSB7fTsKCgl2YXIgTWF0aFV0aWxzJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMTIgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KE1hdGhVdGlscyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbi5kZXRlY3RvciB7Ki8KCS8qKgoJICogR2VuZXJhbCBtYXRoLXJlbGF0ZWQgYW5kIG51bWVyaWMgdXRpbGl0eSBmdW5jdGlvbnMuCgkgKi8KCXZhciBNYXRoVXRpbHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gTWF0aFV0aWxzKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiBFbmRzIHVwIGJlaW5nIGEgYml0IGZhc3RlciB0aGFuIHtAbGluayBNYXRoI3JvdW5kKGZsb2F0KX0uIFRoaXMgbWVyZWx5IHJvdW5kcyBpdHMKCSAgICAgKiBhcmd1bWVudCB0byB0aGUgbmVhcmVzdCBpbnQsIHdoZXJlIHguNSByb3VuZHMgdXAgdG8geCsxLiBTZW1hbnRpY3Mgb2YgdGhpcyBzaG9ydGN1dAoJICAgICAqIGRpZmZlciBzbGlnaHRseSBmcm9tIHtAbGluayBNYXRoI3JvdW5kKGZsb2F0KX0gaW4gdGhhdCBoYWxmIHJvdW5kcyBkb3duIGZvciBuZWdhdGl2ZQoJICAgICAqIHZhbHVlcy4gLTIuNSByb3VuZHMgdG8gLTMsIG5vdCAtMi4gRm9yIHB1cnBvc2VzIGhlcmUgaXQgbWFrZXMgbm8gZGlmZmVyZW5jZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBkIHJlYWwgdmFsdWUgdG8gcm91bmQKCSAgICAgKiBAcmV0dXJuIG5lYXJlc3Qge0Bjb2RlIGludH0KCSAgICAgKi8KCSAgICBNYXRoVXRpbHMucm91bmQgPSBmdW5jdGlvbiAoZCAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE5hTiA9PT0gZCkKCSAgICAgICAgICAgIHJldHVybiAwOwoJICAgICAgICBpZiAoZCA8PSBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUikKCSAgICAgICAgICAgIHJldHVybiBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUjsKCSAgICAgICAgaWYgKGQgPj0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIpCgkgICAgICAgICAgICByZXR1cm4gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgICAgIHJldHVybiAvKihpbnQpICovIChkICsgKGQgPCAwLjAgPyAtMC41IDogMC41KSkgfCAwOwoJICAgIH07CgkgICAgLy8gVFlQRVNDUklQVFBPUlQ6IG1heWJlIHJlbW92ZSByb3VuZCBtZXRob2QgYW5kIGNhbGwgZGlyZWN0bHkgTWF0aC5yb3VuZCwgaXQgbG9va3MgbGlrZSBpdCBkb2Vzbid0IG1ha2Ugc2Vuc2UgZm9yIGpzCgkgICAgLyoqCgkgICAgICogQHBhcmFtIGFYIHBvaW50IEEgeCBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGFZIHBvaW50IEEgeSBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGJYIHBvaW50IEIgeCBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGJZIHBvaW50IEIgeSBjb29yZGluYXRlCgkgICAgICogQHJldHVybiBFdWNsaWRlYW4gZGlzdGFuY2UgYmV0d2VlbiBwb2ludHMgQSBhbmQgQgoJICAgICAqLwoJICAgIE1hdGhVdGlscy5kaXN0YW5jZSA9IGZ1bmN0aW9uIChhWCAvKmZsb2F0fGludCovLCBhWSAvKmZsb2F0fGludCovLCBiWCAvKmZsb2F0fGludCovLCBiWSAvKmZsb2F0fGludCovKSB7CgkgICAgICAgIHZhciB4RGlmZiA9IGFYIC0gYlg7CgkgICAgICAgIHZhciB5RGlmZiA9IGFZIC0gYlk7CgkgICAgICAgIHJldHVybiAvKihmbG9hdCkgKi8gTWF0aC5zcXJ0KHhEaWZmICogeERpZmYgKyB5RGlmZiAqIHlEaWZmKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBhWCBwb2ludCBBIHggY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBhWSBwb2ludCBBIHkgY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBiWCBwb2ludCBCIHggY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBiWSBwb2ludCBCIHkgY29vcmRpbmF0ZQoJICAgICAqIEByZXR1cm4gRXVjbGlkZWFuIGRpc3RhbmNlIGJldHdlZW4gcG9pbnRzIEEgYW5kIEIKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgc3RhdGljIGRpc3RhbmNlKGFYOiBudW1iZXIgLyppbnQqLywgYVk6IG51bWJlciAvKmludCovLCBiWDogbnVtYmVyIC8qaW50Ki8sIGJZOiBudW1iZXIgLyppbnQqLyk6IGZsb2F0IHsKCSAgICAvLyAgIGNvbnN0IHhEaWZmID0gYVggLSBiWAoJICAgIC8vICAgY29uc3QgeURpZmYgPSBhWSAtIGJZCgkgICAgLy8gICByZXR1cm4gKGZsb2F0KSBNYXRoLnNxcnQoeERpZmYgKiB4RGlmZiArIHlEaWZmICogeURpZmYpOwoJICAgIC8vIH0KCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYXJyYXkgdmFsdWVzIHRvIHN1bQoJICAgICAqIEByZXR1cm4gc3VtIG9mIHZhbHVlcyBpbiBhcnJheQoJICAgICAqLwoJICAgIE1hdGhVdGlscy5zdW0gPSBmdW5jdGlvbiAoYXJyYXkpIHsKCSAgICAgICAgdmFyIGNvdW50ID0gMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gYXJyYXkubGVuZ3RoOyBpICE9PSBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgYSA9IGFycmF5W2ldOwoJICAgICAgICAgICAgY291bnQgKz0gYTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gY291bnQ7CgkgICAgfTsKCSAgICByZXR1cm4gTWF0aFV0aWxzOwoJfSgpKTsKCU1hdGhVdGlscyQxLmRlZmF1bHQgPSBNYXRoVXRpbHM7CgoJdmFyIERldGVjdG9yUmVzdWx0JDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KERldGVjdG9yUmVzdWx0JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGV0ZWN0aW5nIGEgYmFyY29kZSBpbiBhbiBpbWFnZS4gVGhpcyBpbmNsdWRlcyB0aGUgcmF3CgkgKiBtYXRyaXggb2YgYmxhY2svd2hpdGUgcGl4ZWxzIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGJhcmNvZGUsIGFuZCBwb3NzaWJseSBwb2ludHMgb2YgaW50ZXJlc3QKCSAqIGluIHRoZSBpbWFnZSwgbGlrZSB0aGUgbG9jYXRpb24gb2YgZmluZGVyIHBhdHRlcm5zIG9yIGNvcm5lcnMgb2YgdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGV0ZWN0b3JSZXN1bHQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gRGV0ZWN0b3JSZXN1bHQoYml0cywgcG9pbnRzKSB7CgkgICAgICAgIHRoaXMuYml0cyA9IGJpdHM7CgkgICAgICAgIHRoaXMucG9pbnRzID0gcG9pbnRzOwoJICAgIH0KCSAgICBEZXRlY3RvclJlc3VsdC5wcm90b3R5cGUuZ2V0Qml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYml0czsKCSAgICB9OwoJICAgIERldGVjdG9yUmVzdWx0LnByb3RvdHlwZS5nZXRQb2ludHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnBvaW50czsKCSAgICB9OwoJICAgIHJldHVybiBEZXRlY3RvclJlc3VsdDsKCX0oKSk7CglEZXRlY3RvclJlc3VsdCQxLmRlZmF1bHQgPSBEZXRlY3RvclJlc3VsdDsKCgl2YXIgR3JpZFNhbXBsZXJJbnN0YW5jZSQxID0ge307CgoJdmFyIERlZmF1bHRHcmlkU2FtcGxlciQxID0ge307CgoJdmFyIEdyaWRTYW1wbGVyJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEdyaWRTYW1wbGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDUgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBJbXBsZW1lbnRhdGlvbnMgb2YgdGhpcyBjbGFzcyBjYW4sIGdpdmVuIGxvY2F0aW9ucyBvZiBmaW5kZXIgcGF0dGVybnMgZm9yIGEgUVIgY29kZSBpbiBhbgoJICogaW1hZ2UsIHNhbXBsZSB0aGUgcmlnaHQgcG9pbnRzIGluIHRoZSBpbWFnZSB0byByZWNvbnN0cnVjdCB0aGUgUVIgY29kZSwgYWNjb3VudGluZyBmb3IKCSAqIHBlcnNwZWN0aXZlIGRpc3RvcnRpb24uIEl0IGlzIGFic3RyYWN0ZWQgc2luY2UgaXQgaXMgcmVsYXRpdmVseSBleHBlbnNpdmUgYW5kIHNob3VsZCBiZSBhbGxvd2VkCgkgKiB0byB0YWtlIGFkdmFudGFnZSBvZiBwbGF0Zm9ybS1zcGVjaWZpYyBvcHRpbWl6ZWQgaW1wbGVtZW50YXRpb25zLCBsaWtlIFN1bidzIEphdmEgQWR2YW5jZWQKCSAqIEltYWdpbmcgbGlicmFyeSwgYnV0IHdoaWNoIG1heSBub3QgYmUgYXZhaWxhYmxlIGluIG90aGVyIGVudmlyb25tZW50cyBzdWNoIGFzIEoyTUUsIGFuZCB2aWNlCgkgKiB2ZXJzYS4KCSAqCgkgKiBUaGUgaW1wbGVtZW50YXRpb24gdXNlZCBjYW4gYmUgY29udHJvbGxlZCBieSBjYWxsaW5nIHtAbGluayAjc2V0R3JpZFNhbXBsZXIoR3JpZFNhbXBsZXIpfQoJICogd2l0aCBhbiBpbnN0YW5jZSBvZiBhIGNsYXNzIHdoaWNoIGltcGxlbWVudHMgdGhpcyBpbnRlcmZhY2UuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEdyaWRTYW1wbGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEdyaWRTYW1wbGVyKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5DaGVja3MgYSBzZXQgb2YgcG9pbnRzIHRoYXQgaGF2ZSBiZWVuIHRyYW5zZm9ybWVkIHRvIHNhbXBsZSBwb2ludHMgb24gYW4gaW1hZ2UgYWdhaW5zdAoJICAgICAqIHRoZSBpbWFnZSdzIGRpbWVuc2lvbnMgdG8gc2VlIGlmIHRoZSBwb2ludCBhcmUgZXZlbiB3aXRoaW4gdGhlIGltYWdlLjwvcD4KCSAgICAgKgoJICAgICAqIDxwPlRoaXMgbWV0aG9kIHdpbGwgYWN0dWFsbHkgIm51ZGdlIiB0aGUgZW5kcG9pbnRzIGJhY2sgb250byB0aGUgaW1hZ2UgaWYgdGhleSBhcmUgZm91bmQgdG8gYmUKCSAgICAgKiBiYXJlbHkgKGxlc3MgdGhhbiAxIHBpeGVsKSBvZmYgdGhlIGltYWdlLiBUaGlzIGFjY291bnRzIGZvciBpbXBlcmZlY3QgZGV0ZWN0aW9uIG9mIGZpbmRlcgoJICAgICAqIHBhdHRlcm5zIGluIGFuIGltYWdlIHdoZXJlIHRoZSBRUiBDb2RlIHJ1bnMgYWxsIHRoZSB3YXkgdG8gdGhlIGltYWdlIGJvcmRlci48L3A+CgkgICAgICoKCSAgICAgKiA8cD5Gb3IgZWZmaWNpZW5jeSwgdGhlIG1ldGhvZCB3aWxsIGNoZWNrIHBvaW50cyBmcm9tIGVpdGhlciBlbmQgb2YgdGhlIGxpbmUgdW50aWwgb25lIGlzIGZvdW5kCgkgICAgICogdG8gYmUgd2l0aGluIHRoZSBpbWFnZS4gQmVjYXVzZSB0aGUgc2V0IG9mIHBvaW50cyBhcmUgYXNzdW1lZCB0byBiZSBsaW5lYXIsIHRoaXMgaXMgdmFsaWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGltYWdlIGltYWdlIGludG8gd2hpY2ggdGhlIHBvaW50cyBzaG91bGQgbWFwCgkgICAgICogQHBhcmFtIHBvaW50cyBhY3R1YWwgcG9pbnRzIGluIHgxLHkxLC4uLix4bix5biBmb3JtCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBhbiBlbmRwb2ludCBpcyBsaWVzIG91dHNpZGUgdGhlIGltYWdlIGJvdW5kYXJpZXMKCSAgICAgKi8KCSAgICBHcmlkU2FtcGxlci5jaGVja0FuZE51ZGdlUG9pbnRzID0gZnVuY3Rpb24gKGltYWdlLCBwb2ludHMpIHsKCSAgICAgICAgdmFyIHdpZHRoID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IGltYWdlLmdldEhlaWdodCgpOwoJICAgICAgICAvLyBDaGVjayBhbmQgbnVkZ2UgcG9pbnRzIGZyb20gc3RhcnQgdW50aWwgd2Ugc2VlIHNvbWUgdGhhdCBhcmUgT0s6CgkgICAgICAgIHZhciBudWRnZWQgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBvZmZzZXQgPSAwOyBvZmZzZXQgPCBwb2ludHMubGVuZ3RoICYmIG51ZGdlZDsgb2Zmc2V0ICs9IDIpIHsKCSAgICAgICAgICAgIHZhciB4ID0gTWF0aC5mbG9vcihwb2ludHNbb2Zmc2V0XSk7CgkgICAgICAgICAgICB2YXIgeSA9IE1hdGguZmxvb3IocG9pbnRzW29mZnNldCArIDFdKTsKCSAgICAgICAgICAgIGlmICh4IDwgLTEgfHwgeCA+IHdpZHRoIHx8IHkgPCAtMSB8fCB5ID4gaGVpZ2h0KSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBudWRnZWQgPSBmYWxzZTsKCSAgICAgICAgICAgIGlmICh4ID09PSAtMSkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXRdID0gMC4wOwoJICAgICAgICAgICAgICAgIG51ZGdlZCA9IHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIGlmICh4ID09PSB3aWR0aCkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXRdID0gd2lkdGggLSAxOwoJICAgICAgICAgICAgICAgIG51ZGdlZCA9IHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAoeSA9PT0gLTEpIHsKCSAgICAgICAgICAgICAgICBwb2ludHNbb2Zmc2V0ICsgMV0gPSAwLjA7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHkgPT09IGhlaWdodCkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXQgKyAxXSA9IGhlaWdodCAtIDE7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICAvLyBDaGVjayBhbmQgbnVkZ2UgcG9pbnRzIGZyb20gZW5kOgoJICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBvZmZzZXQgPSBwb2ludHMubGVuZ3RoIC0gMjsgb2Zmc2V0ID49IDAgJiYgbnVkZ2VkOyBvZmZzZXQgLT0gMikgewoJICAgICAgICAgICAgdmFyIHggPSBNYXRoLmZsb29yKHBvaW50c1tvZmZzZXRdKTsKCSAgICAgICAgICAgIHZhciB5ID0gTWF0aC5mbG9vcihwb2ludHNbb2Zmc2V0ICsgMV0pOwoJICAgICAgICAgICAgaWYgKHggPCAtMSB8fCB4ID4gd2lkdGggfHwgeSA8IC0xIHx8IHkgPiBoZWlnaHQpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQ1LmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIG51ZGdlZCA9IGZhbHNlOwoJICAgICAgICAgICAgaWYgKHggPT09IC0xKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldF0gPSAwLjA7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHggPT09IHdpZHRoKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldF0gPSB3aWR0aCAtIDE7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmICh5ID09PSAtMSkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXQgKyAxXSA9IDAuMDsKCSAgICAgICAgICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSBpZiAoeSA9PT0gaGVpZ2h0KSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldCArIDFdID0gaGVpZ2h0IC0gMTsKCSAgICAgICAgICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICByZXR1cm4gR3JpZFNhbXBsZXI7Cgl9KCkpOwoJR3JpZFNhbXBsZXIkMS5kZWZhdWx0ID0gR3JpZFNhbXBsZXI7CgoJdmFyIFBlcnNwZWN0aXZlVHJhbnNmb3JtJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFBlcnNwZWN0aXZlVHJhbnNmb3JtJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyoqCgkgKiA8cD5UaGlzIGNsYXNzIGltcGxlbWVudHMgYSBwZXJzcGVjdGl2ZSB0cmFuc2Zvcm0gaW4gdHdvIGRpbWVuc2lvbnMuIEdpdmVuIGZvdXIgc291cmNlIGFuZCBmb3VyCgkgKiBkZXN0aW5hdGlvbiBwb2ludHMsIGl0IHdpbGwgY29tcHV0ZSB0aGUgdHJhbnNmb3JtYXRpb24gaW1wbGllZCBiZXR3ZWVuIHRoZW0uIFRoZSBjb2RlIGlzIGJhc2VkCgkgKiBkaXJlY3RseSB1cG9uIHNlY3Rpb24gMy40LjIgb2YgR2VvcmdlIFdvbGJlcmcncyAiRGlnaXRhbCBJbWFnZSBXYXJwaW5nIjsgc2VlIHBhZ2VzIDU0LTU2LjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUGVyc3BlY3RpdmVUcmFuc2Zvcm0gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUGVyc3BlY3RpdmVUcmFuc2Zvcm0oYTExIC8qZmxvYXQqLywgYTIxIC8qZmxvYXQqLywgYTMxIC8qZmxvYXQqLywgYTEyIC8qZmxvYXQqLywgYTIyIC8qZmxvYXQqLywgYTMyIC8qZmxvYXQqLywgYTEzIC8qZmxvYXQqLywgYTIzIC8qZmxvYXQqLywgYTMzIC8qZmxvYXQqLykgewoJICAgICAgICB0aGlzLmExMSA9IGExMTsKCSAgICAgICAgdGhpcy5hMjEgPSBhMjE7CgkgICAgICAgIHRoaXMuYTMxID0gYTMxOwoJICAgICAgICB0aGlzLmExMiA9IGExMjsKCSAgICAgICAgdGhpcy5hMjIgPSBhMjI7CgkgICAgICAgIHRoaXMuYTMyID0gYTMyOwoJICAgICAgICB0aGlzLmExMyA9IGExMzsKCSAgICAgICAgdGhpcy5hMjMgPSBhMjM7CgkgICAgICAgIHRoaXMuYTMzID0gYTMzOwoJICAgIH0KCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5xdWFkcmlsYXRlcmFsVG9RdWFkcmlsYXRlcmFsID0gZnVuY3Rpb24gKHgwIC8qZmxvYXQqLywgeTAgLypmbG9hdCovLCB4MSAvKmZsb2F0Ki8sIHkxIC8qZmxvYXQqLywgeDIgLypmbG9hdCovLCB5MiAvKmZsb2F0Ki8sIHgzIC8qZmxvYXQqLywgeTMgLypmbG9hdCovLCB4MHAgLypmbG9hdCovLCB5MHAgLypmbG9hdCovLCB4MXAgLypmbG9hdCovLCB5MXAgLypmbG9hdCovLCB4MnAgLypmbG9hdCovLCB5MnAgLypmbG9hdCovLCB4M3AgLypmbG9hdCovLCB5M3AgLypmbG9hdCovKSB7CgkgICAgICAgIHZhciBxVG9TID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm0ucXVhZHJpbGF0ZXJhbFRvU3F1YXJlKHgwLCB5MCwgeDEsIHkxLCB4MiwgeTIsIHgzLCB5Myk7CgkgICAgICAgIHZhciBzVG9RID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm0uc3F1YXJlVG9RdWFkcmlsYXRlcmFsKHgwcCwgeTBwLCB4MXAsIHkxcCwgeDJwLCB5MnAsIHgzcCwgeTNwKTsKCSAgICAgICAgcmV0dXJuIHNUb1EudGltZXMocVRvUyk7CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5wcm90b3R5cGUudHJhbnNmb3JtUG9pbnRzID0gZnVuY3Rpb24gKHBvaW50cykgewoJICAgICAgICB2YXIgbWF4ID0gcG9pbnRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGExMSA9IHRoaXMuYTExOwoJICAgICAgICB2YXIgYTEyID0gdGhpcy5hMTI7CgkgICAgICAgIHZhciBhMTMgPSB0aGlzLmExMzsKCSAgICAgICAgdmFyIGEyMSA9IHRoaXMuYTIxOwoJICAgICAgICB2YXIgYTIyID0gdGhpcy5hMjI7CgkgICAgICAgIHZhciBhMjMgPSB0aGlzLmEyMzsKCSAgICAgICAgdmFyIGEzMSA9IHRoaXMuYTMxOwoJICAgICAgICB2YXIgYTMyID0gdGhpcy5hMzI7CgkgICAgICAgIHZhciBhMzMgPSB0aGlzLmEzMzsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXg7IGkgKz0gMikgewoJICAgICAgICAgICAgdmFyIHggPSBwb2ludHNbaV07CgkgICAgICAgICAgICB2YXIgeSA9IHBvaW50c1tpICsgMV07CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3IgPSBhMTMgKiB4ICsgYTIzICogeSArIGEzMzsKCSAgICAgICAgICAgIHBvaW50c1tpXSA9IChhMTEgKiB4ICsgYTIxICogeSArIGEzMSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHBvaW50c1tpICsgMV0gPSAoYTEyICogeCArIGEyMiAqIHkgKyBhMzIpIC8gZGVub21pbmF0b3I7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnByb3RvdHlwZS50cmFuc2Zvcm1Qb2ludHNXaXRoVmFsdWVzID0gZnVuY3Rpb24gKHhWYWx1ZXMsIHlWYWx1ZXMpIHsKCSAgICAgICAgdmFyIGExMSA9IHRoaXMuYTExOwoJICAgICAgICB2YXIgYTEyID0gdGhpcy5hMTI7CgkgICAgICAgIHZhciBhMTMgPSB0aGlzLmExMzsKCSAgICAgICAgdmFyIGEyMSA9IHRoaXMuYTIxOwoJICAgICAgICB2YXIgYTIyID0gdGhpcy5hMjI7CgkgICAgICAgIHZhciBhMjMgPSB0aGlzLmEyMzsKCSAgICAgICAgdmFyIGEzMSA9IHRoaXMuYTMxOwoJICAgICAgICB2YXIgYTMyID0gdGhpcy5hMzI7CgkgICAgICAgIHZhciBhMzMgPSB0aGlzLmEzMzsKCSAgICAgICAgdmFyIG4gPSB4VmFsdWVzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHsKCSAgICAgICAgICAgIHZhciB4ID0geFZhbHVlc1tpXTsKCSAgICAgICAgICAgIHZhciB5ID0geVZhbHVlc1tpXTsKCSAgICAgICAgICAgIHZhciBkZW5vbWluYXRvciA9IGExMyAqIHggKyBhMjMgKiB5ICsgYTMzOwoJICAgICAgICAgICAgeFZhbHVlc1tpXSA9IChhMTEgKiB4ICsgYTIxICogeSArIGEzMSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHlWYWx1ZXNbaV0gPSAoYTEyICogeCArIGEyMiAqIHkgKyBhMzIpIC8gZGVub21pbmF0b3I7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnNxdWFyZVRvUXVhZHJpbGF0ZXJhbCA9IGZ1bmN0aW9uICh4MCAvKmZsb2F0Ki8sIHkwIC8qZmxvYXQqLywgeDEgLypmbG9hdCovLCB5MSAvKmZsb2F0Ki8sIHgyIC8qZmxvYXQqLywgeTIgLypmbG9hdCovLCB4MyAvKmZsb2F0Ki8sIHkzIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgZHgzID0geDAgLSB4MSArIHgyIC0geDM7CgkgICAgICAgIHZhciBkeTMgPSB5MCAtIHkxICsgeTIgLSB5MzsKCSAgICAgICAgaWYgKGR4MyA9PT0gMC4wICYmIGR5MyA9PT0gMC4wKSB7CgkgICAgICAgICAgICAvLyBBZmZpbmUKCSAgICAgICAgICAgIHJldHVybiBuZXcgUGVyc3BlY3RpdmVUcmFuc2Zvcm0oeDEgLSB4MCwgeDIgLSB4MSwgeDAsIHkxIC0geTAsIHkyIC0geTEsIHkwLCAwLjAsIDAuMCwgMS4wKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHZhciBkeDEgPSB4MSAtIHgyOwoJICAgICAgICAgICAgdmFyIGR4MiA9IHgzIC0geDI7CgkgICAgICAgICAgICB2YXIgZHkxID0geTEgLSB5MjsKCSAgICAgICAgICAgIHZhciBkeTIgPSB5MyAtIHkyOwoJICAgICAgICAgICAgdmFyIGRlbm9taW5hdG9yID0gZHgxICogZHkyIC0gZHgyICogZHkxOwoJICAgICAgICAgICAgdmFyIGExMyA9IChkeDMgKiBkeTIgLSBkeDIgKiBkeTMpIC8gZGVub21pbmF0b3I7CgkgICAgICAgICAgICB2YXIgYTIzID0gKGR4MSAqIGR5MyAtIGR4MyAqIGR5MSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHJldHVybiBuZXcgUGVyc3BlY3RpdmVUcmFuc2Zvcm0oeDEgLSB4MCArIGExMyAqIHgxLCB4MyAtIHgwICsgYTIzICogeDMsIHgwLCB5MSAtIHkwICsgYTEzICogeTEsIHkzIC0geTAgKyBhMjMgKiB5MywgeTAsIGExMywgYTIzLCAxLjApOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5xdWFkcmlsYXRlcmFsVG9TcXVhcmUgPSBmdW5jdGlvbiAoeDAgLypmbG9hdCovLCB5MCAvKmZsb2F0Ki8sIHgxIC8qZmxvYXQqLywgeTEgLypmbG9hdCovLCB4MiAvKmZsb2F0Ki8sIHkyIC8qZmxvYXQqLywgeDMgLypmbG9hdCovLCB5MyAvKmZsb2F0Ki8pIHsKCSAgICAgICAgLy8gSGVyZSwgdGhlIGFkam9pbnQgc2VydmVzIGFzIHRoZSBpbnZlcnNlOgoJICAgICAgICByZXR1cm4gUGVyc3BlY3RpdmVUcmFuc2Zvcm0uc3F1YXJlVG9RdWFkcmlsYXRlcmFsKHgwLCB5MCwgeDEsIHkxLCB4MiwgeTIsIHgzLCB5MykuYnVpbGRBZGpvaW50KCk7CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5wcm90b3R5cGUuYnVpbGRBZGpvaW50ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBBZGpvaW50IGlzIHRoZSB0cmFuc3Bvc2Ugb2YgdGhlIGNvZmFjdG9yIG1hdHJpeDoKCSAgICAgICAgcmV0dXJuIG5ldyBQZXJzcGVjdGl2ZVRyYW5zZm9ybSh0aGlzLmEyMiAqIHRoaXMuYTMzIC0gdGhpcy5hMjMgKiB0aGlzLmEzMiwgdGhpcy5hMjMgKiB0aGlzLmEzMSAtIHRoaXMuYTIxICogdGhpcy5hMzMsIHRoaXMuYTIxICogdGhpcy5hMzIgLSB0aGlzLmEyMiAqIHRoaXMuYTMxLCB0aGlzLmExMyAqIHRoaXMuYTMyIC0gdGhpcy5hMTIgKiB0aGlzLmEzMywgdGhpcy5hMTEgKiB0aGlzLmEzMyAtIHRoaXMuYTEzICogdGhpcy5hMzEsIHRoaXMuYTEyICogdGhpcy5hMzEgLSB0aGlzLmExMSAqIHRoaXMuYTMyLCB0aGlzLmExMiAqIHRoaXMuYTIzIC0gdGhpcy5hMTMgKiB0aGlzLmEyMiwgdGhpcy5hMTMgKiB0aGlzLmEyMSAtIHRoaXMuYTExICogdGhpcy5hMjMsIHRoaXMuYTExICogdGhpcy5hMjIgLSB0aGlzLmExMiAqIHRoaXMuYTIxKTsKCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnByb3RvdHlwZS50aW1lcyA9IGZ1bmN0aW9uIChvdGhlcikgewoJICAgICAgICByZXR1cm4gbmV3IFBlcnNwZWN0aXZlVHJhbnNmb3JtKHRoaXMuYTExICogb3RoZXIuYTExICsgdGhpcy5hMjEgKiBvdGhlci5hMTIgKyB0aGlzLmEzMSAqIG90aGVyLmExMywgdGhpcy5hMTEgKiBvdGhlci5hMjEgKyB0aGlzLmEyMSAqIG90aGVyLmEyMiArIHRoaXMuYTMxICogb3RoZXIuYTIzLCB0aGlzLmExMSAqIG90aGVyLmEzMSArIHRoaXMuYTIxICogb3RoZXIuYTMyICsgdGhpcy5hMzEgKiBvdGhlci5hMzMsIHRoaXMuYTEyICogb3RoZXIuYTExICsgdGhpcy5hMjIgKiBvdGhlci5hMTIgKyB0aGlzLmEzMiAqIG90aGVyLmExMywgdGhpcy5hMTIgKiBvdGhlci5hMjEgKyB0aGlzLmEyMiAqIG90aGVyLmEyMiArIHRoaXMuYTMyICogb3RoZXIuYTIzLCB0aGlzLmExMiAqIG90aGVyLmEzMSArIHRoaXMuYTIyICogb3RoZXIuYTMyICsgdGhpcy5hMzIgKiBvdGhlci5hMzMsIHRoaXMuYTEzICogb3RoZXIuYTExICsgdGhpcy5hMjMgKiBvdGhlci5hMTIgKyB0aGlzLmEzMyAqIG90aGVyLmExMywgdGhpcy5hMTMgKiBvdGhlci5hMjEgKyB0aGlzLmEyMyAqIG90aGVyLmEyMiArIHRoaXMuYTMzICogb3RoZXIuYTIzLCB0aGlzLmExMyAqIG90aGVyLmEzMSArIHRoaXMuYTIzICogb3RoZXIuYTMyICsgdGhpcy5hMzMgKiBvdGhlci5hMzMpOwoJICAgIH07CgkgICAgcmV0dXJuIFBlcnNwZWN0aXZlVHJhbnNmb3JtOwoJfSgpKTsKCVBlcnNwZWN0aXZlVHJhbnNmb3JtJDEuZGVmYXVsdCA9IFBlcnNwZWN0aXZlVHJhbnNmb3JtOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDIgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGVmYXVsdEdyaWRTYW1wbGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJdmFyIEdyaWRTYW1wbGVyXzEgPSBHcmlkU2FtcGxlciQxOwoJdmFyIEJpdE1hdHJpeF8xJDEgPSBCaXRNYXRyaXgkMTsKCXZhciBQZXJzcGVjdGl2ZVRyYW5zZm9ybV8xJDEgPSBQZXJzcGVjdGl2ZVRyYW5zZm9ybSQxOwoJdmFyIE5vdEZvdW5kRXhjZXB0aW9uXzEkNCA9IE5vdEZvdW5kRXhjZXB0aW9uJDE7CgkvKioKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBEZWZhdWx0R3JpZFNhbXBsZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDIoRGVmYXVsdEdyaWRTYW1wbGVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIERlZmF1bHRHcmlkU2FtcGxlcigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICAvKkBPdmVycmlkZSovCgkgICAgRGVmYXVsdEdyaWRTYW1wbGVyLnByb3RvdHlwZS5zYW1wbGVHcmlkID0gZnVuY3Rpb24gKGltYWdlLCBkaW1lbnNpb25YIC8qaW50Ki8sIGRpbWVuc2lvblkgLyppbnQqLywgcDFUb1ggLypmbG9hdCovLCBwMVRvWSAvKmZsb2F0Ki8sIHAyVG9YIC8qZmxvYXQqLywgcDJUb1kgLypmbG9hdCovLCBwM1RvWCAvKmZsb2F0Ki8sIHAzVG9ZIC8qZmxvYXQqLywgcDRUb1ggLypmbG9hdCovLCBwNFRvWSAvKmZsb2F0Ki8sIHAxRnJvbVggLypmbG9hdCovLCBwMUZyb21ZIC8qZmxvYXQqLywgcDJGcm9tWCAvKmZsb2F0Ki8sIHAyRnJvbVkgLypmbG9hdCovLCBwM0Zyb21YIC8qZmxvYXQqLywgcDNGcm9tWSAvKmZsb2F0Ki8sIHA0RnJvbVggLypmbG9hdCovLCBwNEZyb21ZIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgdHJhbnNmb3JtID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm1fMSQxLmRlZmF1bHQucXVhZHJpbGF0ZXJhbFRvUXVhZHJpbGF0ZXJhbChwMVRvWCwgcDFUb1ksIHAyVG9YLCBwMlRvWSwgcDNUb1gsIHAzVG9ZLCBwNFRvWCwgcDRUb1ksIHAxRnJvbVgsIHAxRnJvbVksIHAyRnJvbVgsIHAyRnJvbVksIHAzRnJvbVgsIHAzRnJvbVksIHA0RnJvbVgsIHA0RnJvbVkpOwoJICAgICAgICByZXR1cm4gdGhpcy5zYW1wbGVHcmlkV2l0aFRyYW5zZm9ybShpbWFnZSwgZGltZW5zaW9uWCwgZGltZW5zaW9uWSwgdHJhbnNmb3JtKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBEZWZhdWx0R3JpZFNhbXBsZXIucHJvdG90eXBlLnNhbXBsZUdyaWRXaXRoVHJhbnNmb3JtID0gZnVuY3Rpb24gKGltYWdlLCBkaW1lbnNpb25YIC8qaW50Ki8sIGRpbWVuc2lvblkgLyppbnQqLywgdHJhbnNmb3JtKSB7CgkgICAgICAgIGlmIChkaW1lbnNpb25YIDw9IDAgfHwgZGltZW5zaW9uWSA8PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRNYXRyaXhfMSQxLmRlZmF1bHQoZGltZW5zaW9uWCwgZGltZW5zaW9uWSk7CgkgICAgICAgIHZhciBwb2ludHMgPSBuZXcgRmxvYXQzMkFycmF5KDIgKiBkaW1lbnNpb25YKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBkaW1lbnNpb25ZOyB5KyspIHsKCSAgICAgICAgICAgIHZhciBtYXggPSBwb2ludHMubGVuZ3RoOwoJICAgICAgICAgICAgdmFyIGlWYWx1ZSA9IHkgKyAwLjU7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG1heDsgeCArPSAyKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW3hdID0gKHggLyAyKSArIDAuNTsKCSAgICAgICAgICAgICAgICBwb2ludHNbeCArIDFdID0gaVZhbHVlOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdHJhbnNmb3JtLnRyYW5zZm9ybVBvaW50cyhwb2ludHMpOwoJICAgICAgICAgICAgLy8gUXVpY2sgY2hlY2sgdG8gc2VlIGlmIHBvaW50cyB0cmFuc2Zvcm1lZCB0byBzb21ldGhpbmcgaW5zaWRlIHRoZSBpbWFnZQoJICAgICAgICAgICAgLy8gc3VmZmljaWVudCB0byBjaGVjayB0aGUgZW5kcG9pbnRzCgkgICAgICAgICAgICBHcmlkU2FtcGxlcl8xLmRlZmF1bHQuY2hlY2tBbmROdWRnZVBvaW50cyhpbWFnZSwgcG9pbnRzKTsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBtYXg7IHggKz0gMikgewoJICAgICAgICAgICAgICAgICAgICBpZiAoaW1hZ2UuZ2V0KE1hdGguZmxvb3IocG9pbnRzW3hdKSwgTWF0aC5mbG9vcihwb2ludHNbeCArIDFdKSkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJsYWNrKC1pc2gpIHBpeGVsCgkgICAgICAgICAgICAgICAgICAgICAgICBiaXRzLnNldCh4IC8gMiwgeSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjYXRjaCAoYWlvb2JlIC8qOiBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24qLykgewoJICAgICAgICAgICAgICAgIC8vIFRoaXMgZmVlbHMgd3JvbmcsIGJ1dCwgc29tZXRpbWVzIGlmIHRoZSBmaW5kZXIgcGF0dGVybnMgYXJlIG1pc2lkZW50aWZpZWQsIHRoZSByZXN1bHRpbmcKCSAgICAgICAgICAgICAgICAvLyB0cmFuc2Zvcm0gZ2V0cyAidHdpc3RlZCIgc3VjaCB0aGF0IGl0IG1hcHMgYSBzdHJhaWdodCBsaW5lIG9mIHBvaW50cyB0byBhIHNldCBvZiBwb2ludHMKCSAgICAgICAgICAgICAgICAvLyB3aG9zZSBlbmRwb2ludHMgYXJlIGluIGJvdW5kcywgYnV0IG90aGVycyBhcmUgbm90LiBUaGVyZSBpcyBwcm9iYWJseSBzb21lIG1hdGhlbWF0aWNhbAoJICAgICAgICAgICAgICAgIC8vIHdheSB0byBkZXRlY3QgdGhpcyBhYm91dCB0aGUgdHJhbnNmb3JtYXRpb24gdGhhdCBJIGRvbid0IGtub3cgeWV0LgoJICAgICAgICAgICAgICAgIC8vIFRoaXMgcmVzdWx0cyBpbiBhbiB1Z2x5IHJ1bnRpbWUgZXhjZXB0aW9uIGRlc3BpdGUgb3VyIGNsZXZlciBjaGVja3MgYWJvdmUgLS0gY2FuJ3QgaGF2ZQoJICAgICAgICAgICAgICAgIC8vIHRoYXQuIFdlIGNvdWxkIGNoZWNrIGVhY2ggcG9pbnQncyBjb29yZGluYXRlcyBidXQgdGhhdCBmZWVscyBkdXBsaWNhdGl2ZS4gV2Ugc2V0dGxlIGZvcgoJICAgICAgICAgICAgICAgIC8vIGNhdGNoaW5nIGFuZCB3cmFwcGluZyBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24uCgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNC5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICByZXR1cm4gRGVmYXVsdEdyaWRTYW1wbGVyOwoJfShHcmlkU2FtcGxlcl8xLmRlZmF1bHQpKTsKCURlZmF1bHRHcmlkU2FtcGxlciQxLmRlZmF1bHQgPSBEZWZhdWx0R3JpZFNhbXBsZXI7CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEdyaWRTYW1wbGVySW5zdGFuY2UkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIERlZmF1bHRHcmlkU2FtcGxlcl8xID0gRGVmYXVsdEdyaWRTYW1wbGVyJDE7Cgl2YXIgR3JpZFNhbXBsZXJJbnN0YW5jZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBHcmlkU2FtcGxlckluc3RhbmNlKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiBTZXRzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiBHcmlkU2FtcGxlciB1c2VkIGJ5IHRoZSBsaWJyYXJ5LiBPbmUgZ2xvYmFsCgkgICAgICogaW5zdGFuY2UgaXMgc3RvcmVkLCB3aGljaCBtYXkgc291bmQgcHJvYmxlbWF0aWMuIEJ1dCwgdGhlIGltcGxlbWVudGF0aW9uIHByb3ZpZGVkCgkgICAgICogb3VnaHQgdG8gYmUgYXBwcm9wcmlhdGUgZm9yIHRoZSBlbnRpcmUgcGxhdGZvcm0sIGFuZCBhbGwgdXNlcyBvZiB0aGlzIGxpYnJhcnkKCSAgICAgKiBpbiB0aGUgd2hvbGUgbGlmZXRpbWUgb2YgdGhlIEpWTS4gRm9yIGluc3RhbmNlLCBhbiBBbmRyb2lkIGFjdGl2aXR5IGNhbiBzd2FwIGluCgkgICAgICogYW4gaW1wbGVtZW50YXRpb24gdGhhdCB0YWtlcyBhZHZhbnRhZ2Ugb2YgbmF0aXZlIHBsYXRmb3JtIGxpYnJhcmllcy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBuZXdHcmlkU2FtcGxlciBUaGUgcGxhdGZvcm0tc3BlY2lmaWMgb2JqZWN0IHRvIGluc3RhbGwuCgkgICAgICovCgkgICAgR3JpZFNhbXBsZXJJbnN0YW5jZS5zZXRHcmlkU2FtcGxlciA9IGZ1bmN0aW9uIChuZXdHcmlkU2FtcGxlcikgewoJICAgICAgICBHcmlkU2FtcGxlckluc3RhbmNlLmdyaWRTYW1wbGVyID0gbmV3R3JpZFNhbXBsZXI7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHRoZSBjdXJyZW50IGltcGxlbWVudGF0aW9uIG9mIEdyaWRTYW1wbGVyCgkgICAgICovCgkgICAgR3JpZFNhbXBsZXJJbnN0YW5jZS5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIEdyaWRTYW1wbGVySW5zdGFuY2UuZ3JpZFNhbXBsZXI7CgkgICAgfTsKCSAgICBHcmlkU2FtcGxlckluc3RhbmNlLmdyaWRTYW1wbGVyID0gbmV3IERlZmF1bHRHcmlkU2FtcGxlcl8xLmRlZmF1bHQoKTsKCSAgICByZXR1cm4gR3JpZFNhbXBsZXJJbnN0YW5jZTsKCX0oKSk7CglHcmlkU2FtcGxlckluc3RhbmNlJDEuZGVmYXVsdCA9IEdyaWRTYW1wbGVySW5zdGFuY2U7CgoJdmFyIFJlc3VsdFBvaW50JDEgPSB7fTsKCgl2YXIgRmxvYXQkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShGbG9hdCQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKioKCSAqIFBvbnlmaWxsIGZvciBKYXZhJ3MgRmxvYXQgY2xhc3MuCgkgKi8KCXZhciBGbG9hdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBGbG9hdCgpIHsKCSAgICB9CgkgICAgLyoqCgkgICAgICogU2luY1RTIGhhcyBubyBkaWZmZXJlbmNlIGJldHdlZW4gaW50IGFuZCBmbG9hdCwgdGhlcmUncyBhbGwgbnVtYmVycywKCSAgICAgKiB0aGlzIGlzIHVzZWQgb25seSB0byBwb2x5ZmlsbCBKYXZhIGNvZGUuCgkgICAgICovCgkgICAgRmxvYXQuZmxvYXRUb0ludEJpdHMgPSBmdW5jdGlvbiAoZikgewoJICAgICAgICByZXR1cm4gZjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFRoZSBmbG9hdCBtYXggdmFsdWUgaW4gSlMgaXMgdGhlIG51bWJlciBtYXggdmFsdWUuCgkgICAgICovCgkgICAgRmxvYXQuTUFYX1ZBTFVFID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgcmV0dXJuIEZsb2F0OwoJfSgpKTsKCUZsb2F0JDEuZGVmYXVsdCA9IEZsb2F0OwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVzdWx0UG9pbnQkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCXZhciBNYXRoVXRpbHNfMSQxID0gTWF0aFV0aWxzJDE7Cgl2YXIgRmxvYXRfMSA9IEZsb2F0JDE7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIHBvaW50IG9mIGludGVyZXN0IGluIGFuIGltYWdlIGNvbnRhaW5pbmcgYSBiYXJjb2RlLiBUeXBpY2FsbHksIHRoaXMKCSAqIHdvdWxkIGJlIHRoZSBsb2NhdGlvbiBvZiBhIGZpbmRlciBwYXR0ZXJuIG9yIHRoZSBjb3JuZXIgb2YgdGhlIGJhcmNvZGUsIGZvciBleGFtcGxlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUmVzdWx0UG9pbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUmVzdWx0UG9pbnQoeCwgeSkgewoJICAgICAgICB0aGlzLnggPSB4OwoJICAgICAgICB0aGlzLnkgPSB5OwoJICAgIH0KCSAgICBSZXN1bHRQb2ludC5wcm90b3R5cGUuZ2V0WCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMueDsKCSAgICB9OwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5nZXRZID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy55OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2YgUmVzdWx0UG9pbnQpIHsKCSAgICAgICAgICAgIHZhciBvdGhlclBvaW50ID0gb3RoZXI7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy54ID09PSBvdGhlclBvaW50LnggJiYgdGhpcy55ID09PSBvdGhlclBvaW50Lnk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDMxICogRmxvYXRfMS5kZWZhdWx0LmZsb2F0VG9JbnRCaXRzKHRoaXMueCkgKyBGbG9hdF8xLmRlZmF1bHQuZmxvYXRUb0ludEJpdHModGhpcy55KTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBSZXN1bHRQb2ludC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiAnKCcgKyB0aGlzLnggKyAnLCcgKyB0aGlzLnkgKyAnKSc7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBPcmRlcnMgYW4gYXJyYXkgb2YgdGhyZWUgUmVzdWx0UG9pbnRzIGluIGFuIG9yZGVyIFtBLEIsQ10gc3VjaCB0aGF0IEFCIGlzIGxlc3MgdGhhbiBBQwoJICAgICAqIGFuZCBCQyBpcyBsZXNzIHRoYW4gQUMsIGFuZCB0aGUgYW5nbGUgYmV0d2VlbiBCQyBhbmQgQkEgaXMgbGVzcyB0aGFuIDE4MCBkZWdyZWVzLgoJICAgICAqCgkgICAgICogQHBhcmFtIHBhdHRlcm5zIGFycmF5IG9mIHRocmVlIHtAY29kZSBSZXN1bHRQb2ludH0gdG8gb3JkZXIKCSAgICAgKi8KCSAgICBSZXN1bHRQb2ludC5vcmRlckJlc3RQYXR0ZXJucyA9IGZ1bmN0aW9uIChwYXR0ZXJucykgewoJICAgICAgICAvLyBGaW5kIGRpc3RhbmNlcyBiZXR3ZWVuIHBhdHRlcm4gY2VudGVycwoJICAgICAgICB2YXIgemVyb09uZURpc3RhbmNlID0gdGhpcy5kaXN0YW5jZShwYXR0ZXJuc1swXSwgcGF0dGVybnNbMV0pOwoJICAgICAgICB2YXIgb25lVHdvRGlzdGFuY2UgPSB0aGlzLmRpc3RhbmNlKHBhdHRlcm5zWzFdLCBwYXR0ZXJuc1syXSk7CgkgICAgICAgIHZhciB6ZXJvVHdvRGlzdGFuY2UgPSB0aGlzLmRpc3RhbmNlKHBhdHRlcm5zWzBdLCBwYXR0ZXJuc1syXSk7CgkgICAgICAgIHZhciBwb2ludEE7CgkgICAgICAgIHZhciBwb2ludEI7CgkgICAgICAgIHZhciBwb2ludEM7CgkgICAgICAgIC8vIEFzc3VtZSBvbmUgY2xvc2VzdCB0byBvdGhlciB0d28gaXMgQjsgQSBhbmQgQyB3aWxsIGp1c3QgYmUgZ3Vlc3NlcyBhdCBmaXJzdAoJICAgICAgICBpZiAob25lVHdvRGlzdGFuY2UgPj0gemVyb09uZURpc3RhbmNlICYmIG9uZVR3b0Rpc3RhbmNlID49IHplcm9Ud29EaXN0YW5jZSkgewoJICAgICAgICAgICAgcG9pbnRCID0gcGF0dGVybnNbMF07CgkgICAgICAgICAgICBwb2ludEEgPSBwYXR0ZXJuc1sxXTsKCSAgICAgICAgICAgIHBvaW50QyA9IHBhdHRlcm5zWzJdOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgaWYgKHplcm9Ud29EaXN0YW5jZSA+PSBvbmVUd29EaXN0YW5jZSAmJiB6ZXJvVHdvRGlzdGFuY2UgPj0gemVyb09uZURpc3RhbmNlKSB7CgkgICAgICAgICAgICBwb2ludEIgPSBwYXR0ZXJuc1sxXTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBhdHRlcm5zWzBdOwoJICAgICAgICAgICAgcG9pbnRDID0gcGF0dGVybnNbMl07CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICBwb2ludEIgPSBwYXR0ZXJuc1syXTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBhdHRlcm5zWzBdOwoJICAgICAgICAgICAgcG9pbnRDID0gcGF0dGVybnNbMV07CgkgICAgICAgIH0KCSAgICAgICAgLy8gVXNlIGNyb3NzIHByb2R1Y3QgdG8gZmlndXJlIG91dCB3aGV0aGVyIEEgYW5kIEMgYXJlIGNvcnJlY3Qgb3IgZmxpcHBlZC4KCSAgICAgICAgLy8gVGhpcyBhc2tzIHdoZXRoZXIgQkMgeCBCQSBoYXMgYSBwb3NpdGl2ZSB6IGNvbXBvbmVudCwgd2hpY2ggaXMgdGhlIGFycmFuZ2VtZW50CgkgICAgICAgIC8vIHdlIHdhbnQgZm9yIEEsIEIsIEMuIElmIGl0J3MgbmVnYXRpdmUsIHRoZW4gd2UndmUgZ290IGl0IGZsaXBwZWQgYXJvdW5kIGFuZAoJICAgICAgICAvLyBzaG91bGQgc3dhcCBBIGFuZCBDLgoJICAgICAgICBpZiAodGhpcy5jcm9zc1Byb2R1Y3RaKHBvaW50QSwgcG9pbnRCLCBwb2ludEMpIDwgMC4wKSB7CgkgICAgICAgICAgICB2YXIgdGVtcCA9IHBvaW50QTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBvaW50QzsKCSAgICAgICAgICAgIHBvaW50QyA9IHRlbXA7CgkgICAgICAgIH0KCSAgICAgICAgcGF0dGVybnNbMF0gPSBwb2ludEE7CgkgICAgICAgIHBhdHRlcm5zWzFdID0gcG9pbnRCOwoJICAgICAgICBwYXR0ZXJuc1syXSA9IHBvaW50QzsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBwYXR0ZXJuMSBmaXJzdCBwYXR0ZXJuCgkgICAgICogQHBhcmFtIHBhdHRlcm4yIHNlY29uZCBwYXR0ZXJuCgkgICAgICogQHJldHVybiBkaXN0YW5jZSBiZXR3ZWVuIHR3byBwb2ludHMKCSAgICAgKi8KCSAgICBSZXN1bHRQb2ludC5kaXN0YW5jZSA9IGZ1bmN0aW9uIChwYXR0ZXJuMSwgcGF0dGVybjIpIHsKCSAgICAgICAgcmV0dXJuIE1hdGhVdGlsc18xJDEuZGVmYXVsdC5kaXN0YW5jZShwYXR0ZXJuMS54LCBwYXR0ZXJuMS55LCBwYXR0ZXJuMi54LCBwYXR0ZXJuMi55KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIHogY29tcG9uZW50IG9mIHRoZSBjcm9zcyBwcm9kdWN0IGJldHdlZW4gdmVjdG9ycyBCQyBhbmQgQkEuCgkgICAgICovCgkgICAgUmVzdWx0UG9pbnQuY3Jvc3NQcm9kdWN0WiA9IGZ1bmN0aW9uIChwb2ludEEsIHBvaW50QiwgcG9pbnRDKSB7CgkgICAgICAgIHZhciBiWCA9IHBvaW50Qi54OwoJICAgICAgICB2YXIgYlkgPSBwb2ludEIueTsKCSAgICAgICAgcmV0dXJuICgocG9pbnRDLnggLSBiWCkgKiAocG9pbnRBLnkgLSBiWSkpIC0gKChwb2ludEMueSAtIGJZKSAqIChwb2ludEEueCAtIGJYKSk7CgkgICAgfTsKCSAgICByZXR1cm4gUmVzdWx0UG9pbnQ7Cgl9KCkpOwoJUmVzdWx0UG9pbnQkMS5kZWZhdWx0ID0gUmVzdWx0UG9pbnQ7CgoJdmFyIEFsaWdubWVudFBhdHRlcm5GaW5kZXIkMSA9IHt9OwoKCXZhciBBbGlnbm1lbnRQYXR0ZXJuJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fZXh0ZW5kcyQxID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFsaWdubWVudFBhdHRlcm4kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGV0ZWN0b3IgeyovCgl2YXIgUmVzdWx0UG9pbnRfMSQzID0gUmVzdWx0UG9pbnQkMTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGFuIGFsaWdubWVudCBwYXR0ZXJuLCB3aGljaCBhcmUgdGhlIHNtYWxsZXIgc3F1YXJlIHBhdHRlcm5zIGZvdW5kIGluCgkgKiBhbGwgYnV0IHRoZSBzaW1wbGVzdCBRUiBDb2Rlcy48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEFsaWdubWVudFBhdHRlcm4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDEoQWxpZ25tZW50UGF0dGVybiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBBbGlnbm1lbnRQYXR0ZXJuKHBvc1ggLypmbG9hdCovLCBwb3NZIC8qZmxvYXQqLywgZXN0aW1hdGVkTW9kdWxlU2l6ZSAvKmZsb2F0Ki8pIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcG9zWCwgcG9zWSkgfHwgdGhpczsKCSAgICAgICAgX3RoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IGVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZXJtaW5lcyBpZiB0aGlzIGFsaWdubWVudCBwYXR0ZXJuICJhYm91dCBlcXVhbHMiIGFuIGFsaWdubWVudCBwYXR0ZXJuIGF0IHRoZSBzdGF0ZWQKCSAgICAgKiBwb3NpdGlvbiBhbmQgc2l6ZSAtLSBtZWFuaW5nLCBpdCBpcyBhdCBuZWFybHkgdGhlIHNhbWUgY2VudGVyIHdpdGggbmVhcmx5IHRoZSBzYW1lIHNpemUuPC9wPgoJICAgICAqLwoJICAgIEFsaWdubWVudFBhdHRlcm4ucHJvdG90eXBlLmFib3V0RXF1YWxzID0gZnVuY3Rpb24gKG1vZHVsZVNpemUgLypmbG9hdCovLCBpIC8qZmxvYXQqLywgaiAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE1hdGguYWJzKGkgLSB0aGlzLmdldFkoKSkgPD0gbW9kdWxlU2l6ZSAmJiBNYXRoLmFicyhqIC0gdGhpcy5nZXRYKCkpIDw9IG1vZHVsZVNpemUpIHsKCSAgICAgICAgICAgIHZhciBtb2R1bGVTaXplRGlmZiA9IE1hdGguYWJzKG1vZHVsZVNpemUgLSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVNpemVEaWZmIDw9IDEuMCB8fCBtb2R1bGVTaXplRGlmZiA8PSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29tYmluZXMgdGhpcyBvYmplY3QncyBjdXJyZW50IGVzdGltYXRlIG9mIGEgZmluZGVyIHBhdHRlcm4gcG9zaXRpb24gYW5kIG1vZHVsZSBzaXplCgkgICAgICogd2l0aCBhIG5ldyBlc3RpbWF0ZS4gSXQgcmV0dXJucyBhIG5ldyB7QGNvZGUgRmluZGVyUGF0dGVybn0gY29udGFpbmluZyBhbiBhdmVyYWdlIG9mIHRoZSB0d28uCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybi5wcm90b3R5cGUuY29tYmluZUVzdGltYXRlID0gZnVuY3Rpb24gKGkgLypmbG9hdCovLCBqIC8qZmxvYXQqLywgbmV3TW9kdWxlU2l6ZSAvKmZsb2F0Ki8pIHsKCSAgICAgICAgdmFyIGNvbWJpbmVkWCA9ICh0aGlzLmdldFgoKSArIGopIC8gMi4wOwoJICAgICAgICB2YXIgY29tYmluZWRZID0gKHRoaXMuZ2V0WSgpICsgaSkgLyAyLjA7CgkgICAgICAgIHZhciBjb21iaW5lZE1vZHVsZVNpemUgPSAodGhpcy5lc3RpbWF0ZWRNb2R1bGVTaXplICsgbmV3TW9kdWxlU2l6ZSkgLyAyLjA7CgkgICAgICAgIHJldHVybiBuZXcgQWxpZ25tZW50UGF0dGVybihjb21iaW5lZFgsIGNvbWJpbmVkWSwgY29tYmluZWRNb2R1bGVTaXplKTsKCSAgICB9OwoJICAgIHJldHVybiBBbGlnbm1lbnRQYXR0ZXJuOwoJfShSZXN1bHRQb2ludF8xJDMuZGVmYXVsdCkpOwoJQWxpZ25tZW50UGF0dGVybiQxLmRlZmF1bHQgPSBBbGlnbm1lbnRQYXR0ZXJuOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX192YWx1ZXMkMSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX3ZhbHVlcykgfHwgZnVuY3Rpb24obykgewoJICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwOwoJICAgIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pOwoJICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHJldHVybiB7CgkgICAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7CgkgICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHRocm93IG5ldyBUeXBlRXJyb3IocyA/ICJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLiIgOiAiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpOwoJfTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShBbGlnbm1lbnRQYXR0ZXJuRmluZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBBbGlnbm1lbnRQYXR0ZXJuXzEgPSBBbGlnbm1lbnRQYXR0ZXJuJDE7Cgl2YXIgTm90Rm91bmRFeGNlcHRpb25fMSQzID0gTm90Rm91bmRFeGNlcHRpb24kMTsKCS8qaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgYXR0ZW1wdHMgdG8gZmluZCBhbGlnbm1lbnQgcGF0dGVybnMgaW4gYSBRUiBDb2RlLiBBbGlnbm1lbnQgcGF0dGVybnMgbG9vayBsaWtlIGZpbmRlcgoJICogcGF0dGVybnMgYnV0IGFyZSBzbWFsbGVyIGFuZCBhcHBlYXIgYXQgcmVndWxhciBpbnRlcnZhbHMgdGhyb3VnaG91dCB0aGUgaW1hZ2UuPC9wPgoJICoKCSAqIDxwPkF0IHRoZSBtb21lbnQgdGhpcyBvbmx5IGxvb2tzIGZvciB0aGUgYm90dG9tLXJpZ2h0IGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAqCgkgKiA8cD5UaGlzIGlzIG1vc3RseSBhIHNpbXBsaWZpZWQgY29weSBvZiB7QGxpbmsgRmluZGVyUGF0dGVybkZpbmRlcn0uIEl0IGlzIGNvcGllZCwKCSAqIHBhc3RlZCBhbmQgc3RyaXBwZWQgZG93biBoZXJlIGZvciBtYXhpbXVtIHBlcmZvcm1hbmNlIGJ1dCBkb2VzIHVuZm9ydHVuYXRlbHkgZHVwbGljYXRlCgkgKiBzb21lIGNvZGUuPC9wPgoJICoKCSAqIDxwPlRoaXMgY2xhc3MgaXMgdGhyZWFkLXNhZmUgYnV0IG5vdCByZWVudHJhbnQuIEVhY2ggdGhyZWFkIG11c3QgYWxsb2NhdGUgaXRzIG93biBvYmplY3QuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8qKgoJICAgICAqIDxwPkNyZWF0ZXMgYSBmaW5kZXIgdGhhdCB3aWxsIGxvb2sgaW4gYSBwb3J0aW9uIG9mIHRoZSB3aG9sZSBpbWFnZS48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0gaW1hZ2UgaW1hZ2UgdG8gc2VhcmNoCgkgICAgICogQHBhcmFtIHN0YXJ0WCBsZWZ0IGNvbHVtbiBmcm9tIHdoaWNoIHRvIHN0YXJ0IHNlYXJjaGluZwoJICAgICAqIEBwYXJhbSBzdGFydFkgdG9wIHJvdyBmcm9tIHdoaWNoIHRvIHN0YXJ0IHNlYXJjaGluZwoJICAgICAqIEBwYXJhbSB3aWR0aCB3aWR0aCBvZiByZWdpb24gdG8gc2VhcmNoCgkgICAgICogQHBhcmFtIGhlaWdodCBoZWlnaHQgb2YgcmVnaW9uIHRvIHNlYXJjaAoJICAgICAqIEBwYXJhbSBtb2R1bGVTaXplIGVzdGltYXRlZCBtb2R1bGUgc2l6ZSBzbyBmYXIKCSAgICAgKi8KCSAgICBmdW5jdGlvbiBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyKGltYWdlLCBzdGFydFggLyppbnQqLywgc3RhcnRZIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovLCBtb2R1bGVTaXplIC8qZmxvYXQqLywgcmVzdWx0UG9pbnRDYWxsYmFjaykgewoJICAgICAgICB0aGlzLmltYWdlID0gaW1hZ2U7CgkgICAgICAgIHRoaXMuc3RhcnRYID0gc3RhcnRYOwoJICAgICAgICB0aGlzLnN0YXJ0WSA9IHN0YXJ0WTsKCSAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoOwoJICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDsKCSAgICAgICAgdGhpcy5tb2R1bGVTaXplID0gbW9kdWxlU2l6ZTsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gcmVzdWx0UG9pbnRDYWxsYmFjazsKCSAgICAgICAgdGhpcy5wb3NzaWJsZUNlbnRlcnMgPSBbXTsgLy8gbmV3IEFycmF5PGFueT4oNSkpCgkgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiBhcnJheSBpbml0aWFsaXphdGlvbiB3aXRob3V0IHNpemUgYXMgdGhlIGxlbmd0aCBpcyBjaGVja2VkIGJlbG93CgkgICAgICAgIHRoaXMuY3Jvc3NDaGVja1N0YXRlQ291bnQgPSBuZXcgSW50MzJBcnJheSgzKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICogPHA+VGhpcyBtZXRob2QgYXR0ZW1wdHMgdG8gZmluZCB0aGUgYm90dG9tLXJpZ2h0IGFsaWdubWVudCBwYXR0ZXJuIGluIHRoZSBpbWFnZS4gSXQgaXMgYSBiaXQgbWVzc3kgc2luY2UKCSAgICAgKiBpdCdzIHByZXR0eSBwZXJmb3JtYW5jZS1jcml0aWNhbCBhbmQgc28gaXMgd3JpdHRlbiB0byBiZSBmYXN0IGZvcmVtb3N0LjwvcD4KCSAgICAgKgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEFsaWdubWVudFBhdHRlcm59IGlmIGZvdW5kCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBub3QgZm91bmQKCSAgICAgKi8KCSAgICBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgc3RhcnRYID0gdGhpcy5zdGFydFg7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmhlaWdodDsKCSAgICAgICAgdmFyIHdpZHRoID0gdGhpcy53aWR0aDsKCSAgICAgICAgdmFyIG1heEogPSBzdGFydFggKyB3aWR0aDsKCSAgICAgICAgdmFyIG1pZGRsZUkgPSB0aGlzLnN0YXJ0WSArIChoZWlnaHQgLyAyKTsKCSAgICAgICAgLy8gV2UgYXJlIGxvb2tpbmcgZm9yIGJsYWNrL3doaXRlL2JsYWNrIG1vZHVsZXMgaW4gMToxOjEgcmF0aW8KCSAgICAgICAgLy8gdGhpcyB0cmFja3MgdGhlIG51bWJlciBvZiBibGFjay93aGl0ZS9ibGFjayBtb2R1bGVzIHNlZW4gc28gZmFyCgkgICAgICAgIHZhciBzdGF0ZUNvdW50ID0gbmV3IEludDMyQXJyYXkoMyk7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIGZvciAodmFyIGlHZW4gPSAwOyBpR2VuIDwgaGVpZ2h0OyBpR2VuKyspIHsKCSAgICAgICAgICAgIC8vIFNlYXJjaCBmcm9tIG1pZGRsZSBvdXR3YXJkcwoJICAgICAgICAgICAgdmFyIGkgPSBtaWRkbGVJICsgKChpR2VuICYgMHgwMSkgPT09IDAgPyBNYXRoLmZsb29yKChpR2VuICsgMSkgLyAyKSA6IC1NYXRoLmZsb29yKChpR2VuICsgMSkgLyAyKSk7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMV0gPSAwOwoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IDA7CgkgICAgICAgICAgICB2YXIgaiA9IHN0YXJ0WDsKCSAgICAgICAgICAgIC8vIEJ1cm4gb2ZmIGxlYWRpbmcgd2hpdGUgcGl4ZWxzIGJlZm9yZSBhbnl0aGluZyBlbHNlOyBpZiB3ZSBzdGFydCBpbiB0aGUgbWlkZGxlIG9mCgkgICAgICAgICAgICAvLyBhIHdoaXRlIHJ1biwgaXQgZG9lc24ndCBtYWtlIHNlbnNlIHRvIGNvdW50IGl0cyBsZW5ndGgsIHNpbmNlIHdlIGRvbid0IGtub3cgaWYgdGhlCgkgICAgICAgICAgICAvLyB3aGl0ZSBydW4gY29udGludWVkIHRvIHRoZSBsZWZ0IG9mIHRoZSBzdGFydCBwb2ludAoJICAgICAgICAgICAgd2hpbGUgKGogPCBtYXhKICYmICFpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICBqKys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgY3VycmVudFN0YXRlID0gMDsKCSAgICAgICAgICAgIHdoaWxlIChqIDwgbWF4SikgewoJICAgICAgICAgICAgICAgIGlmIChpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gQmxhY2sgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSA9PT0gMSkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMV0rKzsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsgLy8gQ291bnRpbmcgd2hpdGUgcGl4ZWxzCgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFN0YXRlID09PSAyKSB7IC8vIEEgd2lubmVyPwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZvdW5kUGF0dGVybkNyb3NzKHN0YXRlQ291bnQpKSB7IC8vIFllcwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29uZmlybWVkID0gdGhpcy5oYW5kbGVQb3NzaWJsZUNlbnRlcihzdGF0ZUNvdW50LCBpLCBqKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCAhPT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpcm1lZDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gc3RhdGVDb3VudFsyXTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzFdID0gMTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzJdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsrK2N1cnJlbnRTdGF0ZV0rKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsgLy8gV2hpdGUgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSA9PT0gMSkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdGF0ZSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBqKys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAodGhpcy5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSkgewoJICAgICAgICAgICAgICAgIHZhciBjb25maXJtZWQgPSB0aGlzLmhhbmRsZVBvc3NpYmxlQ2VudGVyKHN0YXRlQ291bnQsIGksIG1heEopOwoJICAgICAgICAgICAgICAgIGlmIChjb25maXJtZWQgIT09IG51bGwpIHsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpcm1lZDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gSG1tLCBub3RoaW5nIHdlIHNhdyB3YXMgb2JzZXJ2ZWQgYW5kIGNvbmZpcm1lZCB0d2ljZS4gSWYgd2UgaGFkCgkgICAgICAgIC8vIGFueSBndWVzcyBhdCBhbGwsIHJldHVybiBpdC4KCSAgICAgICAgaWYgKHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aCAhPT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMucG9zc2libGVDZW50ZXJzWzBdOwoJICAgICAgICB9CgkgICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbl8xJDMuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogR2l2ZW4gYSBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCBzZWVuIGFuZCBhbiBlbmQgcG9zaXRpb24sCgkgICAgICogZmlndXJlcyB0aGUgbG9jYXRpb24gb2YgdGhlIGNlbnRlciBvZiB0aGlzIGJsYWNrL3doaXRlL2JsYWNrIHJ1bi4KCSAgICAgKi8KCSAgICBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCwgZW5kIC8qaW50Ki8pIHsKCSAgICAgICAgcmV0dXJuIChlbmQgLSBzdGF0ZUNvdW50WzJdKSAtIHN0YXRlQ291bnRbMV0gLyAyLjA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gc3RhdGVDb3VudCBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCByZWFkCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGUgcHJvcG9ydGlvbnMgb2YgdGhlIGNvdW50cyBpcyBjbG9zZSBlbm91Z2ggdG8gdGhlIDEvMS8xIHJhdGlvcwoJICAgICAqICAgICAgICAgdXNlZCBieSBhbGlnbm1lbnQgcGF0dGVybnMgdG8gYmUgY29uc2lkZXJlZCBhIG1hdGNoCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybkZpbmRlci5wcm90b3R5cGUuZm91bmRQYXR0ZXJuQ3Jvc3MgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCkgewoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRoaXMubW9kdWxlU2l6ZTsKCSAgICAgICAgdmFyIG1heFZhcmlhbmNlID0gbW9kdWxlU2l6ZSAvIDIuMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAzOyBpKyspIHsKCSAgICAgICAgICAgIGlmIChNYXRoLmFicyhtb2R1bGVTaXplIC0gc3RhdGVDb3VudFtpXSkgPj0gbWF4VmFyaWFuY2UpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5BZnRlciBhIGhvcml6b250YWwgc2NhbiBmaW5kcyBhIHBvdGVudGlhbCBhbGlnbm1lbnQgcGF0dGVybiwgdGhpcyBtZXRob2QKCSAgICAgKiAiY3Jvc3MtY2hlY2tzIiBieSBzY2FubmluZyBkb3duIHZlcnRpY2FsbHkgdGhyb3VnaCB0aGUgY2VudGVyIG9mIHRoZSBwb3NzaWJsZQoJICAgICAqIGFsaWdubWVudCBwYXR0ZXJuIHRvIHNlZSBpZiB0aGUgc2FtZSBwcm9wb3J0aW9uIGlzIGRldGVjdGVkLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGFydEkgcm93IHdoZXJlIGFuIGFsaWdubWVudCBwYXR0ZXJuIHdhcyBkZXRlY3RlZAoJICAgICAqIEBwYXJhbSBjZW50ZXJKIGNlbnRlciBvZiB0aGUgc2VjdGlvbiB0aGF0IGFwcGVhcnMgdG8gY3Jvc3MgYW4gYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gbWF4Q291bnQgbWF4aW11bSByZWFzb25hYmxlIG51bWJlciBvZiBtb2R1bGVzIHRoYXQgc2hvdWxkIGJlCgkgICAgICogb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcmV0dXJuIHZlcnRpY2FsIGNlbnRlciBvZiBhbGlnbm1lbnQgcGF0dGVybiwgb3Ige0BsaW5rIEZsb2F0I05hTn0gaWYgbm90IGZvdW5kCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybkZpbmRlci5wcm90b3R5cGUuY3Jvc3NDaGVja1ZlcnRpY2FsID0gZnVuY3Rpb24gKHN0YXJ0SSAvKmludCovLCBjZW50ZXJKIC8qaW50Ki8sIG1heENvdW50IC8qaW50Ki8sIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGltYWdlID0gdGhpcy5pbWFnZTsKCSAgICAgICAgdmFyIG1heEkgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgc3RhdGVDb3VudFsxXSA9IDA7CgkgICAgICAgIHN0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICAvLyBTdGFydCBjb3VudGluZyB1cCBmcm9tIGNlbnRlcgoJICAgICAgICB2YXIgaSA9IHN0YXJ0STsKCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIGFscmVhZHkgdG9vIG1hbnkgbW9kdWxlcyBpbiB0aGlzIHN0YXRlIG9yIHJhbiBvZmYgdGhlIGVkZ2U6CgkgICAgICAgIGlmIChpIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiAhaW1hZ2UuZ2V0KGNlbnRlckosIGkpICYmIHN0YXRlQ291bnRbMF0gPD0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMF0rKzsKCSAgICAgICAgICAgIGktLTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFswXSA+IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIC8vIE5vdyBhbHNvIGNvdW50IGRvd24gZnJvbSBjZW50ZXIKCSAgICAgICAgaSA9IHN0YXJ0SSArIDE7CgkgICAgICAgIHdoaWxlIChpIDwgbWF4SSAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJIHx8IHN0YXRlQ291bnRbMV0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaSA8IG1heEkgJiYgIWltYWdlLmdldChjZW50ZXJKLCBpKSAmJiBzdGF0ZUNvdW50WzJdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzJdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbMl0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdOwoJICAgICAgICBpZiAoNSAqIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA+PSAyICogb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkgPyBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQoc3RhdGVDb3VudCwgaSkgOiBOYU47CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5UaGlzIGlzIGNhbGxlZCB3aGVuIGEgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG9zc2libGUgYWxpZ25tZW50IHBhdHRlcm4uIEl0IHdpbGwKCSAgICAgKiBjcm9zcyBjaGVjayB3aXRoIGEgdmVydGljYWwgc2NhbiwgYW5kIGlmIHN1Y2Nlc3NmdWwsIHdpbGwgc2VlIGlmIHRoaXMgcGF0dGVybiBoYWQgYmVlbgoJICAgICAqIGZvdW5kIG9uIGEgcHJldmlvdXMgaG9yaXpvbnRhbCBzY2FuLiBJZiBzbywgd2UgY29uc2lkZXIgaXQgY29uZmlybWVkIGFuZCBjb25jbHVkZSB3ZSBoYXZlCgkgICAgICogZm91bmQgdGhlIGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGF0ZUNvdW50IHJlYWRpbmcgc3RhdGUgbW9kdWxlIGNvdW50cyBmcm9tIGhvcml6b250YWwgc2NhbgoJICAgICAqIEBwYXJhbSBpIHJvdyB3aGVyZSBhbGlnbm1lbnQgcGF0dGVybiBtYXkgYmUgZm91bmQKCSAgICAgKiBAcGFyYW0gaiBlbmQgb2YgcG9zc2libGUgYWxpZ25tZW50IHBhdHRlcm4gaW4gcm93CgkgICAgICogQHJldHVybiB7QGxpbmsgQWxpZ25tZW50UGF0dGVybn0gaWYgd2UgaGF2ZSBmb3VuZCB0aGUgc2FtZSBwYXR0ZXJuIHR3aWNlLCBvciBudWxsIGlmIG5vdAoJICAgICAqLwoJICAgIEFsaWdubWVudFBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmhhbmRsZVBvc3NpYmxlQ2VudGVyID0gZnVuY3Rpb24gKHN0YXRlQ291bnQsIGkgLyppbnQqLywgaiAvKmludCovKSB7CgkgICAgICAgIHZhciBlXzEsIF9hOwoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdOwoJICAgICAgICB2YXIgY2VudGVySiA9IEFsaWdubWVudFBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBqKTsKCSAgICAgICAgdmFyIGNlbnRlckkgPSB0aGlzLmNyb3NzQ2hlY2tWZXJ0aWNhbChpLCAvKihpbnQpICovIGNlbnRlckosIDIgKiBzdGF0ZUNvdW50WzFdLCBzdGF0ZUNvdW50VG90YWwpOwoJICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckkpKSB7CgkgICAgICAgICAgICB2YXIgZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IChzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0pIC8gMy4wOwoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBfYiA9IF9fdmFsdWVzJDEodGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfYyA9IF9iLm5leHQoKTsgIV9jLmRvbmU7IF9jID0gX2IubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgICAgIHZhciBjZW50ZXIgPSBfYy52YWx1ZTsKCSAgICAgICAgICAgICAgICAgICAgLy8gTG9vayBmb3IgYWJvdXQgdGhlIHNhbWUgY2VudGVyIGFuZCBtb2R1bGUgc2l6ZToKCSAgICAgICAgICAgICAgICAgICAgaWYgKGNlbnRlci5hYm91dEVxdWFscyhlc3RpbWF0ZWRNb2R1bGVTaXplLCBjZW50ZXJJLCBjZW50ZXJKKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNlbnRlci5jb21iaW5lRXN0aW1hdGUoY2VudGVySSwgY2VudGVySiwgZXN0aW1hdGVkTW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKF9jICYmICFfYy5kb25lICYmIChfYSA9IF9iLnJldHVybikpIF9hLmNhbGwoX2IpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBIYWRuJ3QgZm91bmQgdGhpcyBiZWZvcmU7IHNhdmUgaXQKCSAgICAgICAgICAgIHZhciBwb2ludCA9IG5ldyBBbGlnbm1lbnRQYXR0ZXJuXzEuZGVmYXVsdChjZW50ZXJKLCBjZW50ZXJJLCBlc3RpbWF0ZWRNb2R1bGVTaXplKTsKCSAgICAgICAgICAgIHRoaXMucG9zc2libGVDZW50ZXJzLnB1c2gocG9pbnQpOwoJICAgICAgICAgICAgaWYgKHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayAhPT0gbnVsbCAmJiB0aGlzLnJlc3VsdFBvaW50Q2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgICAgIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjay5mb3VuZFBvc3NpYmxlUmVzdWx0UG9pbnQocG9pbnQpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBudWxsOwoJICAgIH07CgkgICAgcmV0dXJuIEFsaWdubWVudFBhdHRlcm5GaW5kZXI7Cgl9KCkpOwoJQWxpZ25tZW50UGF0dGVybkZpbmRlciQxLmRlZmF1bHQgPSBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyOwoKCXZhciBGaW5kZXJQYXR0ZXJuRmluZGVyJDEgPSB7fTsKCgl2YXIgRmluZGVyUGF0dGVybiQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRmluZGVyUGF0dGVybiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLnFyY29kZS5kZXRlY3RvciB7Ki8KCXZhciBSZXN1bHRQb2ludF8xJDIgPSBSZXN1bHRQb2ludCQxOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgYSBmaW5kZXIgcGF0dGVybiwgd2hpY2ggYXJlIHRoZSB0aHJlZSBzcXVhcmUgcGF0dGVybnMgZm91bmQgaW4KCSAqIHRoZSBjb3JuZXJzIG9mIFFSIENvZGVzLiBJdCBhbHNvIGVuY2Fwc3VsYXRlcyBhIGNvdW50IG9mIHNpbWlsYXIgZmluZGVyIHBhdHRlcm5zLAoJICogYXMgYSBjb252ZW5pZW5jZSB0byB0aGUgZmluZGVyJ3MgYm9va2tlZXBpbmcuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBGaW5kZXJQYXR0ZXJuID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyhGaW5kZXJQYXR0ZXJuLCBfc3VwZXIpOwoJICAgIC8vIEZpbmRlclBhdHRlcm4ocG9zWDogbnVtYmVyLypmbG9hdCovLCBwb3NZOiBudW1iZXIvKmZsb2F0Ki8sIGVzdGltYXRlZE1vZHVsZVNpemU6IG51bWJlci8qZmxvYXQqLykgewoJICAgIC8vICAgdGhpcyhwb3NYLCBwb3NZLCBlc3RpbWF0ZWRNb2R1bGVTaXplLCAxKQoJICAgIC8vIH0KCSAgICBmdW5jdGlvbiBGaW5kZXJQYXR0ZXJuKHBvc1ggLypmbG9hdCovLCBwb3NZIC8qZmxvYXQqLywgZXN0aW1hdGVkTW9kdWxlU2l6ZSAvKmZsb2F0Ki8sIGNvdW50IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcG9zWCwgcG9zWSkgfHwgdGhpczsKCSAgICAgICAgX3RoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IGVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIF90aGlzLmNvdW50ID0gY291bnQ7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGNvdW50KSB7CgkgICAgICAgICAgICBfdGhpcy5jb3VudCA9IDE7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBGaW5kZXJQYXR0ZXJuLnByb3RvdHlwZS5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lc3RpbWF0ZWRNb2R1bGVTaXplOwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybi5wcm90b3R5cGUuZ2V0Q291bnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvdW50OwoJICAgIH07CgkgICAgLyoKCSAgICB2b2lkIGluY3JlbWVudENvdW50KCkgewoJICAgICAgdGhpcy5jb3VudCsrCgkgICAgfQoJICAgICAqLwoJICAgIC8qKgoJICAgICAqIDxwPkRldGVybWluZXMgaWYgdGhpcyBmaW5kZXIgcGF0dGVybiAiYWJvdXQgZXF1YWxzIiBhIGZpbmRlciBwYXR0ZXJuIGF0IHRoZSBzdGF0ZWQKCSAgICAgKiBwb3NpdGlvbiBhbmQgc2l6ZSAtLSBtZWFuaW5nLCBpdCBpcyBhdCBuZWFybHkgdGhlIHNhbWUgY2VudGVyIHdpdGggbmVhcmx5IHRoZSBzYW1lIHNpemUuPC9wPgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm4ucHJvdG90eXBlLmFib3V0RXF1YWxzID0gZnVuY3Rpb24gKG1vZHVsZVNpemUgLypmbG9hdCovLCBpIC8qZmxvYXQqLywgaiAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE1hdGguYWJzKGkgLSB0aGlzLmdldFkoKSkgPD0gbW9kdWxlU2l6ZSAmJiBNYXRoLmFicyhqIC0gdGhpcy5nZXRYKCkpIDw9IG1vZHVsZVNpemUpIHsKCSAgICAgICAgICAgIHZhciBtb2R1bGVTaXplRGlmZiA9IE1hdGguYWJzKG1vZHVsZVNpemUgLSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVNpemVEaWZmIDw9IDEuMCB8fCBtb2R1bGVTaXplRGlmZiA8PSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29tYmluZXMgdGhpcyBvYmplY3QncyBjdXJyZW50IGVzdGltYXRlIG9mIGEgZmluZGVyIHBhdHRlcm4gcG9zaXRpb24gYW5kIG1vZHVsZSBzaXplCgkgICAgICogd2l0aCBhIG5ldyBlc3RpbWF0ZS4gSXQgcmV0dXJucyBhIG5ldyB7QGNvZGUgRmluZGVyUGF0dGVybn0gY29udGFpbmluZyBhIHdlaWdodGVkIGF2ZXJhZ2UKCSAgICAgKiBiYXNlZCBvbiBjb3VudC4KCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuLnByb3RvdHlwZS5jb21iaW5lRXN0aW1hdGUgPSBmdW5jdGlvbiAoaSAvKmZsb2F0Ki8sIGogLypmbG9hdCovLCBuZXdNb2R1bGVTaXplIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgY29tYmluZWRDb3VudCA9IHRoaXMuY291bnQgKyAxOwoJICAgICAgICB2YXIgY29tYmluZWRYID0gKHRoaXMuY291bnQgKiB0aGlzLmdldFgoKSArIGopIC8gY29tYmluZWRDb3VudDsKCSAgICAgICAgdmFyIGNvbWJpbmVkWSA9ICh0aGlzLmNvdW50ICogdGhpcy5nZXRZKCkgKyBpKSAvIGNvbWJpbmVkQ291bnQ7CgkgICAgICAgIHZhciBjb21iaW5lZE1vZHVsZVNpemUgPSAodGhpcy5jb3VudCAqIHRoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSArIG5ld01vZHVsZVNpemUpIC8gY29tYmluZWRDb3VudDsKCSAgICAgICAgcmV0dXJuIG5ldyBGaW5kZXJQYXR0ZXJuKGNvbWJpbmVkWCwgY29tYmluZWRZLCBjb21iaW5lZE1vZHVsZVNpemUsIGNvbWJpbmVkQ291bnQpOwoJICAgIH07CgkgICAgcmV0dXJuIEZpbmRlclBhdHRlcm47Cgl9KFJlc3VsdFBvaW50XzEkMi5kZWZhdWx0KSk7CglGaW5kZXJQYXR0ZXJuJDEuZGVmYXVsdCA9IEZpbmRlclBhdHRlcm47CgoJdmFyIEZpbmRlclBhdHRlcm5JbmZvJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEZpbmRlclBhdHRlcm5JbmZvJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGluZm9ybWF0aW9uIGFib3V0IGZpbmRlciBwYXR0ZXJucyBpbiBhbiBpbWFnZSwgaW5jbHVkaW5nIHRoZSBsb2NhdGlvbiBvZgoJICogdGhlIHRocmVlIGZpbmRlciBwYXR0ZXJucywgYW5kIHRoZWlyIGVzdGltYXRlZCBtb2R1bGUgc2l6ZS48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEZpbmRlclBhdHRlcm5JbmZvID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEZpbmRlclBhdHRlcm5JbmZvKHBhdHRlcm5DZW50ZXJzKSB7CgkgICAgICAgIHRoaXMuYm90dG9tTGVmdCA9IHBhdHRlcm5DZW50ZXJzWzBdOwoJICAgICAgICB0aGlzLnRvcExlZnQgPSBwYXR0ZXJuQ2VudGVyc1sxXTsKCSAgICAgICAgdGhpcy50b3BSaWdodCA9IHBhdHRlcm5DZW50ZXJzWzJdOwoJICAgIH0KCSAgICBGaW5kZXJQYXR0ZXJuSW5mby5wcm90b3R5cGUuZ2V0Qm90dG9tTGVmdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYm90dG9tTGVmdDsKCSAgICB9OwoJICAgIEZpbmRlclBhdHRlcm5JbmZvLnByb3RvdHlwZS5nZXRUb3BMZWZ0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50b3BMZWZ0OwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybkluZm8ucHJvdG90eXBlLmdldFRvcFJpZ2h0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50b3BSaWdodDsKCSAgICB9OwoJICAgIHJldHVybiBGaW5kZXJQYXR0ZXJuSW5mbzsKCX0oKSk7CglGaW5kZXJQYXR0ZXJuSW5mbyQxLmRlZmF1bHQgPSBGaW5kZXJQYXR0ZXJuSW5mbzsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEZpbmRlclBhdHRlcm5GaW5kZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGV0ZWN0b3IgeyovCgl2YXIgRGVjb2RlSGludFR5cGVfMSQyID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBSZXN1bHRQb2ludF8xJDEgPSBSZXN1bHRQb2ludCQxOwoJdmFyIEZpbmRlclBhdHRlcm5fMSA9IEZpbmRlclBhdHRlcm4kMTsKCXZhciBGaW5kZXJQYXR0ZXJuSW5mb18xID0gRmluZGVyUGF0dGVybkluZm8kMTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDIgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJLyppbXBvcnQgamF2YS5pby5TZXJpYWxpemFibGU7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsqLwoJLyppbXBvcnQgamF2YS51dGlsLkNvbXBhcmF0b3I7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgYXR0ZW1wdHMgdG8gZmluZCBmaW5kZXIgcGF0dGVybnMgaW4gYSBRUiBDb2RlLiBGaW5kZXIgcGF0dGVybnMgYXJlIHRoZSBzcXVhcmUKCSAqIG1hcmtlcnMgYXQgdGhyZWUgY29ybmVycyBvZiBhIFFSIENvZGUuPC9wPgoJICoKCSAqIDxwPlRoaXMgY2xhc3MgaXMgdGhyZWFkLXNhZmUgYnV0IG5vdCByZWVudHJhbnQuIEVhY2ggdGhyZWFkIG11c3QgYWxsb2NhdGUgaXRzIG93biBvYmplY3QuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEZpbmRlclBhdHRlcm5GaW5kZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogPHA+Q3JlYXRlcyBhIGZpbmRlciB0aGF0IHdpbGwgc2VhcmNoIHRoZSBpbWFnZSBmb3IgdGhyZWUgZmluZGVyIHBhdHRlcm5zLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBpbWFnZSBpbWFnZSB0byBzZWFyY2gKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IoaW1hZ2U6IEJpdE1hdHJpeCkgewoJICAgIC8vICAgdGhpcyhpbWFnZSwgbnVsbCkKCSAgICAvLyB9CgkgICAgZnVuY3Rpb24gRmluZGVyUGF0dGVybkZpbmRlcihpbWFnZSwgcmVzdWx0UG9pbnRDYWxsYmFjaykgewoJICAgICAgICB0aGlzLmltYWdlID0gaW1hZ2U7CgkgICAgICAgIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayA9IHJlc3VsdFBvaW50Q2FsbGJhY2s7CgkgICAgICAgIHRoaXMucG9zc2libGVDZW50ZXJzID0gW107CgkgICAgICAgIHRoaXMuY3Jvc3NDaGVja1N0YXRlQ291bnQgPSBuZXcgSW50MzJBcnJheSg1KTsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gcmVzdWx0UG9pbnRDYWxsYmFjazsKCSAgICB9CgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuZ2V0SW1hZ2UgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmltYWdlOwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuZ2V0UG9zc2libGVDZW50ZXJzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5wb3NzaWJsZUNlbnRlcnM7CgkgICAgfTsKCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24gKGhpbnRzKSB7CgkgICAgICAgIHZhciB0cnlIYXJkZXIgPSAoaGludHMgIT09IG51bGwgJiYgaGludHMgIT09IHVuZGVmaW5lZCkgJiYgdW5kZWZpbmVkICE9PSBoaW50cy5nZXQoRGVjb2RlSGludFR5cGVfMSQyLmRlZmF1bHQuVFJZX0hBUkRFUik7CgkgICAgICAgIHZhciBwdXJlQmFyY29kZSA9IChoaW50cyAhPT0gbnVsbCAmJiBoaW50cyAhPT0gdW5kZWZpbmVkKSAmJiB1bmRlZmluZWQgIT09IGhpbnRzLmdldChEZWNvZGVIaW50VHlwZV8xJDIuZGVmYXVsdC5QVVJFX0JBUkNPREUpOwoJICAgICAgICB2YXIgaW1hZ2UgPSB0aGlzLmltYWdlOwoJICAgICAgICB2YXIgbWF4SSA9IGltYWdlLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgbWF4SiA9IGltYWdlLmdldFdpZHRoKCk7CgkgICAgICAgIC8vIFdlIGFyZSBsb29raW5nIGZvciBibGFjay93aGl0ZS9ibGFjay93aGl0ZS9ibGFjayBtb2R1bGVzIGluCgkgICAgICAgIC8vIDE6MTozOjE6MSByYXRpbzsgdGhpcyB0cmFja3MgdGhlIG51bWJlciBvZiBzdWNoIG1vZHVsZXMgc2VlbiBzbyBmYXIKCSAgICAgICAgLy8gTGV0J3MgYXNzdW1lIHRoYXQgdGhlIG1heGltdW0gdmVyc2lvbiBRUiBDb2RlIHdlIHN1cHBvcnQgdGFrZXMgdXAgMS80IHRoZSBoZWlnaHQgb2YgdGhlCgkgICAgICAgIC8vIGltYWdlLCBhbmQgdGhlbiBhY2NvdW50IGZvciB0aGUgY2VudGVyIGJlaW5nIDMgbW9kdWxlcyBpbiBzaXplLiBUaGlzIGdpdmVzIHRoZSBzbWFsbGVzdAoJICAgICAgICAvLyBudW1iZXIgb2YgcGl4ZWxzIHRoZSBjZW50ZXIgY291bGQgYmUsIHNvIHNraXAgdGhpcyBvZnRlbi4gV2hlbiB0cnlpbmcgaGFyZGVyLCBsb29rIGZvciBhbGwKCSAgICAgICAgLy8gUVIgdmVyc2lvbnMgcmVnYXJkbGVzcyBvZiBob3cgZGVuc2UgdGhleSBhcmUuCgkgICAgICAgIHZhciBpU2tpcCA9IE1hdGguZmxvb3IoKDMgKiBtYXhJKSAvICg0ICogRmluZGVyUGF0dGVybkZpbmRlci5NQVhfTU9EVUxFUykpOwoJICAgICAgICBpZiAoaVNraXAgPCBGaW5kZXJQYXR0ZXJuRmluZGVyLk1JTl9TS0lQIHx8IHRyeUhhcmRlcikgewoJICAgICAgICAgICAgaVNraXAgPSBGaW5kZXJQYXR0ZXJuRmluZGVyLk1JTl9TS0lQOwoJICAgICAgICB9CgkgICAgICAgIHZhciBkb25lID0gZmFsc2U7CgkgICAgICAgIHZhciBzdGF0ZUNvdW50ID0gbmV3IEludDMyQXJyYXkoNSk7CgkgICAgICAgIGZvciAodmFyIGkgPSBpU2tpcCAtIDE7IGkgPCBtYXhJICYmICFkb25lOyBpICs9IGlTa2lwKSB7CgkgICAgICAgICAgICAvLyBHZXQgYSByb3cgb2YgYmxhY2svd2hpdGUgdmFsdWVzCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMV0gPSAwOwoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IDA7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzNdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0gPSAwOwoJICAgICAgICAgICAgdmFyIGN1cnJlbnRTdGF0ZSA9IDA7CgkgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG1heEo7IGorKykgewoJICAgICAgICAgICAgICAgIGlmIChpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gQmxhY2sgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKChjdXJyZW50U3RhdGUgJiAxKSA9PT0gMSkgeyAvLyBDb3VudGluZyB3aGl0ZSBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdGF0ZSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsgLy8gV2hpdGUgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKChjdXJyZW50U3RhdGUgJiAxKSA9PT0gMCkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50U3RhdGUgPT09IDQpIHsgLy8gQSB3aW5uZXI/CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkpIHsgLy8gWWVzCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb25maXJtZWQgPSB0aGlzLmhhbmRsZVBvc3NpYmxlQ2VudGVyKHN0YXRlQ291bnQsIGksIGosIHB1cmVCYXJjb2RlKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCA9PT0gdHJ1ZSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3RhcnQgZXhhbWluaW5nIGV2ZXJ5IG90aGVyIGxpbmUuIENoZWNraW5nIGVhY2ggbGluZSB0dXJuZWQgb3V0IHRvIGJlIHRvbwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXhwZW5zaXZlIGFuZCBkaWRuJ3QgaW1wcm92ZSBwZXJmb3JtYW5jZS4KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlTa2lwID0gMjsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc1NraXBwZWQgPT09IHRydWUpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb25lID0gdGhpcy5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzKCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm93U2tpcCA9IHRoaXMuZmluZFJvd1NraXAoKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocm93U2tpcCA+IHN0YXRlQ291bnRbMl0pIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2tpcCByb3dzIGJldHdlZW4gcm93IG9mIGxvd2VyIGNvbmZpcm1lZCBjZW50ZXIKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYW5kIHRvcCBvZiBwcmVzdW1lZCB0aGlyZCBjb25maXJtZWQgY2VudGVyCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJ1dCBiYWNrIHVwIGEgYml0IHRvIGdldCBhIGZ1bGwgY2hhbmNlIG9mIGRldGVjdGluZwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpdCwgZW50aXJlIHdpZHRoIG9mIGNlbnRlciBvZiBmaW5kZXIgcGF0dGVybgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTa2lwIGJ5IHJvd1NraXAsIGJ1dCBiYWNrIG9mZiBieSBzdGF0ZUNvdW50WzJdIChzaXplIG9mIGxhc3QgY2VudGVyCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9mIHBhdHRlcm4gd2Ugc2F3KSB0byBiZSBjb25zZXJ2YXRpdmUsIGFuZCBhbHNvIGJhY2sgb2ZmIGJ5IGlTa2lwIHdoaWNoCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlzIGFib3V0IHRvIGJlIHJlLWFkZGVkCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgKz0gcm93U2tpcCAtIHN0YXRlQ291bnRbMl0gLSBpU2tpcDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaiA9IG1heEogLSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMF0gPSBzdGF0ZUNvdW50WzJdOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsxXSA9IHN0YXRlQ291bnRbM107CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzJdID0gc3RhdGVDb3VudFs0XTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFs0XSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAzOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2xlYXIgc3RhdGUgdG8gc3RhcnQgbG9va2luZyBhZ2FpbgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsxXSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzNdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFs0XSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgeyAvLyBObywgc2hpZnQgY291bnRzIGJhY2sgYnkgdHdvCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMF0gPSBzdGF0ZUNvdW50WzJdOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzFdID0gc3RhdGVDb3VudFszXTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IHN0YXRlQ291bnRbNF07CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzRdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFN0YXRlID0gMzsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WysrY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgeyAvLyBDb3VudGluZyB3aGl0ZSBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgaWYgKEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgY29uZmlybWVkID0gdGhpcy5oYW5kbGVQb3NzaWJsZUNlbnRlcihzdGF0ZUNvdW50LCBpLCBtYXhKLCBwdXJlQmFyY29kZSk7CgkgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCA9PT0gdHJ1ZSkgewoJICAgICAgICAgICAgICAgICAgICBpU2tpcCA9IHN0YXRlQ291bnRbMF07CgkgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc1NraXBwZWQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvdW5kIGEgdGhpcmQgb25lCgkgICAgICAgICAgICAgICAgICAgICAgICBkb25lID0gdGhpcy5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzKCk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHBhdHRlcm5JbmZvID0gdGhpcy5zZWxlY3RCZXN0UGF0dGVybnMoKTsKCSAgICAgICAgUmVzdWx0UG9pbnRfMSQxLmRlZmF1bHQub3JkZXJCZXN0UGF0dGVybnMocGF0dGVybkluZm8pOwoJICAgICAgICByZXR1cm4gbmV3IEZpbmRlclBhdHRlcm5JbmZvXzEuZGVmYXVsdChwYXR0ZXJuSW5mbyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBHaXZlbiBhIGNvdW50IG9mIGJsYWNrL3doaXRlL2JsYWNrL3doaXRlL2JsYWNrIHBpeGVscyBqdXN0IHNlZW4gYW5kIGFuIGVuZCBwb3NpdGlvbiwKCSAgICAgKiBmaWd1cmVzIHRoZSBsb2NhdGlvbiBvZiB0aGUgY2VudGVyIG9mIHRoaXMgcnVuLgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZCA9IGZ1bmN0aW9uIChzdGF0ZUNvdW50LCBlbmQgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gKGVuZCAtIHN0YXRlQ291bnRbNF0gLSBzdGF0ZUNvdW50WzNdKSAtIHN0YXRlQ291bnRbMl0gLyAyLjA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gc3RhdGVDb3VudCBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCByZWFkCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGUgcHJvcG9ydGlvbnMgb2YgdGhlIGNvdW50cyBpcyBjbG9zZSBlbm91Z2ggdG8gdGhlIDEvMS8zLzEvMSByYXRpb3MKCSAgICAgKiAgICAgICAgIHVzZWQgYnkgZmluZGVyIHBhdHRlcm5zIHRvIGJlIGNvbnNpZGVyZWQgYSBtYXRjaAoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3MgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCkgewoJICAgICAgICB2YXIgdG90YWxNb2R1bGVTaXplID0gMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA1OyBpKyspIHsKCSAgICAgICAgICAgIHZhciBjb3VudCA9IHN0YXRlQ291bnRbaV07CgkgICAgICAgICAgICBpZiAoY291bnQgPT09IDApIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gY291bnQ7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRvdGFsTW9kdWxlU2l6ZSA8IDcpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRvdGFsTW9kdWxlU2l6ZSAvIDcuMDsKCSAgICAgICAgdmFyIG1heFZhcmlhbmNlID0gbW9kdWxlU2l6ZSAvIDIuMDsKCSAgICAgICAgLy8gQWxsb3cgbGVzcyB0aGFuIDUwJSB2YXJpYW5jZSBmcm9tIDEtMS0zLTEtMSBwcm9wb3J0aW9ucwoJICAgICAgICByZXR1cm4gTWF0aC5hYnMobW9kdWxlU2l6ZSAtIHN0YXRlQ291bnRbMF0pIDwgbWF4VmFyaWFuY2UgJiYKCSAgICAgICAgICAgIE1hdGguYWJzKG1vZHVsZVNpemUgLSBzdGF0ZUNvdW50WzFdKSA8IG1heFZhcmlhbmNlICYmCgkgICAgICAgICAgICBNYXRoLmFicygzLjAgKiBtb2R1bGVTaXplIC0gc3RhdGVDb3VudFsyXSkgPCAzICogbWF4VmFyaWFuY2UgJiYKCSAgICAgICAgICAgIE1hdGguYWJzKG1vZHVsZVNpemUgLSBzdGF0ZUNvdW50WzNdKSA8IG1heFZhcmlhbmNlICYmCgkgICAgICAgICAgICBNYXRoLmFicyhtb2R1bGVTaXplIC0gc3RhdGVDb3VudFs0XSkgPCBtYXhWYXJpYW5jZTsKCSAgICB9OwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgY3Jvc3NDaGVja1N0YXRlQ291bnQgPSB0aGlzLmNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgICAgICBjcm9zc0NoZWNrU3RhdGVDb3VudFswXSA9IDA7CgkgICAgICAgIGNyb3NzQ2hlY2tTdGF0ZUNvdW50WzFdID0gMDsKCSAgICAgICAgY3Jvc3NDaGVja1N0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICBjcm9zc0NoZWNrU3RhdGVDb3VudFszXSA9IDA7CgkgICAgICAgIGNyb3NzQ2hlY2tTdGF0ZUNvdW50WzRdID0gMDsKCSAgICAgICAgcmV0dXJuIGNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQWZ0ZXIgYSB2ZXJ0aWNhbCBhbmQgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG90ZW50aWFsIGZpbmRlciBwYXR0ZXJuLCB0aGlzIG1ldGhvZAoJICAgICAqICJjcm9zcy1jcm9zcy1jcm9zcy1jaGVja3MiIGJ5IHNjYW5uaW5nIGRvd24gZGlhZ29uYWxseSB0aHJvdWdoIHRoZSBjZW50ZXIgb2YgdGhlIHBvc3NpYmxlCgkgICAgICogZmluZGVyIHBhdHRlcm4gdG8gc2VlIGlmIHRoZSBzYW1lIHByb3BvcnRpb24gaXMgZGV0ZWN0ZWQuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gc3RhcnRJIHJvdyB3aGVyZSBhIGZpbmRlciBwYXR0ZXJuIHdhcyBkZXRlY3RlZAoJICAgICAqIEBwYXJhbSBjZW50ZXJKIGNlbnRlciBvZiB0aGUgc2VjdGlvbiB0aGF0IGFwcGVhcnMgdG8gY3Jvc3MgYSBmaW5kZXIgcGF0dGVybgoJICAgICAqIEBwYXJhbSBtYXhDb3VudCBtYXhpbXVtIHJlYXNvbmFibGUgbnVtYmVyIG9mIG1vZHVsZXMgdGhhdCBzaG91bGQgYmUKCSAgICAgKiAgb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcGFyYW0gb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwgVGhlIG9yaWdpbmFsIHN0YXRlIGNvdW50IHRvdGFsLgoJICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBwcm9wb3J0aW9ucyBhcmUgd2l0aGluZyBleHBlY3RlZCBsaW1pdHMKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5jcm9zc0NoZWNrRGlhZ29uYWwgPSBmdW5jdGlvbiAoc3RhcnRJIC8qaW50Ki8sIGNlbnRlckogLyppbnQqLywgbWF4Q291bnQgLyppbnQqLywgb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwgLyppbnQqLykgewoJICAgICAgICB2YXIgc3RhdGVDb3VudCA9IHRoaXMuZ2V0Q3Jvc3NDaGVja1N0YXRlQ291bnQoKTsKCSAgICAgICAgLy8gU3RhcnQgY291bnRpbmcgdXAsIGxlZnQgZnJvbSBjZW50ZXIgZmluZGluZyBibGFjayBjZW50ZXIgbWFzcwoJICAgICAgICB2YXIgaSA9IDA7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIHdoaWxlIChzdGFydEkgPj0gaSAmJiBjZW50ZXJKID49IGkgJiYgaW1hZ2UuZ2V0KGNlbnRlckogLSBpLCBzdGFydEkgLSBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGFydEkgPCBpIHx8IGNlbnRlckogPCBpKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29udGludWUgdXAsIGxlZnQgZmluZGluZyB3aGl0ZSBzcGFjZQoJICAgICAgICB3aGlsZSAoc3RhcnRJID49IGkgJiYgY2VudGVySiA+PSBpICYmICFpbWFnZS5nZXQoY2VudGVySiAtIGksIHN0YXJ0SSAtIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzFdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzFdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgLy8gSWYgYWxyZWFkeSB0b28gbWFueSBtb2R1bGVzIGluIHRoaXMgc3RhdGUgb3IgcmFuIG9mZiB0aGUgZWRnZToKCSAgICAgICAgaWYgKHN0YXJ0SSA8IGkgfHwgY2VudGVySiA8IGkgfHwgc3RhdGVDb3VudFsxXSA+IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29udGludWUgdXAsIGxlZnQgZmluZGluZyBibGFjayBib3JkZXIKCSAgICAgICAgd2hpbGUgKHN0YXJ0SSA+PSBpICYmIGNlbnRlckogPj0gaSAmJiBpbWFnZS5nZXQoY2VudGVySiAtIGksIHN0YXJ0SSAtIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbMF0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBtYXhJID0gaW1hZ2UuZ2V0SGVpZ2h0KCk7CgkgICAgICAgIHZhciBtYXhKID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgLy8gTm93IGFsc28gY291bnQgZG93biwgcmlnaHQgZnJvbSBjZW50ZXIKCSAgICAgICAgaSA9IDE7CgkgICAgICAgIHdoaWxlIChzdGFydEkgKyBpIDwgbWF4SSAmJiBjZW50ZXJKICsgaSA8IG1heEogJiYgaW1hZ2UuZ2V0KGNlbnRlckogKyBpLCBzdGFydEkgKyBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIC8vIFJhbiBvZmYgdGhlIGVkZ2U/CgkgICAgICAgIGlmIChzdGFydEkgKyBpID49IG1heEkgfHwgY2VudGVySiArIGkgPj0gbWF4SikgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChzdGFydEkgKyBpIDwgbWF4SSAmJiBjZW50ZXJKICsgaSA8IG1heEogJiYgIWltYWdlLmdldChjZW50ZXJKICsgaSwgc3RhcnRJICsgaSkgJiYKCSAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPCBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFszXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGFydEkgKyBpID49IG1heEkgfHwgY2VudGVySiArIGkgPj0gbWF4SiB8fCBzdGF0ZUNvdW50WzNdID49IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKHN0YXJ0SSArIGkgPCBtYXhJICYmIGNlbnRlckogKyBpIDwgbWF4SiAmJiBpbWFnZS5nZXQoY2VudGVySiArIGksIHN0YXJ0SSArIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0rKzsKCSAgICAgICAgICAgIGkrKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFs0XSA+PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHdlIGZvdW5kIGEgZmluZGVyLXBhdHRlcm4tbGlrZSBzZWN0aW9uLCBidXQgaXRzIHNpemUgaXMgbW9yZSB0aGFuIDEwMCUgZGlmZmVyZW50IHRoYW4KCSAgICAgICAgLy8gdGhlIG9yaWdpbmFsLCBhc3N1bWUgaXQncyBhIGZhbHNlIHBvc2l0aXZlCgkgICAgICAgIHZhciBzdGF0ZUNvdW50VG90YWwgPSBzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0gKyBzdGF0ZUNvdW50WzNdICsgc3RhdGVDb3VudFs0XTsKCSAgICAgICAgcmV0dXJuIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA8IDIgKiBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCAmJgoJICAgICAgICAgICAgRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkFmdGVyIGEgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG90ZW50aWFsIGZpbmRlciBwYXR0ZXJuLCB0aGlzIG1ldGhvZAoJICAgICAqICJjcm9zcy1jaGVja3MiIGJ5IHNjYW5uaW5nIGRvd24gdmVydGljYWxseSB0aHJvdWdoIHRoZSBjZW50ZXIgb2YgdGhlIHBvc3NpYmxlCgkgICAgICogZmluZGVyIHBhdHRlcm4gdG8gc2VlIGlmIHRoZSBzYW1lIHByb3BvcnRpb24gaXMgZGV0ZWN0ZWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIHN0YXJ0SSByb3cgd2hlcmUgYSBmaW5kZXIgcGF0dGVybiB3YXMgZGV0ZWN0ZWQKCSAgICAgKiBAcGFyYW0gY2VudGVySiBjZW50ZXIgb2YgdGhlIHNlY3Rpb24gdGhhdCBhcHBlYXJzIHRvIGNyb3NzIGEgZmluZGVyIHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gbWF4Q291bnQgbWF4aW11bSByZWFzb25hYmxlIG51bWJlciBvZiBtb2R1bGVzIHRoYXQgc2hvdWxkIGJlCgkgICAgICogb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcmV0dXJuIHZlcnRpY2FsIGNlbnRlciBvZiBmaW5kZXIgcGF0dGVybiwgb3Ige0BsaW5rIEZsb2F0I05hTn0gaWYgbm90IGZvdW5kCgkgICAgICovCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuY3Jvc3NDaGVja1ZlcnRpY2FsID0gZnVuY3Rpb24gKHN0YXJ0SSAvKmludCovLCBjZW50ZXJKIC8qaW50Ki8sIG1heENvdW50IC8qaW50Ki8sIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGltYWdlID0gdGhpcy5pbWFnZTsKCSAgICAgICAgdmFyIG1heEkgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50KCk7CgkgICAgICAgIC8vIFN0YXJ0IGNvdW50aW5nIHVwIGZyb20gY2VudGVyCgkgICAgICAgIHZhciBpID0gc3RhcnRJOwoJICAgICAgICB3aGlsZSAoaSA+PSAwICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpIDwgMCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaSA+PSAwICYmICFpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIGFscmVhZHkgdG9vIG1hbnkgbW9kdWxlcyBpbiB0aGlzIHN0YXRlIG9yIHJhbiBvZmYgdGhlIGVkZ2U6CgkgICAgICAgIGlmIChpIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFswXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFswXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGF0ZUNvdW50WzBdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgLy8gTm93IGFsc28gY291bnQgZG93biBmcm9tIGNlbnRlcgoJICAgICAgICBpID0gc3RhcnRJICsgMTsKCSAgICAgICAgd2hpbGUgKGkgPCBtYXhJICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJKSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChpIDwgbWF4SSAmJiAhaW1hZ2UuZ2V0KGNlbnRlckosIGkpICYmIHN0YXRlQ291bnRbM10gPCBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFszXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJIHx8IHN0YXRlQ291bnRbM10gPj0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPCBtYXhJICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSAmJiBzdGF0ZUNvdW50WzRdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0rKzsKCSAgICAgICAgICAgIGkrKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFs0XSA+PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICAvLyBJZiB3ZSBmb3VuZCBhIGZpbmRlci1wYXR0ZXJuLWxpa2Ugc2VjdGlvbiwgYnV0IGl0cyBzaXplIGlzIG1vcmUgdGhhbiA0MCUgZGlmZmVyZW50IHRoYW4KCSAgICAgICAgLy8gdGhlIG9yaWdpbmFsLCBhc3N1bWUgaXQncyBhIGZhbHNlIHBvc2l0aXZlCgkgICAgICAgIHZhciBzdGF0ZUNvdW50VG90YWwgPSBzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0gKyBzdGF0ZUNvdW50WzNdICsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF07CgkgICAgICAgIGlmICg1ICogTWF0aC5hYnMoc3RhdGVDb3VudFRvdGFsIC0gb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwpID49IDIgKiBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSA/IEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBpKSA6IE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkxpa2Uge0BsaW5rICNjcm9zc0NoZWNrVmVydGljYWwoaW50LCBpbnQsIGludCwgaW50KX0sIGFuZCBpbiBmYWN0IGlzIGJhc2ljYWxseSBpZGVudGljYWwsCgkgICAgICogZXhjZXB0IGl0IHJlYWRzIGhvcml6b250YWxseSBpbnN0ZWFkIG9mIHZlcnRpY2FsbHkuIFRoaXMgaXMgdXNlZCB0byBjcm9zcy1jcm9zcwoJICAgICAqIGNoZWNrIGEgdmVydGljYWwgY3Jvc3MgY2hlY2sgYW5kIGxvY2F0ZSB0aGUgcmVhbCBjZW50ZXIgb2YgdGhlIGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5jcm9zc0NoZWNrSG9yaXpvbnRhbCA9IGZ1bmN0aW9uIChzdGFydEogLyppbnQqLywgY2VudGVySSAvKmludCovLCBtYXhDb3VudCAvKmludCovLCBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCAvKmludCovKSB7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIHZhciBtYXhKID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50KCk7CgkgICAgICAgIHZhciBqID0gc3RhcnRKOwoJICAgICAgICB3aGlsZSAoaiA+PSAwICYmIGltYWdlLmdldChqLCBjZW50ZXJJKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChqIDwgMCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaiA+PSAwICYmICFpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChqIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGogPj0gMCAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFswXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFswXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGF0ZUNvdW50WzBdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgaiA9IHN0YXJ0SiArIDE7CgkgICAgICAgIHdoaWxlIChqIDwgbWF4SiAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMl0rKzsKCSAgICAgICAgICAgIGorKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaiA9PT0gbWF4SikgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaiA8IG1heEogJiYgIWltYWdlLmdldChqLCBjZW50ZXJJKSAmJiBzdGF0ZUNvdW50WzNdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbM10rKzsKCSAgICAgICAgICAgIGorKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaiA9PT0gbWF4SiB8fCBzdGF0ZUNvdW50WzNdID49IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChqIDwgbWF4SiAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFs0XSA8IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdKys7CgkgICAgICAgICAgICBqKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbNF0gPj0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgLy8gSWYgd2UgZm91bmQgYSBmaW5kZXItcGF0dGVybi1saWtlIHNlY3Rpb24sIGJ1dCBpdHMgc2l6ZSBpcyBzaWduaWZpY2FudGx5IGRpZmZlcmVudCB0aGFuCgkgICAgICAgIC8vIHRoZSBvcmlnaW5hbCwgYXNzdW1lIGl0J3MgYSBmYWxzZSBwb3NpdGl2ZQoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdICsgc3RhdGVDb3VudFszXSArCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdOwoJICAgICAgICBpZiAoNSAqIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA+PSBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSA/IEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBqKSA6IE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlRoaXMgaXMgY2FsbGVkIHdoZW4gYSBob3Jpem9udGFsIHNjYW4gZmluZHMgYSBwb3NzaWJsZSBhbGlnbm1lbnQgcGF0dGVybi4gSXQgd2lsbAoJICAgICAqIGNyb3NzIGNoZWNrIHdpdGggYSB2ZXJ0aWNhbCBzY2FuLCBhbmQgaWYgc3VjY2Vzc2Z1bCwgd2lsbCwgYWgsIGNyb3NzLWNyb3NzLWNoZWNrCgkgICAgICogd2l0aCBhbm90aGVyIGhvcml6b250YWwgc2Nhbi4gVGhpcyBpcyBuZWVkZWQgcHJpbWFyaWx5IHRvIGxvY2F0ZSB0aGUgcmVhbCBob3Jpem9udGFsCgkgICAgICogY2VudGVyIG9mIHRoZSBwYXR0ZXJuIGluIGNhc2VzIG9mIGV4dHJlbWUgc2tldy4KCSAgICAgKiBBbmQgdGhlbiB3ZSBjcm9zcy1jcm9zcy1jcm9zcyBjaGVjayB3aXRoIGFub3RoZXIgZGlhZ29uYWwgc2Nhbi48L3A+CgkgICAgICoKCSAgICAgKiA8cD5JZiB0aGF0IHN1Y2NlZWRzIHRoZSBmaW5kZXIgcGF0dGVybiBsb2NhdGlvbiBpcyBhZGRlZCB0byBhIGxpc3QgdGhhdCB0cmFja3MKCSAgICAgKiB0aGUgbnVtYmVyIG9mIHRpbWVzIGVhY2ggbG9jYXRpb24gaGFzIGJlZW4gbmVhcmx5LW1hdGNoZWQgYXMgYSBmaW5kZXIgcGF0dGVybi4KCSAgICAgKiBFYWNoIGFkZGl0aW9uYWwgZmluZCBpcyBtb3JlIGV2aWRlbmNlIHRoYXQgdGhlIGxvY2F0aW9uIGlzIGluIGZhY3QgYSBmaW5kZXIKCSAgICAgKiBwYXR0ZXJuIGNlbnRlcgoJICAgICAqCgkgICAgICogQHBhcmFtIHN0YXRlQ291bnQgcmVhZGluZyBzdGF0ZSBtb2R1bGUgY291bnRzIGZyb20gaG9yaXpvbnRhbCBzY2FuCgkgICAgICogQHBhcmFtIGkgcm93IHdoZXJlIGZpbmRlciBwYXR0ZXJuIG1heSBiZSBmb3VuZAoJICAgICAqIEBwYXJhbSBqIGVuZCBvZiBwb3NzaWJsZSBmaW5kZXIgcGF0dGVybiBpbiByb3cKCSAgICAgKiBAcGFyYW0gcHVyZUJhcmNvZGUgdHJ1ZSBpZiBpbiAicHVyZSBiYXJjb2RlIiBtb2RlCgkgICAgICogQHJldHVybiB0cnVlIGlmIGEgZmluZGVyIHBhdHRlcm4gY2FuZGlkYXRlIHdhcyBmb3VuZCB0aGlzIHRpbWUKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5oYW5kbGVQb3NzaWJsZUNlbnRlciA9IGZ1bmN0aW9uIChzdGF0ZUNvdW50LCBpIC8qaW50Ki8sIGogLyppbnQqLywgcHVyZUJhcmNvZGUpIHsKCSAgICAgICAgdmFyIHN0YXRlQ291bnRUb3RhbCA9IHN0YXRlQ291bnRbMF0gKyBzdGF0ZUNvdW50WzFdICsgc3RhdGVDb3VudFsyXSArIHN0YXRlQ291bnRbM10gKwoJICAgICAgICAgICAgc3RhdGVDb3VudFs0XTsKCSAgICAgICAgdmFyIGNlbnRlckogPSBGaW5kZXJQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQoc3RhdGVDb3VudCwgaik7CgkgICAgICAgIHZhciBjZW50ZXJJID0gdGhpcy5jcm9zc0NoZWNrVmVydGljYWwoaSwgLyooaW50KSAqLyBNYXRoLmZsb29yKGNlbnRlckopLCBzdGF0ZUNvdW50WzJdLCBzdGF0ZUNvdW50VG90YWwpOwoJICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckkpKSB7CgkgICAgICAgICAgICAvLyBSZS1jcm9zcyBjaGVjawoJICAgICAgICAgICAgY2VudGVySiA9IHRoaXMuY3Jvc3NDaGVja0hvcml6b250YWwoLyooaW50KSAqLyBNYXRoLmZsb29yKGNlbnRlckopLCAvKihpbnQpICovIE1hdGguZmxvb3IoY2VudGVySSksIHN0YXRlQ291bnRbMl0sIHN0YXRlQ291bnRUb3RhbCk7CgkgICAgICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckopICYmCgkgICAgICAgICAgICAgICAgKCFwdXJlQmFyY29kZSB8fCB0aGlzLmNyb3NzQ2hlY2tEaWFnb25hbCgvKihpbnQpICovIE1hdGguZmxvb3IoY2VudGVySSksIC8qKGludCkgKi8gTWF0aC5mbG9vcihjZW50ZXJKKSwgc3RhdGVDb3VudFsyXSwgc3RhdGVDb3VudFRvdGFsKSkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IHN0YXRlQ291bnRUb3RhbCAvIDcuMDsKCSAgICAgICAgICAgICAgICB2YXIgZm91bmQgPSBmYWxzZTsKCSAgICAgICAgICAgICAgICB2YXIgcG9zc2libGVDZW50ZXJzID0gdGhpcy5wb3NzaWJsZUNlbnRlcnM7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwLCBsZW5ndGhfMSA9IHBvc3NpYmxlQ2VudGVycy5sZW5ndGg7IGluZGV4IDwgbGVuZ3RoXzE7IGluZGV4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGNlbnRlciA9IHBvc3NpYmxlQ2VudGVyc1tpbmRleF07CgkgICAgICAgICAgICAgICAgICAgIC8vIExvb2sgZm9yIGFib3V0IHRoZSBzYW1lIGNlbnRlciBhbmQgbW9kdWxlIHNpemU6CgkgICAgICAgICAgICAgICAgICAgIGlmIChjZW50ZXIuYWJvdXRFcXVhbHMoZXN0aW1hdGVkTW9kdWxlU2l6ZSwgY2VudGVySSwgY2VudGVySikpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVyc1tpbmRleF0gPSBjZW50ZXIuY29tYmluZUVzdGltYXRlKGNlbnRlckksIGNlbnRlckosIGVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwoJICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgaWYgKCFmb3VuZCkgewoJICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnQgPSBuZXcgRmluZGVyUGF0dGVybl8xLmRlZmF1bHQoY2VudGVySiwgY2VudGVySSwgZXN0aW1hdGVkTW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVycy5wdXNoKHBvaW50KTsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayAhPT0gbnVsbCAmJiB0aGlzLnJlc3VsdFBvaW50Q2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrLmZvdW5kUG9zc2libGVSZXN1bHRQb2ludChwb2ludCk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2Ygcm93cyB3ZSBjb3VsZCBzYWZlbHkgc2tpcCBkdXJpbmcgc2Nhbm5pbmcsIGJhc2VkIG9uIHRoZSBmaXJzdAoJICAgICAqICAgICAgICAgdHdvIGZpbmRlciBwYXR0ZXJucyB0aGF0IGhhdmUgYmVlbiBsb2NhdGVkLiBJbiBzb21lIGNhc2VzIHRoZWlyIHBvc2l0aW9uIHdpbGwKCSAgICAgKiAgICAgICAgIGFsbG93IHVzIHRvIGluZmVyIHRoYXQgdGhlIHRoaXJkIHBhdHRlcm4gbXVzdCBsaWUgYmVsb3cgYSBjZXJ0YWluIHBvaW50IGZhcnRoZXIKCSAgICAgKiAgICAgICAgIGRvd24gaW4gdGhlIGltYWdlLgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmZpbmRSb3dTa2lwID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIG1heCA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgaWYgKG1heCA8PSAxKSB7CgkgICAgICAgICAgICByZXR1cm4gMDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgZmlyc3RDb25maXJtZWRDZW50ZXIgPSBudWxsOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgX2IgPSBfX3ZhbHVlcyh0aGlzLnBvc3NpYmxlQ2VudGVycyksIF9jID0gX2IubmV4dCgpOyAhX2MuZG9uZTsgX2MgPSBfYi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgY2VudGVyID0gX2MudmFsdWU7CgkgICAgICAgICAgICAgICAgaWYgKGNlbnRlci5nZXRDb3VudCgpID49IEZpbmRlclBhdHRlcm5GaW5kZXIuQ0VOVEVSX1FVT1JVTSkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoZmlyc3RDb25maXJtZWRDZW50ZXIgPT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RDb25maXJtZWRDZW50ZXIgPSBjZW50ZXI7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBoYXZlIHR3byBjb25maXJtZWQgY2VudGVycwoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gSG93IGZhciBkb3duIGNhbiB3ZSBza2lwIGJlZm9yZSByZXN1bWluZyBsb29raW5nIGZvciB0aGUgbmV4dAoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGF0dGVybj8gSW4gdGhlIHdvcnN0IGNhc2UsIG9ubHkgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiB0aGUKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRpZmZlcmVuY2UgaW4gdGhlIHggLyB5IGNvb3JkaW5hdGVzIG9mIHRoZSB0d28gY2VudGVycy4KCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgdGhlIGNhc2Ugd2hlcmUgeW91IGZpbmQgdG9wIGxlZnQgbGFzdC4KCSAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzU2tpcHBlZCA9IHRydWU7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLyooaW50KSAqLyBNYXRoLmZsb29yKChNYXRoLmFicyhmaXJzdENvbmZpcm1lZENlbnRlci5nZXRYKCkgLSBjZW50ZXIuZ2V0WCgpKSAtCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoZmlyc3RDb25maXJtZWRDZW50ZXIuZ2V0WSgpIC0gY2VudGVyLmdldFkoKSkpIC8gMik7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChfYyAmJiAhX2MuZG9uZSAmJiAoX2EgPSBfYi5yZXR1cm4pKSBfYS5jYWxsKF9iKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gdHJ1ZSBpZmYgd2UgaGF2ZSBmb3VuZCBhdCBsZWFzdCAzIGZpbmRlciBwYXR0ZXJucyB0aGF0IGhhdmUgYmVlbiBkZXRlY3RlZAoJICAgICAqICAgICAgICAgYXQgbGVhc3Qge0BsaW5rICNDRU5URVJfUVVPUlVNfSB0aW1lcyBlYWNoLCBhbmQsIHRoZSBlc3RpbWF0ZWQgbW9kdWxlIHNpemUgb2YgdGhlCgkgICAgICogICAgICAgICBjYW5kaWRhdGVzIGlzICJwcmV0dHkgc2ltaWxhciIKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8yLCBfYSwgZV8zLCBfYjsKCSAgICAgICAgdmFyIGNvbmZpcm1lZENvdW50ID0gMDsKCSAgICAgICAgdmFyIHRvdGFsTW9kdWxlU2l6ZSA9IDAuMDsKCSAgICAgICAgdmFyIG1heCA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIF9jID0gX192YWx1ZXModGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfZCA9IF9jLm5leHQoKTsgIV9kLmRvbmU7IF9kID0gX2MubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBfZC52YWx1ZTsKCSAgICAgICAgICAgICAgICBpZiAocGF0dGVybi5nZXRDb3VudCgpID49IEZpbmRlclBhdHRlcm5GaW5kZXIuQ0VOVEVSX1FVT1JVTSkgewoJICAgICAgICAgICAgICAgICAgICBjb25maXJtZWRDb3VudCsrOwoJICAgICAgICAgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gcGF0dGVybi5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzJfMSkgeyBlXzIgPSB7IGVycm9yOiBlXzJfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2QgJiYgIV9kLmRvbmUgJiYgKF9hID0gX2MucmV0dXJuKSkgX2EuY2FsbChfYyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMikgdGhyb3cgZV8yLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvbmZpcm1lZENvdW50IDwgMykgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIE9LLCB3ZSBoYXZlIGF0IGxlYXN0IDMgY29uZmlybWVkIGNlbnRlcnMsIGJ1dCwgaXQncyBwb3NzaWJsZSB0aGF0IG9uZSBpcyBhICJmYWxzZSBwb3NpdGl2ZSIKCSAgICAgICAgLy8gYW5kIHRoYXQgd2UgbmVlZCB0byBrZWVwIGxvb2tpbmcuIFdlIGRldGVjdCB0aGlzIGJ5IGFza2luZyBpZiB0aGUgZXN0aW1hdGVkIG1vZHVsZSBzaXplcwoJICAgICAgICAvLyB2YXJ5IHRvbyBtdWNoLiBXZSBhcmJpdHJhcmlseSBzYXkgdGhhdCB3aGVuIHRoZSB0b3RhbCBkZXZpYXRpb24gZnJvbSBhdmVyYWdlIGV4Y2VlZHMKCSAgICAgICAgLy8gNSUgb2YgdGhlIHRvdGFsIG1vZHVsZSBzaXplIGVzdGltYXRlcywgaXQncyB0b28gbXVjaC4KCSAgICAgICAgdmFyIGF2ZXJhZ2UgPSB0b3RhbE1vZHVsZVNpemUgLyBtYXg7CgkgICAgICAgIHZhciB0b3RhbERldmlhdGlvbiA9IDAuMDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIF9lID0gX192YWx1ZXModGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfZiA9IF9lLm5leHQoKTsgIV9mLmRvbmU7IF9mID0gX2UubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBfZi52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbERldmlhdGlvbiArPSBNYXRoLmFicyhwYXR0ZXJuLmdldEVzdGltYXRlZE1vZHVsZVNpemUoKSAtIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzNfMSkgeyBlXzMgPSB7IGVycm9yOiBlXzNfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2YgJiYgIV9mLmRvbmUgJiYgKF9iID0gX2UucmV0dXJuKSkgX2IuY2FsbChfZSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMykgdGhyb3cgZV8zLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRvdGFsRGV2aWF0aW9uIDw9IDAuMDUgKiB0b3RhbE1vZHVsZVNpemU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHRoZSAzIGJlc3Qge0BsaW5rIEZpbmRlclBhdHRlcm59cyBmcm9tIG91ciBsaXN0IG9mIGNhbmRpZGF0ZXMuIFRoZSAiYmVzdCIgYXJlCgkgICAgICogICAgICAgICB0aG9zZSB0aGF0IGhhdmUgYmVlbiBkZXRlY3RlZCBhdCBsZWFzdCB7QGxpbmsgI0NFTlRFUl9RVU9SVU19IHRpbWVzLCBhbmQgd2hvc2UgbW9kdWxlCgkgICAgICogICAgICAgICBzaXplIGRpZmZlcnMgZnJvbSB0aGUgYXZlcmFnZSBhbW9uZyB0aG9zZSBwYXR0ZXJucyB0aGUgbGVhc3QKCSAgICAgKiBAdGhyb3dzIE5vdEZvdW5kRXhjZXB0aW9uIGlmIDMgc3VjaCBmaW5kZXIgcGF0dGVybnMgZG8gbm90IGV4aXN0CgkgICAgICovCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuc2VsZWN0QmVzdFBhdHRlcm5zID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV80LCBfYSwgZV81LCBfYjsKCSAgICAgICAgdmFyIHN0YXJ0U2l6ZSA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgaWYgKHN0YXJ0U2l6ZSA8IDMpIHsKCSAgICAgICAgICAgIC8vIENvdWxkbid0IGZpbmQgZW5vdWdoIGZpbmRlciBwYXR0ZXJucwoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkMi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHBvc3NpYmxlQ2VudGVycyA9IHRoaXMucG9zc2libGVDZW50ZXJzOwoJICAgICAgICB2YXIgYXZlcmFnZTsKCSAgICAgICAgLy8gRmlsdGVyIG91dGxpZXIgcG9zc2liaWxpdGllcyB3aG9zZSBtb2R1bGUgc2l6ZSBpcyB0b28gZGlmZmVyZW50CgkgICAgICAgIGlmIChzdGFydFNpemUgPiAzKSB7CgkgICAgICAgICAgICAvLyBCdXQgd2UgY2FuIG9ubHkgYWZmb3JkIHRvIGRvIHNvIGlmIHdlIGhhdmUgYXQgbGVhc3QgNCBwb3NzaWJpbGl0aWVzIHRvIGNob29zZSBmcm9tCgkgICAgICAgICAgICB2YXIgdG90YWxNb2R1bGVTaXplID0gMC4wOwoJICAgICAgICAgICAgdmFyIHNxdWFyZSA9IDAuMDsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgX2MgPSBfX3ZhbHVlcyh0aGlzLnBvc3NpYmxlQ2VudGVycyksIF9kID0gX2MubmV4dCgpOyAhX2QuZG9uZTsgX2QgPSBfYy5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGNlbnRlciA9IF9kLnZhbHVlOwoJICAgICAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IGNlbnRlci5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCk7CgkgICAgICAgICAgICAgICAgICAgIHRvdGFsTW9kdWxlU2l6ZSArPSBzaXplOwoJICAgICAgICAgICAgICAgICAgICBzcXVhcmUgKz0gc2l6ZSAqIHNpemU7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgY2F0Y2ggKGVfNF8xKSB7IGVfNCA9IHsgZXJyb3I6IGVfNF8xIH07IH0KCSAgICAgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChfZCAmJiAhX2QuZG9uZSAmJiAoX2EgPSBfYy5yZXR1cm4pKSBfYS5jYWxsKF9jKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZmluYWxseSB7IGlmIChlXzQpIHRocm93IGVfNC5lcnJvcjsgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgYXZlcmFnZSA9IHRvdGFsTW9kdWxlU2l6ZSAvIHN0YXJ0U2l6ZTsKCSAgICAgICAgICAgIHZhciBzdGREZXYgPSBNYXRoLnNxcnQoc3F1YXJlIC8gc3RhcnRTaXplIC0gYXZlcmFnZSAqIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzLnNvcnQoCgkgICAgICAgICAgICAvKioKCSAgICAgICAgICAgICAqIDxwPk9yZGVycyBieSBmdXJ0aGVzdCBmcm9tIGF2ZXJhZ2U8L3A+CgkgICAgICAgICAgICAgKi8KCSAgICAgICAgICAgIC8vIEZ1cnRoZXN0RnJvbUF2ZXJhZ2VDb21wYXJhdG9yIGltcGxlbWVudHMgQ29tcGFyYXRvcjxGaW5kZXJQYXR0ZXJuPgoJICAgICAgICAgICAgZnVuY3Rpb24gKGNlbnRlcjEsIGNlbnRlcjIpIHsKCSAgICAgICAgICAgICAgICB2YXIgZEEgPSBNYXRoLmFicyhjZW50ZXIyLmdldEVzdGltYXRlZE1vZHVsZVNpemUoKSAtIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgICAgIHZhciBkQiA9IE1hdGguYWJzKGNlbnRlcjEuZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpIC0gYXZlcmFnZSk7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGRBIDwgZEIgPyAtMSA6IGRBID4gZEIgPyAxIDogMDsKCSAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgdmFyIGxpbWl0ID0gTWF0aC5tYXgoMC4yICogYXZlcmFnZSwgc3RkRGV2KTsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcG9zc2libGVDZW50ZXJzLmxlbmd0aCAmJiBwb3NzaWJsZUNlbnRlcnMubGVuZ3RoID4gMzsgaSsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBwb3NzaWJsZUNlbnRlcnNbaV07CgkgICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHBhdHRlcm4uZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpIC0gYXZlcmFnZSkgPiBsaW1pdCkgewoJICAgICAgICAgICAgICAgICAgICBwb3NzaWJsZUNlbnRlcnMuc3BsaWNlKGksIDEpOwoJICAgICAgICAgICAgICAgICAgICBpLS07CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGlmIChwb3NzaWJsZUNlbnRlcnMubGVuZ3RoID4gMykgewoJICAgICAgICAgICAgLy8gVGhyb3cgYXdheSBhbGwgYnV0IHRob3NlIGZpcnN0IHNpemUgY2FuZGlkYXRlIHBvaW50cyB3ZSBmb3VuZC4KCSAgICAgICAgICAgIHZhciB0b3RhbE1vZHVsZVNpemUgPSAwLjA7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGZvciAodmFyIHBvc3NpYmxlQ2VudGVyc18xID0gX192YWx1ZXMocG9zc2libGVDZW50ZXJzKSwgcG9zc2libGVDZW50ZXJzXzFfMSA9IHBvc3NpYmxlQ2VudGVyc18xLm5leHQoKTsgIXBvc3NpYmxlQ2VudGVyc18xXzEuZG9uZTsgcG9zc2libGVDZW50ZXJzXzFfMSA9IHBvc3NpYmxlQ2VudGVyc18xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgICAgICB2YXIgcG9zc2libGVDZW50ZXIgPSBwb3NzaWJsZUNlbnRlcnNfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gcG9zc2libGVDZW50ZXIuZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGNhdGNoIChlXzVfMSkgeyBlXzUgPSB7IGVycm9yOiBlXzVfMSB9OyB9CgkgICAgICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgICAgICBpZiAocG9zc2libGVDZW50ZXJzXzFfMSAmJiAhcG9zc2libGVDZW50ZXJzXzFfMS5kb25lICYmIChfYiA9IHBvc3NpYmxlQ2VudGVyc18xLnJldHVybikpIF9iLmNhbGwocG9zc2libGVDZW50ZXJzXzEpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfNSkgdGhyb3cgZV81LmVycm9yOyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBhdmVyYWdlID0gdG90YWxNb2R1bGVTaXplIC8gcG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVycy5zb3J0KAoJICAgICAgICAgICAgLyoqCgkgICAgICAgICAgICAgKiA8cD5PcmRlcnMgYnkge0BsaW5rIEZpbmRlclBhdHRlcm4jZ2V0Q291bnQoKX0sIGRlc2NlbmRpbmcuPC9wPgoJICAgICAgICAgICAgICovCgkgICAgICAgICAgICAvLyBDZW50ZXJDb21wYXJhdG9yIGltcGxlbWVudHMgQ29tcGFyYXRvcjxGaW5kZXJQYXR0ZXJuPgoJICAgICAgICAgICAgZnVuY3Rpb24gKGNlbnRlcjEsIGNlbnRlcjIpIHsKCSAgICAgICAgICAgICAgICBpZiAoY2VudGVyMi5nZXRDb3VudCgpID09PSBjZW50ZXIxLmdldENvdW50KCkpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGRBID0gTWF0aC5hYnMoY2VudGVyMi5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCkgLSBhdmVyYWdlKTsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGRCID0gTWF0aC5hYnMoY2VudGVyMS5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCkgLSBhdmVyYWdlKTsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRBIDwgZEIgPyAxIDogZEEgPiBkQiA/IC0xIDogMDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBjZW50ZXIyLmdldENvdW50KCkgLSBjZW50ZXIxLmdldENvdW50KCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSk7CgkgICAgICAgICAgICBwb3NzaWJsZUNlbnRlcnMuc3BsaWNlKDMpOyAvLyB0aGlzIGlzIG5vdCByZWFseSBuZWNlc3NhcnkgYXMgd2Ugb25seSByZXR1cm4gZmlyc3QgMyBhbnl3YXkKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gWwoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzBdLAoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzFdLAoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzJdCgkgICAgICAgIF07CgkgICAgfTsKCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLkNFTlRFUl9RVU9SVU0gPSAyOwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuTUlOX1NLSVAgPSAzOyAvLyAxIHBpeGVsL21vZHVsZSB0aW1lcyAzIG1vZHVsZXMvY2VudGVyCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5NQVhfTU9EVUxFUyA9IDU3OyAvLyBzdXBwb3J0IHVwIHRvIHZlcnNpb24gMTAgZm9yIG1vYmlsZSBjbGllbnRzCgkgICAgcmV0dXJuIEZpbmRlclBhdHRlcm5GaW5kZXI7Cgl9KCkpOwoJRmluZGVyUGF0dGVybkZpbmRlciQxLmRlZmF1bHQgPSBGaW5kZXJQYXR0ZXJuRmluZGVyOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGV0ZWN0b3IkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIE1hdGhVdGlsc18xID0gTWF0aFV0aWxzJDE7Cgl2YXIgRGV0ZWN0b3JSZXN1bHRfMSA9IERldGVjdG9yUmVzdWx0JDE7CgkvLyBpbXBvcnQgR3JpZFNhbXBsZXIgZnJvbSAnLi4vLi4vY29tbW9uL0dyaWRTYW1wbGVyJzsKCXZhciBHcmlkU2FtcGxlckluc3RhbmNlXzEgPSBHcmlkU2FtcGxlckluc3RhbmNlJDE7Cgl2YXIgUGVyc3BlY3RpdmVUcmFuc2Zvcm1fMSA9IFBlcnNwZWN0aXZlVHJhbnNmb3JtJDE7Cgl2YXIgRGVjb2RlSGludFR5cGVfMSQxID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJdmFyIFJlc3VsdFBvaW50XzEgPSBSZXN1bHRQb2ludCQxOwoJdmFyIFZlcnNpb25fMSA9IFZlcnNpb24kMTsKCXZhciBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyXzEgPSBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyJDE7Cgl2YXIgRmluZGVyUGF0dGVybkZpbmRlcl8xID0gRmluZGVyUGF0dGVybkZpbmRlciQxOwoJLyppbXBvcnQgamF2YS51dGlsLk1hcDsqLwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgbG9naWMgdGhhdCBjYW4gZGV0ZWN0IGEgUVIgQ29kZSBpbiBhbiBpbWFnZSwgZXZlbiBpZiB0aGUgUVIgQ29kZQoJICogaXMgcm90YXRlZCBvciBza2V3ZWQsIG9yIHBhcnRpYWxseSBvYnNjdXJlZC48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERldGVjdG9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIERldGVjdG9yKGltYWdlKSB7CgkgICAgICAgIHRoaXMuaW1hZ2UgPSBpbWFnZTsKCSAgICB9CgkgICAgRGV0ZWN0b3IucHJvdG90eXBlLmdldEltYWdlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5pbWFnZTsKCSAgICB9OwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5nZXRSZXN1bHRQb2ludENhbGxiYWNrID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZWN0cyBhIFFSIENvZGUgaW4gYW4gaW1hZ2UuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiB7QGxpbmsgRGV0ZWN0b3JSZXN1bHR9IGVuY2Fwc3VsYXRpbmcgcmVzdWx0cyBvZiBkZXRlY3RpbmcgYSBRUiBDb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBRUiBDb2RlIGNhbm5vdCBiZSBmb3VuZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIGEgUVIgQ29kZSBjYW5ub3QgYmUgZGVjb2RlZAoJICAgICAqLwoJICAgIC8vIHB1YmxpYyBkZXRlY3QoKTogRGV0ZWN0b3JSZXN1bHQgLyp0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiovIHsKCSAgICAvLyAgIHJldHVybiBkZXRlY3QobnVsbCkKCSAgICAvLyB9CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZWN0cyBhIFFSIENvZGUgaW4gYW4gaW1hZ2UuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGhpbnRzIG9wdGlvbmFsIGhpbnRzIHRvIGRldGVjdG9yCgkgICAgICogQHJldHVybiB7QGxpbmsgRGV0ZWN0b3JSZXN1bHR9IGVuY2Fwc3VsYXRpbmcgcmVzdWx0cyBvZiBkZXRlY3RpbmcgYSBRUiBDb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBRUiBDb2RlIGNhbm5vdCBiZSBmb3VuZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIGEgUVIgQ29kZSBjYW5ub3QgYmUgZGVjb2RlZAoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5kZXRlY3QgPSBmdW5jdGlvbiAoaGludHMpIHsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gKGhpbnRzID09PSBudWxsIHx8IGhpbnRzID09PSB1bmRlZmluZWQpID8gbnVsbCA6CgkgICAgICAgICAgICAvKihSZXN1bHRQb2ludENhbGxiYWNrKSAqLyBoaW50cy5nZXQoRGVjb2RlSGludFR5cGVfMSQxLmRlZmF1bHQuTkVFRF9SRVNVTFRfUE9JTlRfQ0FMTEJBQ0spOwoJICAgICAgICB2YXIgZmluZGVyID0gbmV3IEZpbmRlclBhdHRlcm5GaW5kZXJfMS5kZWZhdWx0KHRoaXMuaW1hZ2UsIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayk7CgkgICAgICAgIHZhciBpbmZvID0gZmluZGVyLmZpbmQoaGludHMpOwoJICAgICAgICByZXR1cm4gdGhpcy5wcm9jZXNzRmluZGVyUGF0dGVybkluZm8oaW5mbyk7CgkgICAgfTsKCSAgICBEZXRlY3Rvci5wcm90b3R5cGUucHJvY2Vzc0ZpbmRlclBhdHRlcm5JbmZvID0gZnVuY3Rpb24gKGluZm8pIHsKCSAgICAgICAgdmFyIHRvcExlZnQgPSBpbmZvLmdldFRvcExlZnQoKTsKCSAgICAgICAgdmFyIHRvcFJpZ2h0ID0gaW5mby5nZXRUb3BSaWdodCgpOwoJICAgICAgICB2YXIgYm90dG9tTGVmdCA9IGluZm8uZ2V0Qm90dG9tTGVmdCgpOwoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRoaXMuY2FsY3VsYXRlTW9kdWxlU2l6ZSh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCk7CgkgICAgICAgIGlmIChtb2R1bGVTaXplIDwgMS4wKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQxLmRlZmF1bHQoJ05vIHBhdHRlcm4gZm91bmQgaW4gcHJvY2Nlc3MgZmluZGVyLicpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBkaW1lbnNpb24gPSBEZXRlY3Rvci5jb21wdXRlRGltZW5zaW9uKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIHByb3Zpc2lvbmFsVmVyc2lvbiA9IFZlcnNpb25fMS5kZWZhdWx0LmdldFByb3Zpc2lvbmFsVmVyc2lvbkZvckRpbWVuc2lvbihkaW1lbnNpb24pOwoJICAgICAgICB2YXIgbW9kdWxlc0JldHdlZW5GUENlbnRlcnMgPSBwcm92aXNpb25hbFZlcnNpb24uZ2V0RGltZW5zaW9uRm9yVmVyc2lvbigpIC0gNzsKCSAgICAgICAgdmFyIGFsaWdubWVudFBhdHRlcm4gPSBudWxsOwoJICAgICAgICAvLyBBbnl0aGluZyBhYm92ZSB2ZXJzaW9uIDEgaGFzIGFuIGFsaWdubWVudCBwYXR0ZXJuCgkgICAgICAgIGlmIChwcm92aXNpb25hbFZlcnNpb24uZ2V0QWxpZ25tZW50UGF0dGVybkNlbnRlcnMoKS5sZW5ndGggPiAwKSB7CgkgICAgICAgICAgICAvLyBHdWVzcyB3aGVyZSBhICJib3R0b20gcmlnaHQiIGZpbmRlciBwYXR0ZXJuIHdvdWxkIGhhdmUgYmVlbgoJICAgICAgICAgICAgdmFyIGJvdHRvbVJpZ2h0WCA9IHRvcFJpZ2h0LmdldFgoKSAtIHRvcExlZnQuZ2V0WCgpICsgYm90dG9tTGVmdC5nZXRYKCk7CgkgICAgICAgICAgICB2YXIgYm90dG9tUmlnaHRZID0gdG9wUmlnaHQuZ2V0WSgpIC0gdG9wTGVmdC5nZXRZKCkgKyBib3R0b21MZWZ0LmdldFkoKTsKCSAgICAgICAgICAgIC8vIEVzdGltYXRlIHRoYXQgYWxpZ25tZW50IHBhdHRlcm4gaXMgY2xvc2VyIGJ5IDMgbW9kdWxlcwoJICAgICAgICAgICAgLy8gZnJvbSAiYm90dG9tIHJpZ2h0IiB0byBrbm93biB0b3AgbGVmdCBsb2NhdGlvbgoJICAgICAgICAgICAgdmFyIGNvcnJlY3Rpb25Ub1RvcExlZnQgPSAxLjAgLSAzLjAgLyBtb2R1bGVzQmV0d2VlbkZQQ2VudGVyczsKCSAgICAgICAgICAgIHZhciBlc3RBbGlnbm1lbnRYID0gLyooaW50KSAqLyBNYXRoLmZsb29yKHRvcExlZnQuZ2V0WCgpICsgY29ycmVjdGlvblRvVG9wTGVmdCAqIChib3R0b21SaWdodFggLSB0b3BMZWZ0LmdldFgoKSkpOwoJICAgICAgICAgICAgdmFyIGVzdEFsaWdubWVudFkgPSAvKihpbnQpICovIE1hdGguZmxvb3IodG9wTGVmdC5nZXRZKCkgKyBjb3JyZWN0aW9uVG9Ub3BMZWZ0ICogKGJvdHRvbVJpZ2h0WSAtIHRvcExlZnQuZ2V0WSgpKSk7CgkgICAgICAgICAgICAvLyBLaW5kIG9mIGFyYml0cmFyeSAtLSBleHBhbmQgc2VhcmNoIHJhZGl1cyBiZWZvcmUgZ2l2aW5nIHVwCgkgICAgICAgICAgICBmb3IgKHZhciBpID0gNDsgaSA8PSAxNjsgaSA8PD0gMSkgewoJICAgICAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgICAgIGFsaWdubWVudFBhdHRlcm4gPSB0aGlzLmZpbmRBbGlnbm1lbnRJblJlZ2lvbihtb2R1bGVTaXplLCBlc3RBbGlnbm1lbnRYLCBlc3RBbGlnbm1lbnRZLCBpKTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGNhdGNoIChyZSAvKk5vdEZvdW5kRXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKCEocmUgaW5zdGFuY2VvZiBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IHJlOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIC8vIHRyeSBuZXh0IHJvdW5kCgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gSWYgd2UgZGlkbid0IGZpbmQgYWxpZ25tZW50IHBhdHRlcm4uLi4gd2VsbCB0cnkgYW55d2F5IHdpdGhvdXQgaXQKCSAgICAgICAgfQoJICAgICAgICB2YXIgdHJhbnNmb3JtID0gRGV0ZWN0b3IuY3JlYXRlVHJhbnNmb3JtKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBhbGlnbm1lbnRQYXR0ZXJuLCBkaW1lbnNpb24pOwoJICAgICAgICB2YXIgYml0cyA9IERldGVjdG9yLnNhbXBsZUdyaWQodGhpcy5pbWFnZSwgdHJhbnNmb3JtLCBkaW1lbnNpb24pOwoJICAgICAgICB2YXIgcG9pbnRzOwoJICAgICAgICBpZiAoYWxpZ25tZW50UGF0dGVybiA9PT0gbnVsbCkgewoJICAgICAgICAgICAgcG9pbnRzID0gW2JvdHRvbUxlZnQsIHRvcExlZnQsIHRvcFJpZ2h0XTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHBvaW50cyA9IFtib3R0b21MZWZ0LCB0b3BMZWZ0LCB0b3BSaWdodCwgYWxpZ25tZW50UGF0dGVybl07CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG5ldyBEZXRlY3RvclJlc3VsdF8xLmRlZmF1bHQoYml0cywgcG9pbnRzKTsKCSAgICB9OwoJICAgIERldGVjdG9yLmNyZWF0ZVRyYW5zZm9ybSA9IGZ1bmN0aW9uICh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCwgYWxpZ25tZW50UGF0dGVybiwgZGltZW5zaW9uIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGRpbU1pbnVzVGhyZWUgPSBkaW1lbnNpb24gLSAzLjU7CgkgICAgICAgIHZhciBib3R0b21SaWdodFg7IC8qZmxvYXQqLwoJICAgICAgICB2YXIgYm90dG9tUmlnaHRZOyAvKmZsb2F0Ki8KCSAgICAgICAgdmFyIHNvdXJjZUJvdHRvbVJpZ2h0WDsgLypmbG9hdCovCgkgICAgICAgIHZhciBzb3VyY2VCb3R0b21SaWdodFk7IC8qZmxvYXQqLwoJICAgICAgICBpZiAoYWxpZ25tZW50UGF0dGVybiAhPT0gbnVsbCkgewoJICAgICAgICAgICAgYm90dG9tUmlnaHRYID0gYWxpZ25tZW50UGF0dGVybi5nZXRYKCk7CgkgICAgICAgICAgICBib3R0b21SaWdodFkgPSBhbGlnbm1lbnRQYXR0ZXJuLmdldFkoKTsKCSAgICAgICAgICAgIHNvdXJjZUJvdHRvbVJpZ2h0WCA9IGRpbU1pbnVzVGhyZWUgLSAzLjA7CgkgICAgICAgICAgICBzb3VyY2VCb3R0b21SaWdodFkgPSBzb3VyY2VCb3R0b21SaWdodFg7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAvLyBEb24ndCBoYXZlIGFuIGFsaWdubWVudCBwYXR0ZXJuLCBqdXN0IG1ha2UgdXAgdGhlIGJvdHRvbS1yaWdodCBwb2ludAoJICAgICAgICAgICAgYm90dG9tUmlnaHRYID0gKHRvcFJpZ2h0LmdldFgoKSAtIHRvcExlZnQuZ2V0WCgpKSArIGJvdHRvbUxlZnQuZ2V0WCgpOwoJICAgICAgICAgICAgYm90dG9tUmlnaHRZID0gKHRvcFJpZ2h0LmdldFkoKSAtIHRvcExlZnQuZ2V0WSgpKSArIGJvdHRvbUxlZnQuZ2V0WSgpOwoJICAgICAgICAgICAgc291cmNlQm90dG9tUmlnaHRYID0gZGltTWludXNUaHJlZTsKCSAgICAgICAgICAgIHNvdXJjZUJvdHRvbVJpZ2h0WSA9IGRpbU1pbnVzVGhyZWU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIFBlcnNwZWN0aXZlVHJhbnNmb3JtXzEuZGVmYXVsdC5xdWFkcmlsYXRlcmFsVG9RdWFkcmlsYXRlcmFsKDMuNSwgMy41LCBkaW1NaW51c1RocmVlLCAzLjUsIHNvdXJjZUJvdHRvbVJpZ2h0WCwgc291cmNlQm90dG9tUmlnaHRZLCAzLjUsIGRpbU1pbnVzVGhyZWUsIHRvcExlZnQuZ2V0WCgpLCB0b3BMZWZ0LmdldFkoKSwgdG9wUmlnaHQuZ2V0WCgpLCB0b3BSaWdodC5nZXRZKCksIGJvdHRvbVJpZ2h0WCwgYm90dG9tUmlnaHRZLCBib3R0b21MZWZ0LmdldFgoKSwgYm90dG9tTGVmdC5nZXRZKCkpOwoJICAgIH07CgkgICAgRGV0ZWN0b3Iuc2FtcGxlR3JpZCA9IGZ1bmN0aW9uIChpbWFnZSwgdHJhbnNmb3JtLCBkaW1lbnNpb24gLyppbnQqLykgewoJICAgICAgICB2YXIgc2FtcGxlciA9IEdyaWRTYW1wbGVySW5zdGFuY2VfMS5kZWZhdWx0LmdldEluc3RhbmNlKCk7CgkgICAgICAgIHJldHVybiBzYW1wbGVyLnNhbXBsZUdyaWRXaXRoVHJhbnNmb3JtKGltYWdlLCBkaW1lbnNpb24sIGRpbWVuc2lvbiwgdHJhbnNmb3JtKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkNvbXB1dGVzIHRoZSBkaW1lbnNpb24gKG51bWJlciBvZiBtb2R1bGVzIG9uIGEgc2l6ZSkgb2YgdGhlIFFSIENvZGUgYmFzZWQgb24gdGhlIHBvc2l0aW9uCgkgICAgICogb2YgdGhlIGZpbmRlciBwYXR0ZXJucyBhbmQgZXN0aW1hdGVkIG1vZHVsZSBzaXplLjwvcD4KCSAgICAgKi8KCSAgICBEZXRlY3Rvci5jb21wdXRlRGltZW5zaW9uID0gZnVuY3Rpb24gKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBtb2R1bGVTaXplIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgdGx0ckNlbnRlcnNEaW1lbnNpb24gPSBNYXRoVXRpbHNfMS5kZWZhdWx0LnJvdW5kKFJlc3VsdFBvaW50XzEuZGVmYXVsdC5kaXN0YW5jZSh0b3BMZWZ0LCB0b3BSaWdodCkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIHRsYmxDZW50ZXJzRGltZW5zaW9uID0gTWF0aFV0aWxzXzEuZGVmYXVsdC5yb3VuZChSZXN1bHRQb2ludF8xLmRlZmF1bHQuZGlzdGFuY2UodG9wTGVmdCwgYm90dG9tTGVmdCkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IE1hdGguZmxvb3IoKHRsdHJDZW50ZXJzRGltZW5zaW9uICsgdGxibENlbnRlcnNEaW1lbnNpb24pIC8gMikgKyA3OwoJICAgICAgICBzd2l0Y2ggKGRpbWVuc2lvbiAmIDB4MDMpIHsgLy8gbW9kIDQKCSAgICAgICAgICAgIGNhc2UgMDoKCSAgICAgICAgICAgICAgICBkaW1lbnNpb24rKzsKCSAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIC8vIDE/IGRvIG5vdGhpbmcKCSAgICAgICAgICAgIGNhc2UgMjoKCSAgICAgICAgICAgICAgICBkaW1lbnNpb24tLTsKCSAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIGNhc2UgMzoKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQxLmRlZmF1bHQoJ0RpbWVuc2lvbnMgY291bGQgYmUgbm90IGZvdW5kLicpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBkaW1lbnNpb247CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5Db21wdXRlcyBhbiBhdmVyYWdlIGVzdGltYXRlZCBtb2R1bGUgc2l6ZSBiYXNlZCBvbiBlc3RpbWF0ZWQgZGVyaXZlZCBmcm9tIHRoZSBwb3NpdGlvbnMKCSAgICAgKiBvZiB0aGUgdGhyZWUgZmluZGVyIHBhdHRlcm5zLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB0b3BMZWZ0IGRldGVjdGVkIHRvcC1sZWZ0IGZpbmRlciBwYXR0ZXJuIGNlbnRlcgoJICAgICAqIEBwYXJhbSB0b3BSaWdodCBkZXRlY3RlZCB0b3AtcmlnaHQgZmluZGVyIHBhdHRlcm4gY2VudGVyCgkgICAgICogQHBhcmFtIGJvdHRvbUxlZnQgZGV0ZWN0ZWQgYm90dG9tLWxlZnQgZmluZGVyIHBhdHRlcm4gY2VudGVyCgkgICAgICogQHJldHVybiBlc3RpbWF0ZWQgbW9kdWxlIHNpemUKCSAgICAgKi8KCSAgICBEZXRlY3Rvci5wcm90b3R5cGUuY2FsY3VsYXRlTW9kdWxlU2l6ZSA9IGZ1bmN0aW9uICh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCkgewoJICAgICAgICAvLyBUYWtlIHRoZSBhdmVyYWdlCgkgICAgICAgIHJldHVybiAodGhpcy5jYWxjdWxhdGVNb2R1bGVTaXplT25lV2F5KHRvcExlZnQsIHRvcFJpZ2h0KSArCgkgICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZU1vZHVsZVNpemVPbmVXYXkodG9wTGVmdCwgYm90dG9tTGVmdCkpIC8gMi4wOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+RXN0aW1hdGVzIG1vZHVsZSBzaXplIGJhc2VkIG9uIHR3byBmaW5kZXIgcGF0dGVybnMgLS0gaXQgdXNlcwoJICAgICAqIHtAbGluayAjc2l6ZU9mQmxhY2tXaGl0ZUJsYWNrUnVuQm90aFdheXMoaW50LCBpbnQsIGludCwgaW50KX0gdG8gZmlndXJlIHRoZQoJICAgICAqIHdpZHRoIG9mIGVhY2gsIG1lYXN1cmluZyBhbG9uZyB0aGUgYXhpcyBiZXR3ZWVuIHRoZWlyIGNlbnRlcnMuPC9wPgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5jYWxjdWxhdGVNb2R1bGVTaXplT25lV2F5ID0gZnVuY3Rpb24gKHBhdHRlcm4sIG90aGVyUGF0dGVybikgewoJICAgICAgICB2YXIgbW9kdWxlU2l6ZUVzdDEgPSB0aGlzLnNpemVPZkJsYWNrV2hpdGVCbGFja1J1bkJvdGhXYXlzKC8qKGludCkgKi8gTWF0aC5mbG9vcihwYXR0ZXJuLmdldFgoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3IocGF0dGVybi5nZXRZKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKG90aGVyUGF0dGVybi5nZXRYKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKG90aGVyUGF0dGVybi5nZXRZKCkpKTsKCSAgICAgICAgdmFyIG1vZHVsZVNpemVFc3QyID0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW5Cb3RoV2F5cygvKihpbnQpICovIE1hdGguZmxvb3Iob3RoZXJQYXR0ZXJuLmdldFgoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3Iob3RoZXJQYXR0ZXJuLmdldFkoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3IocGF0dGVybi5nZXRYKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKHBhdHRlcm4uZ2V0WSgpKSk7CgkgICAgICAgIGlmIChpc05hTihtb2R1bGVTaXplRXN0MSkpIHsKCSAgICAgICAgICAgIHJldHVybiBtb2R1bGVTaXplRXN0MiAvIDcuMDsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaXNOYU4obW9kdWxlU2l6ZUVzdDIpKSB7CgkgICAgICAgICAgICByZXR1cm4gbW9kdWxlU2l6ZUVzdDEgLyA3LjA7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQXZlcmFnZSB0aGVtLCBhbmQgZGl2aWRlIGJ5IDcgc2luY2Ugd2UndmUgY291bnRlZCB0aGUgd2lkdGggb2YgMyBibGFjayBtb2R1bGVzLAoJICAgICAgICAvLyBhbmQgMSB3aGl0ZSBhbmQgMSBibGFjayBtb2R1bGUgb24gZWl0aGVyIHNpZGUuIEVyZ28sIGRpdmlkZSBzdW0gYnkgMTQuCgkgICAgICAgIHJldHVybiAobW9kdWxlU2l6ZUVzdDEgKyBtb2R1bGVTaXplRXN0MikgLyAxNC4wOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogU2VlIHtAbGluayAjc2l6ZU9mQmxhY2tXaGl0ZUJsYWNrUnVuKGludCwgaW50LCBpbnQsIGludCl9OyBjb21wdXRlcyB0aGUgdG90YWwgd2lkdGggb2YKCSAgICAgKiBhIGZpbmRlciBwYXR0ZXJuIGJ5IGxvb2tpbmcgZm9yIGEgYmxhY2std2hpdGUtYmxhY2sgcnVuIGZyb20gdGhlIGNlbnRlciBpbiB0aGUgZGlyZWN0aW9uCgkgICAgICogb2YgYW5vdGhlciBwb2ludCAoYW5vdGhlciBmaW5kZXIgcGF0dGVybiBjZW50ZXIpLCBhbmQgaW4gdGhlIG9wcG9zaXRlIGRpcmVjdGlvbiB0b28uCgkgICAgICovCgkgICAgRGV0ZWN0b3IucHJvdG90eXBlLnNpemVPZkJsYWNrV2hpdGVCbGFja1J1bkJvdGhXYXlzID0gZnVuY3Rpb24gKGZyb21YIC8qaW50Ki8sIGZyb21ZIC8qaW50Ki8sIHRvWCAvKmludCovLCB0b1kgLyppbnQqLykgewoJICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4oZnJvbVgsIGZyb21ZLCB0b1gsIHRvWSk7CgkgICAgICAgIC8vIE5vdyBjb3VudCBvdGhlciB3YXkgLS0gZG9uJ3QgcnVuIG9mZiBpbWFnZSB0aG91Z2ggb2YgY291cnNlCgkgICAgICAgIHZhciBzY2FsZSA9IDEuMDsKCSAgICAgICAgdmFyIG90aGVyVG9YID0gZnJvbVggLSAodG9YIC0gZnJvbVgpOwoJICAgICAgICBpZiAob3RoZXJUb1ggPCAwKSB7CgkgICAgICAgICAgICBzY2FsZSA9IGZyb21YIC8gLyooZmxvYXQpICovIChmcm9tWCAtIG90aGVyVG9YKTsKCSAgICAgICAgICAgIG90aGVyVG9YID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChvdGhlclRvWCA+PSB0aGlzLmltYWdlLmdldFdpZHRoKCkpIHsKCSAgICAgICAgICAgIHNjYWxlID0gKHRoaXMuaW1hZ2UuZ2V0V2lkdGgoKSAtIDEgLSBmcm9tWCkgLyAvKihmbG9hdCkgKi8gKG90aGVyVG9YIC0gZnJvbVgpOwoJICAgICAgICAgICAgb3RoZXJUb1ggPSB0aGlzLmltYWdlLmdldFdpZHRoKCkgLSAxOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlclRvWSA9IC8qKGludCkgKi8gTWF0aC5mbG9vcihmcm9tWSAtICh0b1kgLSBmcm9tWSkgKiBzY2FsZSk7CgkgICAgICAgIHNjYWxlID0gMS4wOwoJICAgICAgICBpZiAob3RoZXJUb1kgPCAwKSB7CgkgICAgICAgICAgICBzY2FsZSA9IGZyb21ZIC8gLyooZmxvYXQpICovIChmcm9tWSAtIG90aGVyVG9ZKTsKCSAgICAgICAgICAgIG90aGVyVG9ZID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChvdGhlclRvWSA+PSB0aGlzLmltYWdlLmdldEhlaWdodCgpKSB7CgkgICAgICAgICAgICBzY2FsZSA9ICh0aGlzLmltYWdlLmdldEhlaWdodCgpIC0gMSAtIGZyb21ZKSAvIC8qKGZsb2F0KSAqLyAob3RoZXJUb1kgLSBmcm9tWSk7CgkgICAgICAgICAgICBvdGhlclRvWSA9IHRoaXMuaW1hZ2UuZ2V0SGVpZ2h0KCkgLSAxOwoJICAgICAgICB9CgkgICAgICAgIG90aGVyVG9YID0gLyooaW50KSAqLyBNYXRoLmZsb29yKGZyb21YICsgKG90aGVyVG9YIC0gZnJvbVgpICogc2NhbGUpOwoJICAgICAgICByZXN1bHQgKz0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4oZnJvbVgsIGZyb21ZLCBvdGhlclRvWCwgb3RoZXJUb1kpOwoJICAgICAgICAvLyBNaWRkbGUgcGl4ZWwgaXMgZG91YmxlLWNvdW50ZWQgdGhpcyB3YXk7IHN1YnRyYWN0IDEKCSAgICAgICAgcmV0dXJuIHJlc3VsdCAtIDEuMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlRoaXMgbWV0aG9kIHRyYWNlcyBhIGxpbmUgZnJvbSBhIHBvaW50IGluIHRoZSBpbWFnZSwgaW4gdGhlIGRpcmVjdGlvbiB0b3dhcmRzIGFub3RoZXIgcG9pbnQuCgkgICAgICogSXQgYmVnaW5zIGluIGEgYmxhY2sgcmVnaW9uLCBhbmQga2VlcHMgZ29pbmcgdW50aWwgaXQgZmluZHMgd2hpdGUsIHRoZW4gYmxhY2ssIHRoZW4gd2hpdGUgYWdhaW4uCgkgICAgICogSXQgcmVwb3J0cyB0aGUgZGlzdGFuY2UgZnJvbSB0aGUgc3RhcnQgdG8gdGhpcyBwb2ludC48L3A+CgkgICAgICoKCSAgICAgKiA8cD5UaGlzIGlzIHVzZWQgd2hlbiBmaWd1cmluZyBvdXQgaG93IHdpZGUgYSBmaW5kZXIgcGF0dGVybiBpcywgd2hlbiB0aGUgZmluZGVyIHBhdHRlcm4KCSAgICAgKiBtYXkgYmUgc2tld2VkIG9yIHJvdGF0ZWQuPC9wPgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4gPSBmdW5jdGlvbiAoZnJvbVggLyppbnQqLywgZnJvbVkgLyppbnQqLywgdG9YIC8qaW50Ki8sIHRvWSAvKmludCovKSB7CgkgICAgICAgIC8vIE1pbGQgdmFyaWFudCBvZiBCcmVzZW5oYW0ncyBhbGdvcml0aG0KCSAgICAgICAgLy8gc2VlIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQnJlc2VuaGFtJ3NfbGluZV9hbGdvcml0aG0KCSAgICAgICAgdmFyIHN0ZWVwID0gTWF0aC5hYnModG9ZIC0gZnJvbVkpID4gTWF0aC5hYnModG9YIC0gZnJvbVgpOwoJICAgICAgICBpZiAoc3RlZXApIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gZnJvbVg7CgkgICAgICAgICAgICBmcm9tWCA9IGZyb21ZOwoJICAgICAgICAgICAgZnJvbVkgPSB0ZW1wOwoJICAgICAgICAgICAgdGVtcCA9IHRvWDsKCSAgICAgICAgICAgIHRvWCA9IHRvWTsKCSAgICAgICAgICAgIHRvWSA9IHRlbXA7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGR4ID0gTWF0aC5hYnModG9YIC0gZnJvbVgpOwoJICAgICAgICB2YXIgZHkgPSBNYXRoLmFicyh0b1kgLSBmcm9tWSk7CgkgICAgICAgIHZhciBlcnJvciA9IC1keCAvIDI7CgkgICAgICAgIHZhciB4c3RlcCA9IGZyb21YIDwgdG9YID8gMSA6IC0xOwoJICAgICAgICB2YXIgeXN0ZXAgPSBmcm9tWSA8IHRvWSA/IDEgOiAtMTsKCSAgICAgICAgLy8gSW4gYmxhY2sgcGl4ZWxzLCBsb29raW5nIGZvciB3aGl0ZSwgZmlyc3Qgb3Igc2Vjb25kIHRpbWUuCgkgICAgICAgIHZhciBzdGF0ZSA9IDA7CgkgICAgICAgIC8vIExvb3AgdXAgdW50aWwgeCA9PSB0b1gsIGJ1dCBub3QgYmV5b25kCgkgICAgICAgIHZhciB4TGltaXQgPSB0b1ggKyB4c3RlcDsKCSAgICAgICAgZm9yICh2YXIgeCA9IGZyb21YLCB5ID0gZnJvbVk7IHggIT09IHhMaW1pdDsgeCArPSB4c3RlcCkgewoJICAgICAgICAgICAgdmFyIHJlYWxYID0gc3RlZXAgPyB5IDogeDsKCSAgICAgICAgICAgIHZhciByZWFsWSA9IHN0ZWVwID8geCA6IHk7CgkgICAgICAgICAgICAvLyBEb2VzIGN1cnJlbnQgcGl4ZWwgbWVhbiB3ZSBoYXZlIG1vdmVkIHdoaXRlIHRvIGJsYWNrIG9yIHZpY2UgdmVyc2E/CgkgICAgICAgICAgICAvLyBTY2FubmluZyBibGFjayBpbiBzdGF0ZSAwLDIgYW5kIHdoaXRlIGluIHN0YXRlIDEsIHNvIGlmIHdlIGZpbmQgdGhlIHdyb25nCgkgICAgICAgICAgICAvLyBjb2xvciwgYWR2YW5jZSB0byBuZXh0IHN0YXRlIG9yIGVuZCBpZiB3ZSBhcmUgaW4gc3RhdGUgMiBhbHJlYWR5CgkgICAgICAgICAgICBpZiAoKHN0YXRlID09PSAxKSA9PT0gdGhpcy5pbWFnZS5nZXQocmVhbFgsIHJlYWxZKSkgewoJICAgICAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gMikgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWF0aFV0aWxzXzEuZGVmYXVsdC5kaXN0YW5jZSh4LCB5LCBmcm9tWCwgZnJvbVkpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBzdGF0ZSsrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZXJyb3IgKz0gZHk7CgkgICAgICAgICAgICBpZiAoZXJyb3IgPiAwKSB7CgkgICAgICAgICAgICAgICAgaWYgKHkgPT09IHRvWSkgewoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgeSArPSB5c3RlcDsKCSAgICAgICAgICAgICAgICBlcnJvciAtPSBkeDsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICAvLyBGb3VuZCBibGFjay13aGl0ZS1ibGFjazsgZ2l2ZSB0aGUgYmVuZWZpdCBvZiB0aGUgZG91YnQgdGhhdCB0aGUgbmV4dCBwaXhlbCBvdXRzaWRlIHRoZSBpbWFnZQoJICAgICAgICAvLyBpcyAid2hpdGUiIHNvIHRoaXMgbGFzdCBwb2ludCBhdCAodG9YK3hTdGVwLHRvWSkgaXMgdGhlIHJpZ2h0IGVuZGluZy4gVGhpcyBpcyByZWFsbHkgYQoJICAgICAgICAvLyBzbWFsbCBhcHByb3hpbWF0aW9uOyAodG9YK3hTdGVwLHRvWSt5U3RlcCkgbWlnaHQgYmUgcmVhbGx5IGNvcnJlY3QuIElnbm9yZSB0aGlzLgoJICAgICAgICBpZiAoc3RhdGUgPT09IDIpIHsKCSAgICAgICAgICAgIHJldHVybiBNYXRoVXRpbHNfMS5kZWZhdWx0LmRpc3RhbmNlKHRvWCArIHhzdGVwLCB0b1ksIGZyb21YLCBmcm9tWSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gZWxzZSB3ZSBkaWRuJ3QgZmluZCBldmVuIGJsYWNrLXdoaXRlLWJsYWNrOyBubyBlc3RpbWF0ZSBpcyByZWFsbHkgcG9zc2libGUKCSAgICAgICAgcmV0dXJuIE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkF0dGVtcHRzIHRvIGxvY2F0ZSBhbiBhbGlnbm1lbnQgcGF0dGVybiBpbiBhIGxpbWl0ZWQgcmVnaW9uIG9mIHRoZSBpbWFnZSwgd2hpY2ggaXMKCSAgICAgKiBndWVzc2VkIHRvIGNvbnRhaW4gaXQuIFRoaXMgbWV0aG9kIHVzZXMge0BsaW5rIEFsaWdubWVudFBhdHRlcm59LjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBvdmVyYWxsRXN0TW9kdWxlU2l6ZSBlc3RpbWF0ZWQgbW9kdWxlIHNpemUgc28gZmFyCgkgICAgICogQHBhcmFtIGVzdEFsaWdubWVudFggeCBjb29yZGluYXRlIG9mIGNlbnRlciBvZiBhcmVhIHByb2JhYmx5IGNvbnRhaW5pbmcgYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gZXN0QWxpZ25tZW50WSB5IGNvb3JkaW5hdGUgb2YgYWJvdmUKCSAgICAgKiBAcGFyYW0gYWxsb3dhbmNlRmFjdG9yIG51bWJlciBvZiBwaXhlbHMgaW4gYWxsIGRpcmVjdGlvbnMgdG8gc2VhcmNoIGZyb20gdGhlIGNlbnRlcgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEFsaWdubWVudFBhdHRlcm59IGlmIGZvdW5kLCBvciBudWxsIG90aGVyd2lzZQoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgYW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnMgZHVyaW5nIGRldGVjdGlvbgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5maW5kQWxpZ25tZW50SW5SZWdpb24gPSBmdW5jdGlvbiAob3ZlcmFsbEVzdE1vZHVsZVNpemUgLypmbG9hdCovLCBlc3RBbGlnbm1lbnRYIC8qaW50Ki8sIGVzdEFsaWdubWVudFkgLyppbnQqLywgYWxsb3dhbmNlRmFjdG9yIC8qZmxvYXQqLykgewoJICAgICAgICAvLyBMb29rIGZvciBhbiBhbGlnbm1lbnQgcGF0dGVybiAoMyBtb2R1bGVzIGluIHNpemUpIGFyb3VuZCB3aGVyZSBpdAoJICAgICAgICAvLyBzaG91bGQgYmUKCSAgICAgICAgdmFyIGFsbG93YW5jZSA9IC8qKGludCkgKi8gTWF0aC5mbG9vcihhbGxvd2FuY2VGYWN0b3IgKiBvdmVyYWxsRXN0TW9kdWxlU2l6ZSk7CgkgICAgICAgIHZhciBhbGlnbm1lbnRBcmVhTGVmdFggPSBNYXRoLm1heCgwLCBlc3RBbGlnbm1lbnRYIC0gYWxsb3dhbmNlKTsKCSAgICAgICAgdmFyIGFsaWdubWVudEFyZWFSaWdodFggPSBNYXRoLm1pbih0aGlzLmltYWdlLmdldFdpZHRoKCkgLSAxLCBlc3RBbGlnbm1lbnRYICsgYWxsb3dhbmNlKTsKCSAgICAgICAgaWYgKGFsaWdubWVudEFyZWFSaWdodFggLSBhbGlnbm1lbnRBcmVhTGVmdFggPCBvdmVyYWxsRXN0TW9kdWxlU2l6ZSAqIDMpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgnQWxpZ25tZW50IHRvcCBleGNlZWRzIGVzdGltYXRlZCBtb2R1bGUgc2l6ZS4nKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYWxpZ25tZW50QXJlYVRvcFkgPSBNYXRoLm1heCgwLCBlc3RBbGlnbm1lbnRZIC0gYWxsb3dhbmNlKTsKCSAgICAgICAgdmFyIGFsaWdubWVudEFyZWFCb3R0b21ZID0gTWF0aC5taW4odGhpcy5pbWFnZS5nZXRIZWlnaHQoKSAtIDEsIGVzdEFsaWdubWVudFkgKyBhbGxvd2FuY2UpOwoJICAgICAgICBpZiAoYWxpZ25tZW50QXJlYUJvdHRvbVkgLSBhbGlnbm1lbnRBcmVhVG9wWSA8IG92ZXJhbGxFc3RNb2R1bGVTaXplICogMykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkMS5kZWZhdWx0KCdBbGlnbm1lbnQgYm90dG9tIGV4Y2VlZHMgZXN0aW1hdGVkIG1vZHVsZSBzaXplLicpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBhbGlnbm1lbnRGaW5kZXIgPSBuZXcgQWxpZ25tZW50UGF0dGVybkZpbmRlcl8xLmRlZmF1bHQodGhpcy5pbWFnZSwgYWxpZ25tZW50QXJlYUxlZnRYLCBhbGlnbm1lbnRBcmVhVG9wWSwgYWxpZ25tZW50QXJlYVJpZ2h0WCAtIGFsaWdubWVudEFyZWFMZWZ0WCwgYWxpZ25tZW50QXJlYUJvdHRvbVkgLSBhbGlnbm1lbnRBcmVhVG9wWSwgb3ZlcmFsbEVzdE1vZHVsZVNpemUsIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayk7CgkgICAgICAgIHJldHVybiBhbGlnbm1lbnRGaW5kZXIuZmluZCgpOwoJICAgIH07CgkgICAgcmV0dXJuIERldGVjdG9yOwoJfSgpKTsKCURldGVjdG9yJDEuZGVmYXVsdCA9IERldGVjdG9yOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoUVJDb2RlUmVhZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcucXJjb2RlIHsqLwoJdmFyIEJhcmNvZGVGb3JtYXRfMSA9IEJhcmNvZGVGb3JtYXQkMTsKCXZhciBCaXRNYXRyaXhfMSA9IEJpdE1hdHJpeCQxOwoJdmFyIERlY29kZUhpbnRUeXBlXzEgPSBEZWNvZGVIaW50VHlwZSQxOwoJdmFyIE5vdEZvdW5kRXhjZXB0aW9uXzEgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJdmFyIFJlc3VsdF8xID0gUmVzdWx0JDE7Cgl2YXIgUmVzdWx0TWV0YWRhdGFUeXBlXzEgPSBSZXN1bHRNZXRhZGF0YVR5cGUkMTsKCS8vIGltcG9ydCBEZXRlY3RvclJlc3VsdCBmcm9tICcuLi9jb21tb24vRGV0ZWN0b3JSZXN1bHQnOwoJdmFyIERlY29kZXJfMSA9IERlY29kZXIkMTsKCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSA9IFFSQ29kZURlY29kZXJNZXRhRGF0YSQxOwoJdmFyIERldGVjdG9yXzEgPSBEZXRlY3RvciQxOwoJLyppbXBvcnQgamF2YS51dGlsLkxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5NYXA7Ki8KCS8qKgoJICogVGhpcyBpbXBsZW1lbnRhdGlvbiBjYW4gZGV0ZWN0IGFuZCBkZWNvZGUgUVIgQ29kZXMgaW4gYW4gaW1hZ2UuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFFSQ29kZVJlYWRlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBRUkNvZGVSZWFkZXIoKSB7CgkgICAgICAgIHRoaXMuZGVjb2RlciA9IG5ldyBEZWNvZGVyXzEuZGVmYXVsdCgpOwoJICAgIH0KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLmdldERlY29kZXIgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlY29kZXI7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBMb2NhdGVzIGFuZCBkZWNvZGVzIGEgUVIgY29kZSBpbiBhbiBpbWFnZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gYSByZXByZXNlbnRpbmc6IHN0cmluZyB0aGUgY29udGVudCBlbmNvZGVkIGJ5IHRoZSBRUiBjb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBhIFFSIGNvZGUgY2Fubm90IGJlIGZvdW5kCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgYSBRUiBjb2RlIGNhbm5vdCBiZSBkZWNvZGVkCgkgICAgICogQHRocm93cyBDaGVja3N1bUV4Y2VwdGlvbiBpZiBlcnJvciBjb3JyZWN0aW9uIGZhaWxzCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIC8vIHB1YmxpYyBkZWNvZGUoaW1hZ2U6IEJpbmFyeUJpdG1hcCk6IFJlc3VsdCAvKnRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiwgQ2hlY2tzdW1FeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiAqLyB7CgkgICAgLy8gICByZXR1cm4gdGhpcy5kZWNvZGUoaW1hZ2UsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLmRlY29kZSA9IGZ1bmN0aW9uIChpbWFnZSwgaGludHMpIHsKCSAgICAgICAgdmFyIGRlY29kZXJSZXN1bHQ7CgkgICAgICAgIHZhciBwb2ludHM7CgkgICAgICAgIGlmIChoaW50cyAhPT0gdW5kZWZpbmVkICYmIGhpbnRzICE9PSBudWxsICYmIHVuZGVmaW5lZCAhPT0gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEuZGVmYXVsdC5QVVJFX0JBUkNPREUpKSB7CgkgICAgICAgICAgICB2YXIgYml0cyA9IFFSQ29kZVJlYWRlci5leHRyYWN0UHVyZUJpdHMoaW1hZ2UuZ2V0QmxhY2tNYXRyaXgoKSk7CgkgICAgICAgICAgICBkZWNvZGVyUmVzdWx0ID0gdGhpcy5kZWNvZGVyLmRlY29kZUJpdE1hdHJpeChiaXRzLCBoaW50cyk7CgkgICAgICAgICAgICBwb2ludHMgPSBRUkNvZGVSZWFkZXIuTk9fUE9JTlRTOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdmFyIGRldGVjdG9yUmVzdWx0ID0gbmV3IERldGVjdG9yXzEuZGVmYXVsdChpbWFnZS5nZXRCbGFja01hdHJpeCgpKS5kZXRlY3QoaGludHMpOwoJICAgICAgICAgICAgZGVjb2RlclJlc3VsdCA9IHRoaXMuZGVjb2Rlci5kZWNvZGVCaXRNYXRyaXgoZGV0ZWN0b3JSZXN1bHQuZ2V0Qml0cygpLCBoaW50cyk7CgkgICAgICAgICAgICBwb2ludHMgPSBkZXRlY3RvclJlc3VsdC5nZXRQb2ludHMoKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBJZiB0aGUgY29kZSB3YXMgbWlycm9yZWQ6IHN3YXAgdGhlIGJvdHRvbS1sZWZ0IGFuZCB0aGUgdG9wLXJpZ2h0IHBvaW50cy4KCSAgICAgICAgaWYgKGRlY29kZXJSZXN1bHQuZ2V0T3RoZXIoKSBpbnN0YW5jZW9mIFFSQ29kZURlY29kZXJNZXRhRGF0YV8xLmRlZmF1bHQpIHsKCSAgICAgICAgICAgIGRlY29kZXJSZXN1bHQuZ2V0T3RoZXIoKS5hcHBseU1pcnJvcmVkQ29ycmVjdGlvbihwb2ludHMpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSBuZXcgUmVzdWx0XzEuZGVmYXVsdChkZWNvZGVyUmVzdWx0LmdldFRleHQoKSwgZGVjb2RlclJlc3VsdC5nZXRSYXdCeXRlcygpLCB1bmRlZmluZWQsIHBvaW50cywgQmFyY29kZUZvcm1hdF8xLmRlZmF1bHQuUVJfQ09ERSwgdW5kZWZpbmVkKTsKCSAgICAgICAgdmFyIGJ5dGVTZWdtZW50cyA9IGRlY29kZXJSZXN1bHQuZ2V0Qnl0ZVNlZ21lbnRzKCk7CgkgICAgICAgIGlmIChieXRlU2VnbWVudHMgIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJlc3VsdC5wdXRNZXRhZGF0YShSZXN1bHRNZXRhZGF0YVR5cGVfMS5kZWZhdWx0LkJZVEVfU0VHTUVOVFMsIGJ5dGVTZWdtZW50cyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGVjTGV2ZWwgPSBkZWNvZGVyUmVzdWx0LmdldEVDTGV2ZWwoKTsKCSAgICAgICAgaWYgKGVjTGV2ZWwgIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJlc3VsdC5wdXRNZXRhZGF0YShSZXN1bHRNZXRhZGF0YVR5cGVfMS5kZWZhdWx0LkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwsIGVjTGV2ZWwpOwoJICAgICAgICB9CgkgICAgICAgIGlmIChkZWNvZGVyUmVzdWx0Lmhhc1N0cnVjdHVyZWRBcHBlbmQoKSkgewoJICAgICAgICAgICAgcmVzdWx0LnB1dE1ldGFkYXRhKFJlc3VsdE1ldGFkYXRhVHlwZV8xLmRlZmF1bHQuU1RSVUNUVVJFRF9BUFBFTkRfU0VRVUVOQ0UsIGRlY29kZXJSZXN1bHQuZ2V0U3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyKCkpOwoJICAgICAgICAgICAgcmVzdWx0LnB1dE1ldGFkYXRhKFJlc3VsdE1ldGFkYXRhVHlwZV8xLmRlZmF1bHQuU1RSVUNUVVJFRF9BUFBFTkRfUEFSSVRZLCBkZWNvZGVyUmVzdWx0LmdldFN0cnVjdHVyZWRBcHBlbmRQYXJpdHkoKSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBkbyBub3RoaW5nCgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBUaGlzIG1ldGhvZCBkZXRlY3RzIGEgY29kZSBpbiBhICJwdXJlIiBpbWFnZSAtLSB0aGF0IGlzLCBwdXJlIG1vbm9jaHJvbWUgaW1hZ2UKCSAgICAgKiB3aGljaCBjb250YWlucyBvbmx5IGFuIHVucm90YXRlZCwgdW5za2V3ZWQsIGltYWdlIG9mIGEgY29kZSwgd2l0aCBzb21lIHdoaXRlIGJvcmRlcgoJICAgICAqIGFyb3VuZCBpdC4gVGhpcyBpcyBhIHNwZWNpYWxpemVkIG1ldGhvZCB0aGF0IHdvcmtzIGV4Y2VwdGlvbmFsbHkgZmFzdCBpbiB0aGlzIHNwZWNpYWwKCSAgICAgKiBjYXNlLgoJICAgICAqCgkgICAgICogQHNlZSBjb20uZ29vZ2xlLnp4aW5nLmRhdGFtYXRyaXguRGF0YU1hdHJpeFJlYWRlciNleHRyYWN0UHVyZUJpdHMoQml0TWF0cml4KQoJICAgICAqLwoJICAgIFFSQ29kZVJlYWRlci5leHRyYWN0UHVyZUJpdHMgPSBmdW5jdGlvbiAoaW1hZ2UpIHsKCSAgICAgICAgdmFyIGxlZnRUb3BCbGFjayA9IGltYWdlLmdldFRvcExlZnRPbkJpdCgpOwoJICAgICAgICB2YXIgcmlnaHRCb3R0b21CbGFjayA9IGltYWdlLmdldEJvdHRvbVJpZ2h0T25CaXQoKTsKCSAgICAgICAgaWYgKGxlZnRUb3BCbGFjayA9PT0gbnVsbCB8fCByaWdodEJvdHRvbUJsYWNrID09PSBudWxsKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG1vZHVsZVNpemUgPSB0aGlzLm1vZHVsZVNpemUobGVmdFRvcEJsYWNrLCBpbWFnZSk7CgkgICAgICAgIHZhciB0b3AgPSBsZWZ0VG9wQmxhY2tbMV07CgkgICAgICAgIHZhciBib3R0b20gPSByaWdodEJvdHRvbUJsYWNrWzFdOwoJICAgICAgICB2YXIgbGVmdCA9IGxlZnRUb3BCbGFja1swXTsKCSAgICAgICAgdmFyIHJpZ2h0ID0gcmlnaHRCb3R0b21CbGFja1swXTsKCSAgICAgICAgLy8gU2FuaXR5IGNoZWNrIQoJICAgICAgICBpZiAobGVmdCA+PSByaWdodCB8fCB0b3AgPj0gYm90dG9tKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGJvdHRvbSAtIHRvcCAhPT0gcmlnaHQgLSBsZWZ0KSB7CgkgICAgICAgICAgICAvLyBTcGVjaWFsIGNhc2UsIHdoZXJlIGJvdHRvbS1yaWdodCBtb2R1bGUgd2Fzbid0IGJsYWNrIHNvIHdlIGZvdW5kIHNvbWV0aGluZyBlbHNlIGluIHRoZSBsYXN0IHJvdwoJICAgICAgICAgICAgLy8gQXNzdW1lIGl0J3MgYSBzcXVhcmUsIHNvIHVzZSBoZWlnaHQgYXMgdGhlIHdpZHRoCgkgICAgICAgICAgICByaWdodCA9IGxlZnQgKyAoYm90dG9tIC0gdG9wKTsKCSAgICAgICAgICAgIGlmIChyaWdodCA+PSBpbWFnZS5nZXRXaWR0aCgpKSB7CgkgICAgICAgICAgICAgICAgLy8gQWJvcnQgaWYgdGhhdCB3b3VsZCBub3QgbWFrZSBzZW5zZSAtLSBvZmYgaW1hZ2UKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG1hdHJpeFdpZHRoID0gTWF0aC5yb3VuZCgocmlnaHQgLSBsZWZ0ICsgMSkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIG1hdHJpeEhlaWdodCA9IE1hdGgucm91bmQoKGJvdHRvbSAtIHRvcCArIDEpIC8gbW9kdWxlU2l6ZSk7CgkgICAgICAgIGlmIChtYXRyaXhXaWR0aCA8PSAwIHx8IG1hdHJpeEhlaWdodCA8PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKG1hdHJpeEhlaWdodCAhPT0gbWF0cml4V2lkdGgpIHsKCSAgICAgICAgICAgIC8vIE9ubHkgcG9zc2libHkgZGVjb2RlIHNxdWFyZSByZWdpb25zCgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gUHVzaCBpbiB0aGUgImJvcmRlciIgYnkgaGFsZiB0aGUgbW9kdWxlIHdpZHRoIHNvIHRoYXQgd2Ugc3RhcnQKCSAgICAgICAgLy8gc2FtcGxpbmcgaW4gdGhlIG1pZGRsZSBvZiB0aGUgbW9kdWxlLiBKdXN0IGluIGNhc2UgdGhlIGltYWdlIGlzIGEKCSAgICAgICAgLy8gbGl0dGxlIG9mZiwgdGhpcyB3aWxsIGhlbHAgcmVjb3Zlci4KCSAgICAgICAgdmFyIG51ZGdlID0gLyooaW50KSAqLyBNYXRoLmZsb29yKG1vZHVsZVNpemUgLyAyLjApOwoJICAgICAgICB0b3AgKz0gbnVkZ2U7CgkgICAgICAgIGxlZnQgKz0gbnVkZ2U7CgkgICAgICAgIC8vIEJ1dCBjYXJlZnVsIHRoYXQgdGhpcyBkb2VzIG5vdCBzYW1wbGUgb2ZmIHRoZSBlZGdlCgkgICAgICAgIC8vICJyaWdodCIgaXMgdGhlIGZhcnRoZXN0LXJpZ2h0IHZhbGlkIHBpeGVsIGxvY2F0aW9uIC0tIHJpZ2h0KzEgaXMgbm90IG5lY2Vzc2FyaWx5CgkgICAgICAgIC8vIFRoaXMgaXMgcG9zaXRpdmUgYnkgaG93IG11Y2ggdGhlIGlubmVyIHggbG9vcCBiZWxvdyB3b3VsZCBiZSB0b28gbGFyZ2UKCSAgICAgICAgdmFyIG51ZGdlZFRvb0ZhclJpZ2h0ID0gbGVmdCArIC8qKGludCkgKi8gTWF0aC5mbG9vcigobWF0cml4V2lkdGggLSAxKSAqIG1vZHVsZVNpemUpIC0gcmlnaHQ7CgkgICAgICAgIGlmIChudWRnZWRUb29GYXJSaWdodCA+IDApIHsKCSAgICAgICAgICAgIGlmIChudWRnZWRUb29GYXJSaWdodCA+IG51ZGdlKSB7CgkgICAgICAgICAgICAgICAgLy8gTmVpdGhlciB3YXkgZml0czsgYWJvcnQKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBsZWZ0IC09IG51ZGdlZFRvb0ZhclJpZ2h0OwoJICAgICAgICB9CgkgICAgICAgIC8vIFNlZSBsb2dpYyBhYm92ZQoJICAgICAgICB2YXIgbnVkZ2VkVG9vRmFyRG93biA9IHRvcCArIC8qKGludCkgKi8gTWF0aC5mbG9vcigobWF0cml4SGVpZ2h0IC0gMSkgKiBtb2R1bGVTaXplKSAtIGJvdHRvbTsKCSAgICAgICAgaWYgKG51ZGdlZFRvb0ZhckRvd24gPiAwKSB7CgkgICAgICAgICAgICBpZiAobnVkZ2VkVG9vRmFyRG93biA+IG51ZGdlKSB7CgkgICAgICAgICAgICAgICAgLy8gTmVpdGhlciB3YXkgZml0czsgYWJvcnQKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0b3AgLT0gbnVkZ2VkVG9vRmFyRG93bjsKCSAgICAgICAgfQoJICAgICAgICAvLyBOb3cganVzdCByZWFkIG9mZiB0aGUgYml0cwoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRNYXRyaXhfMS5kZWZhdWx0KG1hdHJpeFdpZHRoLCBtYXRyaXhIZWlnaHQpOwoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IG1hdHJpeEhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgaU9mZnNldCA9IHRvcCArIC8qKGludCkgKi8gTWF0aC5mbG9vcih5ICogbW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG1hdHJpeFdpZHRoOyB4KyspIHsKCSAgICAgICAgICAgICAgICBpZiAoaW1hZ2UuZ2V0KGxlZnQgKyAvKihpbnQpICovIE1hdGguZmxvb3IoeCAqIG1vZHVsZVNpemUpLCBpT2Zmc2V0KSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLnNldCh4LCB5KTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICBRUkNvZGVSZWFkZXIubW9kdWxlU2l6ZSA9IGZ1bmN0aW9uIChsZWZ0VG9wQmxhY2ssIGltYWdlKSB7CgkgICAgICAgIHZhciBoZWlnaHQgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHdpZHRoID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIHggPSBsZWZ0VG9wQmxhY2tbMF07CgkgICAgICAgIHZhciB5ID0gbGVmdFRvcEJsYWNrWzFdOwoJICAgICAgICB2YXIgaW5CbGFjayA9IHRydWU7CgkgICAgICAgIHZhciB0cmFuc2l0aW9ucyA9IDA7CgkgICAgICAgIHdoaWxlICh4IDwgd2lkdGggJiYgeSA8IGhlaWdodCkgewoJICAgICAgICAgICAgaWYgKGluQmxhY2sgIT09IGltYWdlLmdldCh4LCB5KSkgewoJICAgICAgICAgICAgICAgIGlmICgrK3RyYW5zaXRpb25zID09PSA1KSB7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBpbkJsYWNrID0gIWluQmxhY2s7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB4Kys7CgkgICAgICAgICAgICB5Kys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHggPT09IHdpZHRoIHx8IHkgPT09IGhlaWdodCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiAoeCAtIGxlZnRUb3BCbGFja1swXSkgLyA3LjA7CgkgICAgfTsKCSAgICBRUkNvZGVSZWFkZXIuTk9fUE9JTlRTID0gbmV3IEFycmF5KCk7CgkgICAgcmV0dXJuIFFSQ29kZVJlYWRlcjsKCX0oKSk7Cgl2YXIgX2RlZmF1bHQgPSBRUkNvZGVSZWFkZXIkMS5kZWZhdWx0ID0gUVJDb2RlUmVhZGVyOwoKCXZhciB0b0dyYXlzY2FsZUJ1ZmZlciA9IGZ1bmN0aW9uIHRvR3JheXNjYWxlQnVmZmVyKGltYWdlQnVmZmVyLCB3aWR0aCwgaGVpZ2h0KSB7CgkgIHZhciBncmF5c2NhbGVCdWZmZXIgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkod2lkdGggKiBoZWlnaHQpOwoKCSAgZm9yICh2YXIgaSA9IDAsIGogPSAwLCBsZW5ndGhfMSA9IGltYWdlQnVmZmVyLmxlbmd0aDsgaSA8IGxlbmd0aF8xOyBpICs9IDQsIGorKykgewoJICAgIHZhciBncmF5ID0gdm9pZCAwOwoJICAgIHZhciBhbHBoYSA9IGltYWdlQnVmZmVyW2kgKyAzXTsgLy8gVGhlIGNvbG9yIG9mIGZ1bGx5LXRyYW5zcGFyZW50IHBpeGVscyBpcyBpcnJlbGV2YW50LiBUaGV5IGFyZSBvZnRlbiwgdGVjaG5pY2FsbHksIGZ1bGx5LXRyYW5zcGFyZW50CgkgICAgLy8gYmxhY2sgKDAgYWxwaGEsIGFuZCB0aGVuIDAgUkdCKS4gVGhleSBhcmUgb2Z0ZW4gdXNlZCwgb2YgY291cnNlIGFzIHRoZSAid2hpdGUiIGFyZWEgaW4gYQoJICAgIC8vIGJhcmNvZGUgaW1hZ2UuIEZvcmNlIGFueSBzdWNoIHBpeGVsIHRvIGJlIHdoaXRlOgoKCSAgICBpZiAoYWxwaGEgPT09IDApIHsKCSAgICAgIGdyYXkgPSAweEZGOwoJICAgIH0gZWxzZSB7CgkgICAgICB2YXIgcGl4ZWxSID0gaW1hZ2VCdWZmZXJbaV07CgkgICAgICB2YXIgcGl4ZWxHID0gaW1hZ2VCdWZmZXJbaSArIDFdOwoJICAgICAgdmFyIHBpeGVsQiA9IGltYWdlQnVmZmVyW2kgKyAyXTsgLy8gLjI5OVIgKyAwLjU4N0cgKyAwLjExNEIgKFlVVi9ZSVEgZm9yIFBBTCBhbmQgTlRTQyksCgkgICAgICAvLyAoMzA2KlIpID4+IDEwIGlzIGFwcHJveGltYXRlbHkgZXF1YWwgdG8gUiowLjI5OSwgYW5kIHNvIG9uLgoJICAgICAgLy8gMHgyMDAgPj4gMTAgaXMgMC41LCBpdCBpbXBsZW1lbnRzIHJvdW5kaW5nLgoKCSAgICAgIGdyYXkgPSAzMDYgKiBwaXhlbFIgKyA2MDEgKiBwaXhlbEcgKyAxMTcgKiBwaXhlbEIgKyAweDIwMCA+PiAxMDsKCSAgICB9CgoJICAgIGdyYXlzY2FsZUJ1ZmZlcltqXSA9IGdyYXk7CgkgIH0KCgkgIHJldHVybiBncmF5c2NhbGVCdWZmZXI7Cgl9OwoKCXZhciByZWFkZXIgPSBuZXcgX2RlZmF1bHQoKTsKCXNlbGYuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIChlKSB7CgkgIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzCgkgIHRyeSB7CgkgICAgdmFyIGx1bWluYW5jZXMgPSB0b0dyYXlzY2FsZUJ1ZmZlcihlLmRhdGEuZGF0YSwgZS5kYXRhLndpZHRoLCBlLmRhdGEuaGVpZ2h0KTsKCSAgICB2YXIgbHVtaW5hbmNlU291cmNlID0gbmV3IF9kZWZhdWx0JDEobHVtaW5hbmNlcywgZS5kYXRhLndpZHRoLCBlLmRhdGEuaGVpZ2h0KTsKCSAgICB2YXIgaHlicmlkQmluYXJpemVyID0gbmV3IF9kZWZhdWx0JDIobHVtaW5hbmNlU291cmNlKTsKCSAgICB2YXIgYmluYXJ5Qml0bWFwID0gbmV3IF9kZWZhdWx0JDMoaHlicmlkQmluYXJpemVyKTsKCSAgICB2YXIgZGVjb2RlZCA9IHJlYWRlci5kZWNvZGUoYmluYXJ5Qml0bWFwKTsKCSAgICBwb3N0TWVzc2FnZShkZWNvZGVkKTsKCSAgfSBjYXRjaCAoZXJyKSB7CgkgICAgcG9zdE1lc3NhZ2UobnVsbCk7CgkgIH0KCX0pOwoKfSkoKTsKCg==",null,!1),j=["constraints","onError","onLoad","onScan","resolution","qrArea"];function P(g,t){var e=Object.keys(g);if(Object.getOwnPropertySymbols){var I=Object.getOwnPropertySymbols(g);t&&(I=I.filter((function(t){return Object.getOwnPropertyDescriptor(g,t).enumerable}))),e.push.apply(e,I)}return e}function O(g){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?P(Object(e),!0).forEach((function(t){n(g,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(e)):P(Object(e)).forEach((function(t){Object.defineProperty(g,t,Object.getOwnPropertyDescriptor(e,t))}))}return g}var q=function(){return new _},$=function(g){g&&(g.getVideoTracks&&g.getAudioTracks?(g.getVideoTracks().forEach((function(t){g.removeTrack(t),t.stop()})),g.getAudioTracks().forEach((function(t){g.removeTrack(t),t.stop()}))):g.stop())},gg=function(g){var t=g.constraints,n=g.onError,C=g.onLoad,i=g.onScan,l=g.resolution,o=g.qrArea,s=c(g,j),r=e.useRef(null),A=e.useRef(null),d=e.useRef(document.createElement("canvas")),u=e.useRef(null),h=e.useRef(),m=a(e.useState(null),2),Z=m[0],b=m[1],G=e.useRef(!1),p=e.useRef();e.useEffect((function(){p.current=q();var g=p.current;return g.onmessage=function(g){i&&i(g.data?O(O({},g.data),{},{canvas:d.current}):null),G.current=!1},function(){g.terminate()}}),[i]);var y=JSON.stringify(o),B=e.useCallback((function(){var g=JSON.parse(y),t=p.current,e=A.current&&A.current.readyState===A.current.HAVE_ENOUGH_DATA;if(!G.current&&e){G.current=!0;var I,n=A.current.videoWidth,C=A.current.videoHeight,i=n>C?n:C,o=Math.floor(l/i*100)/100;C=Math.floor(o*C),n=Math.floor(o*n),d.current.width=n,d.current.height=C,u.current=d.current.getContext("2d"),u.current.drawImage(A.current,0,0,n,C),I=g&&2===g.length&&g[0]>0&&g[1]>0?u.current.getImageData(Math.floor((n-g[0])/2),Math.floor((C-g[1])/2),g[0],g[1]):u.current.getImageData(0,0,n,C),t.postMessage(I)}h.current=requestAnimationFrame(B)}),[l,y]),V=JSON.stringify(t);return e.useEffect((function(){var g=JSON.parse(V),t=!0;return navigator.mediaDevices.getUserMedia(g).then((function(g){if(t){r.current=g;try{A.current&&(A.current.srcObject=g,A.current.setAttribute("playsinline",!0))}catch(e){b(window.URL.createObjectURL(g))}C&&C(),h.current=requestAnimationFrame(B)}else $(g)})).catch((function(g){return t?n(g):null})),function(){cancelAnimationFrame(h.current),t=!1,$(r.current),Z&&window.URL.revokeObjectURL(Z)}}),[B,V,n,C,Z]),e.createElement("video",I({autoPlay:!0,playsInline:!0,src:Z,ref:A},s))};return gg.propTypes={constraints:U.object,onError:U.func.isRequired,onLoad:U.func,onScan:U.func.isRequired,resolution:U.number,qrArea:U.array},gg.defaultProps={constraints:{audio:!1,video:!0},resolution:640,qrArea:[]},gg}(e(43))},153:(g,t,e)=>{"use strict";var I=e(43),n=Symbol.for("react.element"),C=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,l=I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function s(g,t,e){var I,C={},s=null,a=null;for(I in void 0!==e&&(s=""+e),void 0!==t.key&&(s=""+t.key),void 0!==t.ref&&(a=t.ref),t)i.call(t,I)&&!o.hasOwnProperty(I)&&(C[I]=t[I]);if(g&&g.defaultProps)for(I in t=g.defaultProps)void 0===C[I]&&(C[I]=t[I]);return{$$typeof:n,type:g,key:s,ref:a,props:C,_owner:l.current}}t.Fragment=C,t.jsx=s,t.jsxs=s},202:(g,t)=>{"use strict";var e=Symbol.for("react.element"),I=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),o=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),a=Symbol.for("react.suspense"),r=Symbol.for("react.memo"),c=Symbol.for("react.lazy"),A=Symbol.iterator;var d={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},u=Object.assign,h={};function m(g,t,e){this.props=g,this.context=t,this.refs=h,this.updater=e||d}function Z(){}function b(g,t,e){this.props=g,this.context=t,this.refs=h,this.updater=e||d}m.prototype.isReactComponent={},m.prototype.setState=function(g,t){if("object"!==typeof g&&"function"!==typeof g&&null!=g)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,g,t,"setState")},m.prototype.forceUpdate=function(g){this.updater.enqueueForceUpdate(this,g,"forceUpdate")},Z.prototype=m.prototype;var G=b.prototype=new Z;G.constructor=b,u(G,m.prototype),G.isPureReactComponent=!0;var p=Array.isArray,y=Object.prototype.hasOwnProperty,B={current:null},V={key:!0,ref:!0,__self:!0,__source:!0};function W(g,t,I){var n,C={},i=null,l=null;if(null!=t)for(n in void 0!==t.ref&&(l=t.ref),void 0!==t.key&&(i=""+t.key),t)y.call(t,n)&&!V.hasOwnProperty(n)&&(C[n]=t[n]);var o=arguments.length-2;if(1===o)C.children=I;else if(1<o){for(var s=Array(o),a=0;a<o;a++)s[a]=arguments[a+2];C.children=s}if(g&&g.defaultProps)for(n in o=g.defaultProps)void 0===C[n]&&(C[n]=o[n]);return{$$typeof:e,type:g,key:i,ref:l,props:C,_owner:B.current}}function S(g){return"object"===typeof g&&null!==g&&g.$$typeof===e}var R=/\/+/g;function f(g,t){return"object"===typeof g&&null!==g&&null!=g.key?function(g){var t={"=":"=0",":":"=2"};return"$"+g.replace(/[=:]/g,(function(g){return t[g]}))}(""+g.key):t.toString(36)}function X(g,t,n,C,i){var l=typeof g;"undefined"!==l&&"boolean"!==l||(g=null);var o=!1;if(null===g)o=!0;else switch(l){case"string":case"number":o=!0;break;case"object":switch(g.$$typeof){case e:case I:o=!0}}if(o)return i=i(o=g),g=""===C?"."+f(o,0):C,p(i)?(n="",null!=g&&(n=g.replace(R,"$&/")+"/"),X(i,t,n,"",(function(g){return g}))):null!=i&&(S(i)&&(i=function(g,t){return{$$typeof:e,type:g.type,key:t,ref:g.ref,props:g.props,_owner:g._owner}}(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(R,"$&/")+"/")+g)),t.push(i)),1;if(o=0,C=""===C?".":C+":",p(g))for(var s=0;s<g.length;s++){var a=C+f(l=g[s],s);o+=X(l,t,n,a,i)}else if(a=function(g){return null===g||"object"!==typeof g?null:"function"===typeof(g=A&&g[A]||g["@@iterator"])?g:null}(g),"function"===typeof a)for(g=a.call(g),s=0;!(l=g.next()).done;)o+=X(l=l.value,t,n,a=C+f(l,s++),i);else if("object"===l)throw t=String(g),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(g).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function J(g,t,e){if(null==g)return g;var I=[],n=0;return X(g,I,"","",(function(g){return t.call(e,g,n++)})),I}function v(g){if(-1===g._status){var t=g._result;(t=t()).then((function(t){0!==g._status&&-1!==g._status||(g._status=1,g._result=t)}),(function(t){0!==g._status&&-1!==g._status||(g._status=2,g._result=t)})),-1===g._status&&(g._status=0,g._result=t)}if(1===g._status)return g._result.default;throw g._result}var k={current:null},Y={transition:null},H={ReactCurrentDispatcher:k,ReactCurrentBatchConfig:Y,ReactCurrentOwner:B};function w(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:J,forEach:function(g,t,e){J(g,(function(){t.apply(this,arguments)}),e)},count:function(g){var t=0;return J(g,(function(){t++})),t},toArray:function(g){return J(g,(function(g){return g}))||[]},only:function(g){if(!S(g))throw Error("React.Children.only expected to receive a single React element child.");return g}},t.Component=m,t.Fragment=n,t.Profiler=i,t.PureComponent=b,t.StrictMode=C,t.Suspense=a,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=H,t.act=w,t.cloneElement=function(g,t,I){if(null===g||void 0===g)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+g+".");var n=u({},g.props),C=g.key,i=g.ref,l=g._owner;if(null!=t){if(void 0!==t.ref&&(i=t.ref,l=B.current),void 0!==t.key&&(C=""+t.key),g.type&&g.type.defaultProps)var o=g.type.defaultProps;for(s in t)y.call(t,s)&&!V.hasOwnProperty(s)&&(n[s]=void 0===t[s]&&void 0!==o?o[s]:t[s])}var s=arguments.length-2;if(1===s)n.children=I;else if(1<s){o=Array(s);for(var a=0;a<s;a++)o[a]=arguments[a+2];n.children=o}return{$$typeof:e,type:g.type,key:C,ref:i,props:n,_owner:l}},t.createContext=function(g){return(g={$$typeof:o,_currentValue:g,_currentValue2:g,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:l,_context:g},g.Consumer=g},t.createElement=W,t.createFactory=function(g){var t=W.bind(null,g);return t.type=g,t},t.createRef=function(){return{current:null}},t.forwardRef=function(g){return{$$typeof:s,render:g}},t.isValidElement=S,t.lazy=function(g){return{$$typeof:c,_payload:{_status:-1,_result:g},_init:v}},t.memo=function(g,t){return{$$typeof:r,type:g,compare:void 0===t?null:t}},t.startTransition=function(g){var t=Y.transition;Y.transition={};try{g()}finally{Y.transition=t}},t.unstable_act=w,t.useCallback=function(g,t){return k.current.useCallback(g,t)},t.useContext=function(g){return k.current.useContext(g)},t.useDebugValue=function(){},t.useDeferredValue=function(g){return k.current.useDeferredValue(g)},t.useEffect=function(g,t){return k.current.useEffect(g,t)},t.useId=function(){return k.current.useId()},t.useImperativeHandle=function(g,t,e){return k.current.useImperativeHandle(g,t,e)},t.useInsertionEffect=function(g,t){return k.current.useInsertionEffect(g,t)},t.useLayoutEffect=function(g,t){return k.current.useLayoutEffect(g,t)},t.useMemo=function(g,t){return k.current.useMemo(g,t)},t.useReducer=function(g,t,e){return k.current.useReducer(g,t,e)},t.useRef=function(g){return k.current.useRef(g)},t.useState=function(g){return k.current.useState(g)},t.useSyncExternalStore=function(g,t,e){return k.current.useSyncExternalStore(g,t,e)},t.useTransition=function(){return k.current.useTransition()},t.version="18.3.1"},43:(g,t,e)=>{"use strict";g.exports=e(202)},579:(g,t,e)=>{"use strict";g.exports=e(153)},234:(g,t)=>{"use strict";function e(g,t){var e=g.length;g.push(t);g:for(;0<e;){var I=e-1>>>1,n=g[I];if(!(0<C(n,t)))break g;g[I]=t,g[e]=n,e=I}}function I(g){return 0===g.length?null:g[0]}function n(g){if(0===g.length)return null;var t=g[0],e=g.pop();if(e!==t){g[0]=e;g:for(var I=0,n=g.length,i=n>>>1;I<i;){var l=2*(I+1)-1,o=g[l],s=l+1,a=g[s];if(0>C(o,e))s<n&&0>C(a,o)?(g[I]=a,g[s]=e,I=s):(g[I]=o,g[l]=e,I=l);else{if(!(s<n&&0>C(a,e)))break g;g[I]=a,g[s]=e,I=s}}}return t}function C(g,t){var e=g.sortIndex-t.sortIndex;return 0!==e?e:g.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var i=performance;t.unstable_now=function(){return i.now()}}else{var l=Date,o=l.now();t.unstable_now=function(){return l.now()-o}}var s=[],a=[],r=1,c=null,A=3,d=!1,u=!1,h=!1,m="function"===typeof setTimeout?setTimeout:null,Z="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function G(g){for(var t=I(a);null!==t;){if(null===t.callback)n(a);else{if(!(t.startTime<=g))break;n(a),t.sortIndex=t.expirationTime,e(s,t)}t=I(a)}}function p(g){if(h=!1,G(g),!u)if(null!==I(s))u=!0,Y(y);else{var t=I(a);null!==t&&H(p,t.startTime-g)}}function y(g,e){u=!1,h&&(h=!1,Z(S),S=-1),d=!0;var C=A;try{for(G(e),c=I(s);null!==c&&(!(c.expirationTime>e)||g&&!X());){var i=c.callback;if("function"===typeof i){c.callback=null,A=c.priorityLevel;var l=i(c.expirationTime<=e);e=t.unstable_now(),"function"===typeof l?c.callback=l:c===I(s)&&n(s),G(e)}else n(s);c=I(s)}if(null!==c)var o=!0;else{var r=I(a);null!==r&&H(p,r.startTime-e),o=!1}return o}finally{c=null,A=C,d=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var B,V=!1,W=null,S=-1,R=5,f=-1;function X(){return!(t.unstable_now()-f<R)}function J(){if(null!==W){var g=t.unstable_now();f=g;var e=!0;try{e=W(!0,g)}finally{e?B():(V=!1,W=null)}}else V=!1}if("function"===typeof b)B=function(){b(J)};else if("undefined"!==typeof MessageChannel){var v=new MessageChannel,k=v.port2;v.port1.onmessage=J,B=function(){k.postMessage(null)}}else B=function(){m(J,0)};function Y(g){W=g,V||(V=!0,B())}function H(g,e){S=m((function(){g(t.unstable_now())}),e)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(g){g.callback=null},t.unstable_continueExecution=function(){u||d||(u=!0,Y(y))},t.unstable_forceFrameRate=function(g){0>g||125<g?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<g?Math.floor(1e3/g):5},t.unstable_getCurrentPriorityLevel=function(){return A},t.unstable_getFirstCallbackNode=function(){return I(s)},t.unstable_next=function(g){switch(A){case 1:case 2:case 3:var t=3;break;default:t=A}var e=A;A=t;try{return g()}finally{A=e}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(g,t){switch(g){case 1:case 2:case 3:case 4:case 5:break;default:g=3}var e=A;A=g;try{return t()}finally{A=e}},t.unstable_scheduleCallback=function(g,n,C){var i=t.unstable_now();switch("object"===typeof C&&null!==C?C="number"===typeof(C=C.delay)&&0<C?i+C:i:C=i,g){case 1:var l=-1;break;case 2:l=250;break;case 5:l=1073741823;break;case 4:l=1e4;break;default:l=5e3}return g={id:r++,callback:n,priorityLevel:g,startTime:C,expirationTime:l=C+l,sortIndex:-1},C>i?(g.sortIndex=C,e(a,g),null===I(s)&&g===I(a)&&(h?(Z(S),S=-1):h=!0,H(p,C-i))):(g.sortIndex=l,e(s,g),u||d||(u=!0,Y(y))),g},t.unstable_shouldYield=X,t.unstable_wrapCallback=function(g){var t=A;return function(){var e=A;A=t;try{return g.apply(this,arguments)}finally{A=e}}}},853:(g,t,e)=>{"use strict";g.exports=e(234)},249:g=>{"use strict";g.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAABSCAMAAAAhFXfZAAAC91BMVEVMaXEzeak2f7I4g7g3g7cua5gzeKg8hJo3grY4g7c3grU0gLI2frE0daAubJc2gbQwd6QzeKk2gLMtd5sxdKIua5g1frA2f7IydaM0e6w2fq41fK01eqo3grgubJgta5cxdKI1f7AydaQydaMxc6EubJgvbJkwcZ4ubZkwcJwubZgubJcydqUydKIxapgubJctbJcubZcubJcvbJYubJcvbZkubJctbJctbZcubJg2f7AubJcrbZcubJcubJcua5g3grY0fq8ubJcubJdEkdEwhsw6i88vhswuhcsuhMtBjMgthMsrg8srgss6is8qgcs8i9A9iMYtg8spgcoogMo7hcMngMonf8olfso4gr8kfck5iM8jfMk4iM8he8k1fro7itAgesk2hs8eecgzfLcofssdeMg0hc4cd8g2hcsxeLQbdsgZdcgxeLImfcszhM0vda4xgckzhM4xg84wf8Yxgs4udKsvfcQucqhUndROmdM1fK0wcZ8vb5w0eqpQm9MzeKhXoNVcpdYydKNWn9VZotVKltJFjsIwcJ1Rms9OlslLmtH///8+kc9epdYzd6dbo9VHkMM2f7FHmNBClM8ydqVcpNY9hro3gLM9hLczealQmcw3fa46f7A8gLMxc6I3eagyc6FIldJMl9JSnNRSntNNl9JPnNJFi75UnM9ZodVKksg8kM45jc09e6ZHltFBk883gbRBh7pDk9EwcaBzn784g7dKkcY2i81Om9M7j85Llc81is09g7Q4grY/j9A0eqxKmdFFltBEjcXf6fFImdBCiLxJl9FGlNFBi78yiMxVndEvbpo6js74+vx+psPP3+o/ks5HkcpGmNCjwdZCkNDM3ehYoNJEls+lxNkxh8xHks0+jdC1zd5Lg6r+/v/H2ufz9/o3jM3t8/edvdM/k89Th61OiLBSjbZklbaTt9BfptdjmL1AicBHj8hGk9FAgK1dkLNTjLRekrdClc/k7fM0icy0y9tgp9c4jc2NtM9Dlc8zicxeXZn3AAAAQ3RSTlMAHDdTb4yPA+LtnEQmC4L2EmHqB7XA0d0sr478x4/Yd5i1zOfyPkf1sLVq4Nh3FvjxopQ2/STNuFzUwFIwxKaejILpIBEV9wAABhVJREFUeF6s1NdyFEcYBeBeoQIhRAkLlRDGrhIgY3BJL8CVeKzuyXFzzjkn5ZxzzuScg3PO8cKzu70JkO0LfxdTU//pM9vTu7Xgf6KqOVTb9X7toRrVEfBf1HTVjZccrT/2by1VV928Yty9ZbVuucdz90frG8DBjl9pVApbOstvmMuvVgaNXSfAAd6pGxpy6yxf5ph43pS/4f3uoaGm2rdu72S9xzOvMymkZFq/ptDrk90mhW7e4zl7HLzhxGWPR20xmSxJ/VqldG5m9XhaVOA1DadsNh3Pu5L2N6QtPO/32JpqQBVVk20oy/Pi2s23WEvyfHbe1thadVQttvm7Llf65gGmXK67XtupyoM7HQhmXdLS8oGWJNeOJ3C5fG5XCEJnkez3/oFdsvgJ4l2ANZwhrJKk/7OSXa+3Vw2WJMlKnGkobouYk6T0TyX30klOUnTD9HJ5qpckL3EW/w4XF3Xd0FGywXUrstrclVsqz5Pd/sXFYyDnPdrLcQODmGOK47IZb4CmibmMn+MYRzFZ5jg33ZL/EJrWcszHmANy3ARBK/IXtciJy8VsitPSdE3uuHxzougojcUdr8/32atnz/ev3f/K5wtpxUTpcaI45zusVDpYtZi+jg0oU9b3x74h7+n9ABvYEZeKaVq0sh0AtLKsFtqNBdeT0MrSzwwlq9+x6xAO4tgOtSzbCjrNQQiNvQUbUEubvzBUeGw26yDCsRHCoLkTHDa7IdOLIThs/gHvChszh2CimE8peRs47cxANI0lYNB5y1DljpOF0IhzBDPOZnDOqYYbeGKECbPzWnXludPphw5c2YBq5zlwXphIbO4VDCZ0gnPfUO1TwZoYwAs2ExPCedAu9DAjfQUjzITQb3jNj0KG2Sgt6BHaQUdYzWz+XmBktOHwanXjaSTcwwziBcuMOtwBmqPrTOxFQR/DRKKPqyur0aiW6cULYsx6tBm0jXpR/AUWR6HRq9WVW6MRhIq5jLyjbaCTDCijyYJNpCajdyobP/eTw0iexBAKkJ3gA5KcQb2zBXsIBckn+xVv8jkZSaEFHE+jFEleAEfayRU0MouNoBmB/L50Ai/HSLIHxcrpCvnhSQAuakKp2C/YbCylJjXRVy/z3+Kv/RrNcCo+WUzlVEhzKffnTQnxeN9fWF88fiNCUdSTsaufaChKWInHeysygfpIqagoakW+vV20J8uyl6TyNKEZWV4oRSPyCkWpgOLSbkCObT8o2r6tlG58HQquf6O0v50tB7JM7F4EORd2dx/K0w/KHsVkLPaoYrwgP/y7krr3SSMA4zj+OBgmjYkxcdIJQyQRKgg2viX9Hddi9UBb29LrKR7CVVEEEXWojUkXNyfTNDE14W9gbHJNuhjDettN3ZvbOvdOqCD3Jp/9l+/wJE+9PkYGjx/fqkys3S2rMozM/o2106rfMUINo6hVqz+eu/hd1c4xTg0TAfy5kV+4UG6+IthHTU9woWmxuKNbTfuCSfovBCxq7EtHqvYL4Sm6F8GVxsSXHMQ07TOi1DKtZxjWaaIyi4CXWjxPccUw8WVbMYY5wxC1mzEyXMJWkllpRloi+Kkoq69sxBTlElF6aAxYUbjXNlhlDZilDnM4U5SlN5biRsRHnbx3mbeWjEh4mEyiuJDl5XcWVmX5GvNkFgLWZM5qwsop4/AWfLhU1cR7k1VVvcYCWRkOI6Xy5gmnphCYIkvzuNYzHzosq2oNk2RtSs8khfUOfHIDgR6ysYBaMpl4uEgk2U/oJTs9AaTSwma7dT69geAE2ZpEjUsn2ieJNHeKfrI3EcAGJ2ZaNgVuC8EBctCLc57P5u5led6IOBkIYkuQMrmmjChs4VkfOerHqSBkPzZlhe06RslZ3zMjk2sscqKwY0RcjKK+LWbzd7KiHhkncs/siFJ+V5eXxD34B8nVuJEpGJNmxN2gH3vSvp7J70tF+D1Ej8qUJD1TkErAND2GZwTFg/LubvmgiBG3SOvdlsqFQrkEzJCL1rstlnVFROixZoDDSuXQFHESwVGlcuQcMb/b42NgjLowh5MTDFE3vNB5qStRIErdCQEh6pLPR92anSUb/wAIhldAaDMpGgAAAABJRU5ErkJggg=="},24:g=>{"use strict";g.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAFgUlEQVR4Aa1XA5BjWRTN2oW17d3YaZtr2962HUzbDNpjszW24mRt28p47v7zq/bXZtrp/lWnXr337j3nPCe85NcypgSFdugCpW5YoDAMRaIMqRi6aKq5E3YqDQO3qAwjVWrD8Ncq/RBpykd8oZUb/kaJutow8r1aP9II0WmLKLIsJyv1w/kqw9Ch2MYdB++12Onxee/QMwvf4/Dk/Lfp/i4nxTXtOoQ4pW5Aj7wpici1A9erdAN2OH64x8OSP9j3Ft3b7aWkTg/Fm91siTra0f9on5sQr9INejH6CUUUpavjFNq1B+Oadhxmnfa8RfEmN8VNAsQhPqF55xHkMzz3jSmChWU6f7/XZKNH+9+hBLOHYozuKQPxyMPUKkrX/K0uWnfFaJGS1QPRtZsOPtr3NsW0uyh6NNCOkU3Yz+bXbT3I8G3xE5EXLXtCXbbqwCO9zPQYPRTZ5vIDXD7U+w7rFDEoUUf7ibHIR4y6bLVPXrz8JVZEql13trxwue/uDivd3fkWRbS6/IA2bID4uk0UpF1N8qLlbBlXs4Ee7HLTfV1j54APvODnSfOWBqtKVvjgLKzF5YdEk5ewRkGlK0i33Eofffc7HT56jD7/6U+qH3Cx7SBLNntH5YIPvODnyfIXZYRVDPqgHtLs5ABHD3YzLuespb7t79FY34DjMwrVrcTuwlT55YMPvOBnRrJ4VXTdNnYug5ucHLBjEpt30701A3Ts+HEa73u6dT3FNWwflY86eMHPk+Yu+i6pzUpRrW7SNDg5JHR4KapmM5Wv2E8Tfcb1HoqqHMHU+uWDD7zg54mz5/2BSnizi9T1Dg4QQXLToGNCkb6tb1NU+QAlGr1++eADrzhn/u8Q2YZhQVlZ5+CAOtqfbhmaUCS1ezNFVm2imDbPmPng5wmz+gwh+oHDce0eUtQ6OGDIyR0uUhUsoO3vfDmmgOezH0mZN59x7MBi++WDL1g/eEiU3avlidO671bkLfwbw5XV2P8Pzo0ydy4t2/0eu33xYSOMOD8hTf4CrBtGMSoXfPLchX+J0ruSePw3LZeK0juPJbYzrhkH0io7B3k164hiGvawhOKMLkrQLyVpZg8rHFW7E2uHOL888IBPlNZ1FPzstSJM694fWr6RwpvcJK60+0HCILTBzZLFNdtAzJaohze60T8qBzyh5ZuOg5e7uwQppofEmf2++DYvmySqGBuKaicF1blQjhuHdvCIMvp8whTTfZzI7RldpwtSzL+F1+wkdZ2TBOW2gIF88PBTzD/gpeREAMEbxnJcaJHNHrpzji0gQCS6hdkEeYt9DF/2qPcEC8RM28Hwmr3sdNyht00byAut2k3gufWNtgtOEOFGUwcXWNDbdNbpgBGxEvKkOQsxivJx33iow0Vw5S6SVTrpVq11ysA2Rp7gTfPfktc6zhtXBBC+adRLshf6sG2RfHPZ5EAc4sVZ83yCN00Fk/4kggu40ZTvIEm5g24qtU4KjBrx/BTTH8ifVASAG7gKrnWxJDcU7x8X6Ecczhm3o6YicvsLXWfh3Ch1W0k8x0nXF+0fFxgt4phz8QvypiwCCFKMqXCnqXExjq10beH+UUA7+nG6mdG/Pu0f3LgFcGrl2s0kNNjpmoJ9o4B29CMO8dMT4Q5ox8uitF6fqsrJOr8qnwNbRzv6hSnG5wP+64C7h9lp30hKNtKdWjtdkbuPA19nJ7Tz3zR/ibgARbhb4AlhavcBebmTHcFl2fvYEnW0ox9xMxKBS8btJ+KiEbq9zA4RthQXDhPa0T9TEe69gWupwc6uBUphquXgf+/FrIjweHQS4/pduMe5ERUMHUd9xv8ZR98CxkS4F2n3EUrUZ10EYNw7BWm9x1GiPssi3GgiGRDKWRYZfXlON+dfNbM+GgIwYdwAAAAASUVORK5CYII="},71:g=>{"use strict";g.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAQAAAACach9AAACMUlEQVR4Ae3ShY7jQBAE0Aoz/f9/HTMzhg1zrdKUrJbdx+Kd2nD8VNudfsL/Th///dyQN2TH6f3y/BGpC379rV+S+qqetBOxImNQXL8JCAr2V4iMQXHGNJxeCfZXhSRBcQMfvkOWUdtfzlLgAENmZDcmo2TVmt8OSM2eXxBp3DjHSMFutqS7SbmemzBiR+xpKCNUIRkdkkYxhAkyGoBvyQFEJEefwSmmvBfJuJ6aKqKWnAkvGZOaZXTUgFqYULWNSHUckZuR1HIIimUExutRxwzOLROIG4vKmCKQt364mIlhSyzAf1m9lHZHJZrlAOMMztRRiKimp/rpdJDc9Awry5xTZCte7FHtuS8wJgeYGrex28xNTd086Dik7vUMscQOa8y4DoGtCCSkAKlNwpgNtphjrC6MIHUkR6YWxxs6Sc5xqn222mmCRFzIt8lEdKx+ikCtg91qS2WpwVfBelJCiQJwvzixfI9cxZQWgiSJelKnwBElKYtDOb2MFbhmUigbReQBV0Cg4+qMXSxXSyGUn4UbF8l+7qdSGnTC0XLCmahIgUHLhLOhpVCtw4CzYXvLQWQbJNmxoCsOKAxSgBJno75avolkRw8iIAFcsdc02e9iyCd8tHwmeSSoKTowIgvscSGZUOA7PuCN5b2BX9mQM7S0wYhMNU74zgsPBj3HU7wguAfnxxjFQGBE6pwN+GjME9zHY7zGp8wVxMShYX9NXvEWD3HbwJf4giO4CFIQxXScH1/TM+04kkBiAAAAAElFTkSuQmCC"}},t={};function e(I){var n=t[I];if(void 0!==n)return n.exports;var C=t[I]={exports:{}};return g[I].call(C.exports,C,C.exports,e),C.exports}e.m=g,e.n=g=>{var t=g&&g.__esModule?()=>g.default:()=>g;return e.d(t,{a:t}),t},e.d=(g,t)=>{for(var I in t)e.o(t,I)&&!e.o(g,I)&&Object.defineProperty(g,I,{enumerable:!0,get:t[I]})},e.f={},e.e=g=>Promise.all(Object.keys(e.f).reduce(((t,I)=>(e.f[I](g,t),t)),[])),e.u=g=>"static/js/"+g+".8ab44547.chunk.js",e.miniCssF=g=>{},e.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(g){if("object"===typeof window)return window}}(),e.o=(g,t)=>Object.prototype.hasOwnProperty.call(g,t),(()=>{var g={},t="frontend:";e.l=(I,n,C,i)=>{if(g[I])g[I].push(n);else{var l,o;if(void 0!==C)for(var s=document.getElementsByTagName("script"),a=0;a<s.length;a++){var r=s[a];if(r.getAttribute("src")==I||r.getAttribute("data-webpack")==t+C){l=r;break}}l||(o=!0,(l=document.createElement("script")).charset="utf-8",l.timeout=120,e.nc&&l.setAttribute("nonce",e.nc),l.setAttribute("data-webpack",t+C),l.src=I),g[I]=[n];var c=(t,e)=>{l.onerror=l.onload=null,clearTimeout(A);var n=g[I];if(delete g[I],l.parentNode&&l.parentNode.removeChild(l),n&&n.forEach((g=>g(e))),t)return t(e)},A=setTimeout(c.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=c.bind(null,l.onerror),l.onload=c.bind(null,l.onload),o&&document.head.appendChild(l)}}})(),e.r=g=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},e.p="/",(()=>{var g={792:0};e.f.j=(t,I)=>{var n=e.o(g,t)?g[t]:void 0;if(0!==n)if(n)I.push(n[2]);else{var C=new Promise(((e,I)=>n=g[t]=[e,I]));I.push(n[2]=C);var i=e.p+e.u(t),l=new Error;e.l(i,(I=>{if(e.o(g,t)&&(0!==(n=g[t])&&(g[t]=void 0),n)){var C=I&&("load"===I.type?"missing":I.type),i=I&&I.target&&I.target.src;l.message="Loading chunk "+t+" failed.\n("+C+": "+i+")",l.name="ChunkLoadError",l.type=C,l.request=i,n[1](l)}}),"chunk-"+t,t)}};var t=(t,I)=>{var n,C,i=I[0],l=I[1],o=I[2],s=0;if(i.some((t=>0!==g[t]))){for(n in l)e.o(l,n)&&(e.m[n]=l[n]);if(o)o(e)}for(t&&t(I);s<i.length;s++)C=i[s],e.o(g,C)&&g[C]&&g[C][0](),g[C]=0},I=self.webpackChunkfrontend=self.webpackChunkfrontend||[];I.forEach(t.bind(null,0)),I.push=t.bind(null,I.push.bind(I))})(),(()=>{"use strict";var g=e(43),t=e(391);const I=function(){for(var g=arguments.length,t=new Array(g),e=0;e<g;e++)t[e]=arguments[e];return t.filter(((g,t,e)=>Boolean(g)&&""!==g.trim()&&e.indexOf(g)===t)).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const C=(0,g.forwardRef)(((t,e)=>{let{color:C="currentColor",size:i=24,strokeWidth:l=2,absoluteStrokeWidth:o,className:s="",children:a,iconNode:r,...c}=t;return(0,g.createElement)("svg",{ref:e,...n,width:i,height:i,stroke:C,strokeWidth:o?24*Number(l)/Number(i):l,className:I("lucide",s),...c},[...r.map((t=>{let[e,I]=t;return(0,g.createElement)(e,I)})),...Array.isArray(a)?a:[a]])})),i=(t,e)=>{const n=(0,g.forwardRef)(((n,i)=>{let{className:l,...o}=n;return(0,g.createElement)(C,{ref:i,iconNode:e,className:I(`lucide-${s=t,s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,l),...o});var s}));return n.displayName=`${t}`,n},l=i("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),o=i("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),s=i("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]),a=i("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),r=i("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),c=i("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]);var A=e(579);const d=g.forwardRef(((g,t)=>{let{className:e="",...I}=g;return(0,A.jsx)("div",{ref:t,className:`rounded-lg border bg-card text-card-foreground shadow-sm ${e}`,...I})}));d.displayName="Card";g.forwardRef(((g,t)=>{let{className:e="",...I}=g;return(0,A.jsx)("div",{ref:t,className:`flex flex-col space-y-1.5 p-6 ${e}`,...I})})).displayName="CardHeader";const u=g.forwardRef(((g,t)=>{let{className:e="",children:I,...n}=g;return I||console.error("CardTitle requires children to be accessible."),(0,A.jsx)("h3",{ref:t,className:`text-2xl font-semibold leading-none tracking-tight ${e}`,...n,children:I})}));u.displayName="CardTitle",u.displayName="CardTitle";g.forwardRef(((g,t)=>{let{className:e="",...I}=g;return(0,A.jsx)("p",{ref:t,className:`text-sm text-muted-foreground ${e}`,...I})})).displayName="CardDescription";const h=g.forwardRef(((g,t)=>{let{className:e="",...I}=g;return(0,A.jsx)("div",{ref:t,className:`p-6 pt-0 ${e}`,...I})}));h.displayName="CardContent";g.forwardRef(((g,t)=>{let{className:e="",...I}=g;return(0,A.jsx)("div",{ref:t,className:`flex items-center p-6 pt-0 ${e}`,...I})})).displayName="CardFooter";const m=g.forwardRef(((g,t)=>{let{className:e,children:I,...n}=g;return(0,A.jsx)("div",{ref:t,role:"alert",className:`relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground ${e}`,...n,children:I})}));m.displayName="Alert";const Z=g.forwardRef(((g,t)=>{let{className:e,...I}=g;return(0,A.jsx)("h5",{ref:t,className:`mb-1 font-medium leading-none tracking-tight ${e}`,...I})}));Z.displayName="AlertTitle";const b=g.forwardRef(((g,t)=>{let{className:e,...I}=g;return(0,A.jsx)("div",{ref:t,className:`text-sm [&_p]:leading-relaxed ${e}`,...I})}));b.displayName="AlertDescription";const G=function(g){const t=[];let e=0;for(let I=0;I<g.length;I++){let n=g.charCodeAt(I);n<128?t[e++]=n:n<2048?(t[e++]=n>>6|192,t[e++]=63&n|128):55296===(64512&n)&&I+1<g.length&&56320===(64512&g.charCodeAt(I+1))?(n=65536+((1023&n)<<10)+(1023&g.charCodeAt(++I)),t[e++]=n>>18|240,t[e++]=n>>12&63|128,t[e++]=n>>6&63|128,t[e++]=63&n|128):(t[e++]=n>>12|224,t[e++]=n>>6&63|128,t[e++]=63&n|128)}return t},p={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(g,t){if(!Array.isArray(g))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,I=[];for(let n=0;n<g.length;n+=3){const t=g[n],C=n+1<g.length,i=C?g[n+1]:0,l=n+2<g.length,o=l?g[n+2]:0,s=t>>2,a=(3&t)<<4|i>>4;let r=(15&i)<<2|o>>6,c=63&o;l||(c=64,C||(r=64)),I.push(e[s],e[a],e[r],e[c])}return I.join("")},encodeString(g,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(g):this.encodeByteArray(G(g),t)},decodeString(g,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(g):function(g){const t=[];let e=0,I=0;for(;e<g.length;){const n=g[e++];if(n<128)t[I++]=String.fromCharCode(n);else if(n>191&&n<224){const C=g[e++];t[I++]=String.fromCharCode((31&n)<<6|63&C)}else if(n>239&&n<365){const C=((7&n)<<18|(63&g[e++])<<12|(63&g[e++])<<6|63&g[e++])-65536;t[I++]=String.fromCharCode(55296+(C>>10)),t[I++]=String.fromCharCode(56320+(1023&C))}else{const C=g[e++],i=g[e++];t[I++]=String.fromCharCode((15&n)<<12|(63&C)<<6|63&i)}}return t.join("")}(this.decodeStringToByteArray(g,t))},decodeStringToByteArray(g,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,I=[];for(let n=0;n<g.length;){const t=e[g.charAt(n++)],C=n<g.length?e[g.charAt(n)]:0;++n;const i=n<g.length?e[g.charAt(n)]:64;++n;const l=n<g.length?e[g.charAt(n)]:64;if(++n,null==t||null==C||null==i||null==l)throw new y;const o=t<<2|C>>4;if(I.push(o),64!==i){const g=C<<4&240|i>>2;if(I.push(g),64!==l){const g=i<<6&192|l;I.push(g)}}}return I},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let g=0;g<this.ENCODED_VALS.length;g++)this.byteToCharMap_[g]=this.ENCODED_VALS.charAt(g),this.charToByteMap_[this.byteToCharMap_[g]]=g,this.byteToCharMapWebSafe_[g]=this.ENCODED_VALS_WEBSAFE.charAt(g),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[g]]=g,g>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(g)]=g,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(g)]=g)}}};class y extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const B=function(g){return function(g){const t=G(g);return p.encodeByteArray(t,!0)}(g).replace(/\./g,"")},V=function(g){try{return p.decodeString(g,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};const W=()=>function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof e.g)return e.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,S=()=>{try{return W()||(()=>{if("undefined"===typeof process)return;const g={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.__FIREBASE_DEFAULTS__;return g?JSON.parse(g):void 0})()||(()=>{if("undefined"===typeof document)return;let g;try{g=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=g&&V(g[1]);return t&&JSON.parse(t)})()}catch(g){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${g}`)}},R=g=>{const t=(g=>{var t,e;return null===(e=null===(t=S())||void 0===t?void 0:t.emulatorHosts)||void 0===e?void 0:e[g]})(g);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const I=parseInt(t.substring(e+1),10);return"["===t[0]?[t.substring(1,e-1),I]:[t.substring(0,e),I]},f=()=>{var g;return null===(g=S())||void 0===g?void 0:g.config};class X{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((g,t)=>{this.resolve=g,this.reject=t}))}wrapCallback(g){return(t,e)=>{t?this.reject(t):this.resolve(e),"function"===typeof g&&(this.promise.catch((()=>{})),1===g.length?g(t):g(t,e))}}}function J(g,t){if(g.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e=t||"demo-project",I=g.iat||0,n=g.sub||g.user_id;if(!n)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const C=Object.assign({iss:`https://securetoken.google.com/${e}`,aud:e,iat:I,exp:I+3600,auth_time:I,sub:n,user_id:n,firebase:{sign_in_provider:"custom",identities:{}}},g);return[B(JSON.stringify({alg:"none",type:"JWT"})),B(JSON.stringify(C)),""].join(".")}function v(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function k(){return!function(){var g;const t=null===(g=S())||void 0===g?void 0:g.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(I){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Y(){try{return"object"===typeof indexedDB}catch(g){return!1}}class H extends Error{constructor(g,t,e){super(t),this.code=g,this.customData=e,this.name="FirebaseError",Object.setPrototypeOf(this,H.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,w.prototype.create)}}class w{constructor(g,t,e){this.service=g,this.serviceName=t,this.errors=e}create(g){const t=(arguments.length<=1?void 0:arguments[1])||{},e=`${this.service}/${g}`,I=this.errors[g],n=I?function(g,t){return g.replace(N,((g,e)=>{const I=t[e];return null!=I?String(I):`<${e}?>`}))}(I,t):"Error",C=`${this.serviceName}: ${n} (${e}).`;return new H(e,C,t)}}const N=/\{\$([^}]+)}/g;function K(g,t){if(g===t)return!0;const e=Object.keys(g),I=Object.keys(t);for(const n of e){if(!I.includes(n))return!1;const e=g[n],C=t[n];if(F(e)&&F(C)){if(!K(e,C))return!1}else if(e!==C)return!1}for(const n of I)if(!e.includes(n))return!1;return!0}function F(g){return null!==g&&"object"===typeof g}function E(g){return g&&g._delegate?g._delegate:g}class z{constructor(g,t,e){this.name=g,this.instanceFactory=t,this.type=e,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(g){return this.instantiationMode=g,this}setMultipleInstances(g){return this.multipleInstances=g,this}setServiceProps(g){return this.serviceProps=g,this}setInstanceCreatedCallback(g){return this.onInstanceCreated=g,this}}const x="[DEFAULT]";class L{constructor(g,t){this.name=g,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(g){const t=this.normalizeInstanceIdentifier(g);if(!this.instancesDeferred.has(t)){const g=new X;if(this.instancesDeferred.set(t,g),this.isInitialized(t)||this.shouldAutoInitialize())try{const e=this.getOrInitializeService({instanceIdentifier:t});e&&g.resolve(e)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(g){var t;const e=this.normalizeInstanceIdentifier(null===g||void 0===g?void 0:g.identifier),I=null!==(t=null===g||void 0===g?void 0:g.optional)&&void 0!==t&&t;if(!this.isInitialized(e)&&!this.shouldAutoInitialize()){if(I)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:e})}catch(n){if(I)return null;throw n}}getComponent(){return this.component}setComponent(g){if(g.name!==this.name)throw Error(`Mismatching Component ${g.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=g,this.shouldAutoInitialize()){if(function(g){return"EAGER"===g.instantiationMode}(g))try{this.getOrInitializeService({instanceIdentifier:x})}catch(t){}for(const[g,e]of this.instancesDeferred.entries()){const I=this.normalizeInstanceIdentifier(g);try{const g=this.getOrInitializeService({instanceIdentifier:I});e.resolve(g)}catch(t){}}}}clearInstance(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x;this.instancesDeferred.delete(g),this.instancesOptions.delete(g),this.instances.delete(g)}async delete(){const g=Array.from(this.instances.values());await Promise.all([...g.filter((g=>"INTERNAL"in g)).map((g=>g.INTERNAL.delete())),...g.filter((g=>"_delete"in g)).map((g=>g._delete()))])}isComponentSet(){return null!=this.component}isInitialized(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x;return this.instances.has(g)}getOptions(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x;return this.instancesOptions.get(g)||{}}initialize(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=g,e=this.normalizeInstanceIdentifier(g.instanceIdentifier);if(this.isInitialized(e))throw Error(`${this.name}(${e}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const I=this.getOrInitializeService({instanceIdentifier:e,options:t});for(const[n,C]of this.instancesDeferred.entries()){e===this.normalizeInstanceIdentifier(n)&&C.resolve(I)}return I}onInit(g,t){var e;const I=this.normalizeInstanceIdentifier(t),n=null!==(e=this.onInitCallbacks.get(I))&&void 0!==e?e:new Set;n.add(g),this.onInitCallbacks.set(I,n);const C=this.instances.get(I);return C&&g(C,I),()=>{n.delete(g)}}invokeOnInitCallbacks(g,t){const e=this.onInitCallbacks.get(t);if(e)for(const n of e)try{n(g,t)}catch(I){}}getOrInitializeService(g){let{instanceIdentifier:t,options:e={}}=g,I=this.instances.get(t);if(!I&&this.component&&(I=this.component.instanceFactory(this.container,{instanceIdentifier:(n=t,n===x?void 0:n),options:e}),this.instances.set(t,I),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(I,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,I)}catch(C){}var n;return I||null}normalizeInstanceIdentifier(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x;return this.component?this.component.multipleInstances?g:x:g}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class M{constructor(g){this.name=g,this.providers=new Map}addComponent(g){const t=this.getProvider(g.name);if(t.isComponentSet())throw new Error(`Component ${g.name} has already been registered with ${this.name}`);t.setComponent(g)}addOrOverwriteComponent(g){this.getProvider(g.name).isComponentSet()&&this.providers.delete(g.name),this.addComponent(g)}getProvider(g){if(this.providers.has(g))return this.providers.get(g);const t=new L(g,this);return this.providers.set(g,t),t}getProviders(){return Array.from(this.providers.values())}}const U=[];var T,Q;(Q=T||(T={}))[Q.DEBUG=0]="DEBUG",Q[Q.VERBOSE=1]="VERBOSE",Q[Q.INFO=2]="INFO",Q[Q.WARN=3]="WARN",Q[Q.ERROR=4]="ERROR",Q[Q.SILENT=5]="SILENT";const D={debug:T.DEBUG,verbose:T.VERBOSE,info:T.INFO,warn:T.WARN,error:T.ERROR,silent:T.SILENT},_=T.INFO,j={[T.DEBUG]:"log",[T.VERBOSE]:"log",[T.INFO]:"info",[T.WARN]:"warn",[T.ERROR]:"error"},P=function(g,t){if(t<g.logLevel)return;const e=(new Date).toISOString(),I=j[t];if(!I)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);for(var n=arguments.length,C=new Array(n>2?n-2:0),i=2;i<n;i++)C[i-2]=arguments[i];console[I](`[${e}]  ${g.name}:`,...C)};class O{constructor(g){this.name=g,this._logLevel=_,this._logHandler=P,this._userLogHandler=null,U.push(this)}get logLevel(){return this._logLevel}set logLevel(g){if(!(g in T))throw new TypeError(`Invalid value "${g}" assigned to \`logLevel\``);this._logLevel=g}setLogLevel(g){this._logLevel="string"===typeof g?D[g]:g}get logHandler(){return this._logHandler}set logHandler(g){if("function"!==typeof g)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=g}get userLogHandler(){return this._userLogHandler}set userLogHandler(g){this._userLogHandler=g}debug(){for(var g=arguments.length,t=new Array(g),e=0;e<g;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler(this,T.DEBUG,...t),this._logHandler(this,T.DEBUG,...t)}log(){for(var g=arguments.length,t=new Array(g),e=0;e<g;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler(this,T.VERBOSE,...t),this._logHandler(this,T.VERBOSE,...t)}info(){for(var g=arguments.length,t=new Array(g),e=0;e<g;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler(this,T.INFO,...t),this._logHandler(this,T.INFO,...t)}warn(){for(var g=arguments.length,t=new Array(g),e=0;e<g;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler(this,T.WARN,...t),this._logHandler(this,T.WARN,...t)}error(){for(var g=arguments.length,t=new Array(g),e=0;e<g;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler(this,T.ERROR,...t),this._logHandler(this,T.ERROR,...t)}}let q,$;const gg=new WeakMap,tg=new WeakMap,eg=new WeakMap,Ig=new WeakMap,ng=new WeakMap;let Cg={get(g,t,e){if(g instanceof IDBTransaction){if("done"===t)return tg.get(g);if("objectStoreNames"===t)return g.objectStoreNames||eg.get(g);if("store"===t)return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return og(g[t])},set:(g,t,e)=>(g[t]=e,!0),has:(g,t)=>g instanceof IDBTransaction&&("done"===t||"store"===t)||t in g};function ig(g){return g!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?($||($=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(g)?function(){for(var t=arguments.length,e=new Array(t),I=0;I<t;I++)e[I]=arguments[I];return g.apply(sg(this),e),og(gg.get(this))}:function(){for(var t=arguments.length,e=new Array(t),I=0;I<t;I++)e[I]=arguments[I];return og(g.apply(sg(this),e))}:function(t){for(var e=arguments.length,I=new Array(e>1?e-1:0),n=1;n<e;n++)I[n-1]=arguments[n];const C=g.call(sg(this),t,...I);return eg.set(C,t.sort?t.sort():[t]),og(C)}}function lg(g){return"function"===typeof g?ig(g):(g instanceof IDBTransaction&&function(g){if(tg.has(g))return;const t=new Promise(((t,e)=>{const I=()=>{g.removeEventListener("complete",n),g.removeEventListener("error",C),g.removeEventListener("abort",C)},n=()=>{t(),I()},C=()=>{e(g.error||new DOMException("AbortError","AbortError")),I()};g.addEventListener("complete",n),g.addEventListener("error",C),g.addEventListener("abort",C)}));tg.set(g,t)}(g),t=g,(q||(q=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((g=>t instanceof g))?new Proxy(g,Cg):g);var t}function og(g){if(g instanceof IDBRequest)return function(g){const t=new Promise(((t,e)=>{const I=()=>{g.removeEventListener("success",n),g.removeEventListener("error",C)},n=()=>{t(og(g.result)),I()},C=()=>{e(g.error),I()};g.addEventListener("success",n),g.addEventListener("error",C)}));return t.then((t=>{t instanceof IDBCursor&&gg.set(t,g)})).catch((()=>{})),ng.set(t,g),t}(g);if(Ig.has(g))return Ig.get(g);const t=lg(g);return t!==g&&(Ig.set(g,t),ng.set(t,g)),t}const sg=g=>ng.get(g);const ag=["get","getKey","getAll","getAllKeys","count"],rg=["put","add","delete","clear"],cg=new Map;function Ag(g,t){if(!(g instanceof IDBDatabase)||t in g||"string"!==typeof t)return;if(cg.get(t))return cg.get(t);const e=t.replace(/FromIndex$/,""),I=t!==e,n=rg.includes(e);if(!(e in(I?IDBIndex:IDBObjectStore).prototype)||!n&&!ag.includes(e))return;const C=async function(g){const t=this.transaction(g,n?"readwrite":"readonly");let C=t.store;for(var i=arguments.length,l=new Array(i>1?i-1:0),o=1;o<i;o++)l[o-1]=arguments[o];return I&&(C=C.index(l.shift())),(await Promise.all([C[e](...l),n&&t.done]))[0]};return cg.set(t,C),C}Cg=(g=>({...g,get:(t,e,I)=>Ag(t,e)||g.get(t,e,I),has:(t,e)=>!!Ag(t,e)||g.has(t,e)}))(Cg);class dg{constructor(g){this.container=g}getPlatformInfoString(){return this.container.getProviders().map((g=>{if(function(g){const t=g.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(g)){const t=g.getImmediate();return`${t.library}/${t.version}`}return null})).filter((g=>g)).join(" ")}}const ug="@firebase/app",hg="0.10.16",mg=new O("@firebase/app"),Zg="@firebase/app-compat",bg="@firebase/analytics-compat",Gg="@firebase/analytics",pg="@firebase/app-check-compat",yg="@firebase/app-check",Bg="@firebase/auth",Vg="@firebase/auth-compat",Wg="@firebase/database",Sg="@firebase/data-connect",Rg="@firebase/database-compat",fg="@firebase/functions",Xg="@firebase/functions-compat",Jg="@firebase/installations",vg="@firebase/installations-compat",kg="@firebase/messaging",Yg="@firebase/messaging-compat",Hg="@firebase/performance",wg="@firebase/performance-compat",Ng="@firebase/remote-config",Kg="@firebase/remote-config-compat",Fg="@firebase/storage",Eg="@firebase/storage-compat",zg="@firebase/firestore",xg="@firebase/vertexai",Lg="@firebase/firestore-compat",Mg="firebase",Ug="[DEFAULT]",Tg={[ug]:"fire-core",[Zg]:"fire-core-compat",[Gg]:"fire-analytics",[bg]:"fire-analytics-compat",[yg]:"fire-app-check",[pg]:"fire-app-check-compat",[Bg]:"fire-auth",[Vg]:"fire-auth-compat",[Wg]:"fire-rtdb",[Sg]:"fire-data-connect",[Rg]:"fire-rtdb-compat",[fg]:"fire-fn",[Xg]:"fire-fn-compat",[Jg]:"fire-iid",[vg]:"fire-iid-compat",[kg]:"fire-fcm",[Yg]:"fire-fcm-compat",[Hg]:"fire-perf",[wg]:"fire-perf-compat",[Ng]:"fire-rc",[Kg]:"fire-rc-compat",[Fg]:"fire-gcs",[Eg]:"fire-gcs-compat",[zg]:"fire-fst",[Lg]:"fire-fst-compat",[xg]:"fire-vertex","fire-js":"fire-js",[Mg]:"fire-js-all"},Qg=new Map,Dg=new Map,_g=new Map;function jg(g,t){try{g.container.addComponent(t)}catch(e){mg.debug(`Component ${t.name} failed to register with FirebaseApp ${g.name}`,e)}}function Pg(g){const t=g.name;if(_g.has(t))return mg.debug(`There were multiple attempts to register component ${t}.`),!1;_g.set(t,g);for(const e of Qg.values())jg(e,g);for(const e of Dg.values())jg(e,g);return!0}function Og(g,t){const e=g.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),g.container.getProvider(t)}const qg=new w("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class $g{constructor(g,t,e){this._isDeleted=!1,this._options=Object.assign({},g),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=e,this.container.addComponent(new z("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(g){this.checkDestroyed(),this._automaticDataCollectionEnabled=g}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(g){this._isDeleted=g}checkDestroyed(){if(this.isDeleted)throw qg.create("app-deleted",{appName:this._name})}}const gt="11.0.2";function tt(g){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=g;if("object"!==typeof t){t={name:t}}const I=Object.assign({name:Ug,automaticDataCollectionEnabled:!1},t),n=I.name;if("string"!==typeof n||!n)throw qg.create("bad-app-name",{appName:String(n)});if(e||(e=f()),!e)throw qg.create("no-options");const C=Qg.get(n);if(C){if(K(e,C.options)&&K(I,C.config))return C;throw qg.create("duplicate-app",{appName:n})}const i=new M(n);for(const o of _g.values())i.addComponent(o);const l=new $g(e,I,i);return Qg.set(n,l),l}function et(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ug;const t=Qg.get(g);if(!t&&g===Ug&&f())return tt();if(!t)throw qg.create("no-app",{appName:g});return t}function It(g,t,e){var I;let n=null!==(I=Tg[g])&&void 0!==I?I:g;e&&(n+=`-${e}`);const C=n.match(/\s|\//),i=t.match(/\s|\//);if(C||i){const g=[`Unable to register library "${n}" with version "${t}":`];return C&&g.push(`library name "${n}" contains illegal characters (whitespace or "/")`),C&&i&&g.push("and"),i&&g.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void mg.warn(g.join(" "))}Pg(new z(`${n}-version`,(()=>({library:n,version:t})),"VERSION"))}const nt="firebase-heartbeat-store";let Ct=null;function it(){return Ct||(Ct=function(g,t){let{blocked:e,upgrade:I,blocking:n,terminated:C}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=indexedDB.open(g,t),l=og(i);return I&&i.addEventListener("upgradeneeded",(g=>{I(og(i.result),g.oldVersion,g.newVersion,og(i.transaction),g)})),e&&i.addEventListener("blocked",(g=>e(g.oldVersion,g.newVersion,g))),l.then((g=>{C&&g.addEventListener("close",(()=>C())),n&&g.addEventListener("versionchange",(g=>n(g.oldVersion,g.newVersion,g)))})).catch((()=>{})),l}("firebase-heartbeat-database",1,{upgrade:(g,t)=>{if(0===t)try{g.createObjectStore(nt)}catch(e){console.warn(e)}}}).catch((g=>{throw qg.create("idb-open",{originalErrorMessage:g.message})}))),Ct}async function lt(g,t){try{const e=(await it()).transaction(nt,"readwrite"),I=e.objectStore(nt);await I.put(t,ot(g)),await e.done}catch(e){if(e instanceof H)mg.warn(e.message);else{const g=qg.create("idb-set",{originalErrorMessage:null===e||void 0===e?void 0:e.message});mg.warn(g.message)}}}function ot(g){return`${g.name}!${g.options.appId}`}class st{constructor(g){this.container=g,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new rt(t),this._heartbeatsCachePromise=this._storage.read().then((g=>(this._heartbeatsCache=g,g)))}async triggerHeartbeat(){var g,t;try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),I=at();if(null==(null===(g=this._heartbeatsCache)||void 0===g?void 0:g.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===I||this._heartbeatsCache.heartbeats.some((g=>g.date===I)))return;return this._heartbeatsCache.heartbeats.push({date:I,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((g=>{const t=new Date(g.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}catch(e){mg.warn(e)}}async getHeartbeatsHeader(){var g;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(g=this._heartbeatsCache)||void 0===g?void 0:g.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=at(),{heartbeatsToSend:e,unsentEntries:I}=function(g){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const e=[];let I=g.slice();for(const n of g){const g=e.find((g=>g.agent===n.agent));if(g){if(g.dates.push(n.date),ct(e)>t){g.dates.pop();break}}else if(e.push({agent:n.agent,dates:[n.date]}),ct(e)>t){e.pop();break}I=I.slice(1)}return{heartbeatsToSend:e,unsentEntries:I}}(this._heartbeatsCache.heartbeats),n=B(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,I.length>0?(this._heartbeatsCache.heartbeats=I,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(t){return mg.warn(t),""}}}function at(){return(new Date).toISOString().substring(0,10)}class rt{constructor(g){this.app=g,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!Y()&&new Promise(((g,t)=>{try{let e=!0;const I="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(I);n.onsuccess=()=>{n.result.close(),e||self.indexedDB.deleteDatabase(I),g(!0)},n.onupgradeneeded=()=>{e=!1},n.onerror=()=>{var g;t((null===(g=n.error)||void 0===g?void 0:g.message)||"")}}catch(e){t(e)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const g=await async function(g){try{const t=(await it()).transaction(nt),e=await t.objectStore(nt).get(ot(g));return await t.done,e}catch(t){if(t instanceof H)mg.warn(t.message);else{const g=qg.create("idb-get",{originalErrorMessage:null===t||void 0===t?void 0:t.message});mg.warn(g.message)}}}(this.app);return(null===g||void 0===g?void 0:g.heartbeats)?g:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(g){var t;if(await this._canUseIndexedDBPromise){const e=await this.read();return lt(this.app,{lastSentHeartbeatDate:null!==(t=g.lastSentHeartbeatDate)&&void 0!==t?t:e.lastSentHeartbeatDate,heartbeats:g.heartbeats})}}async add(g){var t;if(await this._canUseIndexedDBPromise){const e=await this.read();return lt(this.app,{lastSentHeartbeatDate:null!==(t=g.lastSentHeartbeatDate)&&void 0!==t?t:e.lastSentHeartbeatDate,heartbeats:[...e.heartbeats,...g.heartbeats]})}}}function ct(g){return B(JSON.stringify({version:2,heartbeats:g})).length}var At;At="",Pg(new z("platform-logger",(g=>new dg(g)),"PRIVATE")),Pg(new z("heartbeat",(g=>new st(g)),"PRIVATE")),It(ug,hg,At),It(ug,hg,"esm2017"),It("fire-js","");It("firebase","11.0.2","app");var dt,ut,ht="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},mt={};(function(){var g;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function e(g,t,e){e||(e=0);var I=Array(16);if("string"===typeof t)for(var n=0;16>n;++n)I[n]=t.charCodeAt(e++)|t.charCodeAt(e++)<<8|t.charCodeAt(e++)<<16|t.charCodeAt(e++)<<24;else for(n=0;16>n;++n)I[n]=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;t=g.g[0],e=g.g[1],n=g.g[2];var C=g.g[3],i=t+(C^e&(n^C))+I[0]+3614090360&4294967295;i=(e=(n=(C=(t=(e=(n=(C=(t=(e=(n=(C=(t=(e=(n=(C=(t=(e=(n=(C=(t=(e=(n=(C=(t=(e=(n=(C=(t=(e=(n=(C=(t=(e=(n=(C=(t=(e=(n=(C=(t=(e=(n=(C=(t=(e=(n=(C=(t=(e=(n=(C=(t=(e=(n=(C=(t=(e=(n=(C=(t=e+(i<<7&4294967295|i>>>25))+((i=C+(n^t&(e^n))+I[1]+3905402710&4294967295)<<12&4294967295|i>>>20))+((i=n+(e^C&(t^e))+I[2]+606105819&4294967295)<<17&4294967295|i>>>15))+((i=e+(t^n&(C^t))+I[3]+3250441966&4294967295)<<22&4294967295|i>>>10))+((i=t+(C^e&(n^C))+I[4]+4118548399&4294967295)<<7&4294967295|i>>>25))+((i=C+(n^t&(e^n))+I[5]+1200080426&4294967295)<<12&4294967295|i>>>20))+((i=n+(e^C&(t^e))+I[6]+2821735955&4294967295)<<17&4294967295|i>>>15))+((i=e+(t^n&(C^t))+I[7]+4249261313&4294967295)<<22&4294967295|i>>>10))+((i=t+(C^e&(n^C))+I[8]+1770035416&4294967295)<<7&4294967295|i>>>25))+((i=C+(n^t&(e^n))+I[9]+2336552879&4294967295)<<12&4294967295|i>>>20))+((i=n+(e^C&(t^e))+I[10]+4294925233&4294967295)<<17&4294967295|i>>>15))+((i=e+(t^n&(C^t))+I[11]+2304563134&4294967295)<<22&4294967295|i>>>10))+((i=t+(C^e&(n^C))+I[12]+1804603682&4294967295)<<7&4294967295|i>>>25))+((i=C+(n^t&(e^n))+I[13]+4254626195&4294967295)<<12&4294967295|i>>>20))+((i=n+(e^C&(t^e))+I[14]+2792965006&4294967295)<<17&4294967295|i>>>15))+((i=e+(t^n&(C^t))+I[15]+1236535329&4294967295)<<22&4294967295|i>>>10))+((i=t+(n^C&(e^n))+I[1]+4129170786&4294967295)<<5&4294967295|i>>>27))+((i=C+(e^n&(t^e))+I[6]+3225465664&4294967295)<<9&4294967295|i>>>23))+((i=n+(t^e&(C^t))+I[11]+643717713&4294967295)<<14&4294967295|i>>>18))+((i=e+(C^t&(n^C))+I[0]+3921069994&4294967295)<<20&4294967295|i>>>12))+((i=t+(n^C&(e^n))+I[5]+3593408605&4294967295)<<5&4294967295|i>>>27))+((i=C+(e^n&(t^e))+I[10]+38016083&4294967295)<<9&4294967295|i>>>23))+((i=n+(t^e&(C^t))+I[15]+3634488961&4294967295)<<14&4294967295|i>>>18))+((i=e+(C^t&(n^C))+I[4]+3889429448&4294967295)<<20&4294967295|i>>>12))+((i=t+(n^C&(e^n))+I[9]+568446438&4294967295)<<5&4294967295|i>>>27))+((i=C+(e^n&(t^e))+I[14]+3275163606&4294967295)<<9&4294967295|i>>>23))+((i=n+(t^e&(C^t))+I[3]+4107603335&4294967295)<<14&4294967295|i>>>18))+((i=e+(C^t&(n^C))+I[8]+1163531501&4294967295)<<20&4294967295|i>>>12))+((i=t+(n^C&(e^n))+I[13]+2850285829&4294967295)<<5&4294967295|i>>>27))+((i=C+(e^n&(t^e))+I[2]+4243563512&4294967295)<<9&4294967295|i>>>23))+((i=n+(t^e&(C^t))+I[7]+1735328473&4294967295)<<14&4294967295|i>>>18))+((i=e+(C^t&(n^C))+I[12]+2368359562&4294967295)<<20&4294967295|i>>>12))+((i=t+(e^n^C)+I[5]+4294588738&4294967295)<<4&4294967295|i>>>28))+((i=C+(t^e^n)+I[8]+2272392833&4294967295)<<11&4294967295|i>>>21))+((i=n+(C^t^e)+I[11]+1839030562&4294967295)<<16&4294967295|i>>>16))+((i=e+(n^C^t)+I[14]+4259657740&4294967295)<<23&4294967295|i>>>9))+((i=t+(e^n^C)+I[1]+2763975236&4294967295)<<4&4294967295|i>>>28))+((i=C+(t^e^n)+I[4]+1272893353&4294967295)<<11&4294967295|i>>>21))+((i=n+(C^t^e)+I[7]+4139469664&4294967295)<<16&4294967295|i>>>16))+((i=e+(n^C^t)+I[10]+3200236656&4294967295)<<23&4294967295|i>>>9))+((i=t+(e^n^C)+I[13]+681279174&4294967295)<<4&4294967295|i>>>28))+((i=C+(t^e^n)+I[0]+3936430074&4294967295)<<11&4294967295|i>>>21))+((i=n+(C^t^e)+I[3]+3572445317&4294967295)<<16&4294967295|i>>>16))+((i=e+(n^C^t)+I[6]+76029189&4294967295)<<23&4294967295|i>>>9))+((i=t+(e^n^C)+I[9]+3654602809&4294967295)<<4&4294967295|i>>>28))+((i=C+(t^e^n)+I[12]+3873151461&4294967295)<<11&4294967295|i>>>21))+((i=n+(C^t^e)+I[15]+530742520&4294967295)<<16&4294967295|i>>>16))+((i=e+(n^C^t)+I[2]+3299628645&4294967295)<<23&4294967295|i>>>9))+((i=t+(n^(e|~C))+I[0]+4096336452&4294967295)<<6&4294967295|i>>>26))+((i=C+(e^(t|~n))+I[7]+1126891415&4294967295)<<10&4294967295|i>>>22))+((i=n+(t^(C|~e))+I[14]+2878612391&4294967295)<<15&4294967295|i>>>17))+((i=e+(C^(n|~t))+I[5]+4237533241&4294967295)<<21&4294967295|i>>>11))+((i=t+(n^(e|~C))+I[12]+1700485571&4294967295)<<6&4294967295|i>>>26))+((i=C+(e^(t|~n))+I[3]+2399980690&4294967295)<<10&4294967295|i>>>22))+((i=n+(t^(C|~e))+I[10]+4293915773&4294967295)<<15&4294967295|i>>>17))+((i=e+(C^(n|~t))+I[1]+2240044497&4294967295)<<21&4294967295|i>>>11))+((i=t+(n^(e|~C))+I[8]+1873313359&4294967295)<<6&4294967295|i>>>26))+((i=C+(e^(t|~n))+I[15]+4264355552&4294967295)<<10&4294967295|i>>>22))+((i=n+(t^(C|~e))+I[6]+2734768916&4294967295)<<15&4294967295|i>>>17))+((i=e+(C^(n|~t))+I[13]+1309151649&4294967295)<<21&4294967295|i>>>11))+((C=(t=e+((i=t+(n^(e|~C))+I[4]+4149444226&4294967295)<<6&4294967295|i>>>26))+((i=C+(e^(t|~n))+I[11]+3174756917&4294967295)<<10&4294967295|i>>>22))^((n=C+((i=n+(t^(C|~e))+I[2]+718787259&4294967295)<<15&4294967295|i>>>17))|~t))+I[9]+3951481745&4294967295,g.g[0]=g.g[0]+t&4294967295,g.g[1]=g.g[1]+(n+(i<<21&4294967295|i>>>11))&4294967295,g.g[2]=g.g[2]+n&4294967295,g.g[3]=g.g[3]+C&4294967295}function I(g,t){this.h=t;for(var e=[],I=!0,n=g.length-1;0<=n;n--){var C=0|g[n];I&&C==t||(e[n]=C,I=!1)}this.g=e}!function(g,t){function e(){}e.prototype=t.prototype,g.D=t.prototype,g.prototype=new e,g.prototype.constructor=g,g.C=function(g,e,I){for(var n=Array(arguments.length-2),C=2;C<arguments.length;C++)n[C-2]=arguments[C];return t.prototype[e].apply(g,n)}}(t,(function(){this.blockSize=-1})),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(g,t){void 0===t&&(t=g.length);for(var I=t-this.blockSize,n=this.B,C=this.h,i=0;i<t;){if(0==C)for(;i<=I;)e(this,g,i),i+=this.blockSize;if("string"===typeof g){for(;i<t;)if(n[C++]=g.charCodeAt(i++),C==this.blockSize){e(this,n),C=0;break}}else for(;i<t;)if(n[C++]=g[i++],C==this.blockSize){e(this,n),C=0;break}}this.h=C,this.o+=t},t.prototype.v=function(){var g=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);g[0]=128;for(var t=1;t<g.length-8;++t)g[t]=0;var e=8*this.o;for(t=g.length-8;t<g.length;++t)g[t]=255&e,e/=256;for(this.u(g),g=Array(16),t=e=0;4>t;++t)for(var I=0;32>I;I+=8)g[e++]=this.g[t]>>>I&255;return g};var n={};function C(g){return-128<=g&&128>g?function(g,t){var e=n;return Object.prototype.hasOwnProperty.call(e,g)?e[g]:e[g]=t(g)}(g,(function(g){return new I([0|g],0>g?-1:0)})):new I([0|g],0>g?-1:0)}function i(g){if(isNaN(g)||!isFinite(g))return l;if(0>g)return c(i(-g));for(var t=[],e=1,n=0;g>=e;n++)t[n]=g/e|0,e*=4294967296;return new I(t,0)}var l=C(0),o=C(1),s=C(16777216);function a(g){if(0!=g.h)return!1;for(var t=0;t<g.g.length;t++)if(0!=g.g[t])return!1;return!0}function r(g){return-1==g.h}function c(g){for(var t=g.g.length,e=[],n=0;n<t;n++)e[n]=~g.g[n];return new I(e,~g.h).add(o)}function A(g,t){return g.add(c(t))}function d(g,t){for(;(65535&g[t])!=g[t];)g[t+1]+=g[t]>>>16,g[t]&=65535,t++}function u(g,t){this.g=g,this.h=t}function h(g,t){if(a(t))throw Error("division by zero");if(a(g))return new u(l,l);if(r(g))return t=h(c(g),t),new u(c(t.g),c(t.h));if(r(t))return t=h(g,c(t)),new u(c(t.g),t.h);if(30<g.g.length){if(r(g)||r(t))throw Error("slowDivide_ only works with positive integers.");for(var e=o,I=t;0>=I.l(g);)e=m(e),I=m(I);var n=Z(e,1),C=Z(I,1);for(I=Z(I,2),e=Z(e,2);!a(I);){var s=C.add(I);0>=s.l(g)&&(n=n.add(e),C=s),I=Z(I,1),e=Z(e,1)}return t=A(g,n.j(t)),new u(n,t)}for(n=l;0<=g.l(t);){for(e=Math.max(1,Math.floor(g.m()/t.m())),I=48>=(I=Math.ceil(Math.log(e)/Math.LN2))?1:Math.pow(2,I-48),s=(C=i(e)).j(t);r(s)||0<s.l(g);)s=(C=i(e-=I)).j(t);a(C)&&(C=o),n=n.add(C),g=A(g,s)}return new u(n,g)}function m(g){for(var t=g.g.length+1,e=[],n=0;n<t;n++)e[n]=g.i(n)<<1|g.i(n-1)>>>31;return new I(e,g.h)}function Z(g,t){var e=t>>5;t%=32;for(var n=g.g.length-e,C=[],i=0;i<n;i++)C[i]=0<t?g.i(i+e)>>>t|g.i(i+e+1)<<32-t:g.i(i+e);return new I(C,g.h)}(g=I.prototype).m=function(){if(r(this))return-c(this).m();for(var g=0,t=1,e=0;e<this.g.length;e++){var I=this.i(e);g+=(0<=I?I:4294967296+I)*t,t*=4294967296}return g},g.toString=function(g){if(2>(g=g||10)||36<g)throw Error("radix out of range: "+g);if(a(this))return"0";if(r(this))return"-"+c(this).toString(g);for(var t=i(Math.pow(g,6)),e=this,I="";;){var n=h(e,t).g,C=((0<(e=A(e,n.j(t))).g.length?e.g[0]:e.h)>>>0).toString(g);if(a(e=n))return C+I;for(;6>C.length;)C="0"+C;I=C+I}},g.i=function(g){return 0>g?0:g<this.g.length?this.g[g]:this.h},g.l=function(g){return r(g=A(this,g))?-1:a(g)?0:1},g.abs=function(){return r(this)?c(this):this},g.add=function(g){for(var t=Math.max(this.g.length,g.g.length),e=[],n=0,C=0;C<=t;C++){var i=n+(65535&this.i(C))+(65535&g.i(C)),l=(i>>>16)+(this.i(C)>>>16)+(g.i(C)>>>16);n=l>>>16,i&=65535,l&=65535,e[C]=l<<16|i}return new I(e,-2147483648&e[e.length-1]?-1:0)},g.j=function(g){if(a(this)||a(g))return l;if(r(this))return r(g)?c(this).j(c(g)):c(c(this).j(g));if(r(g))return c(this.j(c(g)));if(0>this.l(s)&&0>g.l(s))return i(this.m()*g.m());for(var t=this.g.length+g.g.length,e=[],n=0;n<2*t;n++)e[n]=0;for(n=0;n<this.g.length;n++)for(var C=0;C<g.g.length;C++){var o=this.i(n)>>>16,A=65535&this.i(n),u=g.i(C)>>>16,h=65535&g.i(C);e[2*n+2*C]+=A*h,d(e,2*n+2*C),e[2*n+2*C+1]+=o*h,d(e,2*n+2*C+1),e[2*n+2*C+1]+=A*u,d(e,2*n+2*C+1),e[2*n+2*C+2]+=o*u,d(e,2*n+2*C+2)}for(n=0;n<t;n++)e[n]=e[2*n+1]<<16|e[2*n];for(n=t;n<2*t;n++)e[n]=0;return new I(e,0)},g.A=function(g){return h(this,g).h},g.and=function(g){for(var t=Math.max(this.g.length,g.g.length),e=[],n=0;n<t;n++)e[n]=this.i(n)&g.i(n);return new I(e,this.h&g.h)},g.or=function(g){for(var t=Math.max(this.g.length,g.g.length),e=[],n=0;n<t;n++)e[n]=this.i(n)|g.i(n);return new I(e,this.h|g.h)},g.xor=function(g){for(var t=Math.max(this.g.length,g.g.length),e=[],n=0;n<t;n++)e[n]=this.i(n)^g.i(n);return new I(e,this.h^g.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,ut=mt.Md5=t,I.prototype.add=I.prototype.add,I.prototype.multiply=I.prototype.j,I.prototype.modulo=I.prototype.A,I.prototype.compare=I.prototype.l,I.prototype.toNumber=I.prototype.m,I.prototype.toString=I.prototype.toString,I.prototype.getBits=I.prototype.i,I.fromNumber=i,I.fromString=function g(t,e){if(0==t.length)throw Error("number format error: empty string");if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if("-"==t.charAt(0))return c(g(t.substring(1),e));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=i(Math.pow(e,8)),n=l,C=0;C<t.length;C+=8){var o=Math.min(8,t.length-C),s=parseInt(t.substring(C,C+o),e);8>o?(o=i(Math.pow(e,o)),n=n.j(o).add(i(s))):n=(n=n.j(I)).add(i(s))}return n},dt=mt.Integer=I}).apply("undefined"!==typeof ht?ht:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var Zt,bt,Gt,pt,yt,Bt,Vt,Wt,St="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},Rt={};(function(){var g,t="function"==typeof Object.defineProperties?Object.defineProperty:function(g,t,e){return g==Array.prototype||g==Object.prototype||(g[t]=e.value),g};var e=function(g){g=["object"==typeof globalThis&&globalThis,g,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof St&&St];for(var t=0;t<g.length;++t){var e=g[t];if(e&&e.Math==Math)return e}throw Error("Cannot find global object")}(this);!function(g,I){if(I)g:{var n=e;g=g.split(".");for(var C=0;C<g.length-1;C++){var i=g[C];if(!(i in n))break g;n=n[i]}(I=I(C=n[g=g[g.length-1]]))!=C&&null!=I&&t(n,g,{configurable:!0,writable:!0,value:I})}}("Array.prototype.values",(function(g){return g||function(){return function(g,t){g instanceof String&&(g+="");var e=0,I=!1,n={next:function(){if(!I&&e<g.length){var n=e++;return{value:t(n,g[n]),done:!1}}return I=!0,{done:!0,value:void 0}}};return n[Symbol.iterator]=function(){return n},n}(this,(function(g,t){return t}))}}));var I=I||{},n=this||self;function C(g){var t=typeof g;return"array"==(t="object"!=t?t:g?Array.isArray(g)?"array":t:"null")||"object"==t&&"number"==typeof g.length}function i(g){var t=typeof g;return"object"==t&&null!=g||"function"==t}function l(g,t,e){return g.call.apply(g.bind,arguments)}function o(g,t,e){if(!g)throw Error();if(2<arguments.length){var I=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,I),g.apply(t,e)}}return function(){return g.apply(t,arguments)}}function s(g,t,e){return(s=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?l:o).apply(null,arguments)}function a(g,t){var e=Array.prototype.slice.call(arguments,1);return function(){var t=e.slice();return t.push.apply(t,arguments),g.apply(this,t)}}function r(g,t){function e(){}e.prototype=t.prototype,g.aa=t.prototype,g.prototype=new e,g.prototype.constructor=g,g.Qb=function(g,e,I){for(var n=Array(arguments.length-2),C=2;C<arguments.length;C++)n[C-2]=arguments[C];return t.prototype[e].apply(g,n)}}function c(g){const t=g.length;if(0<t){const e=Array(t);for(let I=0;I<t;I++)e[I]=g[I];return e}return[]}function A(g,t){for(let e=1;e<arguments.length;e++){const t=arguments[e];if(C(t)){const e=g.length||0,I=t.length||0;g.length=e+I;for(let n=0;n<I;n++)g[e+n]=t[n]}else g.push(t)}}function d(g){return/^[\s\xa0]*$/.test(g)}function u(){var g=n.navigator;return g&&(g=g.userAgent)?g:""}function h(g){return h[" "](g),g}h[" "]=function(){};var m=-1!=u().indexOf("Gecko")&&!(-1!=u().toLowerCase().indexOf("webkit")&&-1==u().indexOf("Edge"))&&!(-1!=u().indexOf("Trident")||-1!=u().indexOf("MSIE"))&&-1==u().indexOf("Edge");function Z(g,t,e){for(const I in g)t.call(e,g[I],I,g)}function b(g){const t={};for(const e in g)t[e]=g[e];return t}const G="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function p(g,t){let e,I;for(let n=1;n<arguments.length;n++){for(e in I=arguments[n],I)g[e]=I[e];for(let t=0;t<G.length;t++)e=G[t],Object.prototype.hasOwnProperty.call(I,e)&&(g[e]=I[e])}}function y(g){var t=1;g=g.split(":");const e=[];for(;0<t&&g.length;)e.push(g.shift()),t--;return g.length&&e.push(g.join(":")),e}function B(g){n.setTimeout((()=>{throw g}),0)}function V(){var g=X;let t=null;return g.g&&(t=g.g,g.g=g.g.next,g.g||(g.h=null),t.next=null),t}var W=new class{constructor(g,t){this.i=g,this.j=t,this.h=0,this.g=null}get(){let g;return 0<this.h?(this.h--,g=this.g,this.g=g.next,g.next=null):g=this.i(),g}}((()=>new S),(g=>g.reset()));class S{constructor(){this.next=this.g=this.h=null}set(g,t){this.h=g,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let R,f=!1,X=new class{constructor(){this.h=this.g=null}add(g,t){const e=W.get();e.set(g,t),this.h?this.h.next=e:this.g=e,this.h=e}},J=()=>{const g=n.Promise.resolve(void 0);R=()=>{g.then(v)}};var v=()=>{for(var g;g=V();){try{g.h.call(g.g)}catch(e){B(e)}var t=W;t.j(g),100>t.h&&(t.h++,g.next=t.g,t.g=g)}f=!1};function k(){this.s=this.s,this.C=this.C}function Y(g,t){this.type=g,this.g=this.target=t,this.defaultPrevented=!1}k.prototype.s=!1,k.prototype.ma=function(){this.s||(this.s=!0,this.N())},k.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},Y.prototype.h=function(){this.defaultPrevented=!0};var H=function(){if(!n.addEventListener||!Object.defineProperty)return!1;var g=!1,t=Object.defineProperty({},"passive",{get:function(){g=!0}});try{const g=()=>{};n.addEventListener("test",g,t),n.removeEventListener("test",g,t)}catch(e){}return g}();function w(g,t){if(Y.call(this,g?g.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,g){var e=this.type=g.type,I=g.changedTouches&&g.changedTouches.length?g.changedTouches[0]:null;if(this.target=g.target||g.srcElement,this.g=t,t=g.relatedTarget){if(m){g:{try{h(t.nodeName);var n=!0;break g}catch(C){}n=!1}n||(t=null)}}else"mouseover"==e?t=g.fromElement:"mouseout"==e&&(t=g.toElement);this.relatedTarget=t,I?(this.clientX=void 0!==I.clientX?I.clientX:I.pageX,this.clientY=void 0!==I.clientY?I.clientY:I.pageY,this.screenX=I.screenX||0,this.screenY=I.screenY||0):(this.clientX=void 0!==g.clientX?g.clientX:g.pageX,this.clientY=void 0!==g.clientY?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0),this.button=g.button,this.key=g.key||"",this.ctrlKey=g.ctrlKey,this.altKey=g.altKey,this.shiftKey=g.shiftKey,this.metaKey=g.metaKey,this.pointerId=g.pointerId||0,this.pointerType="string"===typeof g.pointerType?g.pointerType:N[g.pointerType]||"",this.state=g.state,this.i=g,g.defaultPrevented&&w.aa.h.call(this)}}r(w,Y);var N={2:"touch",3:"pen",4:"mouse"};w.prototype.h=function(){w.aa.h.call(this);var g=this.i;g.preventDefault?g.preventDefault():g.returnValue=!1};var K="closure_listenable_"+(1e6*Math.random()|0),F=0;function E(g,t,e,I,n){this.listener=g,this.proxy=null,this.src=t,this.type=e,this.capture=!!I,this.ha=n,this.key=++F,this.da=this.fa=!1}function z(g){g.da=!0,g.listener=null,g.proxy=null,g.src=null,g.ha=null}function x(g){this.src=g,this.g={},this.h=0}function L(g,t){var e=t.type;if(e in g.g){var I,n=g.g[e],C=Array.prototype.indexOf.call(n,t,void 0);(I=0<=C)&&Array.prototype.splice.call(n,C,1),I&&(z(t),0==g.g[e].length&&(delete g.g[e],g.h--))}}function M(g,t,e,I){for(var n=0;n<g.length;++n){var C=g[n];if(!C.da&&C.listener==t&&C.capture==!!e&&C.ha==I)return n}return-1}x.prototype.add=function(g,t,e,I,n){var C=g.toString();(g=this.g[C])||(g=this.g[C]=[],this.h++);var i=M(g,t,I,n);return-1<i?(t=g[i],e||(t.fa=!1)):((t=new E(t,this.src,C,!!I,n)).fa=e,g.push(t)),t};var U="closure_lm_"+(1e6*Math.random()|0),T={};function Q(g,t,e,I,n){if(I&&I.once)return _(g,t,e,I,n);if(Array.isArray(t)){for(var C=0;C<t.length;C++)Q(g,t[C],e,I,n);return null}return e=tg(e),g&&g[K]?g.K(t,e,i(I)?!!I.capture:!!I,n):D(g,t,e,!1,I,n)}function D(g,t,e,I,n,C){if(!t)throw Error("Invalid event type");var l=i(n)?!!n.capture:!!n,o=$(g);if(o||(g[U]=o=new x(g)),(e=o.add(t,e,I,l,C)).proxy)return e;if(I=function(){function g(e){return t.call(g.src,g.listener,e)}const t=q;return g}(),e.proxy=I,I.src=g,I.listener=e,g.addEventListener)H||(n=l),void 0===n&&(n=!1),g.addEventListener(t.toString(),I,n);else if(g.attachEvent)g.attachEvent(O(t.toString()),I);else{if(!g.addListener||!g.removeListener)throw Error("addEventListener and attachEvent are unavailable.");g.addListener(I)}return e}function _(g,t,e,I,n){if(Array.isArray(t)){for(var C=0;C<t.length;C++)_(g,t[C],e,I,n);return null}return e=tg(e),g&&g[K]?g.L(t,e,i(I)?!!I.capture:!!I,n):D(g,t,e,!0,I,n)}function j(g,t,e,I,n){if(Array.isArray(t))for(var C=0;C<t.length;C++)j(g,t[C],e,I,n);else I=i(I)?!!I.capture:!!I,e=tg(e),g&&g[K]?(g=g.i,(t=String(t).toString())in g.g&&(-1<(e=M(C=g.g[t],e,I,n))&&(z(C[e]),Array.prototype.splice.call(C,e,1),0==C.length&&(delete g.g[t],g.h--)))):g&&(g=$(g))&&(t=g.g[t.toString()],g=-1,t&&(g=M(t,e,I,n)),(e=-1<g?t[g]:null)&&P(e))}function P(g){if("number"!==typeof g&&g&&!g.da){var t=g.src;if(t&&t[K])L(t.i,g);else{var e=g.type,I=g.proxy;t.removeEventListener?t.removeEventListener(e,I,g.capture):t.detachEvent?t.detachEvent(O(e),I):t.addListener&&t.removeListener&&t.removeListener(I),(e=$(t))?(L(e,g),0==e.h&&(e.src=null,t[U]=null)):z(g)}}}function O(g){return g in T?T[g]:T[g]="on"+g}function q(g,t){if(g.da)g=!0;else{t=new w(t,this);var e=g.listener,I=g.ha||g.src;g.fa&&P(g),g=e.call(I,t)}return g}function $(g){return(g=g[U])instanceof x?g:null}var gg="__closure_events_fn_"+(1e9*Math.random()>>>0);function tg(g){return"function"===typeof g?g:(g[gg]||(g[gg]=function(t){return g.handleEvent(t)}),g[gg])}function eg(){k.call(this),this.i=new x(this),this.M=this,this.F=null}function Ig(g,t){var e,I=g.F;if(I)for(e=[];I;I=I.F)e.push(I);if(g=g.M,I=t.type||t,"string"===typeof t)t=new Y(t,g);else if(t instanceof Y)t.target=t.target||g;else{var n=t;p(t=new Y(I,g),n)}if(n=!0,e)for(var C=e.length-1;0<=C;C--){var i=t.g=e[C];n=ng(i,I,!0,t)&&n}if(n=ng(i=t.g=g,I,!0,t)&&n,n=ng(i,I,!1,t)&&n,e)for(C=0;C<e.length;C++)n=ng(i=t.g=e[C],I,!1,t)&&n}function ng(g,t,e,I){if(!(t=g.i.g[String(t)]))return!0;t=t.concat();for(var n=!0,C=0;C<t.length;++C){var i=t[C];if(i&&!i.da&&i.capture==e){var l=i.listener,o=i.ha||i.src;i.fa&&L(g.i,i),n=!1!==l.call(o,I)&&n}}return n&&!I.defaultPrevented}function Cg(g,t,e){if("function"===typeof g)e&&(g=s(g,e));else{if(!g||"function"!=typeof g.handleEvent)throw Error("Invalid listener argument");g=s(g.handleEvent,g)}return 2147483647<Number(t)?-1:n.setTimeout(g,t||0)}function ig(g){g.g=Cg((()=>{g.g=null,g.i&&(g.i=!1,ig(g))}),g.l);const t=g.h;g.h=null,g.m.apply(null,t)}r(eg,k),eg.prototype[K]=!0,eg.prototype.removeEventListener=function(g,t,e,I){j(this,g,t,e,I)},eg.prototype.N=function(){if(eg.aa.N.call(this),this.i){var g,t=this.i;for(g in t.g){for(var e=t.g[g],I=0;I<e.length;I++)z(e[I]);delete t.g[g],t.h--}}this.F=null},eg.prototype.K=function(g,t,e,I){return this.i.add(String(g),t,!1,e,I)},eg.prototype.L=function(g,t,e,I){return this.i.add(String(g),t,!0,e,I)};class lg extends k{constructor(g,t){super(),this.m=g,this.l=t,this.h=null,this.i=!1,this.g=null}j(g){this.h=arguments,this.g?this.i=!0:ig(this)}N(){super.N(),this.g&&(n.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function og(g){k.call(this),this.h=g,this.g={}}r(og,k);var sg=[];function ag(g){Z(g.g,(function(g,t){this.g.hasOwnProperty(t)&&P(g)}),g),g.g={}}og.prototype.N=function(){og.aa.N.call(this),ag(this)},og.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var rg=n.JSON.stringify,cg=n.JSON.parse,Ag=class{stringify(g){return n.JSON.stringify(g,void 0)}parse(g){return n.JSON.parse(g,void 0)}};function dg(){}function ug(g){return g.h||(g.h=g.i())}function hg(){}dg.prototype.h=null;var mg={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Zg(){Y.call(this,"d")}function bg(){Y.call(this,"c")}r(Zg,Y),r(bg,Y);var Gg={},pg=null;function yg(){return pg=pg||new eg}function Bg(g){Y.call(this,Gg.La,g)}function Vg(g){const t=yg();Ig(t,new Bg(t))}function Wg(g,t){Y.call(this,Gg.STAT_EVENT,g),this.stat=t}function Sg(g){const t=yg();Ig(t,new Wg(t,g))}function Rg(g,t){Y.call(this,Gg.Ma,g),this.size=t}function fg(g,t){if("function"!==typeof g)throw Error("Fn must not be null and must be a function");return n.setTimeout((function(){g()}),t)}function Xg(){this.g=!0}function Jg(g,t,e,I){g.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(g,t){if(!g.g)return t;if(!t)return null;try{var e=JSON.parse(t);if(e)for(g=0;g<e.length;g++)if(Array.isArray(e[g])){var I=e[g];if(!(2>I.length)){var n=I[1];if(Array.isArray(n)&&!(1>n.length)){var C=n[0];if("noop"!=C&&"stop"!=C&&"close"!=C)for(var i=1;i<n.length;i++)n[i]=""}}}return rg(e)}catch(l){return t}}(g,e)+(I?" "+I:"")}))}Gg.La="serverreachability",r(Bg,Y),Gg.STAT_EVENT="statevent",r(Wg,Y),Gg.Ma="timingevent",r(Rg,Y),Xg.prototype.xa=function(){this.g=!1},Xg.prototype.info=function(){};var vg,kg={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Yg={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Hg(){}function wg(g,t,e,I){this.j=g,this.i=t,this.l=e,this.R=I||1,this.U=new og(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ng}function Ng(){this.i=null,this.g="",this.h=!1}r(Hg,dg),Hg.prototype.g=function(){return new XMLHttpRequest},Hg.prototype.i=function(){return{}},vg=new Hg;var Kg={},Fg={};function Eg(g,t,e){g.L=1,g.v=rt(it(t)),g.m=e,g.P=!0,zg(g,null)}function zg(g,t){g.F=Date.now(),Mg(g),g.A=it(g.v);var e=g.A,I=g.R;Array.isArray(I)||(I=[String(I)]),wt(e.i,"t",I),g.C=0,e=g.j.J,g.h=new Ng,g.g=ye(g.j,e?t:null,!g.m),0<g.O&&(g.M=new lg(s(g.Y,g,g.g),g.O)),t=g.U,e=g.g,I=g.ca;var n="readystatechange";Array.isArray(n)||(n&&(sg[0]=n.toString()),n=sg);for(var C=0;C<n.length;C++){var i=Q(e,n[C],I||t.handleEvent,!1,t.h||t);if(!i)break;t.g[i.key]=i}t=g.H?b(g.H):{},g.m?(g.u||(g.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",g.g.ea(g.A,g.u,g.m,t)):(g.u="GET",g.g.ea(g.A,g.u,null,t)),Vg(),function(g,t,e,I,n,C){g.info((function(){if(g.g)if(C)for(var i="",l=C.split("&"),o=0;o<l.length;o++){var s=l[o].split("=");if(1<s.length){var a=s[0];s=s[1];var r=a.split("_");i=2<=r.length&&"type"==r[1]?i+(a+"=")+s+"&":i+(a+"=redacted&")}}else i=null;else i=C;return"XMLHTTP REQ ("+I+") [attempt "+n+"]: "+t+"\n"+e+"\n"+i}))}(g.i,g.u,g.A,g.l,g.R,g.m)}function xg(g){return!!g.g&&("GET"==g.u&&2!=g.L&&g.j.Ca)}function Lg(g,t){var e=g.C,I=t.indexOf("\n",e);return-1==I?Fg:(e=Number(t.substring(e,I)),isNaN(e)?Kg:(I+=1)+e>t.length?Fg:(t=t.slice(I,I+e),g.C=I+e,t))}function Mg(g){g.S=Date.now()+g.I,Ug(g,g.I)}function Ug(g,t){if(null!=g.B)throw Error("WatchDog timer not null");g.B=fg(s(g.ba,g),t)}function Tg(g){g.B&&(n.clearTimeout(g.B),g.B=null)}function Qg(g){0==g.j.G||g.J||me(g.j,g)}function Dg(g){Tg(g);var t=g.M;t&&"function"==typeof t.ma&&t.ma(),g.M=null,ag(g.U),g.g&&(t=g.g,g.g=null,t.abort(),t.ma())}function _g(g,t){try{var e=g.j;if(0!=e.G&&(e.g==g||$g(e.h,g)))if(!g.K&&$g(e.h,g)&&3==e.G){try{var I=e.Da.g.parse(t)}catch(a){I=null}if(Array.isArray(I)&&3==I.length){var n=I;if(0==n[0]){g:if(!e.u){if(e.g){if(!(e.g.F+3e3<g.F))break g;he(e),ie(e)}Ae(e),Sg(18)}}else e.za=n[1],0<e.za-e.T&&37500>n[2]&&e.F&&0==e.v&&!e.C&&(e.C=fg(s(e.Za,e),6e3));if(1>=qg(e.h)&&e.ca){try{e.ca()}catch(a){}e.ca=void 0}}else be(e,11)}else if((g.K||e.g==g)&&he(e),!d(t))for(n=e.Da.g.parse(t),t=0;t<n.length;t++){let s=n[t];if(e.T=s[0],s=s[1],2==e.G)if("c"==s[0]){e.K=s[1],e.ia=s[2];const t=s[3];null!=t&&(e.la=t,e.j.info("VER="+e.la));const n=s[4];null!=n&&(e.Aa=n,e.j.info("SVER="+e.Aa));const a=s[5];null!=a&&"number"===typeof a&&0<a&&(I=1.5*a,e.L=I,e.j.info("backChannelRequestTimeoutMs_="+I)),I=e;const r=g.g;if(r){const g=r.g?r.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(g){var C=I.h;C.g||-1==g.indexOf("spdy")&&-1==g.indexOf("quic")&&-1==g.indexOf("h2")||(C.j=C.l,C.g=new Set,C.h&&(gt(C,C.h),C.h=null))}if(I.D){const g=r.g?r.g.getResponseHeader("X-HTTP-Session-Id"):null;g&&(I.ya=g,at(I.I,I.D,g))}}e.G=3,e.l&&e.l.ua(),e.ba&&(e.R=Date.now()-g.F,e.j.info("Handshake RTT: "+e.R+"ms"));var i=g;if((I=e).qa=pe(I,I.J?I.ia:null,I.W),i.K){tt(I.h,i);var l=i,o=I.L;o&&(l.I=o),l.B&&(Tg(l),Mg(l)),I.g=i}else ce(I);0<e.i.length&&oe(e)}else"stop"!=s[0]&&"close"!=s[0]||be(e,7);else 3==e.G&&("stop"==s[0]||"close"==s[0]?"stop"==s[0]?be(e,7):Ce(e):"noop"!=s[0]&&e.l&&e.l.ta(s),e.v=0)}Vg()}catch(a){}}wg.prototype.ca=function(g){g=g.target;const t=this.M;t&&3==te(g)?t.j():this.Y(g)},wg.prototype.Y=function(g){try{if(g==this.g)g:{const c=te(this.g);var t=this.g.Ba();this.g.Z();if(!(3>c)&&(3!=c||this.g&&(this.h.h||this.g.oa()||ee(this.g)))){this.J||4!=c||7==t||Vg(),Tg(this);var e=this.g.Z();this.X=e;t:if(xg(this)){var I=ee(this.g);g="";var C=I.length,i=4==te(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){Dg(this),Qg(this);var l="";break t}this.h.i=new n.TextDecoder}for(t=0;t<C;t++)this.h.h=!0,g+=this.h.i.decode(I[t],{stream:!(i&&t==C-1)});I.length=0,this.h.g+=g,this.C=0,l=this.h.g}else l=this.g.oa();if(this.o=200==e,function(g,t,e,I,n,C,i){g.info((function(){return"XMLHTTP RESP ("+I+") [ attempt "+n+"]: "+t+"\n"+e+"\n"+C+" "+i}))}(this.i,this.u,this.A,this.l,this.R,c,e),this.o){if(this.T&&!this.K){t:{if(this.g){var o,s=this.g;if((o=s.g?s.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!d(o)){var a=o;break t}}a=null}if(!(e=a)){this.o=!1,this.s=3,Sg(12),Dg(this),Qg(this);break g}Jg(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,_g(this,e)}if(this.P){let g;for(e=!0;!this.J&&this.C<l.length;){if(g=Lg(this,l),g==Fg){4==c&&(this.s=4,Sg(14),e=!1),Jg(this.i,this.l,null,"[Incomplete Response]");break}if(g==Kg){this.s=4,Sg(15),Jg(this.i,this.l,l,"[Invalid Chunk]"),e=!1;break}Jg(this.i,this.l,g,null),_g(this,g)}if(xg(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=c||0!=l.length||this.h.h||(this.s=1,Sg(16),e=!1),this.o=this.o&&e,e){if(0<l.length&&!this.W){this.W=!0;var r=this.j;r.g==this&&r.ba&&!r.M&&(r.j.info("Great, no buffering proxy detected. Bytes received: "+l.length),de(r),r.M=!0,Sg(11))}}else Jg(this.i,this.l,l,"[Invalid Chunked Response]"),Dg(this),Qg(this)}else Jg(this.i,this.l,l,null),_g(this,l);4==c&&Dg(this),this.o&&!this.J&&(4==c?me(this.j,this):(this.o=!1,Mg(this)))}else(function(g){const t={};g=(g.g&&2<=te(g)&&g.g.getAllResponseHeaders()||"").split("\r\n");for(let I=0;I<g.length;I++){if(d(g[I]))continue;var e=y(g[I]);const n=e[0];if("string"!==typeof(e=e[1]))continue;e=e.trim();const C=t[n]||[];t[n]=C,C.push(e)}!function(g,t){for(const e in g)t.call(void 0,g[e],e,g)}(t,(function(g){return g.join(", ")}))})(this.g),400==e&&0<l.indexOf("Unknown SID")?(this.s=3,Sg(12)):(this.s=0,Sg(13)),Dg(this),Qg(this)}}}catch(c){}},wg.prototype.cancel=function(){this.J=!0,Dg(this)},wg.prototype.ba=function(){this.B=null;const g=Date.now();0<=g-this.S?(function(g,t){g.info((function(){return"TIMEOUT: "+t}))}(this.i,this.A),2!=this.L&&(Vg(),Sg(17)),Dg(this),this.s=2,Qg(this)):Ug(this,this.S-g)};var jg=class{constructor(g,t){this.g=g,this.map=t}};function Pg(g){this.l=g||10,n.PerformanceNavigationTiming?g=0<(g=n.performance.getEntriesByType("navigation")).length&&("hq"==g[0].nextHopProtocol||"h2"==g[0].nextHopProtocol):g=!!(n.chrome&&n.chrome.loadTimes&&n.chrome.loadTimes()&&n.chrome.loadTimes().wasFetchedViaSpdy),this.j=g?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Og(g){return!!g.h||!!g.g&&g.g.size>=g.j}function qg(g){return g.h?1:g.g?g.g.size:0}function $g(g,t){return g.h?g.h==t:!!g.g&&g.g.has(t)}function gt(g,t){g.g?g.g.add(t):g.h=t}function tt(g,t){g.h&&g.h==t?g.h=null:g.g&&g.g.has(t)&&g.g.delete(t)}function et(g){if(null!=g.h)return g.i.concat(g.h.D);if(null!=g.g&&0!==g.g.size){let t=g.i;for(const e of g.g.values())t=t.concat(e.D);return t}return c(g.i)}function It(g,t){if(g.forEach&&"function"==typeof g.forEach)g.forEach(t,void 0);else if(C(g)||"string"===typeof g)Array.prototype.forEach.call(g,t,void 0);else for(var e=function(g){if(g.na&&"function"==typeof g.na)return g.na();if(!g.V||"function"!=typeof g.V){if("undefined"!==typeof Map&&g instanceof Map)return Array.from(g.keys());if(!("undefined"!==typeof Set&&g instanceof Set)){if(C(g)||"string"===typeof g){var t=[];g=g.length;for(var e=0;e<g;e++)t.push(e);return t}t=[],e=0;for(const I in g)t[e++]=I;return t}}}(g),I=function(g){if(g.V&&"function"==typeof g.V)return g.V();if("undefined"!==typeof Map&&g instanceof Map||"undefined"!==typeof Set&&g instanceof Set)return Array.from(g.values());if("string"===typeof g)return g.split("");if(C(g)){for(var t=[],e=g.length,I=0;I<e;I++)t.push(g[I]);return t}for(I in t=[],e=0,g)t[e++]=g[I];return t}(g),n=I.length,i=0;i<n;i++)t.call(void 0,I[i],e&&e[i],g)}Pg.prototype.cancel=function(){if(this.i=et(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const g of this.g.values())g.cancel();this.g.clear()}};var nt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ct(g){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,g instanceof Ct){this.h=g.h,lt(this,g.j),this.o=g.o,this.g=g.g,ot(this,g.s),this.l=g.l;var t=g.i,e=new vt;e.i=t.i,t.g&&(e.g=new Map(t.g),e.h=t.h),st(this,e),this.m=g.m}else g&&(t=String(g).match(nt))?(this.h=!1,lt(this,t[1]||"",!0),this.o=ct(t[2]||""),this.g=ct(t[3]||"",!0),ot(this,t[4]),this.l=ct(t[5]||"",!0),st(this,t[6]||"",!0),this.m=ct(t[7]||"")):(this.h=!1,this.i=new vt(null,this.h))}function it(g){return new Ct(g)}function lt(g,t,e){g.j=e?ct(t,!0):t,g.j&&(g.j=g.j.replace(/:$/,""))}function ot(g,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);g.s=t}else g.s=null}function st(g,t,e){t instanceof vt?(g.i=t,function(g,t){t&&!g.j&&(kt(g),g.i=null,g.g.forEach((function(g,t){var e=t.toLowerCase();t!=e&&(Yt(this,t),wt(this,e,g))}),g)),g.j=t}(g.i,g.h)):(e||(t=At(t,Xt)),g.i=new vt(t,g.h))}function at(g,t,e){g.i.set(t,e)}function rt(g){return at(g,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),g}function ct(g,t){return g?t?decodeURI(g.replace(/%25/g,"%2525")):decodeURIComponent(g):""}function At(g,t,e){return"string"===typeof g?(g=encodeURI(g).replace(t,dt),e&&(g=g.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g):null}function dt(g){return"%"+((g=g.charCodeAt(0))>>4&15).toString(16)+(15&g).toString(16)}Ct.prototype.toString=function(){var g=[],t=this.j;t&&g.push(At(t,ht,!0),":");var e=this.g;return(e||"file"==t)&&(g.push("//"),(t=this.o)&&g.push(At(t,ht,!0),"@"),g.push(encodeURIComponent(String(e)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(e=this.s)&&g.push(":",String(e))),(e=this.l)&&(this.g&&"/"!=e.charAt(0)&&g.push("/"),g.push(At(e,"/"==e.charAt(0)?ft:mt,!0))),(e=this.i.toString())&&g.push("?",e),(e=this.m)&&g.push("#",At(e,Jt)),g.join("")};var ut,ht=/[#\/\?@]/g,mt=/[#\?:]/g,ft=/[#\?]/g,Xt=/[#\?@]/g,Jt=/#/g;function vt(g,t){this.h=this.g=null,this.i=g||null,this.j=!!t}function kt(g){g.g||(g.g=new Map,g.h=0,g.i&&function(g,t){if(g){g=g.split("&");for(var e=0;e<g.length;e++){var I=g[e].indexOf("="),n=null;if(0<=I){var C=g[e].substring(0,I);n=g[e].substring(I+1)}else C=g[e];t(C,n?decodeURIComponent(n.replace(/\+/g," ")):"")}}}(g.i,(function(t,e){g.add(decodeURIComponent(t.replace(/\+/g," ")),e)})))}function Yt(g,t){kt(g),t=Nt(g,t),g.g.has(t)&&(g.i=null,g.h-=g.g.get(t).length,g.g.delete(t))}function Ht(g,t){return kt(g),t=Nt(g,t),g.g.has(t)}function wt(g,t,e){Yt(g,t),0<e.length&&(g.i=null,g.g.set(Nt(g,t),c(e)),g.h+=e.length)}function Nt(g,t){return t=String(t),g.j&&(t=t.toLowerCase()),t}function Kt(g,t,e,I,n){try{n&&(n.onload=null,n.onerror=null,n.onabort=null,n.ontimeout=null),I(e)}catch(C){}}function Ft(){this.g=new Ag}function Et(g,t,e){const I=e||"";try{It(g,(function(g,e){let n=g;i(g)&&(n=rg(g)),t.push(I+e+"="+encodeURIComponent(n))}))}catch(n){throw t.push(I+"type="+encodeURIComponent("_badmap")),n}}function zt(g){this.l=g.Ub||null,this.j=g.eb||!1}function xt(g,t){eg.call(this),this.D=g,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Lt(g){g.j.read().then(g.Pa.bind(g)).catch(g.ga.bind(g))}function Mt(g){g.readyState=4,g.l=null,g.j=null,g.v=null,Ut(g)}function Ut(g){g.onreadystatechange&&g.onreadystatechange.call(g)}function Tt(g){let t="";return Z(g,(function(g,e){t+=e,t+=":",t+=g,t+="\r\n"})),t}function Qt(g,t,e){g:{for(I in e){var I=!1;break g}I=!0}I||(e=Tt(e),"string"===typeof g?null!=e&&encodeURIComponent(String(e)):at(g,t,e))}function Dt(g){eg.call(this),this.headers=new Map,this.o=g||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(g=vt.prototype).add=function(g,t){kt(this),this.i=null,g=Nt(this,g);var e=this.g.get(g);return e||this.g.set(g,e=[]),e.push(t),this.h+=1,this},g.forEach=function(g,t){kt(this),this.g.forEach((function(e,I){e.forEach((function(e){g.call(t,e,I,this)}),this)}),this)},g.na=function(){kt(this);const g=Array.from(this.g.values()),t=Array.from(this.g.keys()),e=[];for(let I=0;I<t.length;I++){const n=g[I];for(let g=0;g<n.length;g++)e.push(t[I])}return e},g.V=function(g){kt(this);let t=[];if("string"===typeof g)Ht(this,g)&&(t=t.concat(this.g.get(Nt(this,g))));else{g=Array.from(this.g.values());for(let e=0;e<g.length;e++)t=t.concat(g[e])}return t},g.set=function(g,t){return kt(this),this.i=null,Ht(this,g=Nt(this,g))&&(this.h-=this.g.get(g).length),this.g.set(g,[t]),this.h+=1,this},g.get=function(g,t){return g&&0<(g=this.V(g)).length?String(g[0]):t},g.toString=function(){if(this.i)return this.i;if(!this.g)return"";const g=[],t=Array.from(this.g.keys());for(var e=0;e<t.length;e++){var I=t[e];const C=encodeURIComponent(String(I)),i=this.V(I);for(I=0;I<i.length;I++){var n=C;""!==i[I]&&(n+="="+encodeURIComponent(String(i[I]))),g.push(n)}}return this.i=g.join("&")},r(zt,dg),zt.prototype.g=function(){return new xt(this.l,this.j)},zt.prototype.i=(ut={},function(){return ut}),r(xt,eg),(g=xt.prototype).open=function(g,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=g,this.A=t,this.readyState=1,Ut(this)},g.send=function(g){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};g&&(t.body=g),(this.D||n).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},g.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Mt(this)),this.readyState=0},g.Sa=function(g){if(this.g&&(this.l=g,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=g.headers,this.readyState=2,Ut(this)),this.g&&(this.readyState=3,Ut(this),this.g)))if("arraybuffer"===this.responseType)g.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if("undefined"!==typeof n.ReadableStream&&"body"in g){if(this.j=g.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Lt(this)}else g.text().then(this.Ra.bind(this),this.ga.bind(this))},g.Pa=function(g){if(this.g){if(this.o&&g.value)this.response.push(g.value);else if(!this.o){var t=g.value?g.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!g.done}))&&(this.response=this.responseText+=t)}g.done?Mt(this):Ut(this),3==this.readyState&&Lt(this)}},g.Ra=function(g){this.g&&(this.response=this.responseText=g,Mt(this))},g.Qa=function(g){this.g&&(this.response=g,Mt(this))},g.ga=function(){this.g&&Mt(this)},g.setRequestHeader=function(g,t){this.u.append(g,t)},g.getResponseHeader=function(g){return this.h&&this.h.get(g.toLowerCase())||""},g.getAllResponseHeaders=function(){if(!this.h)return"";const g=[],t=this.h.entries();for(var e=t.next();!e.done;)e=e.value,g.push(e[0]+": "+e[1]),e=t.next();return g.join("\r\n")},Object.defineProperty(xt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(g){this.m=g?"include":"same-origin"}}),r(Dt,eg);var _t=/^https?$/i,jt=["POST","PUT"];function Pt(g,t){g.h=!1,g.g&&(g.j=!0,g.g.abort(),g.j=!1),g.l=t,g.m=5,Ot(g),$t(g)}function Ot(g){g.A||(g.A=!0,Ig(g,"complete"),Ig(g,"error"))}function qt(g){if(g.h&&"undefined"!=typeof I&&(!g.v[1]||4!=te(g)||2!=g.Z()))if(g.u&&4==te(g))Cg(g.Ea,0,g);else if(Ig(g,"readystatechange"),4==te(g)){g.h=!1;try{const I=g.Z();g:switch(I){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break g;default:t=!1}var e;if(!(e=t)){var C;if(C=0===I){var i=String(g.D).match(nt)[1]||null;!i&&n.self&&n.self.location&&(i=n.self.location.protocol.slice(0,-1)),C=!_t.test(i?i.toLowerCase():"")}e=C}if(e)Ig(g,"complete"),Ig(g,"success");else{g.m=6;try{var l=2<te(g)?g.g.statusText:""}catch(o){l=""}g.l=l+" ["+g.Z()+"]",Ot(g)}}finally{$t(g)}}}function $t(g,t){if(g.g){ge(g);const I=g.g,n=g.v[0]?()=>{}:null;g.g=null,g.v=null,t||Ig(g,"ready");try{I.onreadystatechange=n}catch(e){}}}function ge(g){g.I&&(n.clearTimeout(g.I),g.I=null)}function te(g){return g.g?g.g.readyState:0}function ee(g){try{if(!g.g)return null;if("response"in g.g)return g.g.response;switch(g.H){case"":case"text":return g.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in g.g)return g.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Ie(g,t,e){return e&&e.internalChannelParams&&e.internalChannelParams[g]||t}function ne(g){this.Aa=0,this.i=[],this.j=new Xg,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ie("failFast",!1,g),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ie("baseRetryDelayMs",5e3,g),this.cb=Ie("retryDelaySeedMs",1e4,g),this.Wa=Ie("forwardChannelMaxRetries",2,g),this.wa=Ie("forwardChannelRequestTimeoutMs",2e4,g),this.pa=g&&g.xmlHttpFactory||void 0,this.Xa=g&&g.Tb||void 0,this.Ca=g&&g.useFetchStreams||!1,this.L=void 0,this.J=g&&g.supportsCrossDomainXhr||!1,this.K="",this.h=new Pg(g&&g.concurrentRequestLimit),this.Da=new Ft,this.P=g&&g.fastHandshake||!1,this.O=g&&g.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=g&&g.Rb||!1,g&&g.xa&&this.j.xa(),g&&g.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&g&&g.detectBufferingProxy||!1,this.ja=void 0,g&&g.longPollingTimeout&&0<g.longPollingTimeout&&(this.ja=g.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Ce(g){if(le(g),3==g.G){var t=g.U++,e=it(g.I);if(at(e,"SID",g.K),at(e,"RID",t),at(e,"TYPE","terminate"),ae(g,e),(t=new wg(g,g.j,t)).L=2,t.v=rt(it(e)),e=!1,n.navigator&&n.navigator.sendBeacon)try{e=n.navigator.sendBeacon(t.v.toString(),"")}catch(I){}!e&&n.Image&&((new Image).src=t.v,e=!0),e||(t.g=ye(t.j,null),t.g.ea(t.v)),t.F=Date.now(),Mg(t)}Ge(g)}function ie(g){g.g&&(de(g),g.g.cancel(),g.g=null)}function le(g){ie(g),g.u&&(n.clearTimeout(g.u),g.u=null),he(g),g.h.cancel(),g.s&&("number"===typeof g.s&&n.clearTimeout(g.s),g.s=null)}function oe(g){if(!Og(g.h)&&!g.s){g.s=!0;var t=g.Ga;R||J(),f||(R(),f=!0),X.add(t,g),g.B=0}}function se(g,t){var e;e=t?t.l:g.U++;const I=it(g.I);at(I,"SID",g.K),at(I,"RID",e),at(I,"AID",g.T),ae(g,I),g.m&&g.o&&Qt(I,g.m,g.o),e=new wg(g,g.j,e,g.B+1),null===g.m&&(e.H=g.o),t&&(g.i=t.D.concat(g.i)),t=re(g,e,1e3),e.I=Math.round(.5*g.wa)+Math.round(.5*g.wa*Math.random()),gt(g.h,e),Eg(e,I,t)}function ae(g,t){g.H&&Z(g.H,(function(g,e){at(t,e,g)})),g.l&&It({},(function(g,e){at(t,e,g)}))}function re(g,t,e){e=Math.min(g.i.length,e);var I=g.l?s(g.l.Na,g.l,g):null;g:{var n=g.i;let t=-1;for(;;){const g=["count="+e];-1==t?0<e?(t=n[0].g,g.push("ofs="+t)):t=0:g.push("ofs="+t);let i=!0;for(let l=0;l<e;l++){let e=n[l].g;const o=n[l].map;if(e-=t,0>e)t=Math.max(0,n[l].g-100),i=!1;else try{Et(o,g,"req"+e+"_")}catch(C){I&&I(o)}}if(i){I=g.join("&");break g}}}return g=g.i.splice(0,e),t.D=g,I}function ce(g){if(!g.g&&!g.u){g.Y=1;var t=g.Fa;R||J(),f||(R(),f=!0),X.add(t,g),g.v=0}}function Ae(g){return!(g.g||g.u||3<=g.v)&&(g.Y++,g.u=fg(s(g.Fa,g),Ze(g,g.v)),g.v++,!0)}function de(g){null!=g.A&&(n.clearTimeout(g.A),g.A=null)}function ue(g){g.g=new wg(g,g.j,"rpc",g.Y),null===g.m&&(g.g.H=g.o),g.g.O=0;var t=it(g.qa);at(t,"RID","rpc"),at(t,"SID",g.K),at(t,"AID",g.T),at(t,"CI",g.F?"0":"1"),!g.F&&g.ja&&at(t,"TO",g.ja),at(t,"TYPE","xmlhttp"),ae(g,t),g.m&&g.o&&Qt(t,g.m,g.o),g.L&&(g.g.I=g.L);var e=g.g;g=g.ia,e.L=1,e.v=rt(it(t)),e.m=null,e.P=!0,zg(e,g)}function he(g){null!=g.C&&(n.clearTimeout(g.C),g.C=null)}function me(g,t){var e=null;if(g.g==t){he(g),de(g),g.g=null;var I=2}else{if(!$g(g.h,t))return;e=t.D,tt(g.h,t),I=1}if(0!=g.G)if(t.o)if(1==I){e=t.m?t.m.length:0,t=Date.now()-t.F;var n=g.B;Ig(I=yg(),new Rg(I,e)),oe(g)}else ce(g);else if(3==(n=t.s)||0==n&&0<t.X||!(1==I&&function(g,t){return!(qg(g.h)>=g.h.j-(g.s?1:0))&&(g.s?(g.i=t.D.concat(g.i),!0):!(1==g.G||2==g.G||g.B>=(g.Va?0:g.Wa))&&(g.s=fg(s(g.Ga,g,t),Ze(g,g.B)),g.B++,!0))}(g,t)||2==I&&Ae(g)))switch(e&&0<e.length&&(t=g.h,t.i=t.i.concat(e)),n){case 1:be(g,5);break;case 4:be(g,10);break;case 3:be(g,6);break;default:be(g,2)}}function Ze(g,t){let e=g.Ta+Math.floor(Math.random()*g.cb);return g.isActive()||(e*=2),e*t}function be(g,t){if(g.j.info("Error code "+t),2==t){var e=s(g.fb,g),I=g.Xa;const t=!I;I=new Ct(I||"//www.google.com/images/cleardot.gif"),n.location&&"http"==n.location.protocol||lt(I,"https"),rt(I),t?function(g,t){const e=new Xg;if(n.Image){const I=new Image;I.onload=a(Kt,e,"TestLoadImage: loaded",!0,t,I),I.onerror=a(Kt,e,"TestLoadImage: error",!1,t,I),I.onabort=a(Kt,e,"TestLoadImage: abort",!1,t,I),I.ontimeout=a(Kt,e,"TestLoadImage: timeout",!1,t,I),n.setTimeout((function(){I.ontimeout&&I.ontimeout()}),1e4),I.src=g}else t(!1)}(I.toString(),e):function(g,t){new Xg;const e=new AbortController,I=setTimeout((()=>{e.abort(),Kt(0,0,!1,t)}),1e4);fetch(g,{signal:e.signal}).then((g=>{clearTimeout(I),g.ok?Kt(0,0,!0,t):Kt(0,0,!1,t)})).catch((()=>{clearTimeout(I),Kt(0,0,!1,t)}))}(I.toString(),e)}else Sg(2);g.G=0,g.l&&g.l.sa(t),Ge(g),le(g)}function Ge(g){if(g.G=0,g.ka=[],g.l){const t=et(g.h);0==t.length&&0==g.i.length||(A(g.ka,t),A(g.ka,g.i),g.h.i.length=0,c(g.i),g.i.length=0),g.l.ra()}}function pe(g,t,e){var I=e instanceof Ct?it(e):new Ct(e);if(""!=I.g)t&&(I.g=t+"."+I.g),ot(I,I.s);else{var C=n.location;I=C.protocol,t=t?t+"."+C.hostname:C.hostname,C=+C.port;var i=new Ct(null);I&&lt(i,I),t&&(i.g=t),C&&ot(i,C),e&&(i.l=e),I=i}return e=g.D,t=g.ya,e&&t&&at(I,e,t),at(I,"VER",g.la),ae(g,I),I}function ye(g,t,e){if(t&&!g.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=g.Ca&&!g.pa?new Dt(new zt({eb:e})):new Dt(g.pa)).Ha(g.J),t}function Be(){}function Ve(){}function We(g,t){eg.call(this),this.g=new ne(t),this.l=g,this.h=t&&t.messageUrlParams||null,g=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(g?g["X-Client-Protocol"]="webchannel":g={"X-Client-Protocol":"webchannel"}),this.g.o=g,g=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(g?g["X-WebChannel-Content-Type"]=t.messageContentType:g={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(g?g["X-WebChannel-Client-Profile"]=t.va:g={"X-WebChannel-Client-Profile":t.va}),this.g.S=g,(g=t&&t.Sb)&&!d(g)&&(this.g.m=g),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!d(t)&&(this.g.D=t,null!==(g=this.h)&&t in g&&(t in(g=this.h)&&delete g[t])),this.j=new fe(this)}function Se(g){Zg.call(this),g.__headers__&&(this.headers=g.__headers__,this.statusCode=g.__status__,delete g.__headers__,delete g.__status__);var t=g.__sm__;if(t){g:{for(const e in t){g=e;break g}g=void 0}(this.i=g)&&(g=this.i,t=null!==t&&g in t?t[g]:void 0),this.data=t}else this.data=g}function Re(){bg.call(this),this.status=1}function fe(g){this.g=g}(g=Dt.prototype).Ha=function(g){this.J=g},g.ea=function(g,t,e,I){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+g);t=t?t.toUpperCase():"GET",this.D=g,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():vg.g(),this.v=this.o?ug(this.o):ug(vg),this.g.onreadystatechange=s(this.Ea,this);try{this.B=!0,this.g.open(t,String(g),!0),this.B=!1}catch(i){return void Pt(this,i)}if(g=e||"",e=new Map(this.headers),I)if(Object.getPrototypeOf(I)===Object.prototype)for(var C in I)e.set(C,I[C]);else{if("function"!==typeof I.keys||"function"!==typeof I.get)throw Error("Unknown input type for opt_headers: "+String(I));for(const g of I.keys())e.set(g,I.get(g))}I=Array.from(e.keys()).find((g=>"content-type"==g.toLowerCase())),C=n.FormData&&g instanceof n.FormData,!(0<=Array.prototype.indexOf.call(jt,t,void 0))||I||C||e.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[n,l]of e)this.g.setRequestHeader(n,l);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{ge(this),this.u=!0,this.g.send(g),this.u=!1}catch(i){Pt(this,i)}},g.abort=function(g){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=g||7,Ig(this,"complete"),Ig(this,"abort"),$t(this))},g.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),$t(this,!0)),Dt.aa.N.call(this)},g.Ea=function(){this.s||(this.B||this.u||this.j?qt(this):this.bb())},g.bb=function(){qt(this)},g.isActive=function(){return!!this.g},g.Z=function(){try{return 2<te(this)?this.g.status:-1}catch(ut){return-1}},g.oa=function(){try{return this.g?this.g.responseText:""}catch(ut){return""}},g.Oa=function(g){if(this.g){var t=this.g.responseText;return g&&0==t.indexOf(g)&&(t=t.substring(g.length)),cg(t)}},g.Ba=function(){return this.m},g.Ka=function(){return"string"===typeof this.l?this.l:String(this.l)},(g=ne.prototype).la=8,g.G=1,g.connect=function(g,t,e,I){Sg(0),this.W=g,this.H=t||{},e&&void 0!==I&&(this.H.OSID=e,this.H.OAID=I),this.F=this.X,this.I=pe(this,null,this.W),oe(this)},g.Ga=function(g){if(this.s)if(this.s=null,1==this.G){if(!g){this.U=Math.floor(1e5*Math.random()),g=this.U++;const n=new wg(this,this.j,g);let C=this.o;if(this.S&&(C?(C=b(C),p(C,this.S)):C=this.S),null!==this.m||this.O||(n.H=C,C=null),this.P)g:{for(var t=0,e=0;e<this.i.length;e++){var I=this.i[e];if(void 0===(I="__data__"in I.map&&"string"===typeof(I=I.map.__data__)?I.length:void 0))break;if(4096<(t+=I)){t=e;break g}if(4096===t||e===this.i.length-1){t=e+1;break g}}t=1e3}else t=1e3;t=re(this,n,t),at(e=it(this.I),"RID",g),at(e,"CVER",22),this.D&&at(e,"X-HTTP-Session-Id",this.D),ae(this,e),C&&(this.O?t="headers="+encodeURIComponent(String(Tt(C)))+"&"+t:this.m&&Qt(e,this.m,C)),gt(this.h,n),this.Ua&&at(e,"TYPE","init"),this.P?(at(e,"$req",t),at(e,"SID","null"),n.T=!0,Eg(n,e,null)):Eg(n,e,t),this.G=2}}else 3==this.G&&(g?se(this,g):0==this.i.length||Og(this.h)||se(this))},g.Fa=function(){if(this.u=null,ue(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var g=2*this.R;this.j.info("BP detection timer enabled: "+g),this.A=fg(s(this.ab,this),g)}},g.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Sg(10),ie(this),ue(this))},g.Za=function(){null!=this.C&&(this.C=null,ie(this),Ae(this),Sg(19))},g.fb=function(g){g?(this.j.info("Successfully pinged google.com"),Sg(2)):(this.j.info("Failed to ping google.com"),Sg(1))},g.isActive=function(){return!!this.l&&this.l.isActive(this)},(g=Be.prototype).ua=function(){},g.ta=function(){},g.sa=function(){},g.ra=function(){},g.isActive=function(){return!0},g.Na=function(){},Ve.prototype.g=function(g,t){return new We(g,t)},r(We,eg),We.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},We.prototype.close=function(){Ce(this.g)},We.prototype.o=function(g){var t=this.g;if("string"===typeof g){var e={};e.__data__=g,g=e}else this.u&&((e={}).__data__=rg(g),g=e);t.i.push(new jg(t.Ya++,g)),3==t.G&&oe(t)},We.prototype.N=function(){this.g.l=null,delete this.j,Ce(this.g),delete this.g,We.aa.N.call(this)},r(Se,Zg),r(Re,bg),r(fe,Be),fe.prototype.ua=function(){Ig(this.g,"a")},fe.prototype.ta=function(g){Ig(this.g,new Se(g))},fe.prototype.sa=function(g){Ig(this.g,new Re)},fe.prototype.ra=function(){Ig(this.g,"b")},Ve.prototype.createWebChannel=Ve.prototype.g,We.prototype.send=We.prototype.o,We.prototype.open=We.prototype.m,We.prototype.close=We.prototype.close,Wt=Rt.createWebChannelTransport=function(){return new Ve},Vt=Rt.getStatEventTarget=function(){return yg()},Bt=Rt.Event=Gg,yt=Rt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},kg.NO_ERROR=0,kg.TIMEOUT=8,kg.HTTP_ERROR=6,pt=Rt.ErrorCode=kg,Yg.COMPLETE="complete",Gt=Rt.EventType=Yg,hg.EventType=mg,mg.OPEN="a",mg.CLOSE="b",mg.ERROR="c",mg.MESSAGE="d",eg.prototype.listen=eg.prototype.K,bt=Rt.WebChannel=hg,Rt.FetchXmlHttpFactory=zt,Dt.prototype.listenOnce=Dt.prototype.L,Dt.prototype.getLastError=Dt.prototype.Ka,Dt.prototype.getLastErrorCode=Dt.prototype.Ba,Dt.prototype.getStatus=Dt.prototype.Z,Dt.prototype.getResponseJson=Dt.prototype.Oa,Dt.prototype.getResponseText=Dt.prototype.oa,Dt.prototype.send=Dt.prototype.ea,Dt.prototype.setWithCredentials=Dt.prototype.Ha,Zt=Rt.XhrIo=Dt}).apply("undefined"!==typeof St?St:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});const ft="@firebase/firestore";class Xt{constructor(g){this.uid=g}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(g){return g.uid===this.uid}}Xt.UNAUTHENTICATED=new Xt(null),Xt.GOOGLE_CREDENTIALS=new Xt("google-credentials-uid"),Xt.FIRST_PARTY=new Xt("first-party-uid"),Xt.MOCK_USER=new Xt("mock-user");let Jt="11.0.2";const vt=new O("@firebase/firestore");function kt(){return vt.logLevel}function Yt(g){if(vt.logLevel<=T.DEBUG){for(var t=arguments.length,e=new Array(t>1?t-1:0),I=1;I<t;I++)e[I-1]=arguments[I];const n=e.map(Nt);vt.debug(`Firestore (${Jt}): ${g}`,...n)}}function Ht(g){if(vt.logLevel<=T.ERROR){for(var t=arguments.length,e=new Array(t>1?t-1:0),I=1;I<t;I++)e[I-1]=arguments[I];const n=e.map(Nt);vt.error(`Firestore (${Jt}): ${g}`,...n)}}function wt(g){if(vt.logLevel<=T.WARN){for(var t=arguments.length,e=new Array(t>1?t-1:0),I=1;I<t;I++)e[I-1]=arguments[I];const n=e.map(Nt);vt.warn(`Firestore (${Jt}): ${g}`,...n)}}function Nt(g){if("string"==typeof g)return g;try{return function(g){return JSON.stringify(g)}(g)}catch(t){return g}}function Kt(){const g=`FIRESTORE (${Jt}) INTERNAL ASSERTION FAILED: `+(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state");throw Ht(g),new Error(g)}function Ft(g,t){g||Kt()}function Et(g,t){return g}const zt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class xt extends H{constructor(g,t){super(g,t),this.code=g,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Lt{constructor(){this.promise=new Promise(((g,t)=>{this.resolve=g,this.reject=t}))}}class Mt{constructor(g,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${g}`)}}class Ut{getToken(){return Promise.resolve(null)}invalidateToken(){}start(g,t){g.enqueueRetryable((()=>t(Xt.UNAUTHENTICATED)))}shutdown(){}}class Tt{constructor(g){this.token=g,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(g,t){this.changeListener=t,g.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Qt{constructor(g){this.t=g,this.currentUser=Xt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(g,t){Ft(void 0===this.o);let e=this.i;const I=g=>this.i!==e?(e=this.i,t(g)):Promise.resolve();let n=new Lt;this.o=()=>{this.i++,this.currentUser=this.u(),n.resolve(),n=new Lt,g.enqueueRetryable((()=>I(this.currentUser)))};const C=()=>{const t=n;g.enqueueRetryable((async()=>{await t.promise,await I(this.currentUser)}))},i=g=>{Yt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=g,this.o&&(this.auth.addAuthTokenListener(this.o),C())};this.t.onInit((g=>i(g))),setTimeout((()=>{if(!this.auth){const g=this.t.getImmediate({optional:!0});g?i(g):(Yt("FirebaseAuthCredentialsProvider","Auth not yet detected"),n.resolve(),n=new Lt)}}),0),C()}getToken(){const g=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==g?(Yt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Ft("string"==typeof t.accessToken),new Mt(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const g=this.auth&&this.auth.getUid();return Ft(null===g||"string"==typeof g),new Xt(g)}}class Dt{constructor(g,t,e){this.l=g,this.h=t,this.P=e,this.type="FirstParty",this.user=Xt.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const g=this.I();return g&&this.T.set("Authorization",g),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class _t{constructor(g,t,e){this.l=g,this.h=t,this.P=e}getToken(){return Promise.resolve(new Dt(this.l,this.h,this.P))}start(g,t){g.enqueueRetryable((()=>t(Xt.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class jt{constructor(g){this.value=g,this.type="AppCheck",this.headers=new Map,g&&g.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Pt{constructor(g){this.A=g,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(g,t){Ft(void 0===this.o);const e=g=>{null!=g.error&&Yt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${g.error.message}`);const e=g.token!==this.R;return this.R=g.token,Yt("FirebaseAppCheckTokenProvider",`Received ${e?"new":"existing"} token.`),e?t(g.token):Promise.resolve()};this.o=t=>{g.enqueueRetryable((()=>e(t)))};const I=g=>{Yt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=g,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit((g=>I(g))),setTimeout((()=>{if(!this.appCheck){const g=this.A.getImmediate({optional:!0});g?I(g):Yt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const g=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(g).then((g=>g?(Ft("string"==typeof g.token),this.R=g.token,new jt(g.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Ot(g){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),e=new Uint8Array(g);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(e);else for(let I=0;I<g;I++)e[I]=Math.floor(256*Math.random());return e}class qt{static newId(){const g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(256/62);let e="";for(;e.length<20;){const I=Ot(40);for(let n=0;n<I.length;++n)e.length<20&&I[n]<t&&(e+=g.charAt(I[n]%62))}return e}}function $t(g,t){return g<t?-1:g>t?1:0}function ge(g,t,e){return g.length===t.length&&g.every(((g,I)=>e(g,t[I])))}class te{static now(){return te.fromMillis(Date.now())}static fromDate(g){return te.fromMillis(g.getTime())}static fromMillis(g){const t=Math.floor(g/1e3),e=Math.floor(1e6*(g-1e3*t));return new te(t,e)}constructor(g,t){if(this.seconds=g,this.nanoseconds=t,t<0)throw new xt(zt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new xt(zt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(g<-62135596800)throw new xt(zt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+g);if(g>=253402300800)throw new xt(zt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+g)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(g){return this.seconds===g.seconds?$t(this.nanoseconds,g.nanoseconds):$t(this.seconds,g.seconds)}isEqual(g){return g.seconds===this.seconds&&g.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const g=this.seconds- -62135596800;return String(g).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ee{static fromTimestamp(g){return new ee(g)}static min(){return new ee(new te(0,0))}static max(){return new ee(new te(253402300799,999999999))}constructor(g){this.timestamp=g}compareTo(g){return this.timestamp._compareTo(g.timestamp)}isEqual(g){return this.timestamp.isEqual(g.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Ie{constructor(g,t,e){void 0===t?t=0:t>g.length&&Kt(),void 0===e?e=g.length-t:e>g.length-t&&Kt(),this.segments=g,this.offset=t,this.len=e}get length(){return this.len}isEqual(g){return 0===Ie.comparator(this,g)}child(g){const t=this.segments.slice(this.offset,this.limit());return g instanceof Ie?g.forEach((g=>{t.push(g)})):t.push(g),this.construct(t)}limit(){return this.offset+this.length}popFirst(g){return g=void 0===g?1:g,this.construct(this.segments,this.offset+g,this.length-g)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(g){return this.segments[this.offset+g]}isEmpty(){return 0===this.length}isPrefixOf(g){if(g.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==g.get(t))return!1;return!0}isImmediateParentOf(g){if(this.length+1!==g.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==g.get(t))return!1;return!0}forEach(g){for(let t=this.offset,e=this.limit();t<e;t++)g(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(g,t){const e=Math.min(g.length,t.length);for(let I=0;I<e;I++){const e=g.get(I),n=t.get(I);if(e<n)return-1;if(e>n)return 1}return g.length<t.length?-1:g.length>t.length?1:0}}class ne extends Ie{construct(g,t,e){return new ne(g,t,e)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const g=[];for(var t=arguments.length,e=new Array(t),I=0;I<t;I++)e[I]=arguments[I];for(const n of e){if(n.indexOf("//")>=0)throw new xt(zt.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);g.push(...n.split("/").filter((g=>g.length>0)))}return new ne(g)}static emptyPath(){return new ne([])}}const Ce=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ie extends Ie{construct(g,t,e){return new ie(g,t,e)}static isValidIdentifier(g){return Ce.test(g)}canonicalString(){return this.toArray().map((g=>(g=g.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ie.isValidIdentifier(g)||(g="`"+g+"`"),g))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ie(["__name__"])}static fromServerFormat(g){const t=[];let e="",I=0;const n=()=>{if(0===e.length)throw new xt(zt.INVALID_ARGUMENT,`Invalid field path (${g}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(e),e=""};let C=!1;for(;I<g.length;){const t=g[I];if("\\"===t){if(I+1===g.length)throw new xt(zt.INVALID_ARGUMENT,"Path has trailing escape character: "+g);const t=g[I+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new xt(zt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+g);e+=t,I+=2}else"`"===t?(C=!C,I++):"."!==t||C?(e+=t,I++):(n(),I++)}if(n(),C)throw new xt(zt.INVALID_ARGUMENT,"Unterminated ` in path: "+g);return new ie(t)}static emptyPath(){return new ie([])}}class le{constructor(g){this.path=g}static fromPath(g){return new le(ne.fromString(g))}static fromName(g){return new le(ne.fromString(g).popFirst(5))}static empty(){return new le(ne.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(g){return this.path.length>=2&&this.path.get(this.path.length-2)===g}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(g){return null!==g&&0===ne.comparator(this.path,g.path)}toString(){return this.path.toString()}static comparator(g,t){return ne.comparator(g.path,t.path)}static isDocumentKey(g){return g.length%2==0}static fromSegments(g){return new le(new ne(g.slice()))}}class oe{constructor(g,t,e,I){this.indexId=g,this.collectionGroup=t,this.fields=e,this.indexState=I}}oe.UNKNOWN_ID=-1;function se(g,t){const e=g.toTimestamp().seconds,I=g.toTimestamp().nanoseconds+1,n=ee.fromTimestamp(1e9===I?new te(e+1,0):new te(e,I));return new re(n,le.empty(),t)}function ae(g){return new re(g.readTime,g.key,-1)}class re{constructor(g,t,e){this.readTime=g,this.documentKey=t,this.largestBatchId=e}static min(){return new re(ee.min(),le.empty(),-1)}static max(){return new re(ee.max(),le.empty(),-1)}}function ce(g,t){let e=g.readTime.compareTo(t.readTime);return 0!==e?e:(e=le.comparator(g.documentKey,t.documentKey),0!==e?e:$t(g.largestBatchId,t.largestBatchId))}const Ae="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class de{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(g){this.onCommittedListeners.push(g)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((g=>g()))}}async function ue(g){if(g.code!==zt.FAILED_PRECONDITION||g.message!==Ae)throw g;Yt("LocalStore","Unexpectedly lost primary lease")}class he{constructor(g){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,g((g=>{this.isDone=!0,this.result=g,this.nextCallback&&this.nextCallback(g)}),(g=>{this.isDone=!0,this.error=g,this.catchCallback&&this.catchCallback(g)}))}catch(g){return this.next(void 0,g)}next(g,t){return this.callbackAttached&&Kt(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(g,this.result):new he(((e,I)=>{this.nextCallback=t=>{this.wrapSuccess(g,t).next(e,I)},this.catchCallback=g=>{this.wrapFailure(t,g).next(e,I)}}))}toPromise(){return new Promise(((g,t)=>{this.next(g,t)}))}wrapUserFunction(g){try{const t=g();return t instanceof he?t:he.resolve(t)}catch(g){return he.reject(g)}}wrapSuccess(g,t){return g?this.wrapUserFunction((()=>g(t))):he.resolve(t)}wrapFailure(g,t){return g?this.wrapUserFunction((()=>g(t))):he.reject(t)}static resolve(g){return new he(((t,e)=>{t(g)}))}static reject(g){return new he(((t,e)=>{e(g)}))}static waitFor(g){return new he(((t,e)=>{let I=0,n=0,C=!1;g.forEach((g=>{++I,g.next((()=>{++n,C&&n===I&&t()}),(g=>e(g)))})),C=!0,n===I&&t()}))}static or(g){let t=he.resolve(!1);for(const e of g)t=t.next((g=>g?he.resolve(g):e()));return t}static forEach(g,t){const e=[];return g.forEach(((g,I)=>{e.push(t.call(this,g,I))})),this.waitFor(e)}static mapArray(g,t){return new he(((e,I)=>{const n=g.length,C=new Array(n);let i=0;for(let l=0;l<n;l++){const o=l;t(g[o]).next((g=>{C[o]=g,++i,i===n&&e(C)}),(g=>I(g)))}}))}static doWhile(g,t){return new he(((e,I)=>{const n=()=>{!0===g()?t().next((()=>{n()}),I):e()};n()}))}}function me(g){const t=g.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function Ze(g){return"IndexedDbTransactionError"===g.name}class be{constructor(g,t){this.previousValue=g,t&&(t.sequenceNumberHandler=g=>this.ie(g),this.se=g=>t.writeSequenceNumber(g))}ie(g){return this.previousValue=Math.max(g,this.previousValue),this.previousValue}next(){const g=++this.previousValue;return this.se&&this.se(g),g}}function Ge(g){return null==g}function pe(g){return 0===g&&1/g==-1/0}function ye(g){return"number"==typeof g&&Number.isInteger(g)&&!pe(g)&&g<=Number.MAX_SAFE_INTEGER&&g>=Number.MIN_SAFE_INTEGER}function Be(g){let t="";for(let e=0;e<g.length;e++)t.length>0&&(t=We(t)),t=Ve(g.get(e),t);return We(t)}function Ve(g,t){let e=t;const I=g.length;for(let n=0;n<I;n++){const t=g.charAt(n);switch(t){case"\0":e+="\x01\x10";break;case"\x01":e+="\x01\x11";break;default:e+=t}}return e}function We(g){return g+"\x01\x01"}be.oe=-1;const Se=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Re=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],fe=Re,Xe=[...fe,"indexConfiguration","indexState","indexEntries"];function Je(g){let t=0;for(const e in g)Object.prototype.hasOwnProperty.call(g,e)&&t++;return t}function ve(g,t){for(const e in g)Object.prototype.hasOwnProperty.call(g,e)&&t(e,g[e])}function ke(g){for(const t in g)if(Object.prototype.hasOwnProperty.call(g,t))return!1;return!0}class Ye{constructor(g,t){this.comparator=g,this.root=t||we.EMPTY}insert(g,t){return new Ye(this.comparator,this.root.insert(g,t,this.comparator).copy(null,null,we.BLACK,null,null))}remove(g){return new Ye(this.comparator,this.root.remove(g,this.comparator).copy(null,null,we.BLACK,null,null))}get(g){let t=this.root;for(;!t.isEmpty();){const e=this.comparator(g,t.key);if(0===e)return t.value;e<0?t=t.left:e>0&&(t=t.right)}return null}indexOf(g){let t=0,e=this.root;for(;!e.isEmpty();){const I=this.comparator(g,e.key);if(0===I)return t+e.left.size;I<0?e=e.left:(t+=e.left.size+1,e=e.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(g){return this.root.inorderTraversal(g)}forEach(g){this.inorderTraversal(((t,e)=>(g(t,e),!1)))}toString(){const g=[];return this.inorderTraversal(((t,e)=>(g.push(`${t}:${e}`),!1))),`{${g.join(", ")}}`}reverseTraversal(g){return this.root.reverseTraversal(g)}getIterator(){return new He(this.root,null,this.comparator,!1)}getIteratorFrom(g){return new He(this.root,g,this.comparator,!1)}getReverseIterator(){return new He(this.root,null,this.comparator,!0)}getReverseIteratorFrom(g){return new He(this.root,g,this.comparator,!0)}}class He{constructor(g,t,e,I){this.isReverse=I,this.nodeStack=[];let n=1;for(;!g.isEmpty();)if(n=t?e(g.key,t):1,t&&I&&(n*=-1),n<0)g=this.isReverse?g.left:g.right;else{if(0===n){this.nodeStack.push(g);break}this.nodeStack.push(g),g=this.isReverse?g.right:g.left}}getNext(){let g=this.nodeStack.pop();const t={key:g.key,value:g.value};if(this.isReverse)for(g=g.left;!g.isEmpty();)this.nodeStack.push(g),g=g.right;else for(g=g.right;!g.isEmpty();)this.nodeStack.push(g),g=g.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const g=this.nodeStack[this.nodeStack.length-1];return{key:g.key,value:g.value}}}class we{constructor(g,t,e,I,n){this.key=g,this.value=t,this.color=null!=e?e:we.RED,this.left=null!=I?I:we.EMPTY,this.right=null!=n?n:we.EMPTY,this.size=this.left.size+1+this.right.size}copy(g,t,e,I,n){return new we(null!=g?g:this.key,null!=t?t:this.value,null!=e?e:this.color,null!=I?I:this.left,null!=n?n:this.right)}isEmpty(){return!1}inorderTraversal(g){return this.left.inorderTraversal(g)||g(this.key,this.value)||this.right.inorderTraversal(g)}reverseTraversal(g){return this.right.reverseTraversal(g)||g(this.key,this.value)||this.left.reverseTraversal(g)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(g,t,e){let I=this;const n=e(g,I.key);return I=n<0?I.copy(null,null,null,I.left.insert(g,t,e),null):0===n?I.copy(null,t,null,null,null):I.copy(null,null,null,null,I.right.insert(g,t,e)),I.fixUp()}removeMin(){if(this.left.isEmpty())return we.EMPTY;let g=this;return g.left.isRed()||g.left.left.isRed()||(g=g.moveRedLeft()),g=g.copy(null,null,null,g.left.removeMin(),null),g.fixUp()}remove(g,t){let e,I=this;if(t(g,I.key)<0)I.left.isEmpty()||I.left.isRed()||I.left.left.isRed()||(I=I.moveRedLeft()),I=I.copy(null,null,null,I.left.remove(g,t),null);else{if(I.left.isRed()&&(I=I.rotateRight()),I.right.isEmpty()||I.right.isRed()||I.right.left.isRed()||(I=I.moveRedRight()),0===t(g,I.key)){if(I.right.isEmpty())return we.EMPTY;e=I.right.min(),I=I.copy(e.key,e.value,null,null,I.right.removeMin())}I=I.copy(null,null,null,null,I.right.remove(g,t))}return I.fixUp()}isRed(){return this.color}fixUp(){let g=this;return g.right.isRed()&&!g.left.isRed()&&(g=g.rotateLeft()),g.left.isRed()&&g.left.left.isRed()&&(g=g.rotateRight()),g.left.isRed()&&g.right.isRed()&&(g=g.colorFlip()),g}moveRedLeft(){let g=this.colorFlip();return g.right.left.isRed()&&(g=g.copy(null,null,null,null,g.right.rotateRight()),g=g.rotateLeft(),g=g.colorFlip()),g}moveRedRight(){let g=this.colorFlip();return g.left.left.isRed()&&(g=g.rotateRight(),g=g.colorFlip()),g}rotateLeft(){const g=this.copy(null,null,we.RED,null,this.right.left);return this.right.copy(null,null,this.color,g,null)}rotateRight(){const g=this.copy(null,null,we.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,g)}colorFlip(){const g=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,g,t)}checkMaxDepth(){const g=this.check();return Math.pow(2,g)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Kt();if(this.right.isRed())throw Kt();const g=this.left.check();if(g!==this.right.check())throw Kt();return g+(this.isRed()?0:1)}}we.EMPTY=null,we.RED=!0,we.BLACK=!1,we.EMPTY=new class{constructor(){this.size=0}get key(){throw Kt()}get value(){throw Kt()}get color(){throw Kt()}get left(){throw Kt()}get right(){throw Kt()}copy(g,t,e,I,n){return this}insert(g,t,e){return new we(g,t)}remove(g,t){return this}isEmpty(){return!0}inorderTraversal(g){return!1}reverseTraversal(g){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ne{constructor(g){this.comparator=g,this.data=new Ye(this.comparator)}has(g){return null!==this.data.get(g)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(g){return this.data.indexOf(g)}forEach(g){this.data.inorderTraversal(((t,e)=>(g(t),!1)))}forEachInRange(g,t){const e=this.data.getIteratorFrom(g[0]);for(;e.hasNext();){const I=e.getNext();if(this.comparator(I.key,g[1])>=0)return;t(I.key)}}forEachWhile(g,t){let e;for(e=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();e.hasNext();)if(!g(e.getNext().key))return}firstAfterOrEqual(g){const t=this.data.getIteratorFrom(g);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ke(this.data.getIterator())}getIteratorFrom(g){return new Ke(this.data.getIteratorFrom(g))}add(g){return this.copy(this.data.remove(g).insert(g,!0))}delete(g){return this.has(g)?this.copy(this.data.remove(g)):this}isEmpty(){return this.data.isEmpty()}unionWith(g){let t=this;return t.size<g.size&&(t=g,g=this),g.forEach((g=>{t=t.add(g)})),t}isEqual(g){if(!(g instanceof Ne))return!1;if(this.size!==g.size)return!1;const t=this.data.getIterator(),e=g.data.getIterator();for(;t.hasNext();){const g=t.getNext().key,I=e.getNext().key;if(0!==this.comparator(g,I))return!1}return!0}toArray(){const g=[];return this.forEach((t=>{g.push(t)})),g}toString(){const g=[];return this.forEach((t=>g.push(t))),"SortedSet("+g.toString()+")"}copy(g){const t=new Ne(this.comparator);return t.data=g,t}}class Ke{constructor(g){this.iter=g}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Fe{constructor(g){this.fields=g,g.sort(ie.comparator)}static empty(){return new Fe([])}unionWith(g){let t=new Ne(ie.comparator);for(const e of this.fields)t=t.add(e);for(const e of g)t=t.add(e);return new Fe(t.toArray())}covers(g){for(const t of this.fields)if(t.isPrefixOf(g))return!0;return!1}isEqual(g){return ge(this.fields,g.fields,((g,t)=>g.isEqual(t)))}}class Ee extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ze{constructor(g){this.binaryString=g}static fromBase64String(g){const t=function(g){try{return atob(g)}catch(g){throw"undefined"!=typeof DOMException&&g instanceof DOMException?new Ee("Invalid base64 string: "+g):g}}(g);return new ze(t)}static fromUint8Array(g){const t=function(g){let t="";for(let e=0;e<g.length;++e)t+=String.fromCharCode(g[e]);return t}(g);return new ze(t)}[Symbol.iterator](){let g=0;return{next:()=>g<this.binaryString.length?{value:this.binaryString.charCodeAt(g++),done:!1}:{value:void 0,done:!0}}}toBase64(){return g=this.binaryString,btoa(g);var g}toUint8Array(){return function(g){const t=new Uint8Array(g.length);for(let e=0;e<g.length;e++)t[e]=g.charCodeAt(e);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(g){return $t(this.binaryString,g.binaryString)}isEqual(g){return this.binaryString===g.binaryString}}ze.EMPTY_BYTE_STRING=new ze("");const xe=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Le(g){if(Ft(!!g),"string"==typeof g){let t=0;const e=xe.exec(g);if(Ft(!!e),e[1]){let g=e[1];g=(g+"000000000").substr(0,9),t=Number(g)}const I=new Date(g);return{seconds:Math.floor(I.getTime()/1e3),nanos:t}}return{seconds:Me(g.seconds),nanos:Me(g.nanos)}}function Me(g){return"number"==typeof g?g:"string"==typeof g?Number(g):0}function Ue(g){return"string"==typeof g?ze.fromBase64String(g):ze.fromUint8Array(g)}function Te(g){var t,e;return"server_timestamp"===(null===(e=((null===(t=null==g?void 0:g.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===e?void 0:e.stringValue)}function Qe(g){const t=g.mapValue.fields.__previous_value__;return Te(t)?Qe(t):t}function De(g){const t=Le(g.mapValue.fields.__local_write_time__.timestampValue);return new te(t.seconds,t.nanos)}class _e{constructor(g,t,e,I,n,C,i,l,o){this.databaseId=g,this.appId=t,this.persistenceKey=e,this.host=I,this.ssl=n,this.forceLongPolling=C,this.autoDetectLongPolling=i,this.longPollingOptions=l,this.useFetchStreams=o}}class je{constructor(g,t){this.projectId=g,this.database=t||"(default)"}static empty(){return new je("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(g){return g instanceof je&&g.projectId===this.projectId&&g.database===this.database}}const Pe={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Oe(g){return"nullValue"in g?0:"booleanValue"in g?1:"integerValue"in g||"doubleValue"in g?2:"timestampValue"in g?3:"stringValue"in g?5:"bytesValue"in g?6:"referenceValue"in g?7:"geoPointValue"in g?8:"arrayValue"in g?9:"mapValue"in g?Te(g)?4:AI(g)?9007199254740991:rI(g)?10:11:Kt()}function qe(g,t){if(g===t)return!0;const e=Oe(g);if(e!==Oe(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return g.booleanValue===t.booleanValue;case 4:return De(g).isEqual(De(t));case 3:return function(g,t){if("string"==typeof g.timestampValue&&"string"==typeof t.timestampValue&&g.timestampValue.length===t.timestampValue.length)return g.timestampValue===t.timestampValue;const e=Le(g.timestampValue),I=Le(t.timestampValue);return e.seconds===I.seconds&&e.nanos===I.nanos}(g,t);case 5:return g.stringValue===t.stringValue;case 6:return function(g,t){return Ue(g.bytesValue).isEqual(Ue(t.bytesValue))}(g,t);case 7:return g.referenceValue===t.referenceValue;case 8:return function(g,t){return Me(g.geoPointValue.latitude)===Me(t.geoPointValue.latitude)&&Me(g.geoPointValue.longitude)===Me(t.geoPointValue.longitude)}(g,t);case 2:return function(g,t){if("integerValue"in g&&"integerValue"in t)return Me(g.integerValue)===Me(t.integerValue);if("doubleValue"in g&&"doubleValue"in t){const e=Me(g.doubleValue),I=Me(t.doubleValue);return e===I?pe(e)===pe(I):isNaN(e)&&isNaN(I)}return!1}(g,t);case 9:return ge(g.arrayValue.values||[],t.arrayValue.values||[],qe);case 10:case 11:return function(g,t){const e=g.mapValue.fields||{},I=t.mapValue.fields||{};if(Je(e)!==Je(I))return!1;for(const n in e)if(e.hasOwnProperty(n)&&(void 0===I[n]||!qe(e[n],I[n])))return!1;return!0}(g,t);default:return Kt()}}function $e(g,t){return void 0!==(g.values||[]).find((g=>qe(g,t)))}function gI(g,t){if(g===t)return 0;const e=Oe(g),I=Oe(t);if(e!==I)return $t(e,I);switch(e){case 0:case 9007199254740991:return 0;case 1:return $t(g.booleanValue,t.booleanValue);case 2:return function(g,t){const e=Me(g.integerValue||g.doubleValue),I=Me(t.integerValue||t.doubleValue);return e<I?-1:e>I?1:e===I?0:isNaN(e)?isNaN(I)?0:-1:1}(g,t);case 3:return tI(g.timestampValue,t.timestampValue);case 4:return tI(De(g),De(t));case 5:return $t(g.stringValue,t.stringValue);case 6:return function(g,t){const e=Ue(g),I=Ue(t);return e.compareTo(I)}(g.bytesValue,t.bytesValue);case 7:return function(g,t){const e=g.split("/"),I=t.split("/");for(let n=0;n<e.length&&n<I.length;n++){const g=$t(e[n],I[n]);if(0!==g)return g}return $t(e.length,I.length)}(g.referenceValue,t.referenceValue);case 8:return function(g,t){const e=$t(Me(g.latitude),Me(t.latitude));return 0!==e?e:$t(Me(g.longitude),Me(t.longitude))}(g.geoPointValue,t.geoPointValue);case 9:return eI(g.arrayValue,t.arrayValue);case 10:return function(g,t){var e,I,n,C;const i=g.fields||{},l=t.fields||{},o=null===(e=i.value)||void 0===e?void 0:e.arrayValue,s=null===(I=l.value)||void 0===I?void 0:I.arrayValue,a=$t((null===(n=null==o?void 0:o.values)||void 0===n?void 0:n.length)||0,(null===(C=null==s?void 0:s.values)||void 0===C?void 0:C.length)||0);return 0!==a?a:eI(o,s)}(g.mapValue,t.mapValue);case 11:return function(g,t){if(g===Pe.mapValue&&t===Pe.mapValue)return 0;if(g===Pe.mapValue)return 1;if(t===Pe.mapValue)return-1;const e=g.fields||{},I=Object.keys(e),n=t.fields||{},C=Object.keys(n);I.sort(),C.sort();for(let i=0;i<I.length&&i<C.length;++i){const g=$t(I[i],C[i]);if(0!==g)return g;const t=gI(e[I[i]],n[C[i]]);if(0!==t)return t}return $t(I.length,C.length)}(g.mapValue,t.mapValue);default:throw Kt()}}function tI(g,t){if("string"==typeof g&&"string"==typeof t&&g.length===t.length)return $t(g,t);const e=Le(g),I=Le(t),n=$t(e.seconds,I.seconds);return 0!==n?n:$t(e.nanos,I.nanos)}function eI(g,t){const e=g.values||[],I=t.values||[];for(let n=0;n<e.length&&n<I.length;++n){const g=gI(e[n],I[n]);if(g)return g}return $t(e.length,I.length)}function II(g){return nI(g)}function nI(g){return"nullValue"in g?"null":"booleanValue"in g?""+g.booleanValue:"integerValue"in g?""+g.integerValue:"doubleValue"in g?""+g.doubleValue:"timestampValue"in g?function(g){const t=Le(g);return`time(${t.seconds},${t.nanos})`}(g.timestampValue):"stringValue"in g?g.stringValue:"bytesValue"in g?function(g){return Ue(g).toBase64()}(g.bytesValue):"referenceValue"in g?function(g){return le.fromName(g).toString()}(g.referenceValue):"geoPointValue"in g?function(g){return`geo(${g.latitude},${g.longitude})`}(g.geoPointValue):"arrayValue"in g?function(g){let t="[",e=!0;for(const I of g.values||[])e?e=!1:t+=",",t+=nI(I);return t+"]"}(g.arrayValue):"mapValue"in g?function(g){const t=Object.keys(g.fields||{}).sort();let e="{",I=!0;for(const n of t)I?I=!1:e+=",",e+=`${n}:${nI(g.fields[n])}`;return e+"}"}(g.mapValue):Kt()}function CI(g){switch(Oe(g)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Qe(g);return t?16+CI(t):16;case 5:return 2*g.stringValue.length;case 6:return Ue(g.bytesValue).approximateByteSize();case 7:return g.referenceValue.length;case 9:return function(g){return(g.values||[]).reduce(((g,t)=>g+CI(t)),0)}(g.arrayValue);case 10:case 11:return function(g){let t=0;return ve(g.fields,((g,e)=>{t+=g.length+CI(e)})),t}(g.mapValue);default:throw Kt()}}function iI(g){return!!g&&"integerValue"in g}function lI(g){return!!g&&"arrayValue"in g}function oI(g){return!!g&&"nullValue"in g}function sI(g){return!!g&&"doubleValue"in g&&isNaN(Number(g.doubleValue))}function aI(g){return!!g&&"mapValue"in g}function rI(g){var t,e;return"__vector__"===(null===(e=((null===(t=null==g?void 0:g.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===e?void 0:e.stringValue)}function cI(g){if(g.geoPointValue)return{geoPointValue:Object.assign({},g.geoPointValue)};if(g.timestampValue&&"object"==typeof g.timestampValue)return{timestampValue:Object.assign({},g.timestampValue)};if(g.mapValue){const t={mapValue:{fields:{}}};return ve(g.mapValue.fields,((g,e)=>t.mapValue.fields[g]=cI(e))),t}if(g.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(g.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=cI(g.arrayValue.values[e]);return t}return Object.assign({},g)}function AI(g){return"__max__"===(((g.mapValue||{}).fields||{}).__type__||{}).stringValue}class dI{constructor(g){this.value=g}static empty(){return new dI({mapValue:{}})}field(g){if(g.isEmpty())return this.value;{let t=this.value;for(let e=0;e<g.length-1;++e)if(t=(t.mapValue.fields||{})[g.get(e)],!aI(t))return null;return t=(t.mapValue.fields||{})[g.lastSegment()],t||null}}set(g,t){this.getFieldsMap(g.popLast())[g.lastSegment()]=cI(t)}setAll(g){let t=ie.emptyPath(),e={},I=[];g.forEach(((g,n)=>{if(!t.isImmediateParentOf(n)){const g=this.getFieldsMap(t);this.applyChanges(g,e,I),e={},I=[],t=n.popLast()}g?e[n.lastSegment()]=cI(g):I.push(n.lastSegment())}));const n=this.getFieldsMap(t);this.applyChanges(n,e,I)}delete(g){const t=this.field(g.popLast());aI(t)&&t.mapValue.fields&&delete t.mapValue.fields[g.lastSegment()]}isEqual(g){return qe(this.value,g.value)}getFieldsMap(g){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let e=0;e<g.length;++e){let I=t.mapValue.fields[g.get(e)];aI(I)&&I.mapValue.fields||(I={mapValue:{fields:{}}},t.mapValue.fields[g.get(e)]=I),t=I}return t.mapValue.fields}applyChanges(g,t,e){ve(t,((t,e)=>g[t]=e));for(const I of e)delete g[I]}clone(){return new dI(cI(this.value))}}function uI(g){const t=[];return ve(g.fields,((g,e)=>{const I=new ie([g]);if(aI(e)){const g=uI(e.mapValue).fields;if(0===g.length)t.push(I);else for(const e of g)t.push(I.child(e))}else t.push(I)})),new Fe(t)}class hI{constructor(g,t,e,I,n,C,i){this.key=g,this.documentType=t,this.version=e,this.readTime=I,this.createTime=n,this.data=C,this.documentState=i}static newInvalidDocument(g){return new hI(g,0,ee.min(),ee.min(),ee.min(),dI.empty(),0)}static newFoundDocument(g,t,e,I){return new hI(g,1,t,ee.min(),e,I,0)}static newNoDocument(g,t){return new hI(g,2,t,ee.min(),ee.min(),dI.empty(),0)}static newUnknownDocument(g,t){return new hI(g,3,t,ee.min(),ee.min(),dI.empty(),2)}convertToFoundDocument(g,t){return!this.createTime.isEqual(ee.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=g),this.version=g,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(g){return this.version=g,this.documentType=2,this.data=dI.empty(),this.documentState=0,this}convertToUnknownDocument(g){return this.version=g,this.documentType=3,this.data=dI.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ee.min(),this}setReadTime(g){return this.readTime=g,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(g){return g instanceof hI&&this.key.isEqual(g.key)&&this.version.isEqual(g.version)&&this.documentType===g.documentType&&this.documentState===g.documentState&&this.data.isEqual(g.data)}mutableCopy(){return new hI(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class mI{constructor(g,t){this.position=g,this.inclusive=t}}function ZI(g,t,e){let I=0;for(let n=0;n<g.position.length;n++){const C=t[n],i=g.position[n];if(I=C.field.isKeyField()?le.comparator(le.fromName(i.referenceValue),e.key):gI(i,e.data.field(C.field)),"desc"===C.dir&&(I*=-1),0!==I)break}return I}function bI(g,t){if(null===g)return null===t;if(null===t)return!1;if(g.inclusive!==t.inclusive||g.position.length!==t.position.length)return!1;for(let e=0;e<g.position.length;e++)if(!qe(g.position[e],t.position[e]))return!1;return!0}class GI{constructor(g){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=g,this.dir=t}}function pI(g,t){return g.dir===t.dir&&g.field.isEqual(t.field)}class yI{}class BI extends yI{constructor(g,t,e){super(),this.field=g,this.op=t,this.value=e}static create(g,t,e){return g.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(g,t,e):new vI(g,t,e):"array-contains"===t?new wI(g,e):"in"===t?new NI(g,e):"not-in"===t?new KI(g,e):"array-contains-any"===t?new FI(g,e):new BI(g,t,e)}static createKeyFieldInFilter(g,t,e){return"in"===t?new kI(g,e):new YI(g,e)}matches(g){const t=g.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(gI(t,this.value)):null!==t&&Oe(this.value)===Oe(t)&&this.matchesComparison(gI(t,this.value))}matchesComparison(g){switch(this.op){case"<":return g<0;case"<=":return g<=0;case"==":return 0===g;case"!=":return 0!==g;case">":return g>0;case">=":return g>=0;default:return Kt()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class VI extends yI{constructor(g,t){super(),this.filters=g,this.op=t,this.ae=null}static create(g,t){return new VI(g,t)}matches(g){return WI(this)?void 0===this.filters.find((t=>!t.matches(g))):void 0!==this.filters.find((t=>t.matches(g)))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce(((g,t)=>g.concat(t.getFlattenedFilters())),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function WI(g){return"and"===g.op}function SI(g){return RI(g)&&WI(g)}function RI(g){for(const t of g.filters)if(t instanceof VI)return!1;return!0}function fI(g){if(g instanceof BI)return g.field.canonicalString()+g.op.toString()+II(g.value);if(SI(g))return g.filters.map((g=>fI(g))).join(",");{const t=g.filters.map((g=>fI(g))).join(",");return`${g.op}(${t})`}}function XI(g,t){return g instanceof BI?function(g,t){return t instanceof BI&&g.op===t.op&&g.field.isEqual(t.field)&&qe(g.value,t.value)}(g,t):g instanceof VI?function(g,t){return t instanceof VI&&g.op===t.op&&g.filters.length===t.filters.length&&g.filters.reduce(((g,e,I)=>g&&XI(e,t.filters[I])),!0)}(g,t):void Kt()}function JI(g){return g instanceof BI?function(g){return`${g.field.canonicalString()} ${g.op} ${II(g.value)}`}(g):g instanceof VI?function(g){return g.op.toString()+" {"+g.getFilters().map(JI).join(" ,")+"}"}(g):"Filter"}class vI extends BI{constructor(g,t,e){super(g,t,e),this.key=le.fromName(e.referenceValue)}matches(g){const t=le.comparator(g.key,this.key);return this.matchesComparison(t)}}class kI extends BI{constructor(g,t){super(g,"in",t),this.keys=HI("in",t)}matches(g){return this.keys.some((t=>t.isEqual(g.key)))}}class YI extends BI{constructor(g,t){super(g,"not-in",t),this.keys=HI("not-in",t)}matches(g){return!this.keys.some((t=>t.isEqual(g.key)))}}function HI(g,t){var e;return((null===(e=t.arrayValue)||void 0===e?void 0:e.values)||[]).map((g=>le.fromName(g.referenceValue)))}class wI extends BI{constructor(g,t){super(g,"array-contains",t)}matches(g){const t=g.data.field(this.field);return lI(t)&&$e(t.arrayValue,this.value)}}class NI extends BI{constructor(g,t){super(g,"in",t)}matches(g){const t=g.data.field(this.field);return null!==t&&$e(this.value.arrayValue,t)}}class KI extends BI{constructor(g,t){super(g,"not-in",t)}matches(g){if($e(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=g.data.field(this.field);return null!==t&&!$e(this.value.arrayValue,t)}}class FI extends BI{constructor(g,t){super(g,"array-contains-any",t)}matches(g){const t=g.data.field(this.field);return!(!lI(t)||!t.arrayValue.values)&&t.arrayValue.values.some((g=>$e(this.value.arrayValue,g)))}}class EI{constructor(g){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=g,this.collectionGroup=t,this.orderBy=e,this.filters=I,this.limit=n,this.startAt=C,this.endAt=i,this.ue=null}}function zI(g){return new EI(g,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function xI(g){const t=Et(g);if(null===t.ue){let g=t.path.canonicalString();null!==t.collectionGroup&&(g+="|cg:"+t.collectionGroup),g+="|f:",g+=t.filters.map((g=>fI(g))).join(","),g+="|ob:",g+=t.orderBy.map((g=>function(g){return g.field.canonicalString()+g.dir}(g))).join(","),Ge(t.limit)||(g+="|l:",g+=t.limit),t.startAt&&(g+="|lb:",g+=t.startAt.inclusive?"b:":"a:",g+=t.startAt.position.map((g=>II(g))).join(",")),t.endAt&&(g+="|ub:",g+=t.endAt.inclusive?"a:":"b:",g+=t.endAt.position.map((g=>II(g))).join(",")),t.ue=g}return t.ue}function LI(g,t){if(g.limit!==t.limit)return!1;if(g.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<g.orderBy.length;e++)if(!pI(g.orderBy[e],t.orderBy[e]))return!1;if(g.filters.length!==t.filters.length)return!1;for(let e=0;e<g.filters.length;e++)if(!XI(g.filters[e],t.filters[e]))return!1;return g.collectionGroup===t.collectionGroup&&!!g.path.isEqual(t.path)&&!!bI(g.startAt,t.startAt)&&bI(g.endAt,t.endAt)}function MI(g){return le.isDocumentKey(g.path)&&null===g.collectionGroup&&0===g.filters.length}class UI{constructor(g){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=g,this.collectionGroup=t,this.explicitOrderBy=e,this.filters=I,this.limit=n,this.limitType=C,this.startAt=i,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function TI(g,t,e,I,n,C,i,l){return new UI(g,t,e,I,n,C,i,l)}function QI(g){return new UI(g)}function DI(g){return 0===g.filters.length&&null===g.limit&&null==g.startAt&&null==g.endAt&&(0===g.explicitOrderBy.length||1===g.explicitOrderBy.length&&g.explicitOrderBy[0].field.isKeyField())}function _I(g){return null!==g.collectionGroup}function jI(g){const t=Et(g);if(null===t.ce){t.ce=[];const g=new Set;for(const n of t.explicitOrderBy)t.ce.push(n),g.add(n.field.canonicalString());const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",I=function(g){let t=new Ne(ie.comparator);return g.filters.forEach((g=>{g.getFlattenedFilters().forEach((g=>{g.isInequality()&&(t=t.add(g.field))}))})),t}(t);I.forEach((I=>{g.has(I.canonicalString())||I.isKeyField()||t.ce.push(new GI(I,e))})),g.has(ie.keyField().canonicalString())||t.ce.push(new GI(ie.keyField(),e))}return t.ce}function PI(g){const t=Et(g);return t.le||(t.le=OI(t,jI(g))),t.le}function OI(g,t){if("F"===g.limitType)return zI(g.path,g.collectionGroup,t,g.filters,g.limit,g.startAt,g.endAt);{t=t.map((g=>{const t="desc"===g.dir?"asc":"desc";return new GI(g.field,t)}));const e=g.endAt?new mI(g.endAt.position,g.endAt.inclusive):null,I=g.startAt?new mI(g.startAt.position,g.startAt.inclusive):null;return zI(g.path,g.collectionGroup,t,g.filters,g.limit,e,I)}}function qI(g,t,e){return new UI(g.path,g.collectionGroup,g.explicitOrderBy.slice(),g.filters.slice(),t,e,g.startAt,g.endAt)}function $I(g,t){return LI(PI(g),PI(t))&&g.limitType===t.limitType}function gn(g){return`${xI(PI(g))}|lt:${g.limitType}`}function tn(g){return`Query(target=${function(g){let t=g.path.canonicalString();return null!==g.collectionGroup&&(t+=" collectionGroup="+g.collectionGroup),g.filters.length>0&&(t+=`, filters: [${g.filters.map((g=>JI(g))).join(", ")}]`),Ge(g.limit)||(t+=", limit: "+g.limit),g.orderBy.length>0&&(t+=`, orderBy: [${g.orderBy.map((g=>function(g){return`${g.field.canonicalString()} (${g.dir})`}(g))).join(", ")}]`),g.startAt&&(t+=", startAt: ",t+=g.startAt.inclusive?"b:":"a:",t+=g.startAt.position.map((g=>II(g))).join(",")),g.endAt&&(t+=", endAt: ",t+=g.endAt.inclusive?"a:":"b:",t+=g.endAt.position.map((g=>II(g))).join(",")),`Target(${t})`}(PI(g))}; limitType=${g.limitType})`}function en(g,t){return t.isFoundDocument()&&function(g,t){const e=t.key.path;return null!==g.collectionGroup?t.key.hasCollectionId(g.collectionGroup)&&g.path.isPrefixOf(e):le.isDocumentKey(g.path)?g.path.isEqual(e):g.path.isImmediateParentOf(e)}(g,t)&&function(g,t){for(const e of jI(g))if(!e.field.isKeyField()&&null===t.data.field(e.field))return!1;return!0}(g,t)&&function(g,t){for(const e of g.filters)if(!e.matches(t))return!1;return!0}(g,t)&&function(g,t){return!(g.startAt&&!function(g,t,e){const I=ZI(g,t,e);return g.inclusive?I<=0:I<0}(g.startAt,jI(g),t))&&!(g.endAt&&!function(g,t,e){const I=ZI(g,t,e);return g.inclusive?I>=0:I>0}(g.endAt,jI(g),t))}(g,t)}function In(g){return g.collectionGroup||(g.path.length%2==1?g.path.lastSegment():g.path.get(g.path.length-2))}function nn(g){return(t,e)=>{let I=!1;for(const n of jI(g)){const g=Cn(n,t,e);if(0!==g)return g;I=I||n.field.isKeyField()}return 0}}function Cn(g,t,e){const I=g.field.isKeyField()?le.comparator(t.key,e.key):function(g,t,e){const I=t.data.field(g),n=e.data.field(g);return null!==I&&null!==n?gI(I,n):Kt()}(g.field,t,e);switch(g.dir){case"asc":return I;case"desc":return-1*I;default:return Kt()}}class ln{constructor(g,t){this.mapKeyFn=g,this.equalsFn=t,this.inner={},this.innerSize=0}get(g){const t=this.mapKeyFn(g),e=this.inner[t];if(void 0!==e)for(const[I,n]of e)if(this.equalsFn(I,g))return n}has(g){return void 0!==this.get(g)}set(g,t){const e=this.mapKeyFn(g),I=this.inner[e];if(void 0===I)return this.inner[e]=[[g,t]],void this.innerSize++;for(let n=0;n<I.length;n++)if(this.equalsFn(I[n][0],g))return void(I[n]=[g,t]);I.push([g,t]),this.innerSize++}delete(g){const t=this.mapKeyFn(g),e=this.inner[t];if(void 0===e)return!1;for(let I=0;I<e.length;I++)if(this.equalsFn(e[I][0],g))return 1===e.length?delete this.inner[t]:e.splice(I,1),this.innerSize--,!0;return!1}forEach(g){ve(this.inner,((t,e)=>{for(const[I,n]of e)g(I,n)}))}isEmpty(){return ke(this.inner)}size(){return this.innerSize}}const on=new Ye(le.comparator);function sn(){return on}const an=new Ye(le.comparator);function rn(){let g=an;for(var t=arguments.length,e=new Array(t),I=0;I<t;I++)e[I]=arguments[I];for(const n of e)g=g.insert(n.key,n);return g}function cn(g){let t=an;return g.forEach(((g,e)=>t=t.insert(g,e.overlayedDocument))),t}function An(){return un()}function dn(){return un()}function un(){return new ln((g=>g.toString()),((g,t)=>g.isEqual(t)))}const hn=new Ye(le.comparator),mn=new Ne(le.comparator);function Zn(){let g=mn;for(var t=arguments.length,e=new Array(t),I=0;I<t;I++)e[I]=arguments[I];for(const n of e)g=g.add(n);return g}const bn=new Ne($t);function Gn(){return bn}function pn(g,t){if(g.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:pe(t)?"-0":t}}function yn(g){return{integerValue:""+g}}function Bn(g,t){return ye(t)?yn(t):pn(g,t)}class Vn{constructor(){this._=void 0}}function Wn(g,t,e){return g instanceof fn?function(g,t){const e={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:g.seconds,nanos:g.nanoseconds}}}};return t&&Te(t)&&(t=Qe(t)),t&&(e.fields.__previous_value__=t),{mapValue:e}}(e,t):g instanceof Xn?Jn(g,t):g instanceof vn?kn(g,t):function(g,t){const e=Rn(g,t),I=Hn(e)+Hn(g.Pe);return iI(e)&&iI(g.Pe)?yn(I):pn(g.serializer,I)}(g,t)}function Sn(g,t,e){return g instanceof Xn?Jn(g,t):g instanceof vn?kn(g,t):e}function Rn(g,t){return g instanceof Yn?function(g){return iI(g)||function(g){return!!g&&"doubleValue"in g}(g)}(t)?t:{integerValue:0}:null}class fn extends Vn{}class Xn extends Vn{constructor(g){super(),this.elements=g}}function Jn(g,t){const e=wn(t);for(const I of g.elements)e.some((g=>qe(g,I)))||e.push(I);return{arrayValue:{values:e}}}class vn extends Vn{constructor(g){super(),this.elements=g}}function kn(g,t){let e=wn(t);for(const I of g.elements)e=e.filter((g=>!qe(g,I)));return{arrayValue:{values:e}}}class Yn extends Vn{constructor(g,t){super(),this.serializer=g,this.Pe=t}}function Hn(g){return Me(g.integerValue||g.doubleValue)}function wn(g){return lI(g)&&g.arrayValue.values?g.arrayValue.values.slice():[]}class Nn{constructor(g,t){this.version=g,this.transformResults=t}}class Kn{constructor(g,t){this.updateTime=g,this.exists=t}static none(){return new Kn}static exists(g){return new Kn(void 0,g)}static updateTime(g){return new Kn(g)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(g){return this.exists===g.exists&&(this.updateTime?!!g.updateTime&&this.updateTime.isEqual(g.updateTime):!g.updateTime)}}function Fn(g,t){return void 0!==g.updateTime?t.isFoundDocument()&&t.version.isEqual(g.updateTime):void 0===g.exists||g.exists===t.isFoundDocument()}class En{}function zn(g,t){if(!g.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return g.isNoDocument()?new Pn(g.key,Kn.none()):new Tn(g.key,g.data,Kn.none());{const e=g.data,I=dI.empty();let n=new Ne(ie.comparator);for(let g of t.fields)if(!n.has(g)){let t=e.field(g);null===t&&g.length>1&&(g=g.popLast(),t=e.field(g)),null===t?I.delete(g):I.set(g,t),n=n.add(g)}return new Qn(g.key,I,new Fe(n.toArray()),Kn.none())}}function xn(g,t,e){g instanceof Tn?function(g,t,e){const I=g.value.clone(),n=_n(g.fieldTransforms,t,e.transformResults);I.setAll(n),t.convertToFoundDocument(e.version,I).setHasCommittedMutations()}(g,t,e):g instanceof Qn?function(g,t,e){if(!Fn(g.precondition,t))return void t.convertToUnknownDocument(e.version);const I=_n(g.fieldTransforms,t,e.transformResults),n=t.data;n.setAll(Dn(g)),n.setAll(I),t.convertToFoundDocument(e.version,n).setHasCommittedMutations()}(g,t,e):function(g,t,e){t.convertToNoDocument(e.version).setHasCommittedMutations()}(0,t,e)}function Ln(g,t,e,I){return g instanceof Tn?function(g,t,e,I){if(!Fn(g.precondition,t))return e;const n=g.value.clone(),C=jn(g.fieldTransforms,I,t);return n.setAll(C),t.convertToFoundDocument(t.version,n).setHasLocalMutations(),null}(g,t,e,I):g instanceof Qn?function(g,t,e,I){if(!Fn(g.precondition,t))return e;const n=jn(g.fieldTransforms,I,t),C=t.data;return C.setAll(Dn(g)),C.setAll(n),t.convertToFoundDocument(t.version,C).setHasLocalMutations(),null===e?null:e.unionWith(g.fieldMask.fields).unionWith(g.fieldTransforms.map((g=>g.field)))}(g,t,e,I):function(g,t,e){return Fn(g.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):e}(g,t,e)}function Mn(g,t){let e=null;for(const I of g.fieldTransforms){const g=t.data.field(I.field),n=Rn(I.transform,g||null);null!=n&&(null===e&&(e=dI.empty()),e.set(I.field,n))}return e||null}function Un(g,t){return g.type===t.type&&!!g.key.isEqual(t.key)&&!!g.precondition.isEqual(t.precondition)&&!!function(g,t){return void 0===g&&void 0===t||!(!g||!t)&&ge(g,t,((g,t)=>function(g,t){return g.field.isEqual(t.field)&&function(g,t){return g instanceof Xn&&t instanceof Xn||g instanceof vn&&t instanceof vn?ge(g.elements,t.elements,qe):g instanceof Yn&&t instanceof Yn?qe(g.Pe,t.Pe):g instanceof fn&&t instanceof fn}(g.transform,t.transform)}(g,t)))}(g.fieldTransforms,t.fieldTransforms)&&(0===g.type?g.value.isEqual(t.value):1!==g.type||g.data.isEqual(t.data)&&g.fieldMask.isEqual(t.fieldMask))}class Tn extends En{constructor(g,t,e){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=g,this.value=t,this.precondition=e,this.fieldTransforms=I,this.type=0}getFieldMask(){return null}}class Qn extends En{constructor(g,t,e,I){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=g,this.data=t,this.fieldMask=e,this.precondition=I,this.fieldTransforms=n,this.type=1}getFieldMask(){return this.fieldMask}}function Dn(g){const t=new Map;return g.fieldMask.fields.forEach((e=>{if(!e.isEmpty()){const I=g.data.field(e);t.set(e,I)}})),t}function _n(g,t,e){const I=new Map;Ft(g.length===e.length);for(let n=0;n<e.length;n++){const C=g[n],i=C.transform,l=t.data.field(C.field);I.set(C.field,Sn(i,l,e[n]))}return I}function jn(g,t,e){const I=new Map;for(const n of g){const g=n.transform,C=e.data.field(n.field);I.set(n.field,Wn(g,C,t))}return I}class Pn extends En{constructor(g,t){super(),this.key=g,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class On extends En{constructor(g,t){super(),this.key=g,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class qn{constructor(g,t,e,I){this.batchId=g,this.localWriteTime=t,this.baseMutations=e,this.mutations=I}applyToRemoteDocument(g,t){const e=t.mutationResults;for(let I=0;I<this.mutations.length;I++){const t=this.mutations[I];t.key.isEqual(g.key)&&xn(t,g,e[I])}}applyToLocalView(g,t){for(const e of this.baseMutations)e.key.isEqual(g.key)&&(t=Ln(e,g,t,this.localWriteTime));for(const e of this.mutations)e.key.isEqual(g.key)&&(t=Ln(e,g,t,this.localWriteTime));return t}applyToLocalDocumentSet(g,t){const e=dn();return this.mutations.forEach((I=>{const n=g.get(I.key),C=n.overlayedDocument;let i=this.applyToLocalView(C,n.mutatedFields);i=t.has(I.key)?null:i;const l=zn(C,i);null!==l&&e.set(I.key,l),C.isValidDocument()||C.convertToNoDocument(ee.min())})),e}keys(){return this.mutations.reduce(((g,t)=>g.add(t.key)),Zn())}isEqual(g){return this.batchId===g.batchId&&ge(this.mutations,g.mutations,((g,t)=>Un(g,t)))&&ge(this.baseMutations,g.baseMutations,((g,t)=>Un(g,t)))}}class $n{constructor(g,t,e,I){this.batch=g,this.commitVersion=t,this.mutationResults=e,this.docVersions=I}static from(g,t,e){Ft(g.mutations.length===e.length);let I=hn;const n=g.mutations;for(let C=0;C<n.length;C++)I=I.insert(n[C].key,e[C].version);return new $n(g,t,e,I)}}class gC{constructor(g,t){this.largestBatchId=g,this.mutation=t}getKey(){return this.mutation.key}isEqual(g){return null!==g&&this.mutation===g.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class tC{constructor(g,t){this.count=g,this.unchangedNames=t}}var eC,IC;function nC(g){switch(g){default:return Kt();case zt.CANCELLED:case zt.UNKNOWN:case zt.DEADLINE_EXCEEDED:case zt.RESOURCE_EXHAUSTED:case zt.INTERNAL:case zt.UNAVAILABLE:case zt.UNAUTHENTICATED:return!1;case zt.INVALID_ARGUMENT:case zt.NOT_FOUND:case zt.ALREADY_EXISTS:case zt.PERMISSION_DENIED:case zt.FAILED_PRECONDITION:case zt.ABORTED:case zt.OUT_OF_RANGE:case zt.UNIMPLEMENTED:case zt.DATA_LOSS:return!0}}function CC(g){if(void 0===g)return Ht("GRPC error has no .code"),zt.UNKNOWN;switch(g){case eC.OK:return zt.OK;case eC.CANCELLED:return zt.CANCELLED;case eC.UNKNOWN:return zt.UNKNOWN;case eC.DEADLINE_EXCEEDED:return zt.DEADLINE_EXCEEDED;case eC.RESOURCE_EXHAUSTED:return zt.RESOURCE_EXHAUSTED;case eC.INTERNAL:return zt.INTERNAL;case eC.UNAVAILABLE:return zt.UNAVAILABLE;case eC.UNAUTHENTICATED:return zt.UNAUTHENTICATED;case eC.INVALID_ARGUMENT:return zt.INVALID_ARGUMENT;case eC.NOT_FOUND:return zt.NOT_FOUND;case eC.ALREADY_EXISTS:return zt.ALREADY_EXISTS;case eC.PERMISSION_DENIED:return zt.PERMISSION_DENIED;case eC.FAILED_PRECONDITION:return zt.FAILED_PRECONDITION;case eC.ABORTED:return zt.ABORTED;case eC.OUT_OF_RANGE:return zt.OUT_OF_RANGE;case eC.UNIMPLEMENTED:return zt.UNIMPLEMENTED;case eC.DATA_LOSS:return zt.DATA_LOSS;default:return Kt()}}(IC=eC||(eC={}))[IC.OK=0]="OK",IC[IC.CANCELLED=1]="CANCELLED",IC[IC.UNKNOWN=2]="UNKNOWN",IC[IC.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",IC[IC.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",IC[IC.NOT_FOUND=5]="NOT_FOUND",IC[IC.ALREADY_EXISTS=6]="ALREADY_EXISTS",IC[IC.PERMISSION_DENIED=7]="PERMISSION_DENIED",IC[IC.UNAUTHENTICATED=16]="UNAUTHENTICATED",IC[IC.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",IC[IC.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",IC[IC.ABORTED=10]="ABORTED",IC[IC.OUT_OF_RANGE=11]="OUT_OF_RANGE",IC[IC.UNIMPLEMENTED=12]="UNIMPLEMENTED",IC[IC.INTERNAL=13]="INTERNAL",IC[IC.UNAVAILABLE=14]="UNAVAILABLE",IC[IC.DATA_LOSS=15]="DATA_LOSS";let iC=null;function lC(){return new TextEncoder}const oC=new dt([4294967295,4294967295],0);function sC(g){const t=lC().encode(g),e=new ut;return e.update(t),new Uint8Array(e.digest())}function aC(g){const t=new DataView(g.buffer),e=t.getUint32(0,!0),I=t.getUint32(4,!0),n=t.getUint32(8,!0),C=t.getUint32(12,!0);return[new dt([e,I],0),new dt([n,C],0)]}class rC{constructor(g,t,e){if(this.bitmap=g,this.padding=t,this.hashCount=e,t<0||t>=8)throw new cC(`Invalid padding: ${t}`);if(e<0)throw new cC(`Invalid hash count: ${e}`);if(g.length>0&&0===this.hashCount)throw new cC(`Invalid hash count: ${e}`);if(0===g.length&&0!==t)throw new cC(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*g.length-t,this.Ie=dt.fromNumber(this.Te)}Ee(g,t,e){let I=g.add(t.multiply(dt.fromNumber(e)));return 1===I.compare(oC)&&(I=new dt([I.getBits(0),I.getBits(1)],0)),I.modulo(this.Ie).toNumber()}de(g){return 0!=(this.bitmap[Math.floor(g/8)]&1<<g%8)}mightContain(g){if(0===this.Te)return!1;const t=sC(g),[e,I]=aC(t);for(let n=0;n<this.hashCount;n++){const g=this.Ee(e,I,n);if(!this.de(g))return!1}return!0}static create(g,t,e){const I=g%8==0?0:8-g%8,n=new Uint8Array(Math.ceil(g/8)),C=new rC(n,I,t);return e.forEach((g=>C.insert(g))),C}insert(g){if(0===this.Te)return;const t=sC(g),[e,I]=aC(t);for(let n=0;n<this.hashCount;n++){const g=this.Ee(e,I,n);this.Ae(g)}}Ae(g){const t=Math.floor(g/8),e=g%8;this.bitmap[t]|=1<<e}}class cC extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class AC{constructor(g,t,e,I,n){this.snapshotVersion=g,this.targetChanges=t,this.targetMismatches=e,this.documentUpdates=I,this.resolvedLimboDocuments=n}static createSynthesizedRemoteEventForCurrentChange(g,t,e){const I=new Map;return I.set(g,dC.createSynthesizedTargetChangeForCurrentChange(g,t,e)),new AC(ee.min(),I,new Ye($t),sn(),Zn())}}class dC{constructor(g,t,e,I,n){this.resumeToken=g,this.current=t,this.addedDocuments=e,this.modifiedDocuments=I,this.removedDocuments=n}static createSynthesizedTargetChangeForCurrentChange(g,t,e){return new dC(e,t,Zn(),Zn(),Zn())}}class uC{constructor(g,t,e,I){this.Re=g,this.removedTargetIds=t,this.key=e,this.Ve=I}}class hC{constructor(g,t){this.targetId=g,this.me=t}}class mC{constructor(g,t){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ze.EMPTY_BYTE_STRING,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.state=g,this.targetIds=t,this.resumeToken=e,this.cause=I}}class ZC{constructor(){this.fe=0,this.ge=pC(),this.pe=ze.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(g){g.approximateByteSize()>0&&(this.we=!0,this.pe=g)}ve(){let g=Zn(),t=Zn(),e=Zn();return this.ge.forEach(((I,n)=>{switch(n){case 0:g=g.add(I);break;case 2:t=t.add(I);break;case 1:e=e.add(I);break;default:Kt()}})),new dC(this.pe,this.ye,g,t,e)}Ce(){this.we=!1,this.ge=pC()}Fe(g,t){this.we=!0,this.ge=this.ge.insert(g,t)}Me(g){this.we=!0,this.ge=this.ge.remove(g)}xe(){this.fe+=1}Oe(){this.fe-=1,Ft(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class bC{constructor(g){this.Le=g,this.Be=new Map,this.ke=sn(),this.qe=GC(),this.Qe=GC(),this.Ke=new Ye($t)}$e(g){for(const t of g.Re)g.Ve&&g.Ve.isFoundDocument()?this.Ue(t,g.Ve):this.We(t,g.key,g.Ve);for(const t of g.removedTargetIds)this.We(t,g.key,g.Ve)}Ge(g){this.forEachTarget(g,(t=>{const e=this.ze(t);switch(g.state){case 0:this.je(t)&&e.De(g.resumeToken);break;case 1:e.Oe(),e.Se||e.Ce(),e.De(g.resumeToken);break;case 2:e.Oe(),e.Se||this.removeTarget(t);break;case 3:this.je(t)&&(e.Ne(),e.De(g.resumeToken));break;case 4:this.je(t)&&(this.He(t),e.De(g.resumeToken));break;default:Kt()}}))}forEachTarget(g,t){g.targetIds.length>0?g.targetIds.forEach(t):this.Be.forEach(((g,e)=>{this.je(e)&&t(e)}))}Je(g){const t=g.targetId,e=g.me.count,I=this.Ye(t);if(I){const n=I.target;if(MI(n))if(0===e){const g=new le(n.path);this.We(t,g,hI.newNoDocument(g,ee.min()))}else Ft(1===e);else{const I=this.Ze(t);if(I!==e){const e=this.Xe(g),n=e?this.et(e,g,I):1;if(0!==n){this.He(t);const g=2===n?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,g)}null==iC||iC.tt(function(g,t,e,I,n){var C,i,l,o,s,a;const r={localCacheCount:g,existenceFilterCount:t.count,databaseId:e.database,projectId:e.projectId},c=t.unchangedNames;return c&&(r.bloomFilter={applied:0===n,hashCount:null!==(C=null==c?void 0:c.hashCount)&&void 0!==C?C:0,bitmapLength:null!==(o=null===(l=null===(i=null==c?void 0:c.bits)||void 0===i?void 0:i.bitmap)||void 0===l?void 0:l.length)&&void 0!==o?o:0,padding:null!==(a=null===(s=null==c?void 0:c.bits)||void 0===s?void 0:s.padding)&&void 0!==a?a:0,mightContain:g=>{var t;return null!==(t=null==I?void 0:I.mightContain(g))&&void 0!==t&&t}}),r}(I,g.me,this.Le.nt(),e,n))}}}}Xe(g){const t=g.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:e="",padding:I=0},hashCount:n=0}=t;let C,i;try{C=Ue(e).toUint8Array()}catch(g){if(g instanceof Ee)return wt("Decoding the base64 bloom filter in existence filter failed ("+g.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw g}try{i=new rC(C,I,n)}catch(g){return wt(g instanceof cC?"BloomFilter error: ":"Applying bloom filter failed: ",g),null}return 0===i.Te?null:i}et(g,t,e){return t.me.count===e-this.rt(g,t.targetId)?0:2}rt(g,t){const e=this.Le.getRemoteKeysForTarget(t);let I=0;return e.forEach((e=>{const n=this.Le.nt(),C=`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`;g.mightContain(C)||(this.We(t,e,null),I++)})),I}it(g){const t=new Map;this.Be.forEach(((e,I)=>{const n=this.Ye(I);if(n){if(e.current&&MI(n.target)){const t=new le(n.target.path);this.st(t).has(I)||this.ot(I,t)||this.We(I,t,hI.newNoDocument(t,g))}e.be&&(t.set(I,e.ve()),e.Ce())}}));let e=Zn();this.Qe.forEach(((g,t)=>{let I=!0;t.forEachWhile((g=>{const t=this.Ye(g);return!t||"TargetPurposeLimboResolution"===t.purpose||(I=!1,!1)})),I&&(e=e.add(g))})),this.ke.forEach(((t,e)=>e.setReadTime(g)));const I=new AC(g,t,this.Ke,this.ke,e);return this.ke=sn(),this.qe=GC(),this.Qe=GC(),this.Ke=new Ye($t),I}Ue(g,t){if(!this.je(g))return;const e=this.ot(g,t.key)?2:0;this.ze(g).Fe(t.key,e),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(g)),this.Qe=this.Qe.insert(t.key,this._t(t.key).add(g))}We(g,t,e){if(!this.je(g))return;const I=this.ze(g);this.ot(g,t)?I.Fe(t,1):I.Me(t),this.Qe=this.Qe.insert(t,this._t(t).delete(g)),this.Qe=this.Qe.insert(t,this._t(t).add(g)),e&&(this.ke=this.ke.insert(t,e))}removeTarget(g){this.Be.delete(g)}Ze(g){const t=this.ze(g).ve();return this.Le.getRemoteKeysForTarget(g).size+t.addedDocuments.size-t.removedDocuments.size}xe(g){this.ze(g).xe()}ze(g){let t=this.Be.get(g);return t||(t=new ZC,this.Be.set(g,t)),t}_t(g){let t=this.Qe.get(g);return t||(t=new Ne($t),this.Qe=this.Qe.insert(g,t)),t}st(g){let t=this.qe.get(g);return t||(t=new Ne($t),this.qe=this.qe.insert(g,t)),t}je(g){const t=null!==this.Ye(g);return t||Yt("WatchChangeAggregator","Detected inactive target",g),t}Ye(g){const t=this.Be.get(g);return t&&t.Se?null:this.Le.ut(g)}He(g){this.Be.set(g,new ZC),this.Le.getRemoteKeysForTarget(g).forEach((t=>{this.We(g,t,null)}))}ot(g,t){return this.Le.getRemoteKeysForTarget(g).has(t)}}function GC(){return new Ye(le.comparator)}function pC(){return new Ye(le.comparator)}const yC={asc:"ASCENDING",desc:"DESCENDING"},BC={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},VC={and:"AND",or:"OR"};class WC{constructor(g,t){this.databaseId=g,this.useProto3Json=t}}function SC(g,t){return g.useProto3Json||Ge(t)?t:{value:t}}function RC(g,t){return g.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function fC(g,t){return g.useProto3Json?t.toBase64():t.toUint8Array()}function XC(g,t){return RC(g,t.toTimestamp())}function JC(g){return Ft(!!g),ee.fromTimestamp(function(g){const t=Le(g);return new te(t.seconds,t.nanos)}(g))}function vC(g,t){return kC(g,t).canonicalString()}function kC(g,t){const e=function(g){return new ne(["projects",g.projectId,"databases",g.database])}(g).child("documents");return void 0===t?e:e.child(t)}function YC(g){const t=ne.fromString(g);return Ft($C(t)),t}function HC(g,t){return vC(g.databaseId,t.path)}function wC(g,t){const e=YC(t);if(e.get(1)!==g.databaseId.projectId)throw new xt(zt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+g.databaseId.projectId);if(e.get(3)!==g.databaseId.database)throw new xt(zt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+g.databaseId.database);return new le(EC(e))}function NC(g,t){return vC(g.databaseId,t)}function KC(g){const t=YC(g);return 4===t.length?ne.emptyPath():EC(t)}function FC(g){return new ne(["projects",g.databaseId.projectId,"databases",g.databaseId.database]).canonicalString()}function EC(g){return Ft(g.length>4&&"documents"===g.get(4)),g.popFirst(5)}function zC(g,t,e){return{name:HC(g,t),fields:e.value.mapValue.fields}}function xC(g,t){let e;if(t instanceof Tn)e={update:zC(g,t.key,t.value)};else if(t instanceof Pn)e={delete:HC(g,t.key)};else if(t instanceof Qn)e={update:zC(g,t.key,t.data),updateMask:qC(t.fieldMask)};else{if(!(t instanceof On))return Kt();e={verify:HC(g,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map((g=>function(g,t){const e=t.transform;if(e instanceof fn)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(e instanceof Xn)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:e.elements}};if(e instanceof vn)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:e.elements}};if(e instanceof Yn)return{fieldPath:t.field.canonicalString(),increment:e.Pe};throw Kt()}(0,g)))),t.precondition.isNone||(e.currentDocument=function(g,t){return void 0!==t.updateTime?{updateTime:XC(g,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Kt()}(g,t.precondition)),e}function LC(g,t){return{documents:[NC(g,t.path)]}}function MC(g,t){const e={structuredQuery:{}},I=t.path;let n;null!==t.collectionGroup?(n=I,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n=I.popLast(),e.structuredQuery.from=[{collectionId:I.lastSegment()}]),e.parent=NC(g,n);const C=function(g){if(0!==g.length)return OC(VI.create(g,"and"))}(t.filters);C&&(e.structuredQuery.where=C);const i=function(g){if(0!==g.length)return g.map((g=>function(g){return{field:jC(g.field),direction:QC(g.dir)}}(g)))}(t.orderBy);i&&(e.structuredQuery.orderBy=i);const l=SC(g,t.limit);return null!==l&&(e.structuredQuery.limit=l),t.startAt&&(e.structuredQuery.startAt=function(g){return{before:g.inclusive,values:g.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(g){return{before:!g.inclusive,values:g.position}}(t.endAt)),{ct:e,parent:n}}function UC(g){let t=KC(g.parent);const e=g.structuredQuery,I=e.from?e.from.length:0;let n=null;if(I>0){Ft(1===I);const g=e.from[0];g.allDescendants?n=g.collectionId:t=t.child(g.collectionId)}let C=[];e.where&&(C=function(g){const t=TC(g);return t instanceof VI&&SI(t)?t.getFilters():[t]}(e.where));let i=[];e.orderBy&&(i=function(g){return g.map((g=>function(g){return new GI(PC(g.field),function(g){switch(g){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(g.direction))}(g)))}(e.orderBy));let l=null;e.limit&&(l=function(g){let t;return t="object"==typeof g?g.value:g,Ge(t)?null:t}(e.limit));let o=null;e.startAt&&(o=function(g){const t=!!g.before,e=g.values||[];return new mI(e,t)}(e.startAt));let s=null;return e.endAt&&(s=function(g){const t=!g.before,e=g.values||[];return new mI(e,t)}(e.endAt)),TI(t,n,i,C,l,"F",o,s)}function TC(g){return void 0!==g.unaryFilter?function(g){switch(g.unaryFilter.op){case"IS_NAN":const t=PC(g.unaryFilter.field);return BI.create(t,"==",{doubleValue:NaN});case"IS_NULL":const e=PC(g.unaryFilter.field);return BI.create(e,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const I=PC(g.unaryFilter.field);return BI.create(I,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const n=PC(g.unaryFilter.field);return BI.create(n,"!=",{nullValue:"NULL_VALUE"});default:return Kt()}}(g):void 0!==g.fieldFilter?function(g){return BI.create(PC(g.fieldFilter.field),function(g){switch(g){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Kt()}}(g.fieldFilter.op),g.fieldFilter.value)}(g):void 0!==g.compositeFilter?function(g){return VI.create(g.compositeFilter.filters.map((g=>TC(g))),function(g){switch(g){case"AND":return"and";case"OR":return"or";default:return Kt()}}(g.compositeFilter.op))}(g):Kt()}function QC(g){return yC[g]}function DC(g){return BC[g]}function _C(g){return VC[g]}function jC(g){return{fieldPath:g.canonicalString()}}function PC(g){return ie.fromServerFormat(g.fieldPath)}function OC(g){return g instanceof BI?function(g){if("=="===g.op){if(sI(g.value))return{unaryFilter:{field:jC(g.field),op:"IS_NAN"}};if(oI(g.value))return{unaryFilter:{field:jC(g.field),op:"IS_NULL"}}}else if("!="===g.op){if(sI(g.value))return{unaryFilter:{field:jC(g.field),op:"IS_NOT_NAN"}};if(oI(g.value))return{unaryFilter:{field:jC(g.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:jC(g.field),op:DC(g.op),value:g.value}}}(g):g instanceof VI?function(g){const t=g.getFilters().map((g=>OC(g)));return 1===t.length?t[0]:{compositeFilter:{op:_C(g.op),filters:t}}}(g):Kt()}function qC(g){const t=[];return g.fields.forEach((g=>t.push(g.canonicalString()))),{fieldPaths:t}}function $C(g){return g.length>=4&&"projects"===g.get(0)&&"databases"===g.get(2)}class gi{constructor(g,t,e,I){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ee.min(),C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:ee.min(),i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:ze.EMPTY_BYTE_STRING,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.target=g,this.targetId=t,this.purpose=e,this.sequenceNumber=I,this.snapshotVersion=n,this.lastLimboFreeSnapshotVersion=C,this.resumeToken=i,this.expectedCount=l}withSequenceNumber(g){return new gi(this.target,this.targetId,this.purpose,g,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(g,t){return new gi(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,g,null)}withExpectedCount(g){return new gi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,g)}withLastLimboFreeSnapshotVersion(g){return new gi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,g,this.resumeToken,this.expectedCount)}}class ti{constructor(g){this.ht=g}}function ei(g){const t=UC({parent:g.parent,structuredQuery:g.structuredQuery});return"LAST"===g.limitType?qI(t,t.limit,"L"):t}class Ii{constructor(){}Et(g,t){this.dt(g,t),t.At()}dt(g,t){if("nullValue"in g)this.Rt(t,5);else if("booleanValue"in g)this.Rt(t,10),t.Vt(g.booleanValue?1:0);else if("integerValue"in g)this.Rt(t,15),t.Vt(Me(g.integerValue));else if("doubleValue"in g){const e=Me(g.doubleValue);isNaN(e)?this.Rt(t,13):(this.Rt(t,15),pe(e)?t.Vt(0):t.Vt(e))}else if("timestampValue"in g){let e=g.timestampValue;this.Rt(t,20),"string"==typeof e&&(e=Le(e)),t.ft(`${e.seconds||""}`),t.Vt(e.nanos||0)}else if("stringValue"in g)this.gt(g.stringValue,t),this.yt(t);else if("bytesValue"in g)this.Rt(t,30),t.wt(Ue(g.bytesValue)),this.yt(t);else if("referenceValue"in g)this.St(g.referenceValue,t);else if("geoPointValue"in g){const e=g.geoPointValue;this.Rt(t,45),t.Vt(e.latitude||0),t.Vt(e.longitude||0)}else"mapValue"in g?AI(g)?this.Rt(t,Number.MAX_SAFE_INTEGER):rI(g)?this.bt(g.mapValue,t):(this.Dt(g.mapValue,t),this.yt(t)):"arrayValue"in g?(this.vt(g.arrayValue,t),this.yt(t)):Kt()}gt(g,t){this.Rt(t,25),this.Ct(g,t)}Ct(g,t){t.ft(g)}Dt(g,t){const e=g.fields||{};this.Rt(t,55);for(const I of Object.keys(e))this.gt(I,t),this.dt(e[I],t)}bt(g,t){var e,I;const n=g.fields||{};this.Rt(t,53);const C="value",i=(null===(I=null===(e=n[C].arrayValue)||void 0===e?void 0:e.values)||void 0===I?void 0:I.length)||0;this.Rt(t,15),t.Vt(Me(i)),this.gt(C,t),this.dt(n[C],t)}vt(g,t){const e=g.values||[];this.Rt(t,50);for(const I of e)this.dt(I,t)}St(g,t){this.Rt(t,37),le.fromName(g).path.forEach((g=>{this.Rt(t,60),this.Ct(g,t)}))}Rt(g,t){g.Vt(t)}yt(g){g.Vt(2)}}Ii.Ft=new Ii;class ni{constructor(){this.ln=new Ci}addToCollectionParentIndex(g,t){return this.ln.add(t),he.resolve()}getCollectionParents(g,t){return he.resolve(this.ln.getEntries(t))}addFieldIndex(g,t){return he.resolve()}deleteFieldIndex(g,t){return he.resolve()}deleteAllFieldIndexes(g){return he.resolve()}createTargetIndexes(g,t){return he.resolve()}getDocumentsMatchingTarget(g,t){return he.resolve(null)}getIndexType(g,t){return he.resolve(0)}getFieldIndexes(g,t){return he.resolve([])}getNextCollectionGroupToUpdate(g){return he.resolve(null)}getMinOffset(g,t){return he.resolve(re.min())}getMinOffsetFromCollectionGroup(g,t){return he.resolve(re.min())}updateCollectionGroup(g,t,e){return he.resolve()}updateIndexEntries(g,t){return he.resolve()}}class Ci{constructor(){this.index={}}add(g){const t=g.lastSegment(),e=g.popLast(),I=this.index[t]||new Ne(ne.comparator),n=!I.has(e);return this.index[t]=I.add(e),n}has(g){const t=g.lastSegment(),e=g.popLast(),I=this.index[t];return I&&I.has(e)}getEntries(g){return(this.index[g]||new Ne(ne.comparator)).toArray()}}new Uint8Array(0);const ii={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class li{static withCacheSize(g){return new li(g,li.DEFAULT_COLLECTION_PERCENTILE,li.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(g,t,e){this.cacheSizeCollectionThreshold=g,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=e}}li.DEFAULT_COLLECTION_PERCENTILE=10,li.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,li.DEFAULT=new li(41943040,li.DEFAULT_COLLECTION_PERCENTILE,li.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),li.DISABLED=new li(-1,0,0);class oi{constructor(g){this.kn=g}next(){return this.kn+=2,this.kn}static qn(){return new oi(0)}static Qn(){return new oi(-1)}}function si(g,t){let[e,I]=g,[n,C]=t;const i=$t(e,n);return 0===i?$t(I,C):i}class ai{constructor(g){this.Gn=g,this.buffer=new Ne(si),this.zn=0}jn(){return++this.zn}Hn(g){const t=[g,this.jn()];if(this.buffer.size<this.Gn)this.buffer=this.buffer.add(t);else{const g=this.buffer.last();si(t,g)<0&&(this.buffer=this.buffer.delete(g).add(t))}}get maxValue(){return this.buffer.last()[0]}}class ri{constructor(g,t,e){this.garbageCollector=g,this.asyncQueue=t,this.localStore=e,this.Jn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Yn(6e4)}stop(){this.Jn&&(this.Jn.cancel(),this.Jn=null)}get started(){return null!==this.Jn}Yn(g){Yt("LruGarbageCollector",`Garbage collection scheduled in ${g}ms`),this.Jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",g,(async()=>{this.Jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(g){Ze(g)?Yt("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",g):await ue(g)}await this.Yn(3e5)}))}}class ci{constructor(g,t){this.Zn=g,this.params=t}calculateTargetCount(g,t){return this.Zn.Xn(g).next((g=>Math.floor(t/100*g)))}nthSequenceNumber(g,t){if(0===t)return he.resolve(be.oe);const e=new ai(t);return this.Zn.forEachTarget(g,(g=>e.Hn(g.sequenceNumber))).next((()=>this.Zn.er(g,(g=>e.Hn(g))))).next((()=>e.maxValue))}removeTargets(g,t,e){return this.Zn.removeTargets(g,t,e)}removeOrphanedDocuments(g,t){return this.Zn.removeOrphanedDocuments(g,t)}collect(g,t){return-1===this.params.cacheSizeCollectionThreshold?(Yt("LruGarbageCollector","Garbage collection skipped; disabled"),he.resolve(ii)):this.getCacheSize(g).next((e=>e<this.params.cacheSizeCollectionThreshold?(Yt("LruGarbageCollector",`Garbage collection skipped; Cache size ${e} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ii):this.tr(g,t)))}getCacheSize(g){return this.Zn.getCacheSize(g)}tr(g,t){let e,I,n,C,i,l,o;const s=Date.now();return this.calculateTargetCount(g,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(Yt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),I=this.params.maximumSequenceNumbersToCollect):I=t,C=Date.now(),this.nthSequenceNumber(g,I)))).next((I=>(e=I,i=Date.now(),this.removeTargets(g,e,t)))).next((t=>(n=t,l=Date.now(),this.removeOrphanedDocuments(g,e)))).next((g=>(o=Date.now(),kt()<=T.DEBUG&&Yt("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${C-s}ms\n\tDetermined least recently used ${I} in `+(i-C)+"ms\n"+`\tRemoved ${n} targets in `+(l-i)+"ms\n"+`\tRemoved ${g} documents in `+(o-l)+"ms\n"+`Total Duration: ${o-s}ms`),he.resolve({didRun:!0,sequenceNumbersCollected:I,targetsRemoved:n,documentsRemoved:g}))))}}function Ai(g,t){return new ci(g,t)}class di{constructor(){this.changes=new ln((g=>g.toString()),((g,t)=>g.isEqual(t))),this.changesApplied=!1}addEntry(g){this.assertNotApplied(),this.changes.set(g.key,g)}removeEntry(g,t){this.assertNotApplied(),this.changes.set(g,hI.newInvalidDocument(g).setReadTime(t))}getEntry(g,t){this.assertNotApplied();const e=this.changes.get(t);return void 0!==e?he.resolve(e):this.getFromCache(g,t)}getEntries(g,t){return this.getAllFromCache(g,t)}apply(g){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(g)}assertNotApplied(){}}class ui{constructor(g,t){this.overlayedDocument=g,this.mutatedFields=t}}class hi{constructor(g,t,e,I){this.remoteDocumentCache=g,this.mutationQueue=t,this.documentOverlayCache=e,this.indexManager=I}getDocument(g,t){let e=null;return this.documentOverlayCache.getOverlay(g,t).next((I=>(e=I,this.remoteDocumentCache.getEntry(g,t)))).next((g=>(null!==e&&Ln(e.mutation,g,Fe.empty(),te.now()),g)))}getDocuments(g,t){return this.remoteDocumentCache.getEntries(g,t).next((t=>this.getLocalViewOfDocuments(g,t,Zn()).next((()=>t))))}getLocalViewOfDocuments(g,t){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Zn();const I=An();return this.populateOverlays(g,I,t).next((()=>this.computeViews(g,t,I,e).next((g=>{let t=rn();return g.forEach(((g,e)=>{t=t.insert(g,e.overlayedDocument)})),t}))))}getOverlayedDocuments(g,t){const e=An();return this.populateOverlays(g,e,t).next((()=>this.computeViews(g,t,e,Zn())))}populateOverlays(g,t,e){const I=[];return e.forEach((g=>{t.has(g)||I.push(g)})),this.documentOverlayCache.getOverlays(g,I).next((g=>{g.forEach(((g,e)=>{t.set(g,e)}))}))}computeViews(g,t,e,I){let n=sn();const C=un(),i=un();return t.forEach(((g,t)=>{const i=e.get(t.key);I.has(t.key)&&(void 0===i||i.mutation instanceof Qn)?n=n.insert(t.key,t):void 0!==i?(C.set(t.key,i.mutation.getFieldMask()),Ln(i.mutation,t,i.mutation.getFieldMask(),te.now())):C.set(t.key,Fe.empty())})),this.recalculateAndSaveOverlays(g,n).next((g=>(g.forEach(((g,t)=>C.set(g,t))),t.forEach(((g,t)=>{var e;return i.set(g,new ui(t,null!==(e=C.get(g))&&void 0!==e?e:null))})),i)))}recalculateAndSaveOverlays(g,t){const e=un();let I=new Ye(((g,t)=>g-t)),n=Zn();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(g,t).next((g=>{for(const n of g)n.keys().forEach((g=>{const C=t.get(g);if(null===C)return;let i=e.get(g)||Fe.empty();i=n.applyToLocalView(C,i),e.set(g,i);const l=(I.get(n.batchId)||Zn()).add(g);I=I.insert(n.batchId,l)}))})).next((()=>{const C=[],i=I.getReverseIterator();for(;i.hasNext();){const I=i.getNext(),l=I.key,o=I.value,s=dn();o.forEach((g=>{if(!n.has(g)){const I=zn(t.get(g),e.get(g));null!==I&&s.set(g,I),n=n.add(g)}})),C.push(this.documentOverlayCache.saveOverlays(g,l,s))}return he.waitFor(C)})).next((()=>e))}recalculateAndSaveOverlaysForDocumentKeys(g,t){return this.remoteDocumentCache.getEntries(g,t).next((t=>this.recalculateAndSaveOverlays(g,t)))}getDocumentsMatchingQuery(g,t,e,I){return function(g){return le.isDocumentKey(g.path)&&null===g.collectionGroup&&0===g.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(g,t.path):_I(t)?this.getDocumentsMatchingCollectionGroupQuery(g,t,e,I):this.getDocumentsMatchingCollectionQuery(g,t,e,I)}getNextDocuments(g,t,e,I){return this.remoteDocumentCache.getAllFromCollectionGroup(g,t,e,I).next((n=>{const C=I-n.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(g,t,e.largestBatchId,I-n.size):he.resolve(An());let i=-1,l=n;return C.next((t=>he.forEach(t,((t,e)=>(i<e.largestBatchId&&(i=e.largestBatchId),n.get(t)?he.resolve():this.remoteDocumentCache.getEntry(g,t).next((g=>{l=l.insert(t,g)}))))).next((()=>this.populateOverlays(g,t,n))).next((()=>this.computeViews(g,l,t,Zn()))).next((g=>({batchId:i,changes:cn(g)})))))}))}getDocumentsMatchingDocumentQuery(g,t){return this.getDocument(g,new le(t)).next((g=>{let t=rn();return g.isFoundDocument()&&(t=t.insert(g.key,g)),t}))}getDocumentsMatchingCollectionGroupQuery(g,t,e,I){const n=t.collectionGroup;let C=rn();return this.indexManager.getCollectionParents(g,n).next((i=>he.forEach(i,(i=>{const l=function(g,t){return new UI(t,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)}(t,i.child(n));return this.getDocumentsMatchingCollectionQuery(g,l,e,I).next((g=>{g.forEach(((g,t)=>{C=C.insert(g,t)}))}))})).next((()=>C))))}getDocumentsMatchingCollectionQuery(g,t,e,I){let n;return this.documentOverlayCache.getOverlaysForCollection(g,t.path,e.largestBatchId).next((C=>(n=C,this.remoteDocumentCache.getDocumentsMatchingQuery(g,t,e,n,I)))).next((g=>{n.forEach(((t,e)=>{const I=e.getKey();null===g.get(I)&&(g=g.insert(I,hI.newInvalidDocument(I)))}));let e=rn();return g.forEach(((g,I)=>{const C=n.get(g);void 0!==C&&Ln(C.mutation,I,Fe.empty(),te.now()),en(t,I)&&(e=e.insert(g,I))})),e}))}}class mi{constructor(g){this.serializer=g,this.Tr=new Map,this.Ir=new Map}getBundleMetadata(g,t){return he.resolve(this.Tr.get(t))}saveBundleMetadata(g,t){return this.Tr.set(t.id,function(g){return{id:g.id,version:g.version,createTime:JC(g.createTime)}}(t)),he.resolve()}getNamedQuery(g,t){return he.resolve(this.Ir.get(t))}saveNamedQuery(g,t){return this.Ir.set(t.name,function(g){return{name:g.name,query:ei(g.bundledQuery),readTime:JC(g.readTime)}}(t)),he.resolve()}}class Zi{constructor(){this.overlays=new Ye(le.comparator),this.Er=new Map}getOverlay(g,t){return he.resolve(this.overlays.get(t))}getOverlays(g,t){const e=An();return he.forEach(t,(t=>this.getOverlay(g,t).next((g=>{null!==g&&e.set(t,g)})))).next((()=>e))}saveOverlays(g,t,e){return e.forEach(((e,I)=>{this.Tt(g,t,I)})),he.resolve()}removeOverlaysForBatchId(g,t,e){const I=this.Er.get(e);return void 0!==I&&(I.forEach((g=>this.overlays=this.overlays.remove(g))),this.Er.delete(e)),he.resolve()}getOverlaysForCollection(g,t,e){const I=An(),n=t.length+1,C=new le(t.child("")),i=this.overlays.getIteratorFrom(C);for(;i.hasNext();){const g=i.getNext().value,C=g.getKey();if(!t.isPrefixOf(C.path))break;C.path.length===n&&g.largestBatchId>e&&I.set(g.getKey(),g)}return he.resolve(I)}getOverlaysForCollectionGroup(g,t,e,I){let n=new Ye(((g,t)=>g-t));const C=this.overlays.getIterator();for(;C.hasNext();){const g=C.getNext().value;if(g.getKey().getCollectionGroup()===t&&g.largestBatchId>e){let t=n.get(g.largestBatchId);null===t&&(t=An(),n=n.insert(g.largestBatchId,t)),t.set(g.getKey(),g)}}const i=An(),l=n.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach(((g,t)=>i.set(g,t))),!(i.size()>=I)););return he.resolve(i)}Tt(g,t,e){const I=this.overlays.get(e.key);if(null!==I){const g=this.Er.get(I.largestBatchId).delete(e.key);this.Er.set(I.largestBatchId,g)}this.overlays=this.overlays.insert(e.key,new gC(t,e));let n=this.Er.get(t);void 0===n&&(n=Zn(),this.Er.set(t,n)),this.Er.set(t,n.add(e.key))}}class bi{constructor(){this.sessionToken=ze.EMPTY_BYTE_STRING}getSessionToken(g){return he.resolve(this.sessionToken)}setSessionToken(g,t){return this.sessionToken=t,he.resolve()}}class Gi{constructor(){this.dr=new Ne(pi.Ar),this.Rr=new Ne(pi.Vr)}isEmpty(){return this.dr.isEmpty()}addReference(g,t){const e=new pi(g,t);this.dr=this.dr.add(e),this.Rr=this.Rr.add(e)}mr(g,t){g.forEach((g=>this.addReference(g,t)))}removeReference(g,t){this.gr(new pi(g,t))}pr(g,t){g.forEach((g=>this.removeReference(g,t)))}yr(g){const t=new le(new ne([])),e=new pi(t,g),I=new pi(t,g+1),n=[];return this.Rr.forEachInRange([e,I],(g=>{this.gr(g),n.push(g.key)})),n}wr(){this.dr.forEach((g=>this.gr(g)))}gr(g){this.dr=this.dr.delete(g),this.Rr=this.Rr.delete(g)}Sr(g){const t=new le(new ne([])),e=new pi(t,g),I=new pi(t,g+1);let n=Zn();return this.Rr.forEachInRange([e,I],(g=>{n=n.add(g.key)})),n}containsKey(g){const t=new pi(g,0),e=this.dr.firstAfterOrEqual(t);return null!==e&&g.isEqual(e.key)}}class pi{constructor(g,t){this.key=g,this.br=t}static Ar(g,t){return le.comparator(g.key,t.key)||$t(g.br,t.br)}static Vr(g,t){return $t(g.br,t.br)||le.comparator(g.key,t.key)}}class yi{constructor(g,t){this.indexManager=g,this.referenceDelegate=t,this.mutationQueue=[],this.Dr=1,this.vr=new Ne(pi.Ar)}checkEmpty(g){return he.resolve(0===this.mutationQueue.length)}addMutationBatch(g,t,e,I){const n=this.Dr;this.Dr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const C=new qn(n,t,e,I);this.mutationQueue.push(C);for(const i of I)this.vr=this.vr.add(new pi(i.key,n)),this.indexManager.addToCollectionParentIndex(g,i.key.path.popLast());return he.resolve(C)}lookupMutationBatch(g,t){return he.resolve(this.Cr(t))}getNextMutationBatchAfterBatchId(g,t){const e=t+1,I=this.Fr(e),n=I<0?0:I;return he.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return he.resolve(0===this.mutationQueue.length?-1:this.Dr-1)}getAllMutationBatches(g){return he.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(g,t){const e=new pi(t,0),I=new pi(t,Number.POSITIVE_INFINITY),n=[];return this.vr.forEachInRange([e,I],(g=>{const t=this.Cr(g.br);n.push(t)})),he.resolve(n)}getAllMutationBatchesAffectingDocumentKeys(g,t){let e=new Ne($t);return t.forEach((g=>{const t=new pi(g,0),I=new pi(g,Number.POSITIVE_INFINITY);this.vr.forEachInRange([t,I],(g=>{e=e.add(g.br)}))})),he.resolve(this.Mr(e))}getAllMutationBatchesAffectingQuery(g,t){const e=t.path,I=e.length+1;let n=e;le.isDocumentKey(n)||(n=n.child(""));const C=new pi(new le(n),0);let i=new Ne($t);return this.vr.forEachWhile((g=>{const t=g.key.path;return!!e.isPrefixOf(t)&&(t.length===I&&(i=i.add(g.br)),!0)}),C),he.resolve(this.Mr(i))}Mr(g){const t=[];return g.forEach((g=>{const e=this.Cr(g);null!==e&&t.push(e)})),t}removeMutationBatch(g,t){Ft(0===this.Or(t.batchId,"removed")),this.mutationQueue.shift();let e=this.vr;return he.forEach(t.mutations,(I=>{const n=new pi(I.key,t.batchId);return e=e.delete(n),this.referenceDelegate.markPotentiallyOrphaned(g,I.key)})).next((()=>{this.vr=e}))}Ln(g){}containsKey(g,t){const e=new pi(t,0),I=this.vr.firstAfterOrEqual(e);return he.resolve(t.isEqual(I&&I.key))}performConsistencyCheck(g){return this.mutationQueue.length,he.resolve()}Or(g,t){return this.Fr(g)}Fr(g){return 0===this.mutationQueue.length?0:g-this.mutationQueue[0].batchId}Cr(g){const t=this.Fr(g);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Bi{constructor(g){this.Nr=g,this.docs=new Ye(le.comparator),this.size=0}setIndexManager(g){this.indexManager=g}addEntry(g,t){const e=t.key,I=this.docs.get(e),n=I?I.size:0,C=this.Nr(t);return this.docs=this.docs.insert(e,{document:t.mutableCopy(),size:C}),this.size+=C-n,this.indexManager.addToCollectionParentIndex(g,e.path.popLast())}removeEntry(g){const t=this.docs.get(g);t&&(this.docs=this.docs.remove(g),this.size-=t.size)}getEntry(g,t){const e=this.docs.get(t);return he.resolve(e?e.document.mutableCopy():hI.newInvalidDocument(t))}getEntries(g,t){let e=sn();return t.forEach((g=>{const t=this.docs.get(g);e=e.insert(g,t?t.document.mutableCopy():hI.newInvalidDocument(g))})),he.resolve(e)}getDocumentsMatchingQuery(g,t,e,I){let n=sn();const C=t.path,i=new le(C.child("")),l=this.docs.getIteratorFrom(i);for(;l.hasNext();){const{key:g,value:{document:i}}=l.getNext();if(!C.isPrefixOf(g.path))break;g.path.length>C.length+1||ce(ae(i),e)<=0||(I.has(i.key)||en(t,i))&&(n=n.insert(i.key,i.mutableCopy()))}return he.resolve(n)}getAllFromCollectionGroup(g,t,e,I){Kt()}Lr(g,t){return he.forEach(this.docs,(g=>t(g)))}newChangeBuffer(g){return new Vi(this)}getSize(g){return he.resolve(this.size)}}class Vi extends di{constructor(g){super(),this.hr=g}applyChanges(g){const t=[];return this.changes.forEach(((e,I)=>{I.isValidDocument()?t.push(this.hr.addEntry(g,I)):this.hr.removeEntry(e)})),he.waitFor(t)}getFromCache(g,t){return this.hr.getEntry(g,t)}getAllFromCache(g,t){return this.hr.getEntries(g,t)}}class Wi{constructor(g){this.persistence=g,this.Br=new ln((g=>xI(g)),LI),this.lastRemoteSnapshotVersion=ee.min(),this.highestTargetId=0,this.kr=0,this.qr=new Gi,this.targetCount=0,this.Qr=oi.qn()}forEachTarget(g,t){return this.Br.forEach(((g,e)=>t(e))),he.resolve()}getLastRemoteSnapshotVersion(g){return he.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(g){return he.resolve(this.kr)}allocateTargetId(g){return this.highestTargetId=this.Qr.next(),he.resolve(this.highestTargetId)}setTargetsMetadata(g,t,e){return e&&(this.lastRemoteSnapshotVersion=e),t>this.kr&&(this.kr=t),he.resolve()}Un(g){this.Br.set(g.target,g);const t=g.targetId;t>this.highestTargetId&&(this.Qr=new oi(t),this.highestTargetId=t),g.sequenceNumber>this.kr&&(this.kr=g.sequenceNumber)}addTargetData(g,t){return this.Un(t),this.targetCount+=1,he.resolve()}updateTargetData(g,t){return this.Un(t),he.resolve()}removeTargetData(g,t){return this.Br.delete(t.target),this.qr.yr(t.targetId),this.targetCount-=1,he.resolve()}removeTargets(g,t,e){let I=0;const n=[];return this.Br.forEach(((C,i)=>{i.sequenceNumber<=t&&null===e.get(i.targetId)&&(this.Br.delete(C),n.push(this.removeMatchingKeysForTargetId(g,i.targetId)),I++)})),he.waitFor(n).next((()=>I))}getTargetCount(g){return he.resolve(this.targetCount)}getTargetData(g,t){const e=this.Br.get(t)||null;return he.resolve(e)}addMatchingKeys(g,t,e){return this.qr.mr(t,e),he.resolve()}removeMatchingKeys(g,t,e){this.qr.pr(t,e);const I=this.persistence.referenceDelegate,n=[];return I&&t.forEach((t=>{n.push(I.markPotentiallyOrphaned(g,t))})),he.waitFor(n)}removeMatchingKeysForTargetId(g,t){return this.qr.yr(t),he.resolve()}getMatchingKeysForTargetId(g,t){const e=this.qr.Sr(t);return he.resolve(e)}containsKey(g,t){return he.resolve(this.qr.containsKey(t))}}class Si{constructor(g,t){this.Kr={},this.overlays={},this.$r=new be(0),this.Ur=!1,this.Ur=!0,this.Wr=new bi,this.referenceDelegate=g(this),this.Gr=new Wi(this),this.indexManager=new ni,this.remoteDocumentCache=function(g){return new Bi(g)}((g=>this.referenceDelegate.zr(g))),this.serializer=new ti(t),this.jr=new mi(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Ur=!1,Promise.resolve()}get started(){return this.Ur}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(g){return this.indexManager}getDocumentOverlayCache(g){let t=this.overlays[g.toKey()];return t||(t=new Zi,this.overlays[g.toKey()]=t),t}getMutationQueue(g,t){let e=this.Kr[g.toKey()];return e||(e=new yi(t,this.referenceDelegate),this.Kr[g.toKey()]=e),e}getGlobalsCache(){return this.Wr}getTargetCache(){return this.Gr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.jr}runTransaction(g,t,e){Yt("MemoryPersistence","Starting transaction:",g);const I=new Ri(this.$r.next());return this.referenceDelegate.Hr(),e(I).next((g=>this.referenceDelegate.Jr(I).next((()=>g)))).toPromise().then((g=>(I.raiseOnCommittedEvent(),g)))}Yr(g,t){return he.or(Object.values(this.Kr).map((e=>()=>e.containsKey(g,t))))}}class Ri extends de{constructor(g){super(),this.currentSequenceNumber=g}}class fi{constructor(g){this.persistence=g,this.Zr=new Gi,this.Xr=null}static ei(g){return new fi(g)}get ti(){if(this.Xr)return this.Xr;throw Kt()}addReference(g,t,e){return this.Zr.addReference(e,t),this.ti.delete(e.toString()),he.resolve()}removeReference(g,t,e){return this.Zr.removeReference(e,t),this.ti.add(e.toString()),he.resolve()}markPotentiallyOrphaned(g,t){return this.ti.add(t.toString()),he.resolve()}removeTarget(g,t){this.Zr.yr(t.targetId).forEach((g=>this.ti.add(g.toString())));const e=this.persistence.getTargetCache();return e.getMatchingKeysForTargetId(g,t.targetId).next((g=>{g.forEach((g=>this.ti.add(g.toString())))})).next((()=>e.removeTargetData(g,t)))}Hr(){this.Xr=new Set}Jr(g){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return he.forEach(this.ti,(e=>{const I=le.fromPath(e);return this.ni(g,I).next((g=>{g||t.removeEntry(I,ee.min())}))})).next((()=>(this.Xr=null,t.apply(g))))}updateLimboDocument(g,t){return this.ni(g,t).next((g=>{g?this.ti.delete(t.toString()):this.ti.add(t.toString())}))}zr(g){return 0}ni(g,t){return he.or([()=>he.resolve(this.Zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(g,t),()=>this.persistence.Yr(g,t)])}}class Xi{constructor(g,t){this.persistence=g,this.ri=new ln((g=>Be(g.path)),((g,t)=>g.isEqual(t))),this.garbageCollector=Ai(this,t)}static ei(g,t){return new Xi(g,t)}Hr(){}Jr(g){return he.resolve()}forEachTarget(g,t){return this.persistence.getTargetCache().forEachTarget(g,t)}Xn(g){const t=this.nr(g);return this.persistence.getTargetCache().getTargetCount(g).next((g=>t.next((t=>g+t))))}nr(g){let t=0;return this.er(g,(g=>{t++})).next((()=>t))}er(g,t){return he.forEach(this.ri,((e,I)=>this.ir(g,e,I).next((g=>g?he.resolve():t(I)))))}removeTargets(g,t,e){return this.persistence.getTargetCache().removeTargets(g,t,e)}removeOrphanedDocuments(g,t){let e=0;const I=this.persistence.getRemoteDocumentCache(),n=I.newChangeBuffer();return I.Lr(g,(I=>this.ir(g,I,t).next((g=>{g||(e++,n.removeEntry(I,ee.min()))})))).next((()=>n.apply(g))).next((()=>e))}markPotentiallyOrphaned(g,t){return this.ri.set(t,g.currentSequenceNumber),he.resolve()}removeTarget(g,t){const e=t.withSequenceNumber(g.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(g,e)}addReference(g,t,e){return this.ri.set(e,g.currentSequenceNumber),he.resolve()}removeReference(g,t,e){return this.ri.set(e,g.currentSequenceNumber),he.resolve()}updateLimboDocument(g,t){return this.ri.set(t,g.currentSequenceNumber),he.resolve()}zr(g){let t=g.key.toString().length;return g.isFoundDocument()&&(t+=CI(g.data.value)),t}ir(g,t,e){return he.or([()=>this.persistence.Yr(g,t),()=>this.persistence.getTargetCache().containsKey(g,t),()=>{const g=this.ri.get(t);return he.resolve(void 0!==g&&g>e)}])}getCacheSize(g){return this.persistence.getRemoteDocumentCache().getSize(g)}}class Ji{constructor(g,t,e,I){this.targetId=g,this.fromCache=t,this.Wi=e,this.Gi=I}static zi(g,t){let e=Zn(),I=Zn();for(const n of t.docChanges)switch(n.type){case 0:e=e.add(n.doc.key);break;case 1:I=I.add(n.doc.key)}return new Ji(g,t.fromCache,e,I)}}class vi{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(g){this._documentReadCount+=g}}class ki{constructor(){this.ji=!1,this.Hi=!1,this.Ji=100,this.Yi=k()?8:me(v())>0?6:4}initialize(g,t){this.Zi=g,this.indexManager=t,this.ji=!0}getDocumentsMatchingQuery(g,t,e,I){const n={result:null};return this.Xi(g,t).next((g=>{n.result=g})).next((()=>{if(!n.result)return this.es(g,t,I,e).next((g=>{n.result=g}))})).next((()=>{if(n.result)return;const e=new vi;return this.ts(g,t,e).next((I=>{if(n.result=I,this.Hi)return this.ns(g,t,e,I.size)}))})).next((()=>n.result))}ns(g,t,e,I){return e.documentReadCount<this.Ji?(kt()<=T.DEBUG&&Yt("QueryEngine","SDK will not create cache indexes for query:",tn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ji,"documents"),he.resolve()):(kt()<=T.DEBUG&&Yt("QueryEngine","Query:",tn(t),"scans",e.documentReadCount,"local documents and returns",I,"documents as results."),e.documentReadCount>this.Yi*I?(kt()<=T.DEBUG&&Yt("QueryEngine","The SDK decides to create cache indexes for query:",tn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(g,PI(t))):he.resolve())}Xi(g,t){if(DI(t))return he.resolve(null);let e=PI(t);return this.indexManager.getIndexType(g,e).next((I=>0===I?null:(null!==t.limit&&1===I&&(t=qI(t,null,"F"),e=PI(t)),this.indexManager.getDocumentsMatchingTarget(g,e).next((I=>{const n=Zn(...I);return this.Zi.getDocuments(g,n).next((I=>this.indexManager.getMinOffset(g,e).next((e=>{const C=this.rs(t,I);return this.ss(t,C,n,e.readTime)?this.Xi(g,qI(t,null,"F")):this.os(g,C,t,e)}))))})))))}es(g,t,e,I){return DI(t)||I.isEqual(ee.min())?he.resolve(null):this.Zi.getDocuments(g,e).next((n=>{const C=this.rs(t,n);return this.ss(t,C,e,I)?he.resolve(null):(kt()<=T.DEBUG&&Yt("QueryEngine","Re-using previous result from %s to execute query: %s",I.toString(),tn(t)),this.os(g,C,t,se(I,-1)).next((g=>g)))}))}rs(g,t){let e=new Ne(nn(g));return t.forEach(((t,I)=>{en(g,I)&&(e=e.add(I))})),e}ss(g,t,e,I){if(null===g.limit)return!1;if(e.size!==t.size)return!0;const n="F"===g.limitType?t.last():t.first();return!!n&&(n.hasPendingWrites||n.version.compareTo(I)>0)}ts(g,t,e){return kt()<=T.DEBUG&&Yt("QueryEngine","Using full collection scan to execute query:",tn(t)),this.Zi.getDocumentsMatchingQuery(g,t,re.min(),e)}os(g,t,e,I){return this.Zi.getDocumentsMatchingQuery(g,e,I).next((g=>(t.forEach((t=>{g=g.insert(t.key,t)})),g)))}}class Yi{constructor(g,t,e,I){this.persistence=g,this._s=t,this.serializer=I,this.us=new Ye($t),this.cs=new ln((g=>xI(g)),LI),this.ls=new Map,this.hs=g.getRemoteDocumentCache(),this.Gr=g.getTargetCache(),this.jr=g.getBundleCache(),this.Ps(e)}Ps(g){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(g),this.indexManager=this.persistence.getIndexManager(g),this.mutationQueue=this.persistence.getMutationQueue(g,this.indexManager),this.localDocuments=new hi(this.hs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.hs.setIndexManager(this.indexManager),this._s.initialize(this.localDocuments,this.indexManager)}collectGarbage(g){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>g.collect(t,this.us)))}}function Hi(g,t,e,I){return new Yi(g,t,e,I)}async function wi(g,t){const e=Et(g);return await e.persistence.runTransaction("Handle user change","readonly",(g=>{let I;return e.mutationQueue.getAllMutationBatches(g).next((n=>(I=n,e.Ps(t),e.mutationQueue.getAllMutationBatches(g)))).next((t=>{const n=[],C=[];let i=Zn();for(const g of I){n.push(g.batchId);for(const t of g.mutations)i=i.add(t.key)}for(const g of t){C.push(g.batchId);for(const t of g.mutations)i=i.add(t.key)}return e.localDocuments.getDocuments(g,i).next((g=>({Ts:g,removedBatchIds:n,addedBatchIds:C})))}))}))}function Ni(g){const t=Et(g);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(g=>t.Gr.getLastRemoteSnapshotVersion(g)))}function Ki(g,t,e){let I=Zn(),n=Zn();return e.forEach((g=>I=I.add(g))),t.getEntries(g,I).next((g=>{let I=sn();return e.forEach(((e,C)=>{const i=g.get(e);C.isFoundDocument()!==i.isFoundDocument()&&(n=n.add(e)),C.isNoDocument()&&C.version.isEqual(ee.min())?(t.removeEntry(e,C.readTime),I=I.insert(e,C)):!i.isValidDocument()||C.version.compareTo(i.version)>0||0===C.version.compareTo(i.version)&&i.hasPendingWrites?(t.addEntry(C),I=I.insert(e,C)):Yt("LocalStore","Ignoring outdated watch update for ",e,". Current version:",i.version," Watch version:",C.version)})),{Is:I,Es:n}}))}function Fi(g,t){const e=Et(g);return e.persistence.runTransaction("Get next mutation batch","readonly",(g=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(g,t))))}function Ei(g,t){const e=Et(g);return e.persistence.runTransaction("Allocate target","readwrite",(g=>{let I;return e.Gr.getTargetData(g,t).next((n=>n?(I=n,he.resolve(I)):e.Gr.allocateTargetId(g).next((n=>(I=new gi(t,n,"TargetPurposeListen",g.currentSequenceNumber),e.Gr.addTargetData(g,I).next((()=>I)))))))})).then((g=>{const I=e.us.get(g.targetId);return(null===I||g.snapshotVersion.compareTo(I.snapshotVersion)>0)&&(e.us=e.us.insert(g.targetId,g),e.cs.set(t,g.targetId)),g}))}async function zi(g,t,e){const I=Et(g),n=I.us.get(t),C=e?"readwrite":"readwrite-primary";try{e||await I.persistence.runTransaction("Release target",C,(g=>I.persistence.referenceDelegate.removeTarget(g,n)))}catch(g){if(!Ze(g))throw g;Yt("LocalStore",`Failed to update sequence numbers for target ${t}: ${g}`)}I.us=I.us.remove(t),I.cs.delete(n.target)}function xi(g,t,e){const I=Et(g);let n=ee.min(),C=Zn();return I.persistence.runTransaction("Execute query","readwrite",(g=>function(g,t,e){const I=Et(g),n=I.cs.get(e);return void 0!==n?he.resolve(I.us.get(n)):I.Gr.getTargetData(t,e)}(I,g,PI(t)).next((t=>{if(t)return n=t.lastLimboFreeSnapshotVersion,I.Gr.getMatchingKeysForTargetId(g,t.targetId).next((g=>{C=g}))})).next((()=>I._s.getDocumentsMatchingQuery(g,t,e?n:ee.min(),e?C:Zn()))).next((g=>(Li(I,In(t),g),{documents:g,ds:C})))))}function Li(g,t,e){let I=g.ls.get(t)||ee.min();e.forEach(((g,t)=>{t.readTime.compareTo(I)>0&&(I=t.readTime)})),g.ls.set(t,I)}class Mi{constructor(){this.activeTargetIds=Gn()}ps(g){this.activeTargetIds=this.activeTargetIds.add(g)}ys(g){this.activeTargetIds=this.activeTargetIds.delete(g)}gs(){const g={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(g)}}class Ui{constructor(){this._o=new Mi,this.ao={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(g){}updateMutationState(g,t,e){}addLocalQueryTarget(g){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this._o.ps(g),this.ao[g]||"not-current"}updateQueryState(g,t,e){this.ao[g]=t}removeLocalQueryTarget(g){this._o.ys(g)}isLocalQueryTarget(g){return this._o.activeTargetIds.has(g)}clearQueryState(g){delete this.ao[g]}getAllActiveQueryTargets(){return this._o.activeTargetIds}isActiveQueryTarget(g){return this._o.activeTargetIds.has(g)}start(){return this._o=new Mi,Promise.resolve()}handleUserChange(g,t,e){}setOnlineState(g){}shutdown(){}writeSequenceNumber(g){}notifyBundleLoaded(g){}}class Ti{uo(g){}shutdown(){}}class Qi{constructor(){this.co=()=>this.lo(),this.ho=()=>this.Po(),this.To=[],this.Io()}uo(g){this.To.push(g)}shutdown(){window.removeEventListener("online",this.co),window.removeEventListener("offline",this.ho)}Io(){window.addEventListener("online",this.co),window.addEventListener("offline",this.ho)}lo(){Yt("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const g of this.To)g(0)}Po(){Yt("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const g of this.To)g(1)}static p(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Di=null;function _i(){return null===Di?Di=268435456+Math.round(2147483648*Math.random()):Di++,"0x"+Di.toString(16)}const ji={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Pi{constructor(g){this.Eo=g.Eo,this.Ao=g.Ao}Ro(g){this.Vo=g}mo(g){this.fo=g}po(g){this.yo=g}onMessage(g){this.wo=g}close(){this.Ao()}send(g){this.Eo(g)}So(){this.Vo()}bo(){this.fo()}Do(g){this.yo(g)}vo(g){this.wo(g)}}const Oi="WebChannelConnection";class qi extends class{get Co(){return!1}constructor(g){this.databaseInfo=g,this.databaseId=g.databaseId;const t=g.ssl?"https":"http",e=encodeURIComponent(this.databaseId.projectId),I=encodeURIComponent(this.databaseId.database);this.Fo=t+"://"+g.host,this.Mo=`projects/${e}/databases/${I}`,this.xo="(default)"===this.databaseId.database?`project_id=${e}`:`project_id=${e}&database_id=${I}`}Oo(g,t,e,I,n){const C=_i(),i=this.No(g,t.toUriEncodedString());Yt("RestConnection",`Sending RPC '${g}' ${C}:`,i,e);const l={"google-cloud-resource-prefix":this.Mo,"x-goog-request-params":this.xo};return this.Lo(l,I,n),this.Bo(g,i,l,e).then((t=>(Yt("RestConnection",`Received RPC '${g}' ${C}: `,t),t)),(t=>{throw wt("RestConnection",`RPC '${g}' ${C} failed with error: `,t,"url: ",i,"request:",e),t}))}ko(g,t,e,I,n,C){return this.Oo(g,t,e,I,n)}Lo(g,t,e){g["X-Goog-Api-Client"]="gl-js/ fire/"+Jt,g["Content-Type"]="text/plain",this.databaseInfo.appId&&(g["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,e)=>g[e]=t)),e&&e.headers.forEach(((t,e)=>g[e]=t))}No(g,t){const e=ji[g];return`${this.Fo}/v1/${t}:${e}`}terminate(){}}{constructor(g){super(g),this.forceLongPolling=g.forceLongPolling,this.autoDetectLongPolling=g.autoDetectLongPolling,this.useFetchStreams=g.useFetchStreams,this.longPollingOptions=g.longPollingOptions}Bo(g,t,e,I){const n=_i();return new Promise(((C,i)=>{const l=new Zt;l.setWithCredentials(!0),l.listenOnce(Gt.COMPLETE,(()=>{try{switch(l.getLastErrorCode()){case pt.NO_ERROR:const t=l.getResponseJson();Yt(Oi,`XHR for RPC '${g}' ${n} received:`,JSON.stringify(t)),C(t);break;case pt.TIMEOUT:Yt(Oi,`RPC '${g}' ${n} timed out`),i(new xt(zt.DEADLINE_EXCEEDED,"Request time out"));break;case pt.HTTP_ERROR:const e=l.getStatus();if(Yt(Oi,`RPC '${g}' ${n} failed with status:`,e,"response text:",l.getResponseText()),e>0){let g=l.getResponseJson();Array.isArray(g)&&(g=g[0]);const t=null==g?void 0:g.error;if(t&&t.status&&t.message){const g=function(g){const t=g.toLowerCase().replace(/_/g,"-");return Object.values(zt).indexOf(t)>=0?t:zt.UNKNOWN}(t.status);i(new xt(g,t.message))}else i(new xt(zt.UNKNOWN,"Server responded with status "+l.getStatus()))}else i(new xt(zt.UNAVAILABLE,"Connection failed."));break;default:Kt()}}finally{Yt(Oi,`RPC '${g}' ${n} completed.`)}}));const o=JSON.stringify(I);Yt(Oi,`RPC '${g}' ${n} sending request:`,I),l.send(t,"POST",o,e,15)}))}qo(g,t,e){const I=_i(),n=[this.Fo,"/","google.firestore.v1.Firestore","/",g,"/channel"],C=Wt(),i=Vt(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},o=this.longPollingOptions.timeoutSeconds;void 0!==o&&(l.longPollingTimeout=Math.round(1e3*o)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Lo(l.initMessageHeaders,t,e),l.encodeInitMessageHeaders=!0;const s=n.join("");Yt(Oi,`Creating RPC '${g}' stream ${I}: ${s}`,l);const a=C.createWebChannel(s,l);let r=!1,c=!1;const A=new Pi({Eo:t=>{c?Yt(Oi,`Not sending because RPC '${g}' stream ${I} is closed:`,t):(r||(Yt(Oi,`Opening RPC '${g}' stream ${I} transport.`),a.open(),r=!0),Yt(Oi,`RPC '${g}' stream ${I} sending:`,t),a.send(t))},Ao:()=>a.close()}),d=(g,t,e)=>{g.listen(t,(g=>{try{e(g)}catch(g){setTimeout((()=>{throw g}),0)}}))};return d(a,bt.EventType.OPEN,(()=>{c||(Yt(Oi,`RPC '${g}' stream ${I} transport opened.`),A.So())})),d(a,bt.EventType.CLOSE,(()=>{c||(c=!0,Yt(Oi,`RPC '${g}' stream ${I} transport closed`),A.Do())})),d(a,bt.EventType.ERROR,(t=>{c||(c=!0,wt(Oi,`RPC '${g}' stream ${I} transport errored:`,t),A.Do(new xt(zt.UNAVAILABLE,"The operation could not be completed")))})),d(a,bt.EventType.MESSAGE,(t=>{var e;if(!c){const n=t.data[0];Ft(!!n);const C=n,i=(null==C?void 0:C.error)||(null===(e=C[0])||void 0===e?void 0:e.error);if(i){Yt(Oi,`RPC '${g}' stream ${I} received error:`,i);const t=i.status;let e=function(g){const t=eC[g];if(void 0!==t)return CC(t)}(t),n=i.message;void 0===e&&(e=zt.INTERNAL,n="Unknown error status: "+t+" with message "+i.message),c=!0,A.Do(new xt(e,n)),a.close()}else Yt(Oi,`RPC '${g}' stream ${I} received:`,n),A.vo(n)}})),d(i,Bt.STAT_EVENT,(t=>{t.stat===yt.PROXY?Yt(Oi,`RPC '${g}' stream ${I} detected buffering proxy`):t.stat===yt.NOPROXY&&Yt(Oi,`RPC '${g}' stream ${I} detected no buffering proxy`)})),setTimeout((()=>{A.bo()}),0),A}}function $i(){return"undefined"!=typeof document?document:null}function gl(g){return new WC(g,!0)}class tl{constructor(g,t){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.li=g,this.timerId=t,this.Qo=e,this.Ko=I,this.$o=n,this.Uo=0,this.Wo=null,this.Go=Date.now(),this.reset()}reset(){this.Uo=0}zo(){this.Uo=this.$o}jo(g){this.cancel();const t=Math.floor(this.Uo+this.Ho()),e=Math.max(0,Date.now()-this.Go),I=Math.max(0,t-e);I>0&&Yt("ExponentialBackoff",`Backing off for ${I} ms (base delay: ${this.Uo} ms, delay with jitter: ${t} ms, last attempt: ${e} ms ago)`),this.Wo=this.li.enqueueAfterDelay(this.timerId,I,(()=>(this.Go=Date.now(),g()))),this.Uo*=this.Ko,this.Uo<this.Qo&&(this.Uo=this.Qo),this.Uo>this.$o&&(this.Uo=this.$o)}Jo(){null!==this.Wo&&(this.Wo.skipDelay(),this.Wo=null)}cancel(){null!==this.Wo&&(this.Wo.cancel(),this.Wo=null)}Ho(){return(Math.random()-.5)*this.Uo}}class el{constructor(g,t,e,I,n,C,i,l){this.li=g,this.Yo=e,this.Zo=I,this.connection=n,this.authCredentialsProvider=C,this.appCheckCredentialsProvider=i,this.listener=l,this.state=0,this.Xo=0,this.e_=null,this.t_=null,this.stream=null,this.n_=0,this.r_=new tl(g,t)}i_(){return 1===this.state||5===this.state||this.s_()}s_(){return 2===this.state||3===this.state}start(){this.n_=0,4!==this.state?this.auth():this.o_()}async stop(){this.i_()&&await this.close(0)}__(){this.state=0,this.r_.reset()}a_(){this.s_()&&null===this.e_&&(this.e_=this.li.enqueueAfterDelay(this.Yo,6e4,(()=>this.u_())))}c_(g){this.l_(),this.stream.send(g)}async u_(){if(this.s_())return this.close(0)}l_(){this.e_&&(this.e_.cancel(),this.e_=null)}h_(){this.t_&&(this.t_.cancel(),this.t_=null)}async close(g,t){this.l_(),this.h_(),this.r_.cancel(),this.Xo++,4!==g?this.r_.reset():t&&t.code===zt.RESOURCE_EXHAUSTED?(Ht(t.toString()),Ht("Using maximum backoff delay to prevent overloading the backend."),this.r_.zo()):t&&t.code===zt.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.P_(),this.stream.close(),this.stream=null),this.state=g,await this.listener.po(t)}P_(){}auth(){this.state=1;const g=this.T_(this.Xo),t=this.Xo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((g=>{let[e,I]=g;this.Xo===t&&this.I_(e,I)}),(t=>{g((()=>{const g=new xt(zt.UNKNOWN,"Fetching auth token failed: "+t.message);return this.E_(g)}))}))}I_(g,t){const e=this.T_(this.Xo);this.stream=this.d_(g,t),this.stream.Ro((()=>{e((()=>this.listener.Ro()))})),this.stream.mo((()=>{e((()=>(this.state=2,this.t_=this.li.enqueueAfterDelay(this.Zo,1e4,(()=>(this.s_()&&(this.state=3),Promise.resolve()))),this.listener.mo())))})),this.stream.po((g=>{e((()=>this.E_(g)))})),this.stream.onMessage((g=>{e((()=>1==++this.n_?this.A_(g):this.onNext(g)))}))}o_(){this.state=5,this.r_.jo((async()=>{this.state=0,this.start()}))}E_(g){return Yt("PersistentStream",`close with error: ${g}`),this.stream=null,this.close(4,g)}T_(g){return t=>{this.li.enqueueAndForget((()=>this.Xo===g?t():(Yt("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Il extends el{constructor(g,t,e,I,n,C){super(g,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,e,I,C),this.serializer=n}d_(g,t){return this.connection.qo("Listen",g,t)}A_(g){return this.onNext(g)}onNext(g){this.r_.reset();const t=function(g,t){let e;if("targetChange"in t){t.targetChange;const I=function(g){return"NO_CHANGE"===g?0:"ADD"===g?1:"REMOVE"===g?2:"CURRENT"===g?3:"RESET"===g?4:Kt()}(t.targetChange.targetChangeType||"NO_CHANGE"),n=t.targetChange.targetIds||[],C=function(g,t){return g.useProto3Json?(Ft(void 0===t||"string"==typeof t),ze.fromBase64String(t||"")):(Ft(void 0===t||t instanceof Buffer||t instanceof Uint8Array),ze.fromUint8Array(t||new Uint8Array))}(g,t.targetChange.resumeToken),i=t.targetChange.cause,l=i&&function(g){const t=void 0===g.code?zt.UNKNOWN:CC(g.code);return new xt(t,g.message||"")}(i);e=new mC(I,n,C,l||null)}else if("documentChange"in t){t.documentChange;const I=t.documentChange;I.document,I.document.name,I.document.updateTime;const n=wC(g,I.document.name),C=JC(I.document.updateTime),i=I.document.createTime?JC(I.document.createTime):ee.min(),l=new dI({mapValue:{fields:I.document.fields}}),o=hI.newFoundDocument(n,C,i,l),s=I.targetIds||[],a=I.removedTargetIds||[];e=new uC(s,a,o.key,o)}else if("documentDelete"in t){t.documentDelete;const I=t.documentDelete;I.document;const n=wC(g,I.document),C=I.readTime?JC(I.readTime):ee.min(),i=hI.newNoDocument(n,C),l=I.removedTargetIds||[];e=new uC([],l,i.key,i)}else if("documentRemove"in t){t.documentRemove;const I=t.documentRemove;I.document;const n=wC(g,I.document),C=I.removedTargetIds||[];e=new uC([],C,n,null)}else{if(!("filter"in t))return Kt();{t.filter;const g=t.filter;g.targetId;const{count:I=0,unchangedNames:n}=g,C=new tC(I,n),i=g.targetId;e=new hC(i,C)}}return e}(this.serializer,g),e=function(g){if(!("targetChange"in g))return ee.min();const t=g.targetChange;return t.targetIds&&t.targetIds.length?ee.min():t.readTime?JC(t.readTime):ee.min()}(g);return this.listener.R_(t,e)}V_(g){const t={};t.database=FC(this.serializer),t.addTarget=function(g,t){let e;const I=t.target;if(e=MI(I)?{documents:LC(g,I)}:{query:MC(g,I).ct},e.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){e.resumeToken=fC(g,t.resumeToken);const I=SC(g,t.expectedCount);null!==I&&(e.expectedCount=I)}else if(t.snapshotVersion.compareTo(ee.min())>0){e.readTime=RC(g,t.snapshotVersion.toTimestamp());const I=SC(g,t.expectedCount);null!==I&&(e.expectedCount=I)}return e}(this.serializer,g);const e=function(g,t){const e=function(g){switch(g){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Kt()}}(t.purpose);return null==e?null:{"goog-listen-tags":e}}(this.serializer,g);e&&(t.labels=e),this.c_(t)}m_(g){const t={};t.database=FC(this.serializer),t.removeTarget=g,this.c_(t)}}class nl extends el{constructor(g,t,e,I,n,C){super(g,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,e,I,C),this.serializer=n}get f_(){return this.n_>0}start(){this.lastStreamToken=void 0,super.start()}P_(){this.f_&&this.g_([])}d_(g,t){return this.connection.qo("Write",g,t)}A_(g){return Ft(!!g.streamToken),this.lastStreamToken=g.streamToken,Ft(!g.writeResults||0===g.writeResults.length),this.listener.p_()}onNext(g){Ft(!!g.streamToken),this.lastStreamToken=g.streamToken,this.r_.reset();const t=function(g,t){return g&&g.length>0?(Ft(void 0!==t),g.map((g=>function(g,t){let e=g.updateTime?JC(g.updateTime):JC(t);return e.isEqual(ee.min())&&(e=JC(t)),new Nn(e,g.transformResults||[])}(g,t)))):[]}(g.writeResults,g.commitTime),e=JC(g.commitTime);return this.listener.y_(e,t)}w_(){const g={};g.database=FC(this.serializer),this.c_(g)}g_(g){const t={streamToken:this.lastStreamToken,writes:g.map((g=>xC(this.serializer,g)))};this.c_(t)}}class Cl extends class{}{constructor(g,t,e,I){super(),this.authCredentials=g,this.appCheckCredentials=t,this.connection=e,this.serializer=I,this.S_=!1}b_(){if(this.S_)throw new xt(zt.FAILED_PRECONDITION,"The client has already been terminated.")}Oo(g,t,e,I){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((n=>{let[C,i]=n;return this.connection.Oo(g,kC(t,e),I,C,i)})).catch((g=>{throw"FirebaseError"===g.name?(g.code===zt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),g):new xt(zt.UNKNOWN,g.toString())}))}ko(g,t,e,I,n){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((C=>{let[i,l]=C;return this.connection.ko(g,kC(t,e),I,i,l,n)})).catch((g=>{throw"FirebaseError"===g.name?(g.code===zt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),g):new xt(zt.UNKNOWN,g.toString())}))}terminate(){this.S_=!0,this.connection.terminate()}}class il{constructor(g,t){this.asyncQueue=g,this.onlineStateHandler=t,this.state="Unknown",this.D_=0,this.v_=null,this.C_=!0}F_(){0===this.D_&&(this.M_("Unknown"),this.v_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.v_=null,this.x_("Backend didn't respond within 10 seconds."),this.M_("Offline"),Promise.resolve()))))}O_(g){"Online"===this.state?this.M_("Unknown"):(this.D_++,this.D_>=1&&(this.N_(),this.x_(`Connection failed 1 times. Most recent error: ${g.toString()}`),this.M_("Offline")))}set(g){this.N_(),this.D_=0,"Online"===g&&(this.C_=!1),this.M_(g)}M_(g){g!==this.state&&(this.state=g,this.onlineStateHandler(g))}x_(g){const t=`Could not reach Cloud Firestore backend. ${g}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.C_?(Ht(t),this.C_=!1):Yt("OnlineStateTracker",t)}N_(){null!==this.v_&&(this.v_.cancel(),this.v_=null)}}class ll{constructor(g,t,e,I,n){this.localStore=g,this.datastore=t,this.asyncQueue=e,this.remoteSyncer={},this.L_=[],this.B_=new Map,this.k_=new Set,this.q_=[],this.Q_=n,this.Q_.uo((g=>{e.enqueueAndForget((async()=>{hl(this)&&(Yt("RemoteStore","Restarting streams for network reachability change."),await async function(g){const t=Et(g);t.k_.add(4),await sl(t),t.K_.set("Unknown"),t.k_.delete(4),await ol(t)}(this))}))})),this.K_=new il(e,I)}}async function ol(g){if(hl(g))for(const t of g.q_)await t(!0)}async function sl(g){for(const t of g.q_)await t(!1)}function al(g,t){const e=Et(g);e.B_.has(t.targetId)||(e.B_.set(t.targetId,t),ul(e)?dl(e):wl(e).s_()&&cl(e,t))}function rl(g,t){const e=Et(g),I=wl(e);e.B_.delete(t),I.s_()&&Al(e,t),0===e.B_.size&&(I.s_()?I.a_():hl(e)&&e.K_.set("Unknown"))}function cl(g,t){if(g.U_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ee.min())>0){const e=g.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}wl(g).V_(t)}function Al(g,t){g.U_.xe(t),wl(g).m_(t)}function dl(g){g.U_=new bC({getRemoteKeysForTarget:t=>g.remoteSyncer.getRemoteKeysForTarget(t),ut:t=>g.B_.get(t)||null,nt:()=>g.datastore.serializer.databaseId}),wl(g).start(),g.K_.F_()}function ul(g){return hl(g)&&!wl(g).i_()&&g.B_.size>0}function hl(g){return 0===Et(g).k_.size}function ml(g){g.U_=void 0}async function Zl(g){g.K_.set("Online")}async function bl(g){g.B_.forEach(((t,e)=>{cl(g,t)}))}async function Gl(g,t){ml(g),ul(g)?(g.K_.O_(t),dl(g)):g.K_.set("Unknown")}async function pl(g,t,e){if(g.K_.set("Online"),t instanceof mC&&2===t.state&&t.cause)try{await async function(g,t){const e=t.cause;for(const I of t.targetIds)g.B_.has(I)&&(await g.remoteSyncer.rejectListen(I,e),g.B_.delete(I),g.U_.removeTarget(I))}(g,t)}catch(e){Yt("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),e),await yl(g,e)}else if(t instanceof uC?g.U_.$e(t):t instanceof hC?g.U_.Je(t):g.U_.Ge(t),!e.isEqual(ee.min()))try{const t=await Ni(g.localStore);e.compareTo(t)>=0&&await function(g,t){const e=g.U_.it(t);return e.targetChanges.forEach(((e,I)=>{if(e.resumeToken.approximateByteSize()>0){const n=g.B_.get(I);n&&g.B_.set(I,n.withResumeToken(e.resumeToken,t))}})),e.targetMismatches.forEach(((t,e)=>{const I=g.B_.get(t);if(!I)return;g.B_.set(t,I.withResumeToken(ze.EMPTY_BYTE_STRING,I.snapshotVersion)),Al(g,t);const n=new gi(I.target,t,e,I.sequenceNumber);cl(g,n)})),g.remoteSyncer.applyRemoteEvent(e)}(g,e)}catch(t){Yt("RemoteStore","Failed to raise snapshot:",t),await yl(g,t)}}async function yl(g,t,e){if(!Ze(t))throw t;g.k_.add(1),await sl(g),g.K_.set("Offline"),e||(e=()=>Ni(g.localStore)),g.asyncQueue.enqueueRetryable((async()=>{Yt("RemoteStore","Retrying IndexedDB access"),await e(),g.k_.delete(1),await ol(g)}))}function Bl(g,t){return t().catch((e=>yl(g,e,t)))}async function Vl(g){const t=Et(g),e=Nl(t);let I=t.L_.length>0?t.L_[t.L_.length-1].batchId:-1;for(;Wl(t);)try{const g=await Fi(t.localStore,I);if(null===g){0===t.L_.length&&e.a_();break}I=g.batchId,Sl(t,g)}catch(g){await yl(t,g)}Rl(t)&&fl(t)}function Wl(g){return hl(g)&&g.L_.length<10}function Sl(g,t){g.L_.push(t);const e=Nl(g);e.s_()&&e.f_&&e.g_(t.mutations)}function Rl(g){return hl(g)&&!Nl(g).i_()&&g.L_.length>0}function fl(g){Nl(g).start()}async function Xl(g){Nl(g).w_()}async function Jl(g){const t=Nl(g);for(const e of g.L_)t.g_(e.mutations)}async function vl(g,t,e){const I=g.L_.shift(),n=$n.from(I,t,e);await Bl(g,(()=>g.remoteSyncer.applySuccessfulWrite(n))),await Vl(g)}async function kl(g,t){t&&Nl(g).f_&&await async function(g,t){if(function(g){return nC(g)&&g!==zt.ABORTED}(t.code)){const e=g.L_.shift();Nl(g).__(),await Bl(g,(()=>g.remoteSyncer.rejectFailedWrite(e.batchId,t))),await Vl(g)}}(g,t),Rl(g)&&fl(g)}async function Yl(g,t){const e=Et(g);e.asyncQueue.verifyOperationInProgress(),Yt("RemoteStore","RemoteStore received new credentials");const I=hl(e);e.k_.add(3),await sl(e),I&&e.K_.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.k_.delete(3),await ol(e)}async function Hl(g,t){const e=Et(g);t?(e.k_.delete(2),await ol(e)):t||(e.k_.add(2),await sl(e),e.K_.set("Unknown"))}function wl(g){return g.W_||(g.W_=function(g,t,e){const I=Et(g);return I.b_(),new Il(t,I.connection,I.authCredentials,I.appCheckCredentials,I.serializer,e)}(g.datastore,g.asyncQueue,{Ro:Zl.bind(null,g),mo:bl.bind(null,g),po:Gl.bind(null,g),R_:pl.bind(null,g)}),g.q_.push((async t=>{t?(g.W_.__(),ul(g)?dl(g):g.K_.set("Unknown")):(await g.W_.stop(),ml(g))}))),g.W_}function Nl(g){return g.G_||(g.G_=function(g,t,e){const I=Et(g);return I.b_(),new nl(t,I.connection,I.authCredentials,I.appCheckCredentials,I.serializer,e)}(g.datastore,g.asyncQueue,{Ro:()=>Promise.resolve(),mo:Xl.bind(null,g),po:kl.bind(null,g),p_:Jl.bind(null,g),y_:vl.bind(null,g)}),g.q_.push((async t=>{t?(g.G_.__(),await Vl(g)):(await g.G_.stop(),g.L_.length>0&&(Yt("RemoteStore",`Stopping write stream with ${g.L_.length} pending writes`),g.L_=[]))}))),g.G_}class Kl{constructor(g,t,e,I,n){this.asyncQueue=g,this.timerId=t,this.targetTimeMs=e,this.op=I,this.removalCallback=n,this.deferred=new Lt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((g=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(g,t,e,I,n){const C=Date.now()+e,i=new Kl(g,t,C,I,n);return i.start(e),i}start(g){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),g)}skipDelay(){return this.handleDelayElapsed()}cancel(g){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new xt(zt.CANCELLED,"Operation cancelled"+(g?": "+g:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((g=>this.deferred.resolve(g)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Fl(g,t){if(Ht("AsyncQueue",`${t}: ${g}`),Ze(g))return new xt(zt.UNAVAILABLE,`${t}: ${g}`);throw g}class El{static emptySet(g){return new El(g.comparator)}constructor(g){this.comparator=g?(t,e)=>g(t,e)||le.comparator(t.key,e.key):(g,t)=>le.comparator(g.key,t.key),this.keyedMap=rn(),this.sortedSet=new Ye(this.comparator)}has(g){return null!=this.keyedMap.get(g)}get(g){return this.keyedMap.get(g)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(g){const t=this.keyedMap.get(g);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(g){this.sortedSet.inorderTraversal(((t,e)=>(g(t),!1)))}add(g){const t=this.delete(g.key);return t.copy(t.keyedMap.insert(g.key,g),t.sortedSet.insert(g,null))}delete(g){const t=this.get(g);return t?this.copy(this.keyedMap.remove(g),this.sortedSet.remove(t)):this}isEqual(g){if(!(g instanceof El))return!1;if(this.size!==g.size)return!1;const t=this.sortedSet.getIterator(),e=g.sortedSet.getIterator();for(;t.hasNext();){const g=t.getNext().key,I=e.getNext().key;if(!g.isEqual(I))return!1}return!0}toString(){const g=[];return this.forEach((t=>{g.push(t.toString())})),0===g.length?"DocumentSet ()":"DocumentSet (\n  "+g.join("  \n")+"\n)"}copy(g,t){const e=new El;return e.comparator=this.comparator,e.keyedMap=g,e.sortedSet=t,e}}class zl{constructor(){this.z_=new Ye(le.comparator)}track(g){const t=g.doc.key,e=this.z_.get(t);e?0!==g.type&&3===e.type?this.z_=this.z_.insert(t,g):3===g.type&&1!==e.type?this.z_=this.z_.insert(t,{type:e.type,doc:g.doc}):2===g.type&&2===e.type?this.z_=this.z_.insert(t,{type:2,doc:g.doc}):2===g.type&&0===e.type?this.z_=this.z_.insert(t,{type:0,doc:g.doc}):1===g.type&&0===e.type?this.z_=this.z_.remove(t):1===g.type&&2===e.type?this.z_=this.z_.insert(t,{type:1,doc:e.doc}):0===g.type&&1===e.type?this.z_=this.z_.insert(t,{type:2,doc:g.doc}):Kt():this.z_=this.z_.insert(t,g)}j_(){const g=[];return this.z_.inorderTraversal(((t,e)=>{g.push(e)})),g}}class xl{constructor(g,t,e,I,n,C,i,l,o){this.query=g,this.docs=t,this.oldDocs=e,this.docChanges=I,this.mutatedKeys=n,this.fromCache=C,this.syncStateChanged=i,this.excludesMetadataChanges=l,this.hasCachedResults=o}static fromInitialDocuments(g,t,e,I,n){const C=[];return t.forEach((g=>{C.push({type:0,doc:g})})),new xl(g,t,El.emptySet(t),C,e,I,!0,!1,n)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(g){if(!(this.fromCache===g.fromCache&&this.hasCachedResults===g.hasCachedResults&&this.syncStateChanged===g.syncStateChanged&&this.mutatedKeys.isEqual(g.mutatedKeys)&&$I(this.query,g.query)&&this.docs.isEqual(g.docs)&&this.oldDocs.isEqual(g.oldDocs)))return!1;const t=this.docChanges,e=g.docChanges;if(t.length!==e.length)return!1;for(let I=0;I<t.length;I++)if(t[I].type!==e[I].type||!t[I].doc.isEqual(e[I].doc))return!1;return!0}}class Ll{constructor(){this.H_=void 0,this.J_=[]}Y_(){return this.J_.some((g=>g.Z_()))}}class Ml{constructor(){this.queries=Ul(),this.onlineState="Unknown",this.X_=new Set}terminate(){!function(g,t){const e=Et(g),I=e.queries;e.queries=Ul(),I.forEach(((g,e)=>{for(const I of e.J_)I.onError(t)}))}(this,new xt(zt.ABORTED,"Firestore shutting down"))}}function Ul(){return new ln((g=>gn(g)),$I)}async function Tl(g,t){const e=Et(g);let I=3;const n=t.query;let C=e.queries.get(n);C?!C.Y_()&&t.Z_()&&(I=2):(C=new Ll,I=t.Z_()?0:1);try{switch(I){case 0:C.H_=await e.onListen(n,!0);break;case 1:C.H_=await e.onListen(n,!1);break;case 2:await e.onFirstRemoteStoreListen(n)}}catch(g){const e=Fl(g,`Initialization of query '${tn(t.query)}' failed`);return void t.onError(e)}e.queries.set(n,C),C.J_.push(t),t.ea(e.onlineState),C.H_&&t.ta(C.H_)&&jl(e)}async function Ql(g,t){const e=Et(g),I=t.query;let n=3;const C=e.queries.get(I);if(C){const g=C.J_.indexOf(t);g>=0&&(C.J_.splice(g,1),0===C.J_.length?n=t.Z_()?0:1:!C.Y_()&&t.Z_()&&(n=2))}switch(n){case 0:return e.queries.delete(I),e.onUnlisten(I,!0);case 1:return e.queries.delete(I),e.onUnlisten(I,!1);case 2:return e.onLastRemoteStoreUnlisten(I);default:return}}function Dl(g,t){const e=Et(g);let I=!1;for(const n of t){const g=n.query,t=e.queries.get(g);if(t){for(const g of t.J_)g.ta(n)&&(I=!0);t.H_=n}}I&&jl(e)}function _l(g,t,e){const I=Et(g),n=I.queries.get(t);if(n)for(const C of n.J_)C.onError(e);I.queries.delete(t)}function jl(g){g.X_.forEach((g=>{g.next()}))}var Pl,Ol;(Ol=Pl||(Pl={})).na="default",Ol.Cache="cache";class ql{constructor(g,t,e){this.query=g,this.ra=t,this.ia=!1,this.sa=null,this.onlineState="Unknown",this.options=e||{}}ta(g){if(!this.options.includeMetadataChanges){const t=[];for(const e of g.docChanges)3!==e.type&&t.push(e);g=new xl(g.query,g.docs,g.oldDocs,t,g.mutatedKeys,g.fromCache,g.syncStateChanged,!0,g.hasCachedResults)}let t=!1;return this.ia?this.oa(g)&&(this.ra.next(g),t=!0):this._a(g,this.onlineState)&&(this.aa(g),t=!0),this.sa=g,t}onError(g){this.ra.error(g)}ea(g){this.onlineState=g;let t=!1;return this.sa&&!this.ia&&this._a(this.sa,g)&&(this.aa(this.sa),t=!0),t}_a(g,t){if(!g.fromCache)return!0;if(!this.Z_())return!0;const e="Offline"!==t;return(!this.options.ua||!e)&&(!g.docs.isEmpty()||g.hasCachedResults||"Offline"===t)}oa(g){if(g.docChanges.length>0)return!0;const t=this.sa&&this.sa.hasPendingWrites!==g.hasPendingWrites;return!(!g.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}aa(g){g=xl.fromInitialDocuments(g.query,g.docs,g.mutatedKeys,g.fromCache,g.hasCachedResults),this.ia=!0,this.ra.next(g)}Z_(){return this.options.source!==Pl.Cache}}class $l{constructor(g){this.key=g}}class go{constructor(g){this.key=g}}class to{constructor(g,t){this.query=g,this.da=t,this.Aa=null,this.hasCachedResults=!1,this.current=!1,this.Ra=Zn(),this.mutatedKeys=Zn(),this.Va=nn(g),this.ma=new El(this.Va)}get fa(){return this.da}ga(g,t){const e=t?t.pa:new zl,I=t?t.ma:this.ma;let n=t?t.mutatedKeys:this.mutatedKeys,C=I,i=!1;const l="F"===this.query.limitType&&I.size===this.query.limit?I.last():null,o="L"===this.query.limitType&&I.size===this.query.limit?I.first():null;if(g.inorderTraversal(((g,t)=>{const s=I.get(g),a=en(this.query,t)?t:null,r=!!s&&this.mutatedKeys.has(s.key),c=!!a&&(a.hasLocalMutations||this.mutatedKeys.has(a.key)&&a.hasCommittedMutations);let A=!1;s&&a?s.data.isEqual(a.data)?r!==c&&(e.track({type:3,doc:a}),A=!0):this.ya(s,a)||(e.track({type:2,doc:a}),A=!0,(l&&this.Va(a,l)>0||o&&this.Va(a,o)<0)&&(i=!0)):!s&&a?(e.track({type:0,doc:a}),A=!0):s&&!a&&(e.track({type:1,doc:s}),A=!0,(l||o)&&(i=!0)),A&&(a?(C=C.add(a),n=c?n.add(g):n.delete(g)):(C=C.delete(g),n=n.delete(g)))})),null!==this.query.limit)for(;C.size>this.query.limit;){const g="F"===this.query.limitType?C.last():C.first();C=C.delete(g.key),n=n.delete(g.key),e.track({type:1,doc:g})}return{ma:C,pa:e,ss:i,mutatedKeys:n}}ya(g,t){return g.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(g,t,e,I){const n=this.ma;this.ma=g.ma,this.mutatedKeys=g.mutatedKeys;const C=g.pa.j_();C.sort(((g,t)=>function(g,t){const e=g=>{switch(g){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Kt()}};return e(g)-e(t)}(g.type,t.type)||this.Va(g.doc,t.doc))),this.wa(e),I=null!=I&&I;const i=t&&!I?this.Sa():[],l=0===this.Ra.size&&this.current&&!I?1:0,o=l!==this.Aa;return this.Aa=l,0!==C.length||o?{snapshot:new xl(this.query,g.ma,n,C,g.mutatedKeys,0===l,o,!1,!!e&&e.resumeToken.approximateByteSize()>0),ba:i}:{ba:i}}ea(g){return this.current&&"Offline"===g?(this.current=!1,this.applyChanges({ma:this.ma,pa:new zl,mutatedKeys:this.mutatedKeys,ss:!1},!1)):{ba:[]}}Da(g){return!this.da.has(g)&&!!this.ma.has(g)&&!this.ma.get(g).hasLocalMutations}wa(g){g&&(g.addedDocuments.forEach((g=>this.da=this.da.add(g))),g.modifiedDocuments.forEach((g=>{})),g.removedDocuments.forEach((g=>this.da=this.da.delete(g))),this.current=g.current)}Sa(){if(!this.current)return[];const g=this.Ra;this.Ra=Zn(),this.ma.forEach((g=>{this.Da(g.key)&&(this.Ra=this.Ra.add(g.key))}));const t=[];return g.forEach((g=>{this.Ra.has(g)||t.push(new go(g))})),this.Ra.forEach((e=>{g.has(e)||t.push(new $l(e))})),t}va(g){this.da=g.ds,this.Ra=Zn();const t=this.ga(g.documents);return this.applyChanges(t,!0)}Ca(){return xl.fromInitialDocuments(this.query,this.ma,this.mutatedKeys,0===this.Aa,this.hasCachedResults)}}class eo{constructor(g,t,e){this.query=g,this.targetId=t,this.view=e}}class Io{constructor(g){this.key=g,this.Fa=!1}}class no{constructor(g,t,e,I,n,C){this.localStore=g,this.remoteStore=t,this.eventManager=e,this.sharedClientState=I,this.currentUser=n,this.maxConcurrentLimboResolutions=C,this.Ma={},this.xa=new ln((g=>gn(g)),$I),this.Oa=new Map,this.Na=new Set,this.La=new Ye(le.comparator),this.Ba=new Map,this.ka=new Gi,this.qa={},this.Qa=new Map,this.Ka=oi.Qn(),this.onlineState="Unknown",this.$a=void 0}get isPrimaryClient(){return!0===this.$a}}async function Co(g,t){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const I=Ro(g);let n;const C=I.xa.get(t);return C?(I.sharedClientState.addLocalQueryTarget(C.targetId),n=C.view.Ca()):n=await lo(I,t,e,!0),n}async function io(g,t){const e=Ro(g);await lo(e,t,!0,!1)}async function lo(g,t,e,I){const n=await Ei(g.localStore,PI(t)),C=n.targetId,i=g.sharedClientState.addLocalQueryTarget(C,e);let l;return I&&(l=await oo(g,t,C,"current"===i,n.resumeToken)),g.isPrimaryClient&&e&&al(g.remoteStore,n),l}async function oo(g,t,e,I,n){g.Ua=(t,e,I)=>async function(g,t,e,I){let n=t.view.ga(e);n.ss&&(n=await xi(g.localStore,t.query,!1).then((g=>{let{documents:e}=g;return t.view.ga(e,n)})));const C=I&&I.targetChanges.get(t.targetId),i=I&&null!=I.targetMismatches.get(t.targetId),l=t.view.applyChanges(n,g.isPrimaryClient,C,i);return po(g,t.targetId,l.ba),l.snapshot}(g,t,e,I);const C=await xi(g.localStore,t,!0),i=new to(t,C.ds),l=i.ga(C.documents),o=dC.createSynthesizedTargetChangeForCurrentChange(e,I&&"Offline"!==g.onlineState,n),s=i.applyChanges(l,g.isPrimaryClient,o);po(g,e,s.ba);const a=new eo(t,e,i);return g.xa.set(t,a),g.Oa.has(e)?g.Oa.get(e).push(t):g.Oa.set(e,[t]),s.snapshot}async function so(g,t,e){const I=Et(g),n=I.xa.get(t),C=I.Oa.get(n.targetId);if(C.length>1)return I.Oa.set(n.targetId,C.filter((g=>!$I(g,t)))),void I.xa.delete(t);I.isPrimaryClient?(I.sharedClientState.removeLocalQueryTarget(n.targetId),I.sharedClientState.isActiveQueryTarget(n.targetId)||await zi(I.localStore,n.targetId,!1).then((()=>{I.sharedClientState.clearQueryState(n.targetId),e&&rl(I.remoteStore,n.targetId),bo(I,n.targetId)})).catch(ue)):(bo(I,n.targetId),await zi(I.localStore,n.targetId,!0))}async function ao(g,t){const e=Et(g),I=e.xa.get(t),n=e.Oa.get(I.targetId);e.isPrimaryClient&&1===n.length&&(e.sharedClientState.removeLocalQueryTarget(I.targetId),rl(e.remoteStore,I.targetId))}async function ro(g,t){const e=Et(g);try{const g=await function(g,t){const e=Et(g),I=t.snapshotVersion;let n=e.us;return e.persistence.runTransaction("Apply remote event","readwrite-primary",(g=>{const C=e.hs.newChangeBuffer({trackRemovals:!0});n=e.us;const i=[];t.targetChanges.forEach(((C,l)=>{const o=n.get(l);if(!o)return;i.push(e.Gr.removeMatchingKeys(g,C.removedDocuments,l).next((()=>e.Gr.addMatchingKeys(g,C.addedDocuments,l))));let s=o.withSequenceNumber(g.currentSequenceNumber);null!==t.targetMismatches.get(l)?s=s.withResumeToken(ze.EMPTY_BYTE_STRING,ee.min()).withLastLimboFreeSnapshotVersion(ee.min()):C.resumeToken.approximateByteSize()>0&&(s=s.withResumeToken(C.resumeToken,I)),n=n.insert(l,s),function(g,t,e){return 0===g.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-g.snapshotVersion.toMicroseconds()>=3e8||e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size>0}(o,s,C)&&i.push(e.Gr.updateTargetData(g,s))}));let l=sn(),o=Zn();if(t.documentUpdates.forEach((I=>{t.resolvedLimboDocuments.has(I)&&i.push(e.persistence.referenceDelegate.updateLimboDocument(g,I))})),i.push(Ki(g,C,t.documentUpdates).next((g=>{l=g.Is,o=g.Es}))),!I.isEqual(ee.min())){const t=e.Gr.getLastRemoteSnapshotVersion(g).next((t=>e.Gr.setTargetsMetadata(g,g.currentSequenceNumber,I)));i.push(t)}return he.waitFor(i).next((()=>C.apply(g))).next((()=>e.localDocuments.getLocalViewOfDocuments(g,l,o))).next((()=>l))})).then((g=>(e.us=n,g)))}(e.localStore,t);t.targetChanges.forEach(((g,t)=>{const I=e.Ba.get(t);I&&(Ft(g.addedDocuments.size+g.modifiedDocuments.size+g.removedDocuments.size<=1),g.addedDocuments.size>0?I.Fa=!0:g.modifiedDocuments.size>0?Ft(I.Fa):g.removedDocuments.size>0&&(Ft(I.Fa),I.Fa=!1))})),await Vo(e,g,t)}catch(g){await ue(g)}}function co(g,t,e){const I=Et(g);if(I.isPrimaryClient&&0===e||!I.isPrimaryClient&&1===e){const g=[];I.xa.forEach(((e,I)=>{const n=I.view.ea(t);n.snapshot&&g.push(n.snapshot)})),function(g,t){const e=Et(g);e.onlineState=t;let I=!1;e.queries.forEach(((g,e)=>{for(const n of e.J_)n.ea(t)&&(I=!0)})),I&&jl(e)}(I.eventManager,t),g.length&&I.Ma.R_(g),I.onlineState=t,I.isPrimaryClient&&I.sharedClientState.setOnlineState(t)}}async function Ao(g,t,e){const I=Et(g);I.sharedClientState.updateQueryState(t,"rejected",e);const n=I.Ba.get(t),C=n&&n.key;if(C){let g=new Ye(le.comparator);g=g.insert(C,hI.newNoDocument(C,ee.min()));const e=Zn().add(C),n=new AC(ee.min(),new Map,new Ye($t),g,e);await ro(I,n),I.La=I.La.remove(C),I.Ba.delete(t),Bo(I)}else await zi(I.localStore,t,!1).then((()=>bo(I,t,e))).catch(ue)}async function uo(g,t){const e=Et(g),I=t.batch.batchId;try{const g=await function(g,t){const e=Et(g);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",(g=>{const I=t.batch.keys(),n=e.hs.newChangeBuffer({trackRemovals:!0});return function(g,t,e,I){const n=e.batch,C=n.keys();let i=he.resolve();return C.forEach((g=>{i=i.next((()=>I.getEntry(t,g))).next((t=>{const C=e.docVersions.get(g);Ft(null!==C),t.version.compareTo(C)<0&&(n.applyToRemoteDocument(t,e),t.isValidDocument()&&(t.setReadTime(e.commitVersion),I.addEntry(t)))}))})),i.next((()=>g.mutationQueue.removeMutationBatch(t,n)))}(e,g,t,n).next((()=>n.apply(g))).next((()=>e.mutationQueue.performConsistencyCheck(g))).next((()=>e.documentOverlayCache.removeOverlaysForBatchId(g,I,t.batch.batchId))).next((()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(g,function(g){let t=Zn();for(let e=0;e<g.mutationResults.length;++e)g.mutationResults[e].transformResults.length>0&&(t=t.add(g.batch.mutations[e].key));return t}(t)))).next((()=>e.localDocuments.getDocuments(g,I)))}))}(e.localStore,t);Zo(e,I,null),mo(e,I),e.sharedClientState.updateMutationState(I,"acknowledged"),await Vo(e,g)}catch(g){await ue(g)}}async function ho(g,t,e){const I=Et(g);try{const g=await function(g,t){const e=Et(g);return e.persistence.runTransaction("Reject batch","readwrite-primary",(g=>{let I;return e.mutationQueue.lookupMutationBatch(g,t).next((t=>(Ft(null!==t),I=t.keys(),e.mutationQueue.removeMutationBatch(g,t)))).next((()=>e.mutationQueue.performConsistencyCheck(g))).next((()=>e.documentOverlayCache.removeOverlaysForBatchId(g,I,t))).next((()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(g,I))).next((()=>e.localDocuments.getDocuments(g,I)))}))}(I.localStore,t);Zo(I,t,e),mo(I,t),I.sharedClientState.updateMutationState(t,"rejected",e),await Vo(I,g)}catch(e){await ue(e)}}function mo(g,t){(g.Qa.get(t)||[]).forEach((g=>{g.resolve()})),g.Qa.delete(t)}function Zo(g,t,e){const I=Et(g);let n=I.qa[I.currentUser.toKey()];if(n){const g=n.get(t);g&&(e?g.reject(e):g.resolve(),n=n.remove(t)),I.qa[I.currentUser.toKey()]=n}}function bo(g,t){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;g.sharedClientState.removeLocalQueryTarget(t);for(const I of g.Oa.get(t))g.xa.delete(I),e&&g.Ma.Wa(I,e);g.Oa.delete(t),g.isPrimaryClient&&g.ka.yr(t).forEach((t=>{g.ka.containsKey(t)||Go(g,t)}))}function Go(g,t){g.Na.delete(t.path.canonicalString());const e=g.La.get(t);null!==e&&(rl(g.remoteStore,e),g.La=g.La.remove(t),g.Ba.delete(e),Bo(g))}function po(g,t,e){for(const I of e)I instanceof $l?(g.ka.addReference(I.key,t),yo(g,I)):I instanceof go?(Yt("SyncEngine","Document no longer in limbo: "+I.key),g.ka.removeReference(I.key,t),g.ka.containsKey(I.key)||Go(g,I.key)):Kt()}function yo(g,t){const e=t.key,I=e.path.canonicalString();g.La.get(e)||g.Na.has(I)||(Yt("SyncEngine","New document in limbo: "+e),g.Na.add(I),Bo(g))}function Bo(g){for(;g.Na.size>0&&g.La.size<g.maxConcurrentLimboResolutions;){const t=g.Na.values().next().value;g.Na.delete(t);const e=new le(ne.fromString(t)),I=g.Ka.next();g.Ba.set(I,new Io(e)),g.La=g.La.insert(e,I),al(g.remoteStore,new gi(PI(QI(e.path)),I,"TargetPurposeLimboResolution",be.oe))}}async function Vo(g,t,e){const I=Et(g),n=[],C=[],i=[];I.xa.isEmpty()||(I.xa.forEach(((g,l)=>{i.push(I.Ua(l,t,e).then((g=>{var t;if((g||e)&&I.isPrimaryClient){const n=g?!g.fromCache:null===(t=null==e?void 0:e.targetChanges.get(l.targetId))||void 0===t?void 0:t.current;I.sharedClientState.updateQueryState(l.targetId,n?"current":"not-current")}if(g){n.push(g);const t=Ji.zi(l.targetId,g);C.push(t)}})))})),await Promise.all(i),I.Ma.R_(n),await async function(g,t){const e=Et(g);try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",(g=>he.forEach(t,(t=>he.forEach(t.Wi,(I=>e.persistence.referenceDelegate.addReference(g,t.targetId,I))).next((()=>he.forEach(t.Gi,(I=>e.persistence.referenceDelegate.removeReference(g,t.targetId,I)))))))))}catch(g){if(!Ze(g))throw g;Yt("LocalStore","Failed to update sequence numbers: "+g)}for(const I of t){const g=I.targetId;if(!I.fromCache){const t=e.us.get(g),I=t.snapshotVersion,n=t.withLastLimboFreeSnapshotVersion(I);e.us=e.us.insert(g,n)}}}(I.localStore,C))}async function Wo(g,t){const e=Et(g);if(!e.currentUser.isEqual(t)){Yt("SyncEngine","User change. New user:",t.toKey());const g=await wi(e.localStore,t);e.currentUser=t,function(g,t){g.Qa.forEach((g=>{g.forEach((g=>{g.reject(new xt(zt.CANCELLED,t))}))})),g.Qa.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,g.removedBatchIds,g.addedBatchIds),await Vo(e,g.Ts)}}function So(g,t){const e=Et(g),I=e.Ba.get(t);if(I&&I.Fa)return Zn().add(I.key);{let g=Zn();const I=e.Oa.get(t);if(!I)return g;for(const t of I){const I=e.xa.get(t);g=g.unionWith(I.view.fa)}return g}}function Ro(g){const t=Et(g);return t.remoteStore.remoteSyncer.applyRemoteEvent=ro.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=So.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Ao.bind(null,t),t.Ma.R_=Dl.bind(null,t.eventManager),t.Ma.Wa=_l.bind(null,t.eventManager),t}function fo(g){const t=Et(g);return t.remoteStore.remoteSyncer.applySuccessfulWrite=uo.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=ho.bind(null,t),t}class Xo{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(g){this.serializer=gl(g.databaseInfo.databaseId),this.sharedClientState=this.za(g),this.persistence=this.ja(g),await this.persistence.start(),this.localStore=this.Ha(g),this.gcScheduler=this.Ja(g,this.localStore),this.indexBackfillerScheduler=this.Ya(g,this.localStore)}Ja(g,t){return null}Ya(g,t){return null}Ha(g){return Hi(this.persistence,new ki,g.initialUser,this.serializer)}ja(g){return new Si(fi.ei,this.serializer)}za(g){return new Ui}async terminate(){var g,t;null===(g=this.gcScheduler)||void 0===g||g.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Xo.provider={build:()=>new Xo};class Jo extends Xo{constructor(g){super(),this.cacheSizeBytes=g}Ja(g,t){Ft(this.persistence.referenceDelegate instanceof Xi);const e=this.persistence.referenceDelegate.garbageCollector;return new ri(e,g.asyncQueue,t)}ja(g){const t=void 0!==this.cacheSizeBytes?li.withCacheSize(this.cacheSizeBytes):li.DEFAULT;return new Si((g=>Xi.ei(g,t)),this.serializer)}}class vo{async initialize(g,t){this.localStore||(this.localStore=g.localStore,this.sharedClientState=g.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!g.synchronizeTabs),this.sharedClientState.onlineStateHandler=g=>co(this.syncEngine,g,1),this.remoteStore.remoteSyncer.handleCredentialChange=Wo.bind(null,this.syncEngine),await Hl(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(g){return new Ml}createDatastore(g){const t=gl(g.databaseInfo.databaseId),e=function(g){return new qi(g)}(g.databaseInfo);return function(g,t,e,I){return new Cl(g,t,e,I)}(g.authCredentials,g.appCheckCredentials,e,t)}createRemoteStore(g){return function(g,t,e,I,n){return new ll(g,t,e,I,n)}(this.localStore,this.datastore,g.asyncQueue,(g=>co(this.syncEngine,g,0)),Qi.p()?new Qi:new Ti)}createSyncEngine(g,t){return function(g,t,e,I,n,C,i){const l=new no(g,t,e,I,n,C);return i&&(l.$a=!0),l}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,g.initialUser,g.maxConcurrentLimboResolutions,t)}async terminate(){var g,t;await async function(g){const t=Et(g);Yt("RemoteStore","RemoteStore shutting down."),t.k_.add(5),await sl(t),t.Q_.shutdown(),t.K_.set("Unknown")}(this.remoteStore),null===(g=this.datastore)||void 0===g||g.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}vo.provider={build:()=>new vo};class ko{constructor(g){this.observer=g,this.muted=!1}next(g){this.muted||this.observer.next&&this.Xa(this.observer.next,g)}error(g){this.muted||(this.observer.error?this.Xa(this.observer.error,g):Ht("Uncaught Error in snapshot listener:",g.toString()))}eu(){this.muted=!0}Xa(g,t){setTimeout((()=>{this.muted||g(t)}),0)}}class Yo{constructor(g,t,e,I,n){this.authCredentials=g,this.appCheckCredentials=t,this.asyncQueue=e,this.databaseInfo=I,this.user=Xt.UNAUTHENTICATED,this.clientId=qt.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=n,this.authCredentials.start(e,(async g=>{Yt("FirestoreClient","Received user=",g.uid),await this.authCredentialListener(g),this.user=g})),this.appCheckCredentials.start(e,(g=>(Yt("FirestoreClient","Received new app check token=",g),this.appCheckCredentialListener(g,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(g){this.authCredentialListener=g}setAppCheckTokenChangeListener(g){this.appCheckCredentialListener=g}terminate(){this.asyncQueue.enterRestrictedMode();const g=new Lt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),g.resolve()}catch(t){const e=Fl(t,"Failed to shutdown persistence");g.reject(e)}})),g.promise}}async function Ho(g,t){g.asyncQueue.verifyOperationInProgress(),Yt("FirestoreClient","Initializing OfflineComponentProvider");const e=g.configuration;await t.initialize(e);let I=e.initialUser;g.setCredentialChangeListener((async g=>{I.isEqual(g)||(await wi(t.localStore,g),I=g)})),t.persistence.setDatabaseDeletedListener((()=>g.terminate())),g._offlineComponents=t}async function wo(g,t){g.asyncQueue.verifyOperationInProgress();const e=await No(g);Yt("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(e,g.configuration),g.setCredentialChangeListener((g=>Yl(t.remoteStore,g))),g.setAppCheckTokenChangeListener(((g,e)=>Yl(t.remoteStore,e))),g._onlineComponents=t}async function No(g){if(!g._offlineComponents)if(g._uninitializedComponentsProvider){Yt("FirestoreClient","Using user provided OfflineComponentProvider");try{await Ho(g,g._uninitializedComponentsProvider._offline)}catch(t){const e=t;if(!function(g){return"FirebaseError"===g.name?g.code===zt.FAILED_PRECONDITION||g.code===zt.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&g instanceof DOMException)||22===g.code||20===g.code||11===g.code}(e))throw e;wt("Error using user provided cache. Falling back to memory cache: "+e),await Ho(g,new Xo)}}else Yt("FirestoreClient","Using default OfflineComponentProvider"),await Ho(g,new Jo(void 0));return g._offlineComponents}async function Ko(g){return g._onlineComponents||(g._uninitializedComponentsProvider?(Yt("FirestoreClient","Using user provided OnlineComponentProvider"),await wo(g,g._uninitializedComponentsProvider._online)):(Yt("FirestoreClient","Using default OnlineComponentProvider"),await wo(g,new vo))),g._onlineComponents}function Fo(g){return Ko(g).then((g=>g.syncEngine))}async function Eo(g){const t=await Ko(g),e=t.eventManager;return e.onListen=Co.bind(null,t.syncEngine),e.onUnlisten=so.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=io.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=ao.bind(null,t.syncEngine),e}function zo(g,t){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const I=new Lt;return g.asyncQueue.enqueueAndForget((async()=>function(g,t,e,I,n){const C=new ko({next:e=>{C.eu(),t.enqueueAndForget((()=>Ql(g,i))),e.fromCache&&"server"===I.source?n.reject(new xt(zt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):n.resolve(e)},error:g=>n.reject(g)}),i=new ql(e,C,{includeMetadataChanges:!0,ua:!0});return Tl(g,i)}(await Eo(g),g.asyncQueue,t,e,I))),I.promise}function xo(g){const t={};return void 0!==g.timeoutSeconds&&(t.timeoutSeconds=g.timeoutSeconds),t}const Lo=new Map;function Mo(g,t,e){if(!e)throw new xt(zt.INVALID_ARGUMENT,`Function ${g}() cannot be called with an empty ${t}.`)}function Uo(g){if(!le.isDocumentKey(g))throw new xt(zt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${g} has ${g.length}.`)}function To(g){if(le.isDocumentKey(g))throw new xt(zt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${g} has ${g.length}.`)}function Qo(g){if(void 0===g)return"undefined";if(null===g)return"null";if("string"==typeof g)return g.length>20&&(g=`${g.substring(0,20)}...`),JSON.stringify(g);if("number"==typeof g||"boolean"==typeof g)return""+g;if("object"==typeof g){if(g instanceof Array)return"an array";{const t=function(g){return g.constructor?g.constructor.name:null}(g);return t?`a custom ${t} object`:"an object"}}return"function"==typeof g?"a function":Kt()}function Do(g,t){if("_delegate"in g&&(g=g._delegate),!(g instanceof t)){if(t.name===g.constructor.name)throw new xt(zt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=Qo(g);throw new xt(zt.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return g}class _o{constructor(g){var t,e;if(void 0===g.host){if(void 0!==g.ssl)throw new xt(zt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=g.host,this.ssl=null===(t=g.ssl)||void 0===t||t;if(this.credentials=g.credentials,this.ignoreUndefinedProperties=!!g.ignoreUndefinedProperties,this.localCache=g.localCache,void 0===g.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==g.cacheSizeBytes&&g.cacheSizeBytes<1048576)throw new xt(zt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=g.cacheSizeBytes}(function(g,t,e,I){if(!0===t&&!0===I)throw new xt(zt.INVALID_ARGUMENT,`${g} and ${e} cannot be used together.`)})("experimentalForceLongPolling",g.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",g.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!g.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===g.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!g.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=xo(null!==(e=g.experimentalLongPollingOptions)&&void 0!==e?e:{}),function(g){if(void 0!==g.timeoutSeconds){if(isNaN(g.timeoutSeconds))throw new xt(zt.INVALID_ARGUMENT,`invalid long polling timeout: ${g.timeoutSeconds} (must not be NaN)`);if(g.timeoutSeconds<5)throw new xt(zt.INVALID_ARGUMENT,`invalid long polling timeout: ${g.timeoutSeconds} (minimum allowed value is 5)`);if(g.timeoutSeconds>30)throw new xt(zt.INVALID_ARGUMENT,`invalid long polling timeout: ${g.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!g.useFetchStreams}isEqual(g){return this.host===g.host&&this.ssl===g.ssl&&this.credentials===g.credentials&&this.cacheSizeBytes===g.cacheSizeBytes&&this.experimentalForceLongPolling===g.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===g.experimentalAutoDetectLongPolling&&function(g,t){return g.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,g.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===g.ignoreUndefinedProperties&&this.useFetchStreams===g.useFetchStreams}}class jo{constructor(g,t,e,I){this._authCredentials=g,this._appCheckCredentials=t,this._databaseId=e,this._app=I,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new _o({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new xt(zt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(g){if(this._settingsFrozen)throw new xt(zt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new _o(g),void 0!==g.credentials&&(this._authCredentials=function(g){if(!g)return new Ut;switch(g.type){case"firstParty":return new _t(g.sessionIndex||"0",g.iamToken||null,g.authTokenFactory||null);case"provider":return g.client;default:throw new xt(zt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(g.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(g){const t=Lo.get(g);t&&(Yt("ComponentProvider","Removing Datastore"),Lo.delete(g),t.terminate())}(this),Promise.resolve()}}class Po{constructor(g,t,e){this.converter=t,this._query=e,this.type="query",this.firestore=g}withConverter(g){return new Po(this.firestore,g,this._query)}}class Oo{constructor(g,t,e){this.converter=t,this._key=e,this.type="document",this.firestore=g}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new qo(this.firestore,this.converter,this._key.path.popLast())}withConverter(g){return new Oo(this.firestore,g,this._key)}}class qo extends Po{constructor(g,t,e){super(g,t,QI(e)),this._path=e,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const g=this._path.popLast();return g.isEmpty()?null:new Oo(this.firestore,null,new le(g))}withConverter(g){return new qo(this.firestore,g,this._path)}}function $o(g,t){for(var e=arguments.length,I=new Array(e>2?e-2:0),n=2;n<e;n++)I[n-2]=arguments[n];if(g=E(g),1===arguments.length&&(t=qt.newId()),Mo("doc","path",t),g instanceof jo){const e=ne.fromString(t,...I);return Uo(e),new Oo(g,null,new le(e))}{if(!(g instanceof Oo||g instanceof qo))throw new xt(zt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const e=g._path.child(ne.fromString(t,...I));return Uo(e),new Oo(g.firestore,g instanceof qo?g.converter:null,new le(e))}}class gs{constructor(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Promise.resolve();this.Iu=[],this.Eu=!1,this.du=[],this.Au=null,this.Ru=!1,this.Vu=!1,this.mu=[],this.r_=new tl(this,"async_queue_retry"),this.fu=()=>{const g=$i();g&&Yt("AsyncQueue","Visibility state changed to "+g.visibilityState),this.r_.Jo()},this.gu=g;const t=$i();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.fu)}get isShuttingDown(){return this.Eu}enqueueAndForget(g){this.enqueue(g)}enqueueAndForgetEvenWhileRestricted(g){this.pu(),this.yu(g)}enterRestrictedMode(g){if(!this.Eu){this.Eu=!0,this.Vu=g||!1;const t=$i();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.fu)}}enqueue(g){if(this.pu(),this.Eu)return new Promise((()=>{}));const t=new Lt;return this.yu((()=>this.Eu&&this.Vu?Promise.resolve():(g().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(g){this.enqueueAndForget((()=>(this.Iu.push(g),this.wu())))}async wu(){if(0!==this.Iu.length){try{await this.Iu[0](),this.Iu.shift(),this.r_.reset()}catch(g){if(!Ze(g))throw g;Yt("AsyncQueue","Operation failed with retryable error: "+g)}this.Iu.length>0&&this.r_.jo((()=>this.wu()))}}yu(g){const t=this.gu.then((()=>(this.Ru=!0,g().catch((g=>{this.Au=g,this.Ru=!1;const t=function(g){let t=g.message||"";return g.stack&&(t=g.stack.includes(g.message)?g.stack:g.message+"\n"+g.stack),t}(g);throw Ht("INTERNAL UNHANDLED ERROR: ",t),g})).then((g=>(this.Ru=!1,g))))));return this.gu=t,t}enqueueAfterDelay(g,t,e){this.pu(),this.mu.indexOf(g)>-1&&(t=0);const I=Kl.createAndSchedule(this,g,t,e,(g=>this.Su(g)));return this.du.push(I),I}pu(){this.Au&&Kt()}verifyOperationInProgress(){}async bu(){let g;do{g=this.gu,await g}while(g!==this.gu)}Du(g){for(const t of this.du)if(t.timerId===g)return!0;return!1}vu(g){return this.bu().then((()=>{this.du.sort(((g,t)=>g.targetTimeMs-t.targetTimeMs));for(const t of this.du)if(t.skipDelay(),"all"!==g&&t.timerId===g)break;return this.bu()}))}Cu(g){this.mu.push(g)}Su(g){const t=this.du.indexOf(g);this.du.splice(t,1)}}class ts extends jo{constructor(g,t,e,I){super(g,t,e,I),this.type="firestore",this._queue=new gs,this._persistenceKey=(null==I?void 0:I.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const g=this._firestoreClient.terminate();this._queue=new gs(g),this._firestoreClient=void 0,await g}}}function es(g){if(g._terminated)throw new xt(zt.FAILED_PRECONDITION,"The client has already been terminated.");return g._firestoreClient||Is(g),g._firestoreClient}function Is(g){var t,e,I;const n=g._freezeSettings(),C=function(g,t,e,I){return new _e(g,t,e,I.host,I.ssl,I.experimentalForceLongPolling,I.experimentalAutoDetectLongPolling,xo(I.experimentalLongPollingOptions),I.useFetchStreams)}(g._databaseId,(null===(t=g._app)||void 0===t?void 0:t.options.appId)||"",g._persistenceKey,n);g._componentsProvider||(null===(e=n.localCache)||void 0===e?void 0:e._offlineComponentProvider)&&(null===(I=n.localCache)||void 0===I?void 0:I._onlineComponentProvider)&&(g._componentsProvider={_offline:n.localCache._offlineComponentProvider,_online:n.localCache._onlineComponentProvider}),g._firestoreClient=new Yo(g._authCredentials,g._appCheckCredentials,g._queue,C,g._componentsProvider&&function(g){const t=null==g?void 0:g._online.build();return{_offline:null==g?void 0:g._offline.build(t),_online:t}}(g._componentsProvider))}class ns{constructor(g){this._byteString=g}static fromBase64String(g){try{return new ns(ze.fromBase64String(g))}catch(g){throw new xt(zt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+g)}}static fromUint8Array(g){return new ns(ze.fromUint8Array(g))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(g){return this._byteString.isEqual(g._byteString)}}class Cs{constructor(){for(var g=arguments.length,t=new Array(g),e=0;e<g;e++)t[e]=arguments[e];for(let I=0;I<t.length;++I)if(0===t[I].length)throw new xt(zt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ie(t)}isEqual(g){return this._internalPath.isEqual(g._internalPath)}}class is{constructor(g){this._methodName=g}}class ls{constructor(g,t){if(!isFinite(g)||g<-90||g>90)throw new xt(zt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+g);if(!isFinite(t)||t<-180||t>180)throw new xt(zt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=g,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(g){return this._lat===g._lat&&this._long===g._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(g){return $t(this._lat,g._lat)||$t(this._long,g._long)}}class os{constructor(g){this._values=(g||[]).map((g=>g))}toArray(){return this._values.map((g=>g))}isEqual(g){return function(g,t){if(g.length!==t.length)return!1;for(let e=0;e<g.length;++e)if(g[e]!==t[e])return!1;return!0}(this._values,g._values)}}const ss=/^__.*__$/;class as{constructor(g,t,e){this.data=g,this.fieldMask=t,this.fieldTransforms=e}toMutation(g,t){return new Qn(g,this.data,this.fieldMask,t,this.fieldTransforms)}}function rs(g){switch(g){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Kt()}}class cs{constructor(g,t,e,I,n,C){this.settings=g,this.databaseId=t,this.serializer=e,this.ignoreUndefinedProperties=I,void 0===n&&this.Fu(),this.fieldTransforms=n||[],this.fieldMask=C||[]}get path(){return this.settings.path}get Mu(){return this.settings.Mu}xu(g){return new cs(Object.assign(Object.assign({},this.settings),g),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ou(g){var t;const e=null===(t=this.path)||void 0===t?void 0:t.child(g),I=this.xu({path:e,Nu:!1});return I.Lu(g),I}Bu(g){var t;const e=null===(t=this.path)||void 0===t?void 0:t.child(g),I=this.xu({path:e,Nu:!1});return I.Fu(),I}ku(g){return this.xu({path:void 0,Nu:!0})}qu(g){return Ws(g,this.settings.methodName,this.settings.Qu||!1,this.path,this.settings.Ku)}contains(g){return void 0!==this.fieldMask.find((t=>g.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>g.isPrefixOf(t.field)))}Fu(){if(this.path)for(let g=0;g<this.path.length;g++)this.Lu(this.path.get(g))}Lu(g){if(0===g.length)throw this.qu("Document fields must not be empty");if(rs(this.Mu)&&ss.test(g))throw this.qu('Document fields cannot begin and end with "__"')}}class As{constructor(g,t,e){this.databaseId=g,this.ignoreUndefinedProperties=t,this.serializer=e||gl(g)}$u(g,t,e){let I=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new cs({Mu:g,methodName:t,Ku:e,path:ie.emptyPath(),Nu:!1,Qu:I},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ds(g){const t=g._freezeSettings(),e=gl(g._databaseId);return new As(g._databaseId,!!t.ignoreUndefinedProperties,e)}class us extends is{_toFieldTransform(g){if(2!==g.Mu)throw 1===g.Mu?g.qu(`${this._methodName}() can only appear at the top level of your update data`):g.qu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return g.fieldMask.push(g.path),null}isEqual(g){return g instanceof us}}function hs(g,t,e,I){const n=g.$u(1,t,e);ps("Data must be an object, but it was:",n,I);const C=[],i=dI.empty();ve(I,((g,I)=>{const l=Vs(t,g,e);I=E(I);const o=n.Bu(l);if(I instanceof us)C.push(l);else{const g=Zs(I,o);null!=g&&(C.push(l),i.set(l,g))}}));const l=new Fe(C);return new as(i,l,n.fieldTransforms)}function ms(g,t,e,I,n,C){const i=g.$u(1,t,e),l=[ys(t,I,e)],o=[n];if(C.length%2!=0)throw new xt(zt.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let c=0;c<C.length;c+=2)l.push(ys(t,C[c])),o.push(C[c+1]);const s=[],a=dI.empty();for(let c=l.length-1;c>=0;--c)if(!Ss(s,l[c])){const g=l[c];let t=o[c];t=E(t);const e=i.Bu(g);if(t instanceof us)s.push(g);else{const I=Zs(t,e);null!=I&&(s.push(g),a.set(g,I))}}const r=new Fe(s);return new as(a,r,i.fieldTransforms)}function Zs(g,t){if(Gs(g=E(g)))return ps("Unsupported field value:",t,g),bs(g,t);if(g instanceof is)return function(g,t){if(!rs(t.Mu))throw t.qu(`${g._methodName}() can only be used with update() and set()`);if(!t.path)throw t.qu(`${g._methodName}() is not currently supported inside arrays`);const e=g._toFieldTransform(t);e&&t.fieldTransforms.push(e)}(g,t),null;if(void 0===g&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),g instanceof Array){if(t.settings.Nu&&4!==t.Mu)throw t.qu("Nested arrays are not supported");return function(g,t){const e=[];let I=0;for(const n of g){let g=Zs(n,t.ku(I));null==g&&(g={nullValue:"NULL_VALUE"}),e.push(g),I++}return{arrayValue:{values:e}}}(g,t)}return function(g,t){if(null===(g=E(g)))return{nullValue:"NULL_VALUE"};if("number"==typeof g)return Bn(t.serializer,g);if("boolean"==typeof g)return{booleanValue:g};if("string"==typeof g)return{stringValue:g};if(g instanceof Date){const e=te.fromDate(g);return{timestampValue:RC(t.serializer,e)}}if(g instanceof te){const e=new te(g.seconds,1e3*Math.floor(g.nanoseconds/1e3));return{timestampValue:RC(t.serializer,e)}}if(g instanceof ls)return{geoPointValue:{latitude:g.latitude,longitude:g.longitude}};if(g instanceof ns)return{bytesValue:fC(t.serializer,g._byteString)};if(g instanceof Oo){const e=t.databaseId,I=g.firestore._databaseId;if(!I.isEqual(e))throw t.qu(`Document reference is for database ${I.projectId}/${I.database} but should be for database ${e.projectId}/${e.database}`);return{referenceValue:vC(g.firestore._databaseId||t.databaseId,g._key.path)}}if(g instanceof os)return function(g,t){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:g.toArray().map((g=>{if("number"!=typeof g)throw t.qu("VectorValues must only contain numeric values.");return pn(t.serializer,g)}))}}}}}}(g,t);throw t.qu(`Unsupported field value: ${Qo(g)}`)}(g,t)}function bs(g,t){const e={};return ke(g)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ve(g,((g,I)=>{const n=Zs(I,t.Ou(g));null!=n&&(e[g]=n)})),{mapValue:{fields:e}}}function Gs(g){return!("object"!=typeof g||null===g||g instanceof Array||g instanceof Date||g instanceof te||g instanceof ls||g instanceof ns||g instanceof Oo||g instanceof is||g instanceof os)}function ps(g,t,e){if(!Gs(e)||!function(g){return"object"==typeof g&&null!==g&&(Object.getPrototypeOf(g)===Object.prototype||null===Object.getPrototypeOf(g))}(e)){const I=Qo(e);throw"an object"===I?t.qu(g+" a custom object"):t.qu(g+" "+I)}}function ys(g,t,e){if((t=E(t))instanceof Cs)return t._internalPath;if("string"==typeof t)return Vs(g,t);throw Ws("Field path arguments must be of type string or ",g,!1,void 0,e)}const Bs=new RegExp("[~\\*/\\[\\]]");function Vs(g,t,e){if(t.search(Bs)>=0)throw Ws(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,g,!1,void 0,e);try{return new Cs(...t.split("."))._internalPath}catch(I){throw Ws(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,g,!1,void 0,e)}}function Ws(g,t,e,I,n){const C=I&&!I.isEmpty(),i=void 0!==n;let l=`Function ${t}() called with invalid data`;e&&(l+=" (via `toFirestore()`)"),l+=". ";let o="";return(C||i)&&(o+=" (found",C&&(o+=` in field ${I}`),i&&(o+=` in document ${n}`),o+=")"),new xt(zt.INVALID_ARGUMENT,l+g+o)}function Ss(g,t){return g.some((g=>g.isEqual(t)))}class Rs{constructor(g,t,e,I,n){this._firestore=g,this._userDataWriter=t,this._key=e,this._document=I,this._converter=n}get id(){return this._key.path.lastSegment()}get ref(){return new Oo(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const g=new fs(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(g)}return this._userDataWriter.convertValue(this._document.data.value)}}get(g){if(this._document){const t=this._document.data.field(Xs("DocumentSnapshot.get",g));if(null!==t)return this._userDataWriter.convertValue(t)}}}class fs extends Rs{data(){return super.data()}}function Xs(g,t){return"string"==typeof t?Vs(g,t):t instanceof Cs?t._internalPath:t._delegate._internalPath}function Js(g){if("L"===g.limitType&&0===g.explicitOrderBy.length)throw new xt(zt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class vs{convertValue(g){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(Oe(g)){case 0:return null;case 1:return g.booleanValue;case 2:return Me(g.integerValue||g.doubleValue);case 3:return this.convertTimestamp(g.timestampValue);case 4:return this.convertServerTimestamp(g,t);case 5:return g.stringValue;case 6:return this.convertBytes(Ue(g.bytesValue));case 7:return this.convertReference(g.referenceValue);case 8:return this.convertGeoPoint(g.geoPointValue);case 9:return this.convertArray(g.arrayValue,t);case 11:return this.convertObject(g.mapValue,t);case 10:return this.convertVectorValue(g.mapValue);default:throw Kt()}}convertObject(g,t){return this.convertObjectMap(g.fields,t)}convertObjectMap(g){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";const e={};return ve(g,((g,I)=>{e[g]=this.convertValue(I,t)})),e}convertVectorValue(g){var t,e,I;const n=null===(I=null===(e=null===(t=g.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===e?void 0:e.values)||void 0===I?void 0:I.map((g=>Me(g.doubleValue)));return new os(n)}convertGeoPoint(g){return new ls(Me(g.latitude),Me(g.longitude))}convertArray(g,t){return(g.values||[]).map((g=>this.convertValue(g,t)))}convertServerTimestamp(g,t){switch(t){case"previous":const e=Qe(g);return null==e?null:this.convertValue(e,t);case"estimate":return this.convertTimestamp(De(g));default:return null}}convertTimestamp(g){const t=Le(g);return new te(t.seconds,t.nanos)}convertDocumentKey(g,t){const e=ne.fromString(g);Ft($C(e));const I=new je(e.get(1),e.get(3)),n=new le(e.popFirst(5));return I.isEqual(t)||Ht(`Document ${n} contains a document reference within a different database (${I.projectId}/${I.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),n}}class ks{constructor(g,t){this.hasPendingWrites=g,this.fromCache=t}isEqual(g){return this.hasPendingWrites===g.hasPendingWrites&&this.fromCache===g.fromCache}}class Ys extends Rs{constructor(g,t,e,I,n,C){super(g,t,e,I,C),this._firestore=g,this._firestoreImpl=g,this.metadata=n}exists(){return super.exists()}data(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const t=new Hs(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,g)}return this._userDataWriter.convertValue(this._document.data.value,g.serverTimestamps)}}get(g){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const e=this._document.data.field(Xs("DocumentSnapshot.get",g));if(null!==e)return this._userDataWriter.convertValue(e,t.serverTimestamps)}}}class Hs extends Ys{data(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(g)}}class ws{constructor(g,t,e,I){this._firestore=g,this._userDataWriter=t,this._snapshot=I,this.metadata=new ks(I.hasPendingWrites,I.fromCache),this.query=e}get docs(){const g=[];return this.forEach((t=>g.push(t))),g}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(g,t){this._snapshot.docs.forEach((e=>{g.call(t,new Hs(this._firestore,this._userDataWriter,e.key,e,new ks(this._snapshot.mutatedKeys.has(e.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(){const g=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(g&&this._snapshot.excludesMetadataChanges)throw new xt(zt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===g||(this._cachedChanges=function(g,t){if(g._snapshot.oldDocs.isEmpty()){let t=0;return g._snapshot.docChanges.map((e=>{const I=new Hs(g._firestore,g._userDataWriter,e.doc.key,e.doc,new ks(g._snapshot.mutatedKeys.has(e.doc.key),g._snapshot.fromCache),g.query.converter);return e.doc,{type:"added",doc:I,oldIndex:-1,newIndex:t++}}))}{let e=g._snapshot.oldDocs;return g._snapshot.docChanges.filter((g=>t||3!==g.type)).map((t=>{const I=new Hs(g._firestore,g._userDataWriter,t.doc.key,t.doc,new ks(g._snapshot.mutatedKeys.has(t.doc.key),g._snapshot.fromCache),g.query.converter);let n=-1,C=-1;return 0!==t.type&&(n=e.indexOf(t.doc.key),e=e.delete(t.doc.key)),1!==t.type&&(e=e.add(t.doc),C=e.indexOf(t.doc.key)),{type:Ns(t.type),doc:I,oldIndex:n,newIndex:C}}))}}(this,g),this._cachedChangesIncludeMetadataChanges=g),this._cachedChanges}}function Ns(g){switch(g){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Kt()}}class Ks extends vs{constructor(g){super(),this.firestore=g}convertBytes(g){return new ns(g)}convertReference(g){const t=this.convertDocumentKey(g,this.firestore._databaseId);return new Oo(this.firestore,null,t)}}function Fs(g,t,e){g=Do(g,Oo);const I=Do(g.firestore,ts),n=ds(I);let C;for(var i=arguments.length,l=new Array(i>3?i-3:0),o=3;o<i;o++)l[o-3]=arguments[o];return C="string"==typeof(t=E(t))||t instanceof Cs?ms(n,"updateDoc",g._key,t,e,l):hs(n,"updateDoc",g._key,t),Es(I,[C.toMutation(g._key,Kn.exists(!0))])}function Es(g,t){return function(g,t){const e=new Lt;return g.asyncQueue.enqueueAndForget((async()=>async function(g,t,e){const I=fo(g);try{const g=await function(g,t){const e=Et(g),I=te.now(),n=t.reduce(((g,t)=>g.add(t.key)),Zn());let C,i;return e.persistence.runTransaction("Locally write mutations","readwrite",(g=>{let l=sn(),o=Zn();return e.hs.getEntries(g,n).next((g=>{l=g,l.forEach(((g,t)=>{t.isValidDocument()||(o=o.add(g))}))})).next((()=>e.localDocuments.getOverlayedDocuments(g,l))).next((n=>{C=n;const i=[];for(const g of t){const t=Mn(g,C.get(g.key).overlayedDocument);null!=t&&i.push(new Qn(g.key,t,uI(t.value.mapValue),Kn.exists(!0)))}return e.mutationQueue.addMutationBatch(g,I,i,t)})).next((t=>{i=t;const I=t.applyToLocalDocumentSet(C,o);return e.documentOverlayCache.saveOverlays(g,t.batchId,I)}))})).then((()=>({batchId:i.batchId,changes:cn(C)})))}(I.localStore,t);I.sharedClientState.addPendingMutation(g.batchId),function(g,t,e){let I=g.qa[g.currentUser.toKey()];I||(I=new Ye($t)),I=I.insert(t,e),g.qa[g.currentUser.toKey()]=I}(I,g.batchId,e),await Vo(I,g.changes),await Vl(I.remoteStore)}catch(g){const t=Fl(g,"Failed to persist write");e.reject(t)}}(await Fo(g),t,e))),e.promise}(es(g),t)}new WeakMap;!function(g){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(g){Jt=g}(gt),Pg(new z("firestore",((g,e)=>{let{instanceIdentifier:I,options:n}=e;const C=g.getProvider("app").getImmediate(),i=new ts(new Qt(g.getProvider("auth-internal")),new Pt(g.getProvider("app-check-internal")),function(g,t){if(!Object.prototype.hasOwnProperty.apply(g.options,["projectId"]))throw new xt(zt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new je(g.options.projectId,t)}(C,I),C);return n=Object.assign({useFetchStreams:t},n),i._setSettings(n),i}),"PUBLIC").setMultipleInstances(!0)),It(ft,"4.7.5",g),It(ft,"4.7.5","esm2017")}();const zs="firebasestorage.googleapis.com",xs="storageBucket";class Ls extends H{constructor(g,t){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(Ds(g),`Firebase Storage: ${t} (${Ds(g)})`),this.status_=e,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Ls.prototype)}get status(){return this.status_}set status(g){this.status_=g}_codeEquals(g){return Ds(g)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(g){this.customData.serverResponse=g,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var Ms,Us,Ts,Qs;function Ds(g){return"storage/"+g}function _s(){return new Ls(Ms.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function js(){return new Ls(Ms.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Ps(){return new Ls(Ms.CANCELED,"User canceled the upload/download.")}function Os(g){return new Ls(Ms.INVALID_ARGUMENT,g)}function qs(){return new Ls(Ms.APP_DELETED,"The Firebase app was deleted.")}(Us=Ms||(Ms={})).UNKNOWN="unknown",Us.OBJECT_NOT_FOUND="object-not-found",Us.BUCKET_NOT_FOUND="bucket-not-found",Us.PROJECT_NOT_FOUND="project-not-found",Us.QUOTA_EXCEEDED="quota-exceeded",Us.UNAUTHENTICATED="unauthenticated",Us.UNAUTHORIZED="unauthorized",Us.UNAUTHORIZED_APP="unauthorized-app",Us.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",Us.INVALID_CHECKSUM="invalid-checksum",Us.CANCELED="canceled",Us.INVALID_EVENT_NAME="invalid-event-name",Us.INVALID_URL="invalid-url",Us.INVALID_DEFAULT_BUCKET="invalid-default-bucket",Us.NO_DEFAULT_BUCKET="no-default-bucket",Us.CANNOT_SLICE_BLOB="cannot-slice-blob",Us.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",Us.NO_DOWNLOAD_URL="no-download-url",Us.INVALID_ARGUMENT="invalid-argument",Us.INVALID_ARGUMENT_COUNT="invalid-argument-count",Us.APP_DELETED="app-deleted",Us.INVALID_ROOT_OPERATION="invalid-root-operation",Us.INVALID_FORMAT="invalid-format",Us.INTERNAL_ERROR="internal-error",Us.UNSUPPORTED_ENVIRONMENT="unsupported-environment";class $s{constructor(g,t){this.bucket=g,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const g=encodeURIComponent;return"/b/"+g(this.bucket)+"/o/"+g(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(g,t){let e;try{e=$s.makeFromUrl(g,t)}catch(n){return new $s(g,"")}if(""===e.path)return e;throw I=g,new Ls(Ms.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+I+"'.");var I}static makeFromUrl(g,t){let e=null;const I="([A-Za-z0-9.\\-_]+)";const n=new RegExp("^gs://"+I+"(/(.*))?$","i");function C(g){g.path_=decodeURIComponent(g.path)}const i=t.replace(/[.]/g,"\\."),l=[{regex:n,indices:{bucket:1,path:3},postModify:function(g){"/"===g.path.charAt(g.path.length-1)&&(g.path_=g.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${i}/v[A-Za-z0-9_]+/b/${I}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:C},{regex:new RegExp(`^https?://${t===zs?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${I}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:C}];for(let o=0;o<l.length;o++){const t=l[o],I=t.regex.exec(g);if(I){const g=I[t.indices.bucket];let n=I[t.indices.path];n||(n=""),e=new $s(g,n),t.postModify(e);break}}if(null==e)throw function(g){return new Ls(Ms.INVALID_URL,"Invalid URL '"+g+"'.")}(g);return e}}class ga{constructor(g){this.promise_=Promise.reject(g)}getPromise(){return this.promise_}cancel(){}}function ta(g,t,e,I){if(I<t)throw Os(`Invalid value for '${g}'. Expected ${t} or greater.`);if(I>e)throw Os(`Invalid value for '${g}'. Expected ${e} or less.`)}function ea(g){const t=encodeURIComponent;let e="?";for(const I in g)if(g.hasOwnProperty(I)){e=e+(t(I)+"="+t(g[I]))+"&"}return e=e.slice(0,-1),e}function Ia(g,t){const e=g>=500&&g<600,I=-1!==[408,429].indexOf(g),n=-1!==t.indexOf(g);return e||I||n}(Qs=Ts||(Ts={}))[Qs.NO_ERROR=0]="NO_ERROR",Qs[Qs.NETWORK_ERROR=1]="NETWORK_ERROR",Qs[Qs.ABORT=2]="ABORT";class na{constructor(g,t,e,I,n,C,i,l,o,s,a){let r=!(arguments.length>11&&void 0!==arguments[11])||arguments[11];this.url_=g,this.method_=t,this.headers_=e,this.body_=I,this.successCodes_=n,this.additionalRetryCodes_=C,this.callback_=i,this.errorCallback_=l,this.timeout_=o,this.progressCallback_=s,this.connectionFactory_=a,this.retry=r,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((g,t)=>{this.resolve_=g,this.reject_=t,this.start_()}))}start_(){const g=(g,t)=>{if(t)return void g(!1,new Ca(!1,null,!0));const e=this.connectionFactory_();this.pendingConnection_=e;const I=g=>{const t=g.loaded,e=g.lengthComputable?g.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,e)};null!==this.progressCallback_&&e.addUploadProgressListener(I),e.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&e.removeUploadProgressListener(I),this.pendingConnection_=null;const t=e.getErrorCode()===Ts.NO_ERROR,n=e.getStatus();if(!t||Ia(n,this.additionalRetryCodes_)&&this.retry){const t=e.getErrorCode()===Ts.ABORT;return void g(!1,new Ca(!1,null,t))}const C=-1!==this.successCodes_.indexOf(n);g(!0,new Ca(C,e))}))},t=(g,t)=>{const e=this.resolve_,I=this.reject_,n=t.connection;if(t.wasSuccessCode)try{const g=this.callback_(n,n.getResponse());void 0!==g?e(g):e()}catch(C){I(C)}else if(null!==n){const g=_s();g.serverResponse=n.getErrorText(),this.errorCallback_?I(this.errorCallback_(n,g)):I(g)}else if(t.canceled){I(this.appDelete_?qs():Ps())}else{I(js())}};this.canceled_?t(0,new Ca(!1,null,!0)):this.backoffId_=function(g,t,e){let I=1,n=null,C=null,i=!1,l=0;function o(){return 2===l}let s=!1;function a(){if(!s){s=!0;for(var g=arguments.length,e=new Array(g),I=0;I<g;I++)e[I]=arguments[I];t.apply(null,e)}}function r(t){n=setTimeout((()=>{n=null,g(A,o())}),t)}function c(){C&&clearTimeout(C)}function A(g){if(s)return void c();for(var t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];if(g)return c(),void a.call(null,g,...e);if(o()||i)return c(),void a.call(null,g,...e);let C;I<64&&(I*=2),1===l?(l=2,C=0):C=1e3*(I+Math.random()),r(C)}let d=!1;function u(g){d||(d=!0,c(),s||(null!==n?(g||(l=2),clearTimeout(n),r(0)):g||(l=1)))}return r(0),C=setTimeout((()=>{i=!0,u(!0)}),e),u}(g,t,this.timeout_)}getPromise(){return this.promise_}cancel(g){this.canceled_=!0,this.appDelete_=g||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class Ca{constructor(g,t,e){this.wasSuccessCode=g,this.connection=t,this.canceled=!!e}}function ia(g){const t=g.lastIndexOf("/",g.length-2);return-1===t?g:g.slice(t+1)}class la{constructor(g,t){this._service=g,this._location=t instanceof $s?t:$s.makeFromUrl(t,g.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(g,t){return new la(g,t)}get root(){const g=new $s(this._location.bucket,"");return this._newRef(this._service,g)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return ia(this._location.path)}get storage(){return this._service}get parent(){const g=function(g){if(0===g.length)return null;const t=g.lastIndexOf("/");return-1===t?"":g.slice(0,t)}(this._location.path);if(null===g)return null;const t=new $s(this._location.bucket,g);return new la(this._service,t)}_throwIfRoot(g){if(""===this._location.path)throw function(g){return new Ls(Ms.INVALID_ROOT_OPERATION,"The operation '"+g+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(g)}}function oa(g,t){const e=null===t||void 0===t?void 0:t[xs];return null==e?null:$s.makeFromBucketSpec(e,g)}class sa{constructor(g,t,e,I,n){this.app=g,this._authProvider=t,this._appCheckProvider=e,this._url=I,this._firebaseVersion=n,this._bucket=null,this._host=zs,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=I?$s.makeFromBucketSpec(I,this._host):oa(this._host,this.app.options)}get host(){return this._host}set host(g){this._host=g,null!=this._url?this._bucket=$s.makeFromBucketSpec(this._url,g):this._bucket=oa(g,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(g){ta("time",0,Number.POSITIVE_INFINITY,g),this._maxUploadRetryTime=g}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(g){ta("time",0,Number.POSITIVE_INFINITY,g),this._maxOperationRetryTime=g}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const g=this._authProvider.getImmediate({optional:!0});if(g){const t=await g.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const g=this._appCheckProvider.getImmediate({optional:!0});if(g){return(await g.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((g=>g.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(g){return new la(this,g)}_makeRequest(g,t,e,I){let n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._deleted)return new ga(qs());{const C=function(g,t,e,I,n,C){let i=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const l=ea(g.urlParams),o=g.url+l,s=Object.assign({},g.headers);return function(g,t){t&&(g["X-Firebase-GMPID"]=t)}(s,t),function(g,t){null!==t&&t.length>0&&(g.Authorization="Firebase "+t)}(s,e),function(g,t){g["X-Firebase-Storage-Version"]="webjs/"+(null!==t&&void 0!==t?t:"AppManager")}(s,C),function(g,t){null!==t&&(g["X-Firebase-AppCheck"]=t)}(s,I),new na(o,g.method,s,g.body,g.successCodes,g.additionalRetryCodes,g.handler,g.errorHandler,g.timeout,g.progressCallback,n,i)}(g,this._appId,e,I,t,this._firebaseVersion,n);return this._requests.add(C),C.getPromise().then((()=>this._requests.delete(C)),(()=>this._requests.delete(C))),C}}async makeRequestWithTokens(g,t){const[e,I]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(g,t,e,I).getPromise()}}const aa="@firebase/storage",ra="0.13.4",ca="storage";function Aa(g,t){let{instanceIdentifier:e}=t;const I=g.getProvider("app").getImmediate(),n=g.getProvider("auth-internal"),C=g.getProvider("app-check-internal");return new sa(I,n,C,e,gt)}Pg(new z(ca,Aa,"PUBLIC").setMultipleInstances(!0)),It(aa,ra,""),It(aa,ra,"esm2017");const da=tt({apiKey:"AIzaSyBzAkFZCALk96ngCmC9u6Wbns3IFoMVCPI",authDomain:"auto-wheel.firebaseapp.com",projectId:"auto-wheel",storageBucket:"auto-wheel.firebasestorage.app",messagingSenderId:"56170845456",appId:"1:56170845456:web:ddc0031ddc4e99414c0195"}),ua=function(g,t){const e="string"==typeof g?g:t||"(default)",I=Og("object"==typeof g?g:et(),"firestore").getImmediate({identifier:e});if(!I._initialized){const g=R("firestore");g&&function(g,t,e){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};var n;const C=(g=Do(g,jo))._getSettings(),i=`${t}:${e}`;if("firestore.googleapis.com"!==C.host&&C.host!==i&&wt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),g._setSettings(Object.assign(Object.assign({},C),{host:i,ssl:!1})),I.mockUserToken){let t,e;if("string"==typeof I.mockUserToken)t=I.mockUserToken,e=Xt.MOCK_USER;else{t=J(I.mockUserToken,null===(n=g._app)||void 0===n?void 0:n.options.projectId);const C=I.mockUserToken.sub||I.mockUserToken.user_id;if(!C)throw new xt(zt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");e=new Xt(C)}g._authCredentials=new Tt(new Mt(t,e))}}(I,...g)}return I}(da);!function(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:et(),t=arguments.length>1?arguments[1]:void 0;g=E(g);const e=Og(g,ca).getImmediate({identifier:t}),I=R("storage");I&&function(g,t,e){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};!function(g,t,e){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};g.host=`${t}:${e}`,g._protocol="http";const{mockUserToken:n}=I;n&&(g._overrideAuthToken="string"===typeof n?n:J(n,g.app.options.projectId))}(g,t,e,I)}(e,...I)}(da);const ha=(0,g.createContext)(null),ma=ha.Provider;function Za(){const t=(0,g.useContext)(ha);if(null==t)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return t}var ba=e(228),Ga=e.n(ba);function pa(){return pa=Object.assign||function(g){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var I in e)Object.prototype.hasOwnProperty.call(e,I)&&(g[I]=e[I])}return g},pa.apply(this,arguments)}function ya(t,e){let{bounds:I,boundsOptions:n,center:C,children:i,className:l,id:o,placeholder:s,style:a,whenReady:r,zoom:c,...A}=t;const[d]=(0,g.useState)({className:l,id:o,style:a}),[u,h]=(0,g.useState)(null);(0,g.useImperativeHandle)(e,(()=>u?.map??null),[u]);const m=(0,g.useCallback)((g=>{if(null!==g&&null===u){const t=new ba.Map(g,A);null!=C&&null!=c?t.setView(C,c):null!=I&&t.fitBounds(I,n),null!=r&&t.whenReady(r),h(function(g){return Object.freeze({__version:1,map:g})}(t))}}),[]);(0,g.useEffect)((()=>()=>{u?.map.remove()}),[u]);const Z=u?g.createElement(ma,{value:u},i):s??null;return g.createElement("div",pa({},d,{ref:m}),Z)}const Ba=(0,g.forwardRef)(ya);var Va=e(950);function Wa(g,t,e){return Object.freeze({instance:g,context:t,container:e})}function Sa(t,e){return null==e?function(e,I){const n=(0,g.useRef)();return n.current||(n.current=t(e,I)),n}:function(I,n){const C=(0,g.useRef)();C.current||(C.current=t(I,n));const i=(0,g.useRef)(I),{instance:l}=C.current;return(0,g.useEffect)((function(){i.current!==I&&(e(l,I,i.current),i.current=I)}),[l,I,n]),C}}function Ra(t,e){const I=(0,g.useRef)(e);(0,g.useEffect)((function(){e!==I.current&&null!=t.attributionControl&&(null!=I.current&&t.attributionControl.removeAttribution(I.current),null!=e&&t.attributionControl.addAttribution(e)),I.current=e}),[t,e])}function fa(t,e){const I=(0,g.useRef)();(0,g.useEffect)((function(){return null!=e&&t.instance.on(e),I.current=e,function(){null!=I.current&&t.instance.off(I.current),I.current=null}}),[t,e])}function Xa(g,t){const e=g.pane??t.pane;return e?{...g,pane:e}:g}function Ja(t){return function(e){const I=Za(),n=t(Xa(e,I),I);return Ra(I.map,e.attribution),fa(n.current,e.eventHandlers),function(t,e){(0,g.useEffect)((function(){return(e.layerContainer??e.map).addLayer(t.instance),function(){e.layerContainer?.removeLayer(t.instance),e.map.removeLayer(t.instance)}}),[e,t])}(n.current,I),n}}const va=function(t){function e(e,I){const{instance:n}=t(e).current;return(0,g.useImperativeHandle)(I,(()=>n)),null}return(0,g.forwardRef)(e)}(Ja(Sa((function(g,t){let{url:e,...I}=g;return Wa(new ba.TileLayer(e,Xa(I,t)),t)}),(function(g,t,e){!function(g,t,e){const{opacity:I,zIndex:n}=t;null!=I&&I!==e.opacity&&g.setOpacity(I),null!=n&&n!==e.zIndex&&g.setZIndex(n)}(g,t,e);const{url:I}=t;null!=I&&I!==e.url&&g.setUrl(I)}))));const ka=function(t,e){return function(t){function e(e,I){const{instance:n,context:C}=t(e).current;return(0,g.useImperativeHandle)(I,(()=>n)),null==e.children?null:g.createElement(ma,{value:C},e.children)}return(0,g.forwardRef)(e)}(Ja(Sa(t,e)))}((function(g,t){let{position:e,...I}=g;const n=new ba.Marker(e,I);return Wa(n,(C=t,i={overlayContainer:n},Object.freeze({...C,...i})));var C,i}),(function(g,t,e){t.position!==e.position&&g.setLatLng(t.position),null!=t.icon&&t.icon!==e.icon&&g.setIcon(t.icon),null!=t.zIndexOffset&&t.zIndexOffset!==e.zIndexOffset&&g.setZIndexOffset(t.zIndexOffset),null!=t.opacity&&t.opacity!==e.opacity&&g.setOpacity(t.opacity),null!=g.dragging&&t.draggable!==e.draggable&&(!0===t.draggable?g.dragging.enable():g.dragging.disable())})),Ya=function(t,e){const I=function(g,t){return function(e,I){const n=Za(),C=g(Xa(e,n),n);return Ra(n.map,e.attribution),fa(C.current,e.eventHandlers),t(C.current,n,e,I),C}}(Sa(t),e);return function(t){function e(e,I){const[n,C]=(0,g.useState)(!1),{instance:i}=t(e,C).current;(0,g.useImperativeHandle)(I,(()=>i)),(0,g.useEffect)((function(){n&&i.update()}),[i,n,e.children]);const l=i._contentNode;return l?(0,Va.createPortal)(e.children,l):null}return(0,g.forwardRef)(e)}(I)}((function(g,t){return Wa(new ba.Popup(g,t.overlayContainer),t)}),(function(t,e,I,n){let{position:C}=I;(0,g.useEffect)((function(){const{instance:g}=t;function I(t){t.popup===g&&(g.update(),n(!0))}function i(t){t.popup===g&&n(!1)}return e.map.on({popupopen:I,popupclose:i}),null==e.overlayContainer?(null!=C&&g.setLatLng(C),g.openOn(e.map)):e.overlayContainer.bindPopup(g),function(){e.map.off({popupopen:I,popupclose:i}),e.overlayContainer?.unbindPopup(),e.map.removeLayer(g)}}),[t,e,n,C])}));delete Ga().Icon.Default.prototype._getIconUrl,Ga().Icon.Default.mergeOptions({iconRetinaUrl:e(249),iconUrl:e(24),shadowUrl:e(71)});const Ha=function(g){let{wheelchair:t}=g;const e=[35.214,-80.9431];return(0,A.jsxs)(Ba,{center:e,zoom:15,style:{height:"400px",width:"100%"},children:[(0,A.jsx)(va,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),t&&(0,A.jsx)(ka,{position:e,children:(0,A.jsxs)(Ya,{children:[(0,A.jsx)("strong",{children:t.name}),(0,A.jsx)("br",{}),"Status: ",t.status,(0,A.jsx)("br",{}),"Battery: ",t.battery,"%"]})})]})};var wa=e(309),Na=e.n(wa);const Ka=t=>{let{onScan:e}=t;const[I,n]=(0,g.useState)(null);return(0,A.jsx)("div",{className:"p-4",children:(0,A.jsx)(d,{children:(0,A.jsxs)(h,{className:"p-4",children:[(0,A.jsx)("div",{className:"aspect-square relative overflow-hidden rounded-lg",children:(0,A.jsx)(Na(),{delay:300,onError:g=>{console.error(g),n("Error accessing camera. Please make sure you have granted camera permissions.")},onScan:g=>{g&&e(g.text)},constraints:{video:{facingMode:{exact:"environment"}}},style:{width:"100%"}})}),I&&(0,A.jsx)("p",{className:"text-red-500 text-sm mt-2",children:I}),(0,A.jsx)("p",{className:"text-center text-gray-500 text-sm mt-4",children:"Position the QR code within the frame to scan"})]})})})};var Fa=e(970);const Ea={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_OPENAI_API_KEY,za=()=>{const[t,e]=(0,g.useState)("map"),[I,n]=(0,g.useState)(null),[C,i]=(0,g.useState)(0),[u,G]=(0,g.useState)(!1),[p,y]=(0,g.useState)([]),[B,V]=(0,g.useState)(!1),[W,S]=(0,g.useState)(!1),[R,f]=(0,g.useState)(!1),X=t=>{let{onClose:e}=t;const[I,n]=(0,g.useState)([{role:"assistant",content:"Hello! I am your automated wheelchair assistant. I can help you with navigating the airport and using the wheelchair. How can I assist you today?"}]),[C,i]=(0,g.useState)(""),[o,s]=(0,g.useState)(!1),a=(0,g.useRef)(null),r=(0,g.useRef)(null);(0,g.useEffect)((()=>{(()=>{var g;null===(g=a.current)||void 0===g||g.scrollIntoView({behavior:"smooth"})})()}),[I]),(0,g.useEffect)((()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="unset"})),[]);const c=async()=>{if(!C.trim())return;const g={role:"user",content:C};n((t=>[...t,g])),i(""),s(!0);try{const t=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Ea}`},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"You are an airport wheelchair assistance specialist. Your role is to help passengers use automated wheelchairs and navigate the airport efficiently. You should provide clear, concise information about:\n                  - How to operate the automated wheelchair\n                  - Navigation within the airport\n                  - Safety guidelines\n                  - Location of facilities\n                  - General airport assistance\n                  Always maintain a helpful, professional tone and prioritize user safety and comfort."},...I.map((g=>({role:g.role,content:g.content}))),g],stream:!0})});if(!t.ok)throw new Error(t.statusText);const e=t.body.getReader(),C=new TextDecoder("utf-8");let i="";for(;;){const{done:g,value:t}=await e.read();if(g)break;const I=C.decode(t),l=I.split("\n").map((g=>g.replace(/^data: /,"").trim())).filter((g=>""!==g&&"[DONE]"!==g)).map((g=>JSON.parse(g)));for(const e of l)e.choices[0].delta.content&&(i+=e.choices[0].delta.content,n((g=>[...g.slice(0,-1),{role:"assistant",content:i}])))}}catch(e){console.error("Error sending message:",e),n((g=>[...g,{role:"assistant",content:"I apologize, but I encountered an error. Please try again."}]))}finally{var t;s(!1),null===(t=r.current)||void 0===t||t.focus()}};return(0,A.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{position:"fixed",height:"100vh",height:"-webkit-fill-available",touchAction:"none"},children:(0,A.jsx)(d,{className:"w-full max-w-sm h-[600px] flex flex-col",children:(0,A.jsxs)(h,{className:"p-4 flex flex-col h-full relative",children:[(0,A.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,A.jsx)("h3",{className:"text-lg font-semibold",children:"Ride Assistant"}),(0,A.jsx)("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 p-2",children:"\u2715"})]}),(0,A.jsxs)("div",{className:"flex-1 overflow-y-auto mb-4 p-4 space-y-4 bg-gray-50 rounded-lg",children:[I.map(((g,t)=>(0,A.jsx)("div",{className:"flex "+("user"===g.role?"justify-end":"justify-start"),children:(0,A.jsx)("div",{className:"max-w-[80%] rounded-lg px-4 py-2 "+("user"===g.role?"bg-green-500 text-white rounded-br-none":"bg-blue-500 text-white rounded-bl-none"),children:g.content})},t))),o&&(0,A.jsx)("div",{className:"flex justify-start",children:(0,A.jsx)("div",{className:"bg-blue-500 text-white rounded-lg rounded-bl-none px-4 py-2",children:"typing..."})}),(0,A.jsx)("div",{ref:a})]}),(0,A.jsxs)("div",{className:"flex gap-2 bg-white p-2 rounded-lg border relative",children:[(0,A.jsx)("textarea",{ref:r,value:C,onChange:g=>i(g.target.value),onKeyPress:g=>{"Enter"!==g.key||g.shiftKey||(g.preventDefault(),c())},placeholder:"Type your message...",className:"flex-1 p-2 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"2",style:{minHeight:"50px",maxHeight:"100px",WebkitUserSelect:"text",WebkitTouchCallout:"none",touchAction:"manipulation",caretColor:"auto"},autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onFocus:g=>{window.scrollTo(0,0),document.body.scrollTop=0}}),(0,A.jsx)("button",{onClick:c,disabled:o||!C.trim(),className:"px-4 rounded-lg flex items-center justify-center "+(o||!C.trim()?"bg-gray-300":"bg-blue-500 hover:bg-blue-600"),children:(0,A.jsx)(l,{className:"h-5 w-5 text-white"})})]})]})})})};(0,g.useEffect)((()=>{(async()=>{const g=function(g,t){for(var e=arguments.length,I=new Array(e>2?e-2:0),n=2;n<e;n++)I[n-2]=arguments[n];if(g=E(g),Mo("collection","path",t),g instanceof jo){const e=ne.fromString(t,...I);return To(e),new qo(g,null,e)}{if(!(g instanceof Oo||g instanceof qo))throw new xt(zt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const e=g._path.child(ne.fromString(t,...I));return To(e),new qo(g.firestore,null,e)}}(ua,"wheelchairs"),t=(await function(g){g=Do(g,Po);const t=Do(g.firestore,ts),e=es(t),I=new Ks(t);return Js(g._query),zo(e,g._query).then((e=>new ws(t,I,g,e)))}(g)).docs.map((g=>({id:g.id,...g.data()})));y(t)})()}),[]),(0,g.useEffect)((()=>{let g;return B&&(g=setInterval((()=>{i((g=>g+1))}),1e3)),()=>clearInterval(g)}),[B]);const J=async()=>{if(I){const t=$o(ua,"wheelchairs",I.id);try{const g=`wheelchair:${I.id}`,n=await Fa.toDataURL(g);await Fs(t,{status:"in_use",qrCode:n}),G(!0),setTimeout((()=>{G(!1),e("active")}),2e3)}catch(g){console.error("Error generating QR code:",g),alert("Failed to confirm booking. Please try again.")}}},v=()=>{e("scanner")},k=async()=>{if(I){const t=$o(ua,"wheelchairs",I.id);try{await Fs(t,{status:"available"}),V(!1),i(0),e("map"),n(null),f(!1)}catch(g){console.error("Error ending ride:",g),alert("Failed to end ride. Please try again.")}}},Y=()=>(0,A.jsxs)("div",{className:"p-4 space-y-4",children:[(0,A.jsx)(d,{children:(0,A.jsx)(h,{className:"p-4",children:(0,A.jsxs)("div",{className:"flex items-center justify-between",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("h3",{className:"font-semibold",children:"Current Location"}),(0,A.jsx)("p",{className:"text-sm text-gray-500",children:"Terminal 1 - Main Entrance"})]}),(0,A.jsx)(o,{className:"text-blue-500"})]})})}),(0,A.jsxs)("div",{className:"space-y-2",children:[(0,A.jsx)("h2",{className:"text-lg font-semibold",children:"Available Wheelchairs"}),p.map((g=>(0,A.jsx)(d,{className:"cursor-pointer hover:shadow-md transition-shadow "+("in_use"===g.status?"opacity-50":""),onClick:()=>{"available"===g.status&&(n(g),e("booking"))},children:(0,A.jsx)(h,{className:"p-4",children:(0,A.jsxs)("div",{className:"flex justify-between items-start",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("h3",{className:"font-medium",children:g.id}),(0,A.jsx)("p",{className:"text-sm text-gray-500",children:g.location}),(0,A.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:g.distance})]}),(0,A.jsxs)("div",{className:"flex flex-col items-end",children:[(0,A.jsxs)("div",{className:"flex items-center gap-1",children:[(0,A.jsx)(s,{className:"text-green-500",size:18}),(0,A.jsxs)("span",{className:"text-sm text-gray-600",children:[g.battery,"%"]})]}),(0,A.jsx)("span",{className:"text-xs mt-1 "+("available"===g.status?"text-green-500":"text-red-500"),children:"available"===g.status?"Available":"In Use"})]})]})})},g.id)))]})]}),H=()=>(0,A.jsx)("div",{className:"p-4 space-y-4",children:(0,A.jsx)(d,{children:(0,A.jsxs)(h,{className:"p-4",children:[(0,A.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Confirm Booking"}),I&&(0,A.jsx)(Ha,{wheelchair:{name:I.id,status:I.status,distance:I.distance,estimatedTime:I.estimatedTime||"N/A",battery:I.battery}}),(0,A.jsxs)("div",{className:"space-y-4 mt-4",children:[(0,A.jsxs)("div",{className:"flex justify-between items-center",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("h3",{className:"font-medium",children:null===I||void 0===I?void 0:I.id}),(0,A.jsx)("p",{className:"text-sm text-gray-500",children:null===I||void 0===I?void 0:I.location})]}),(0,A.jsxs)("div",{className:"flex items-center gap-1",children:[(0,A.jsx)(s,{className:"text-green-500",size:18}),(0,A.jsxs)("span",{className:"text-sm text-gray-600",children:[null===I||void 0===I?void 0:I.battery,"%"]})]})]}),(0,A.jsxs)(m,{children:[(0,A.jsx)(a,{className:"h-4 w-4"}),(0,A.jsx)(Z,{children:"Important"}),(0,A.jsx)(b,{children:"Please ensure you've read the usage instructions on the wheelchair before proceeding."})]}),(0,A.jsx)("button",{onClick:J,className:"w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600",children:"Confirm Booking"}),(0,A.jsx)("button",{onClick:()=>{e("map"),n(null)},className:"w-full border border-gray-300 py-3 rounded-lg",children:"Cancel"})]})]})})}),w=()=>{return(0,A.jsxs)("div",{className:"p-4 space-y-4",children:[(0,A.jsx)(d,{children:(0,A.jsxs)(h,{className:"p-4",children:[(0,A.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Active Booking"}),(0,A.jsxs)("div",{className:"space-y-4",children:[(0,A.jsxs)("div",{className:"flex justify-between items-center",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("h3",{className:"font-medium",children:I.id}),(0,A.jsx)("p",{className:"text-sm text-gray-500",children:I.location})]}),(0,A.jsxs)("div",{className:"flex flex-col items-end gap-1",children:[(0,A.jsxs)("div",{className:"flex items-center gap-1",children:[(0,A.jsx)(r,{className:"text-blue-500",size:18}),(0,A.jsx)("span",{className:"text-sm text-gray-600",children:(g=C,`${Math.floor(g/60)}:${(g%60).toString().padStart(2,"0")}`)})]}),(0,A.jsxs)("div",{className:"flex items-center gap-1",children:[(0,A.jsx)(s,{className:"text-green-500",size:18}),(0,A.jsxs)("span",{className:"text-sm text-gray-600",children:[I.battery,"%"]})]})]})]}),B?null:(0,A.jsx)("button",{onClick:v,className:"w-full bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 mb-2",children:"Begin Ride"}),B&&(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("button",{onClick:()=>f(!0),className:"w-full bg-red-500 text-white py-3 rounded-lg hover:bg-red-600 mb-2",children:"End Ride"}),(0,A.jsx)("button",{onClick:()=>S(!0),className:"w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600",children:"Ride Assistant"})]}),(0,A.jsxs)(m,{children:[(0,A.jsx)(a,{className:"h-4 w-4"}),(0,A.jsx)(Z,{children:"Need Help?"}),(0,A.jsx)(b,{children:"Call support at 1-800-HELP for immediate assistance."})]})]})]})}),R&&(0,A.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",children:(0,A.jsx)(d,{className:"w-full max-w-sm",children:(0,A.jsxs)(h,{className:"p-4",children:[(0,A.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"End Ride?"}),(0,A.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Are you sure you want to end your ride?"}),(0,A.jsxs)("div",{className:"space-y-2",children:[(0,A.jsx)("button",{onClick:k,className:"w-full bg-red-500 text-white py-2 rounded-lg hover:bg-red-600",children:"Yes, End Ride"}),(0,A.jsx)("button",{onClick:()=>f(!1),className:"w-full border border-gray-300 py-2 rounded-lg",children:"Cancel"})]})]})})}),W&&(0,A.jsx)(X,{onClose:()=>S(!1)})]});var g};return(0,A.jsxs)("div",{className:"max-w-md mx-auto min-h-screen bg-gray-50",children:[(0,A.jsx)("div",{className:"bg-white border-b px-4 py-3",children:(0,A.jsx)("h1",{className:"text-xl font-bold text-center",children:"Ridely"})}),"map"===t&&(0,A.jsx)(Y,{}),"scanner"===t&&(0,A.jsx)(Ka,{onScan:g=>{g&&(V(!0),e("active"),G(!0),setTimeout((()=>G(!1)),2e3))}}),"booking"===t&&(0,A.jsx)(H,{}),"active"===t&&(0,A.jsx)(w,{}),u&&(0,A.jsxs)("div",{className:"fixed bottom-4 left-4 right-4 bg-green-500 text-white p-4 rounded-lg flex items-center gap-2",children:[(0,A.jsx)(c,{size:20}),(0,A.jsx)("span",{children:B?"Ride started successfully!":"Booking confirmed successfully!"})]})]})},xa=()=>(0,A.jsx)("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:(0,A.jsx)(za,{})}),La=g=>{g&&g instanceof Function&&e.e(453).then(e.bind(e,453)).then((t=>{let{getCLS:e,getFID:I,getFCP:n,getLCP:C,getTTFB:i}=t;e(g),I(g),n(g),C(g),i(g)}))};t.createRoot(document.getElementById("root")).render((0,A.jsx)(g.StrictMode,{children:(0,A.jsx)(xa,{})})),La()})()})();
//# sourceMappingURL=main.28410da4.js.map